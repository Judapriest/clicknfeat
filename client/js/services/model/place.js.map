{"version":3,"sources":["../../../es6/services/model/place.js"],"names":[],"mappings":"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","file":"place.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('modelPlace', [\n    'point',\n    function modelPlaceServiceFactory(pointService) {\n      var PLACE_EPSILON = 0.1;\n      return function(MOVES, modelService) {\n        var modelPlaceService = {\n          startPlace: function modelStartPlace(model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            model.state = R.assoc('pla', {\n              s: R.pick(['x','y','r'], model.state)\n            }, model.state);\n            return model;\n          },\n          isPlacing: function modelIsPlarging(model) {\n            return R.exists(model.state.pla);\n          },\n          endPlace: function modelEndPlace(model) {\n            model.state = R.assoc('pla', null, model.state);\n            return model;\n          },\n          setPlaceOrigin: function modelSetPlaceOrigin(factions, other, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var direction = pointService.directionTo(model.state.pla.s, other.state);\n            model.state = R.pipe(\n              pointService.rotateAroundTo$(direction, model.state.pla.s),\n              R.assocPath(['pla','s','r'], direction)\n            )(model.state);\n            return modelService.checkState(factions, null, model);\n          },\n          setPlaceTarget: function modelSetPlaceTarget(factions, other, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var direction = pointService.directionTo(other.state, model.state.pla.s);\n            model.state = R.pipe(\n              pointService.rotateAroundTo$(direction, model.state.pla.s),\n              R.assocPath(['pla','s','r'], direction)\n            )(model.state);\n            return modelService.checkState(factions, null, model);\n          },\n          placeMaxLength: function modelPlaceMaxLength(model) {\n            return R.head(R.path(['state','pml'], model));\n          },\n          setPlaceMaxLength: function modelSetPlaceMaxLength(factions, value, model) {\n            model.state = R.assoc('pml', [ value, model.state.pml[1] ], model.state);\n            return modelService.checkState(factions, null, model);\n          },\n          placeWithin: function modelPlaceWithin(model) {\n            return R.nth(1, R.defaultTo([], R.path(['state','pml'], model)));\n          },\n          setPlaceWithin: function modelSetPlaceWithin(factions, value, model) {\n            model.state = R.assoc('pml', [ model.state.pml[0], value ], model.state);\n            return modelService.checkState(factions, null, model);\n          },\n          moveFrontPlace: function modelMoveFrontPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var dist = MOVES[small ? 'MoveSmall' : 'Move'];\n            var direction = model.state.pla.s.r;\n            model.state = pointService.translateInDirection$(dist, direction, model.state);\n            return modelService.checkState(factions, null, model);\n          },\n          moveBackPlace: function modelMoveBackPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var dist = MOVES[small ? 'MoveSmall' : 'Move'];\n            var direction = model.state.pla.s.r+180;\n            var distance = pointService.distanceTo(model.state, model.state.pla.s);\n            if(dist > distance) dist = distance;\n            model.state = pointService.translateInDirection$(dist, direction, model.state);\n            return modelService.checkState(factions, null, model);\n          },\n          rotateLeftPlace: function modelRotateLeftPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var angle = MOVES[small ? 'RotateChargeSmall' : 'RotateCharge'];\n            model.state = R.pipe(\n              pointService.rotateLeftAround$(angle, model.state.pla.s),\n              R.assocPath(['pla','s','r'], model.state.pla.s.r - angle)\n            )(model.state);\n            return modelService.checkState(factions, null, model);\n          },\n          rotateRightPlace: function modelRotateRightPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var angle = MOVES[small ? 'RotateChargeSmall' : 'RotateCharge'];\n            model.state = R.pipe( \n              pointService.rotateRightAround$(angle, model.state.pla.s),\n              R.assocPath(['pla','s','r'], model.state.pla.s.r + angle)\n            )(model.state);\n            return modelService.checkState(factions, null, model);\n          },\n          shiftLeftPlace: function modelShiftLeftPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n            model.state = pointService.shiftLeft(dist, model.state);\n            return modelService.checkState(factions, null, model);\n          },\n          shiftRightPlace: function modelShiftRightPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n            model.state = pointService.shiftRight(dist, model.state);\n            return modelService.checkState(factions, null, model);\n          },\n          shiftUpPlace: function modelShiftUpPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n            model.state = pointService.shiftUp(dist, model.state);\n            return modelService.checkState(factions, null, model);\n          },\n          shiftDownPlace: function modelShiftDownPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n            model.state = pointService.shiftDown(dist, model.state);\n            return modelService.checkState(factions, null, model);\n          },\n        };\n        var ensurePlaceLength = R.curry(function _ensurePlaceLength(info, target, state) {\n          if(R.exists(state.pla) &&\n             R.exists(state.pml) &&\n             state.pml[0] > 0) {\n            var distance = pointService.distanceTo(state, state.pla.s);\n            var max_dist = state.pml[0] * 10 + (state.pml[1] ? info.base_radius * 2 : 0);\n            if(distance > max_dist) {\n              var direction = pointService.directionTo(state, state.pla.s);\n              var position = pointService.translateInDirection(max_dist, direction,\n                                                               state.pla.s);\n              return R.pipe(\n                R.assoc('x', position.x),\n                R.assoc('y', position.y)\n              )(state);\n            }\n          }\n          return state;\n        });\n        modelService.state_checkers = R.append(ensurePlaceLength, modelService.state_checkers);\n        \n        var updatePlaceDirection = R.curry(function _updatePlaceDirection(state) {\n          if(R.exists(state.pla)) {\n            var distance = pointService.distanceTo(state, state.pla.s);\n            if(distance > PLACE_EPSILON) {\n              var direction = pointService.directionTo(state, state.pla.s);\n              return R.assocPath(['pla','s','r'], direction, state);\n            }\n          }\n          return state;\n        });\n        modelService.state_updaters = R.append(updatePlaceDirection, modelService.state_updaters);\n\n        return modelPlaceService;\n      };\n    }\n  ]);\n"]}