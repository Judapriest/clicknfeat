{"version":3,"sources":["../../../es6/services/command/deleteModel.js"],"names":[],"mappings":"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","file":"deleteModel.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('deleteModelCommand', [\n    'commands',\n    'model',\n    'gameModels',\n    'gameModelSelection',\n    function deleteModelCommandServiceFactory(commandsService,\n                                              modelService,\n                                              gameModelsService,\n                                              gameModelSelectionService) {\n      var deleteModelCommandService = {\n        execute: function deleteModelExecute(stamps, scope, game) {\n          return R.pipeP(\n            function(stamps) {\n              return gameModelsService.findAnyStamps(stamps, game.models);\n            },\n            R.spy('find any'),\n            R.reject(R.isNil),\n            R.spy('not nil'),\n            R.map(modelService.saveState),\n            R.spy('save'),\n            function(states) {\n              var ctxt = {\n                models: states,\n                desc: '',\n              };\n              return R.pipe(\n                gameModelsService.removeStamps$(stamps),\n                function(game_models) {\n                  game.models = game_models;\n\n                  return gameModelSelectionService\n                    .removeFrom('local', stamps, scope, game.model_selection);\n                },\n                gameModelSelectionService.removeFrom$('remote', stamps, scope),\n                function(selection) {\n                  game.model_selection = selection;\n                  \n                  scope.gameEvent('createModel');\n                  return ctxt;\n                }\n              )(game.models);\n            }\n          )(stamps);\n        },\n        replay: function deleteModelReplay(ctxt, scope, game) {\n          return R.pipe(\n            R.map(R.prop('stamp')),\n            function(stamps) {\n              return R.pipe(\n                function() {\n                  return gameModelsService.removeStamps(stamps, game.models);\n                },\n                function(game_models) {\n                  game.models = game_models;\n\n                  return gameModelSelectionService\n                    .removeFrom('local', stamps, scope, game.model_selection);\n                },\n                gameModelSelectionService.removeFrom$('remote', stamps, scope),\n                function(selection) {\n                  game.model_selection = selection;\n                  \n                  scope.gameEvent('createModel');\n                }\n              )();\n            }\n          )(ctxt.models);\n        },\n        undo: function deleteModelUndo(ctxt, scope, game) {\n          return R.pipeP(\n            R.bind(self.Promise.resolve, self.Promise),\n            R.map(function(model) {\n              return modelService.create(scope.factions, model)\n                .catch(R.always(null));\n            }),\n            R.bind(self.Promise.all, self.Promise),\n            R.reject(R.isNil),\n            function(models) {\n              if(R.isEmpty(models)) {\n                return self.Promise.reject('No valid model definition');\n              }\n              \n              return R.pipe(\n                gameModelsService.add$(models),\n                function(game_models) {\n                  game.models = game_models;\n\n                  var stamps = R.map(R.path(['state','stamp']), models);\n                  return gameModelSelectionService\n                    .set('remote', stamps, scope, game.model_selection);\n                },\n                function(selection) {\n                  game.model_selection = selection;\n                  \n                  scope.gameEvent('createModel');\n                }\n              )(game.models);\n            }\n          )(ctxt.models);\n        }\n      };\n      commandsService.registerCommand('deleteModel', deleteModelCommandService);\n      return deleteModelCommandService;\n    }\n  ]);\n"]}