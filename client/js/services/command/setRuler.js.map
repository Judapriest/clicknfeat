{"version":3,"sources":["../../../es6/services/command/setRuler.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,OAAO,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAChC,OAAO,CAAC,iBAAiB,EAAE,CAC1B,UAAU,EACV,WAAW,EACX,SAAS,6BAA6B,CAAC,eAAe,EACf,gBAAgB,EAAE;AACvD,MAAI,sBAAsB,GAAG;AAC3B,WAAO,EAAE,SAAS,eAAe,CAAC,oCAAM,EAAgC;AACtE,UAAG,UAAU,KAAK,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,EAAE;AAClD,eAAO,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,uBAAuB,GAAC,MAAM,CAAC,CAAC;OAC5D;;AAED,UAAI,IAAI,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;AACjD,UAAI,IAAI,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACxB,UAAI,IAAI,GAAG;AACT,cAAM,EAAE,EAAE;AACV,aAAK,EAAE,EAAE;AACT,YAAI,EAAE,MAAM;OACb,CAAC;AACF,UAAI,GAAG,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;;AAElD,aAAO,CAAC,CAAC,KAAK,CACZ,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,EAC1C,YAAW;AACT,eAAO,gBAAgB,CAAC,eAAe,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;OACrD,EACD,UAAS,MAAM,EAAE;AACf,YAAI,CAAC,MAAM,GAAG,MAAM,CAAC;;AAErB,eAAO,gBAAgB,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;OACnD,EACD,UAAS,KAAK,EAAE;AACd,YAAI,CAAC,KAAK,GAAG,KAAK,CAAC;;AAEnB,eAAO,gBAAgB,CAAC,eAAe,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;OACrD,EACD,UAAS,KAAK,EAAE;AACd,YAAI,CAAC,KAAK,GAAG,KAAK,CAAC;AACnB,eAAO,IAAI,CAAC;OACb,CACF,EAAE,CAAC;KACL;AACD,UAAM,EAAE,SAAS,YAAY,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE;AAC/C,UAAI,CAAC,KAAK,GAAG,gBAAgB,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;KAC1E;AACD,QAAI,EAAE,SAAS,YAAY,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE;AAC7C,UAAI,CAAC,KAAK,GAAG,gBAAgB,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;KAC3E;GACF,CAAC;AACF,iBAAe,CAAC,eAAe,CAAC,UAAU,EAAE,sBAAsB,CAAC,CAAC;AACpE,SAAO,sBAAsB,CAAC;CAC/B,CACF,CAAC,CAAC","file":"setRuler.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('setRulerCommand', [\n    'commands',\n    'gameRuler',\n    function setRulerCommandServiceFactory(commandsService,\n                                           gameRulerService) {\n      var setRulerCommandService = {\n        execute: function setRulerExecute(method /* ...args..., scope, game */) {\n          if('Function' !== R.type(gameRulerService[method])) {\n            return self.Promise.reject('Ruler unknown method '+method);\n          }\n\n          var args = Array.prototype.slice.call(arguments);\n          var game = R.last(args);\n          var ctxt = {\n            before: [],\n            after: [],\n            desc: method,\n          };\n          args = R.append(game.ruler, R.slice(1, -1, args));\n\n          return R.pipeP(\n            R.bind(self.Promise.resolve, self.Promise),\n            function() {\n              return gameRulerService.saveRemoteState(game.ruler);\n            },\n            function(before) {\n              ctxt.before = before;\n              \n              return gameRulerService[method].apply(null, args);\n            },\n            function(ruler) {\n              game.ruler = ruler;\n              \n              return gameRulerService.saveRemoteState(game.ruler);\n            },\n            function(after) {\n              ctxt.after = after;\n              return ctxt;\n            }\n          )();\n        },\n        replay: function setRulerRedo(ctxt, scope, game) {\n          game.ruler = gameRulerService.resetRemote(ctxt.after, scope, game.ruler);\n        },\n        undo: function setRulerUndo(ctxt, scope, game) {\n          game.ruler = gameRulerService.resetRemote(ctxt.before, scope, game.ruler);\n        }\n      };\n      commandsService.registerCommand('setRuler', setRulerCommandService);\n      return setRulerCommandService;\n    }\n  ]);\n"]}