{"version":3,"sources":["../../../es6/services/command/createTemplate.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,OAAO,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAChC,OAAO,CAAC,uBAAuB,EAAE,CAChC,UAAU,EACV,UAAU,EACV,eAAe,EACf,uBAAuB,EACvB,SAAS,mCAAmC,CAAC,eAAe,EACf,eAAe,EACf,oBAAoB,EACpB,4BAA4B,EAAE;AACzE,MAAI,4BAA4B,GAAG;AACjC,WAAO,EAAE,SAAS,qBAAqB,CAAC,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE;AAC1D,aAAO,CAAC,CAAC,KAAK,CACZ,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,EAC1C,CAAC,CAAC,GAAG,CAAC,UAAS,IAAI,EAAE;AACnB,eAAO,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,CAChC,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;OAC1B,CAAC,EACF,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,IAAI,CAAC,OAAO,CAAC,EACtC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,EACjB,UAAS,SAAS,EAAE;AAClB,YAAG,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;AACvB,iBAAO,CAAC,GAAG,CAAC,uDAAuD,CAAC,CAAC;AACrE,iBAAO,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,8BAA8B,CAAC,CAAC;SAC5D;AACD,eAAO,SAAS,CAAC;OAClB,EACD,UAAS,SAAS,EAAE;AAClB,YAAI,IAAI,GAAG;AACT,mBAAS,EAAE,CAAC,CAAC,GAAG,CAAC,eAAe,CAAC,SAAS,EAAE,SAAS,CAAC;AACtD,cAAI,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI;SACxB,CAAC;;AAEF,eAAO,CAAC,CAAC,IAAI,CACX,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,EACpC,UAAS,cAAc,EAAE;AACvB,cAAI,CAAC,SAAS,GAAG,cAAc,CAAC;;AAEhC,iBAAO,4BAA4B,CAChC,GAAG,CAAC,OAAO,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,EAAC,OAAO,CAAC,CAAC,EAAE,SAAS,CAAC,EACpD,KAAK,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;SACxC,EACD,UAAS,SAAS,EAAE;AAClB,cAAI,CAAC,kBAAkB,GAAG,SAAS,CAAC;;AAEpC,eAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC;AAClC,iBAAO,IAAI,CAAC;SACb,CACF,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;OACnB,CACF,CAAC,KAAK,CAAC,CAAC;KACV;AACD,UAAM,EAAE,SAAS,oBAAoB,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE;AACvD,aAAO,CAAC,CAAC,KAAK,CACZ,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,EAC1C,CAAC,CAAC,GAAG,CAAC,UAAS,IAAI,EAAE;AACnB,eAAO,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,CAChC,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;OAC1B,CAAC,EACF,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,IAAI,CAAC,OAAO,CAAC,EACtC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,EACjB,UAAS,SAAS,EAAE;AAClB,YAAG,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;AACvB,iBAAO,CAAC,GAAG,CAAC,uDAAuD,CAAC,CAAC;AACrE,iBAAO,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,8BAA8B,CAAC,CAAC;SAC5D;AACD,eAAO,SAAS,CAAC;OAClB,EACD,UAAS,SAAS,EAAE;AAClB,eAAO,CAAC,CAAC,IAAI,CACX,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,EACpC,UAAS,cAAc,EAAE;AACvB,cAAI,CAAC,SAAS,GAAG,cAAc,CAAC;;AAEhC,iBAAO,4BAA4B,CAChC,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,EAAC,OAAO,CAAC,CAAC,EAAE,SAAS,CAAC,EACrD,KAAK,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;SACxC,EACD,UAAS,SAAS,EAAE;AAClB,cAAI,CAAC,kBAAkB,GAAG,SAAS,CAAC;;AAEpC,eAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC;SACnC,CACF,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;OACnB,CACF,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;KACnB;AACD,QAAI,EAAE,SAAS,kBAAkB,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE;AACnD,aAAO,CAAC,CAAC,IAAI,CACX,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,EACtB,UAAS,MAAM,EAAE;AACf,eAAO,CAAC,CAAC,IAAI,CACX,oBAAoB,CAAC,aAAa,CAAC,MAAM,CAAC,EAC1C,UAAS,cAAc,EAAE;AACvB,cAAI,CAAC,SAAS,GAAG,cAAc,CAAC;;AAEhC,iBAAO,4BAA4B,CAChC,UAAU,CAAC,OAAO,EAAE,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;SAChE,EACD,UAAS,SAAS,EAAE;AAClB,cAAI,CAAC,kBAAkB,GAAG,SAAS,CAAC;;AAEpC,iBAAO,4BAA4B,CAChC,UAAU,CAAC,QAAQ,EAAE,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;SACjE,EACD,UAAS,SAAS,EAAE;AAClB,cAAI,CAAC,kBAAkB,GAAG,SAAS,CAAC;;AAEpC,eAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC;SACnC,CACF,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;OACnB,CACF,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;KACnB;GACF,CAAC;AACF,iBAAe,CAAC,eAAe,CAAC,gBAAgB,EAAE,4BAA4B,CAAC,CAAC;AAChF,SAAO,4BAA4B,CAAC;CACrC,CACF,CAAC,CAAC","file":"createTemplate.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('createTemplateCommand', [\n    'commands',\n    'template',\n    'gameTemplates',\n    'gameTemplateSelection',\n    function createTemplateCommandServiceFactory(commandsService,\n                                                 templateService,\n                                                 gameTemplatesService,\n                                                 gameTemplateSelectionService) {\n      var createTemplateCommandService = {\n        execute: function createTemplateExecute(temps, scope, game) {\n          return R.pipeP(\n            R.bind(self.Promise.resolve, self.Promise),\n            R.map(function(temp) {\n              return templateService.create(temp)\n                .catch(R.always(null));\n            }),\n            R.bind(self.Promise.all, self.Promise),\n            R.reject(R.isNil),\n            function(templates) {\n              if(R.isEmpty(templates)) {\n                console.log('Command CreateTemplate : no valid template definition');\n                return self.Promise.reject('No valid template definition');\n              }\n              return templates;\n            },\n            function(templates) {\n              var ctxt = {\n                templates: R.map(templateService.saveState, templates),\n                desc: templates[0].type,\n              };\n\n              return R.pipe(\n                gameTemplatesService.add$(templates),\n                function(game_templates) {\n                  game.templates = game_templates;\n\n                  return gameTemplateSelectionService\n                    .set('local', R.map(R.path(['state','stamp']), templates),\n                         scope, game.template_selection);\n                },\n                function(selection) {\n                  game.template_selection = selection;\n\n                  scope.gameEvent('createTemplate');\n                  return ctxt;\n                }\n              )(game.templates);\n            }\n          )(temps);\n        },\n        replay: function createTemplateReplay(ctxt, scope, game) {\n          return R.pipeP(\n            R.bind(self.Promise.resolve, self.Promise),\n            R.map(function(temp) {\n              return templateService.create(temp)\n                .catch(R.always(null));\n            }),\n            R.bind(self.Promise.all, self.Promise),\n            R.reject(R.isNil),\n            function(templates) {\n              if(R.isEmpty(templates)) {\n                console.log('Command CreateTemplate : no valid template definition');\n                return self.Promise.reject('No valid template definition');\n              }\n              return templates;\n            },\n            function(templates) {\n              return R.pipe(\n                gameTemplatesService.add$(templates),\n                function(game_templates) {\n                  game.templates = game_templates;\n            \n                  return gameTemplateSelectionService\n                    .set('remote', R.map(R.path(['state','stamp']), templates),\n                         scope, game.template_selection);\n                },\n                function(selection) {\n                  game.template_selection = selection;\n\n                  scope.gameEvent('createTemplate');\n                }\n              )(game.templates);\n            }\n          )(ctxt.templates);\n        },\n        undo: function createTemplateUndo(ctxt, scope, game) {\n          return R.pipe(\n            R.map(R.prop('stamp')),\n            function(stamps) {\n              return R.pipe(\n                gameTemplatesService.removeStamps$(stamps),\n                function(game_templates) {\n                  game.templates = game_templates;\n\n                  return gameTemplateSelectionService\n                    .removeFrom('local', stamps, scope, game.template_selection);\n                },\n                function(selection) {\n                  game.template_selection = selection;\n              \n                  return gameTemplateSelectionService\n                    .removeFrom('remote', stamps, scope, game.template_selection);\n                },\n                function(selection) {\n                  game.template_selection = selection;\n          \n                  scope.gameEvent('createTemplate');\n                }\n              )(game.templates);\n            }\n          )(ctxt.templates);\n        }\n      };\n      commandsService.registerCommand('createTemplate', createTemplateCommandService);\n      return createTemplateCommandService;\n    }\n  ]);\n"]}