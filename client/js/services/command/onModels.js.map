{"version":3,"sources":["../../../es6/services/command/onModels.js"],"names":[],"mappings":"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","file":"onModels.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('onModelsCommand', [\n    'commands',\n    'model',\n    'gameModels',\n    'gameModelSelection',\n    function onModelsCommandServiceFactory(commandsService,\n                                           modelService,\n                                           gameModelsService,\n                                           gameModelSelectionService) {\n      var onModelsCommandService = {\n        execute: function onModelsExecute(method /* ...args..., stamps, scope, game */) {\n          if('Function' !== R.type(modelService[method])) {\n            return self.Promise.reject('Unknown method '+method+' on model');\n          }\n          \n          var args = Array.prototype.slice.call(arguments);\n          var game = R.last(args);\n          var scope = R.nth(-2, args);\n          var stamps = R.nth(-3, args);\n          var ctxt = {\n            before: [],\n            after: [],\n            desc: method,\n          };\n\n          args = R.append(game.models, R.slice(0, -2, args));\n\n          return R.pipeP(\n            function() {\n              return gameModelsService.onStamps$('saveState', stamps, game.models);\n            },\n            function(before) {\n              ctxt.before = before;\n              \n              return gameModelsService.onStamps.apply(null, args);\n            },\n            function() {\n              return gameModelsService.onStamps('saveState', stamps, game.models);\n            },\n            function(after) {\n              ctxt.after = after;\n\n              R.forEach(function(stamp) {\n                scope.gameEvent('changeModel-'+stamp);\n              }, stamps);\n              \n              return ctxt;\n            }\n          )();\n        },\n        replay: function onModelsRedo(ctxt, scope, game) {\n          var stamps = R.pluck('stamp', ctxt.after);\n          return R.pipeP(\n            gameModelsService.findAnyStamps$(stamps),\n            R.addIndex(R.forEach)(function(model, index) {\n              if(R.isNil(model)) return;\n\n              modelService.setState(ctxt.after[index], model);\n              scope.gameEvent('changeModel-'+modelService.eventName(model));\n            }),\n            function() {\n              game.model_selection =\n                gameModelSelectionService.set('remote', stamps,\n                                              scope, game.model_selection);\n            }\n          )(game.models);\n        },\n        undo: function onModelsUndo(ctxt, scope, game) {\n          var stamps = R.pluck('stamp', ctxt.before);\n          return R.pipeP(\n            gameModelsService.findAnyStamps$(stamps),\n            R.addIndex(R.forEach)(function(model, index) {\n              if(R.isNil(model)) return;\n\n              modelService.setState(ctxt.before[index], model);\n              scope.gameEvent('changeModel-'+modelService.eventName(model));\n            }),\n            function() {\n              game.model_selection =\n                gameModelSelectionService.set('remote', stamps,\n                                              scope, game.model_selection);\n            }\n          )(game.models);\n        }\n      };\n      commandsService.registerCommand('onModels', onModelsCommandService);\n      return onModelsCommandService;\n    }\n  ]);\n"]}