{"version":3,"sources":["../../../es6/services/game/factions.js"],"names":[],"mappings":"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","file":"factions.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('gameFactions', [\n    'localStorage',\n    'http',\n    function gameFactionsServiceFactory(localStorageService,\n                                        httpService) {\n      var BASE_RADIUS = {\n        huge: 24.605,\n        large: 9.842,\n        medium: 7.874,\n        small: 5.905\n      };\n      var STORAGE_KEY = 'clickApp.factions_desc';\n      var gameFactionsService = {\n        init: function gameFactionsInit() {\n          return R.pipeP(\n            httpService.get,\n            function(data) {\n              return R.map(function(faction) {\n                return httpService.get(data[faction])\n                  .then(function(fdata) {\n                    if(R.isNil(fdata)) {\n                      console.log('factions: Error getting '+faction+' info', data[faction]);\n                    }\n                    return [ faction, fdata ];\n                  });\n              }, R.keys(data));\n            },\n            R.bind(self.Promise.all, self.Promise),\n            R.sortBy(R.compose(R.prop('name'), R.nth(1))),\n            R.reduce(function(mem, pair) {\n              return R.assoc(pair[0], updateFaction(pair[1]), mem);\n            }, {}),\n            function(factions) {\n              return gameFactionsService.loadDesc()\n                .then(gameFactionsService.applyDesc$(factions));\n            }\n          )('/data/model/factions.json').catch(function(reason) {\n            console.log('factions: error getting description', reason);\n          });\n        },\n        loadDesc: function() {\n          return localStorageService.load(STORAGE_KEY)\n            .catch(function() {\n              console.log('factions: no stored desc');\n            })\n            .then(R.defaultTo({}));\n        },\n        applyDesc: function(factions, desc) {\n          return R.deepExtend(factions, desc);\n        },\n        storeDesc: function(desc) {\n          return localStorageService.save(STORAGE_KEY, desc);\n        },\n        getModelInfo: function factionsGetModelInfo(path, factions) {\n          return new self.Promise(function(resolve, reject) {\n            var info = R.path(path, factions);\n            if(R.isNil(info)) reject('Model info '+path.join('.')+' not found');\n            else resolve(info);\n          });\n        },\n      };\n      function updateFaction(faction) {\n        // console.log(faction);\n        return R.pipe(\n          R.assoc('wreck', updateWreck(faction.wreck)),\n          function(faction) {\n            return R.assoc('models',\n                           updateFactionModels(faction, faction.models),\n                           faction);\n          }\n        )(faction);\n      }\n      function updateFactionModels(faction, models) {\n        // console.log(models);\n        return R.reduce(function(mem, section) {\n          // console.log(section);\n          return R.assoc(section, updateSection(faction, models[section]), mem);\n        }, {}, R.keys(models));\n      }\n      function updateSection(faction, section) {\n        // console.log(section);\n        return R.pipe(\n          R.keys,\n          R.sortBy(function(entry) { return section[entry].name; }),\n          R.reduce(function(mem, entry) {\n            // console.log(entry);\n            return R.assoc(entry, updateEntry(faction, section[entry]), mem);\n          }, {})\n        )(section);\n      }\n      function updateEntry(faction, entry) {\n        // console.log(entry);\n        if(R.exists(entry.entries)) {\n          return updateUnit(faction, entry);\n        }\n        else {\n          return updateModel(faction, null, entry);\n        }\n      }\n      function updateUnit(faction, unit) {\n        // console.log(unit);\n        return R.assoc('entries', updateUnitEntries(faction, unit, unit.entries), unit);\n      }\n      function updateUnitEntries(faction, unit, entries) {\n        // console.log(unit, entries);\n        return R.reduce(function(mem, category) {\n          // console.log(category);\n          return R.assoc(category, updateUnitCategory(faction, unit, entries[category]), mem);\n        }, {}, R.keys(entries));    \n      }\n      function updateUnitCategory(faction, unit, category) {\n        return R.reduce(function(mem, entry) {\n          // console.log(entry);\n          return R.assoc(entry, updateModel(faction, unit, category[entry]), mem);\n        }, {}, R.keys(category));\n      }\n      function updateModel(faction, unit, model) {\n        // console.log(model);\n        unit = R.defaultTo({}, unit);\n        var default_fk_name = R.defaultTo(model.name, unit.name);\n        return R.pipe(\n          R.assoc('fk_name', R.defaultTo(default_fk_name, model.fk_name)),\n          R.assoc('unit_name', unit.name),\n          R.assoc('img', updateImgs(model.img)),\n          R.assoc('damage', updateDamage(model.damage)),\n          R.assoc('base_color', faction.color),\n          R.assoc('base_radius', BASE_RADIUS[model.base]),\n          function(model) {\n            if(model.type === 'jack' &&\n               R.exists(faction.wreck) &&\n               R.exists(faction.wreck[model.base])) {\n              return R.assoc('img', R.append(faction.wreck[model.base], model.img), model);\n            }\n            return model;\n          }\n        )(model);\n      }\n      function updateImgs(imgs) {\n        // console.log(imgs);\n        return R.pipe(\n          R.defaultTo([]),\n          function(imgs) {\n            if(R.isEmpty(imgs)) {\n              return R.append({}, imgs);\n            }\n            return imgs;\n          },\n          R.map(updateImage)\n        )(imgs);\n      }\n      function updateWreck(wreck) {\n        return R.pipe(\n          R.defaultTo({}),\n          function(wreck) {\n            return R.pipe(\n              R.keys,\n              R.reduce(function(mem, key) {\n                return R.assoc(key, updateImage(R.assoc('type','wreck',wreck[key])), mem);\n              }, {})\n            )(wreck);\n          }\n        )(wreck);\n      }\n      function updateImage(img) {\n        return R.pipe(\n          R.assoc('type', R.defaultTo('default', img.type)),\n          R.assoc('width', R.defaultTo(60, img.width)),\n          R.assoc('height', R.defaultTo(60, img.height))\n        )(img);\n      }\n      function updateDamage(damage) {\n        // console.log(damage);\n        return R.pipe(\n          R.defaultTo({ type: 'warrior', n: 1 }),\n          function(damage) {\n            return R.assoc('type', R.defaultTo('warrior', damage.type), damage);\n          },\n          function(damage) {\n            return R.assoc('total', computeDamageTotal(damage), damage);\n          },\n          function(damage) {\n            return R.assoc('depth', computeDamageDepth(damage), damage);\n          }\n        )(damage);\n      }\n      function computeDamageTotal(damage) {\n        if(damage.type === 'warrior') return damage.n;\n        return R.pipe(\n          R.keys,\n          R.reject(R.equals('type')),\n          R.reject(R.equals('total')),\n          R.reject(R.equals('field')),\n          R.reduce(function(mem, key) {\n            return mem + R.pipe(\n              R.reject(R.isNil),\n              R.length\n            )(damage[key]);\n          }, 0)\n        )(damage);\n      }\n      function computeDamageDepth(damage) {\n        if(damage.type === 'warrior') return damage.n;\n        return R.pipe(\n          R.keys,\n          R.reject(R.equals('type')),\n          R.reject(R.equals('total')),\n          R.reject(R.equals('field')),\n          R.map(function(key) {\n            return R.length(damage[key]);\n          }),\n          R.reduce(R.max, 0)\n        )(damage);\n      }\n      R.curryService(gameFactionsService);\n      return gameFactionsService;\n    }\n  ]);\n"]}