{"version":3,"sources":["../../../es6/services/game/models.js"],"names":[],"mappings":"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","file":"models.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('gameModels', [\n    'point',\n    'model',\n    function gameModelsServiceFactory(pointService,\n                                      modelService) {\n      var gameModelsService = {\n        create: function() {\n          return {\n            active: [],\n            locked: [],\n          };\n        },\n        all: function modelsAll(models) {\n          return R.concat(models.active, models.locked);\n        },\n        findStamp: function modelsFindStamp(stamp, models) {\n          return new self.Promise(function(resolve, reject) {\n            var model = R.pipe(\n              gameModelsService.all,\n              R.find(R.pathEq(['state','stamp'], stamp))\n            )(models);\n            if(R.isNil(model)) reject('Model '+stamp+' not found');\n            else resolve(model);\n          });\n        },\n        findAnyStamps: function modelsFindAnyStamps(stamps, models) {\n          return R.pipeP(\n            R.bind(self.Promise.resolve, self.Promise),\n            R.map(function(stamp) {\n              return gameModelsService.findStamp(stamp, models)\n                .catch(R.always(null));\n            }),\n            R.bind(self.Promise.all, self.Promise),\n            function(models) {\n              if(R.isEmpty(R.reject(R.isNil, models))) {\n                return self.Promise.reject('No model found');\n              }\n              return models;\n            }\n          )(stamps);\n        },\n        findStampsBetweenPoints: function modelsFindStampBetweenPoints(top_left, bottom_right, models) {\n          return new self.Promise(function(resolve, reject) {\n            models = gameModelsService.all(models);\n            var stamps = R.pipe(\n              R.filter(modelService.isBetweenPoints$(top_left, bottom_right)),\n              R.map(R.path(['state','stamp']))\n            )(models);\n            if(R.isEmpty(stamps)) reject('No model found between points');\n            else resolve(stamps);\n          });\n        },\n        onStamps: function modelsOnStamps(method /*, ...args..., stamps, models*/) {\n          if('Function' !== R.type(modelService[method])) {\n            return self.Promise.reject('Unknown method '+method+' on models');\n          }\n          \n          var args = Array.prototype.slice.call(arguments);\n          var models = R.last(args);\n          var stamps = R.nth(-2, args);\n\n          args = R.slice(1, -2, args);\n          var reason;\n          return R.pipeP(\n            gameModelsService.findAnyStamps$(stamps),\n            R.reject(R.isNil),\n            R.map(function(model) {\n              return self.Promise.resolve(modelService[method]\n                                          .apply(null, R.append(model, args)))\n                .catch(function(_reason) {\n                  console.error(_reason);\n                  reason = _reason;\n                  return '##failed##';\n                });\n            }),\n            R.bind(self.Promise.all, self.Promise),\n            function(results) {\n              if(R.isEmpty(R.reject(R.equals('##failed##'), results))) {\n                console.error('Models: onStamps all failed', args);\n                return self.Promise.reject(reason);\n              }\n              return R.map(function(res) {\n                return ( res === '##failed##' ?\n                         null : res\n                       );\n              }, results);\n            }\n          )(models);\n        },\n        lockStamps: function modelsLockStamps(lock, stamps, models) {\n          return R.pipeP(\n            function() {\n              return gameModelsService.findAnyStamps(stamps, models);\n            },\n            R.reject(R.isNil),\n            R.forEach(modelService.setLock$(lock)),\n            function() {\n              var partition = R.pipe(\n                gameModelsService.all,\n                R.partition(modelService.isLocked)\n              )(models);\n              return {\n                active: partition[1],\n                locked: partition[0]\n              };\n            }\n          )();\n        },\n        add: function modelsAdd(mods, models) {\n          return R.pipe(\n            gameModelsService.removeStamps$(R.map(R.path(['state','stamp']), mods)),\n            function(models) {\n              return R.assoc('active', R.concat(models.active, mods), models);\n            }\n          )(models);\n        },\n        removeStamps: function modelsRemoveStamps(stamps, models) {\n          function inStamps(model) {\n            return R.find(R.equals(R.path(['state', 'stamp'], model)), stamps);\n          }\n          return R.pipe(\n            R.assoc('active', R.reject(inStamps, models.active)),\n            R.assoc('locked', R.reject(inStamps, models.locked))\n          )(models);\n        },\n        modeForStamp: function modelsModeForStamp(stamp, models) {\n          return R.pipeP(\n            function() {\n              return gameModelsService.findStamp(stamp, models);\n            },\n            modelService.modeFor$\n          )();\n        },\n        copyStamps: function modelsCopyStamps(stamps, models) {\n          return R.pipeP(\n            gameModelsService.findAnyStamps$(stamps),\n            R.reject(R.isNil),\n            function(selection) {\n              var base = R.pick(['x','y','r'], selection[0].state);\n\n              return {\n                base: base,\n                models: R.map(R.compose(pointService.differenceFrom$(base),\n                                        modelService.saveState),\n                              selection)\n              };\n            }\n          )(models);\n        },\n      };\n      R.curryService(gameModelsService);\n      return gameModelsService;\n    }\n  ]);\n"]}