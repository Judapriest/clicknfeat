{"version":3,"sources":["../../../es6/services/modes/model_charge.js"],"names":[],"mappings":"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","file":"model_charge.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('modelChargeMode', [\n    'modes',\n    'settings',\n    'modelsMode',\n    'modelBaseMode',\n    'model',\n    'game',\n    'gameModels',\n    'gameModelSelection',\n    function modelChargeModeServiceFactory(modesService,\n                                           settingsService,\n                                           modelsModeService,\n                                           modelBaseModeService,\n                                           modelService,\n                                           gameService,\n                                           gameModelsService,\n                                           gameModelSelectionService) {\n      var charge_actions = Object.create(modelBaseModeService.actions);\n      charge_actions.endCharge = function modelEndCharge(scope) {\n        var stamps = gameModelSelectionService.get('local', scope.game.model_selection);\n        return R.pipeP(\n          function() {\n            return gameService.executeCommand('onModels', 'endCharge',\n                                              stamps, scope, scope.game);\n          },\n          function() {\n            return scope.doSwitchToMode('Model');\n          }\n        )();\n      };\n      charge_actions.setTargetModel = function modelSetTargetModel(scope, event) {\n        var stamps = gameModelSelectionService.get('local', scope.game.model_selection);\n        return R.pipeP(\n          gameModelsService.findStamp$(stamps[0]),\n          function(model) {\n            return R.pipeP(\n              function() {\n                return modelService.chargeTarget(model)\n                  .catch(R.always(null));\n              },\n              function(target_stamp) {\n                return ( target_stamp === event['click#'].target.state.stamp ?\n                         null :\n                         event['click#'].target\n                       );\n              },\n              function(set_target) {\n                if(R.exists(set_target) &&\n                   model.state.stamp === set_target.state.stamp) return;\n\n                return gameService.executeCommand('onModels', 'setChargeTarget',\n                                                  scope.factions, set_target,\n                                                  stamps, scope, scope.game);\n              }\n            )();\n          }\n        )(scope.game.models);\n      };\n      var moves = [\n        ['moveFront', 'up', 'moveFront'],\n        ['moveBack', 'down', 'moveBack'],\n        ['rotateLeft', 'left', 'rotateLeft'],\n        ['rotateRight', 'right', 'rotateRight'],\n        ['shiftUp', 'ctrl+up', 'shiftDown'],\n        ['shiftDown', 'ctrl+down', 'shiftUp'],\n        ['shiftLeft', 'ctrl+left', 'shiftRight'],\n        ['shiftRight', 'ctrl+right', 'shiftLeft'],\n      ];\n      R.forEach(function(move) {\n        charge_actions[move[0]] = buildChargeMove(move[0], move[2], false,\n                                                 move[0]);\n        charge_actions[move[0]+'Small'] = buildChargeMove(move[0], move[2], true,\n                                                         move[0]+'Small');\n      }, moves);\n      function buildChargeMove(move, flip_move, small) {\n        return function modelDoChargeMove(scope) {\n          var stamps = gameModelSelectionService.get('local', scope.game.model_selection);\n          var _move = ( R.path(['ui_state','flip_map'], scope) ?\n                        flip_move :\n                        move\n                      );\n          return R.pipeP(\n            gameModelsService.findStamp$(stamps[0]),\n            function(model) {\n              return modelService.chargeTarget(model)\n                .catch(R.always(null));\n            },\n            function(target_stamp) {\n              return ( R.exists(target_stamp) ?\n                       gameModelsService.findStamp(target_stamp, scope.game.models) :\n                       null\n                     );\n            },\n            function(target_model) {\n              return gameService.executeCommand('onModels', _move+'Charge',\n                                                scope.factions, target_model, small,\n                                                stamps, scope, scope.game);\n            }\n          )(scope.game.models);\n        };\n      }\n\n      var charge_default_bindings = {\n        'endCharge': 'c',\n        'setTargetModel': 'shift+clickModel',\n      };\n      var charge_bindings = R.extend(Object.create(modelBaseModeService.bindings),\n                                     charge_default_bindings);\n      var charge_buttons = modelsModeService.buildButtons({ single: true,\n                                                            end_charge: true });\n      var charge_mode = {\n        onEnter: function modelOnEnter(/*scope*/) {\n        },\n        onLeave: function modelOnLeave(/*scope*/) {\n        },\n        name: 'ModelCharge',\n        actions: charge_actions,\n        buttons: charge_buttons,\n        bindings: charge_bindings,\n      };\n      modesService.registerMode(charge_mode);\n      settingsService.register('Bindings',\n                               charge_mode.name,\n                               charge_default_bindings,\n                               function(bs) {\n                                 R.extend(charge_mode.bindings, bs);\n                               });\n      return charge_mode;\n    }\n  ]);\n"]}