{"version":3,"sources":["../../../es6/services/modes/sprayTemplate.js"],"names":[],"mappings":"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","file":"sprayTemplate.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('sprayTemplateMode', [\n    'modes',\n    'settings',\n    'templateMode',\n    'sprayTemplate',\n    'game',\n    'gameTemplates',\n    'gameTemplateSelection',\n    'gameModels',\n    function sprayTemplateModeServiceFactory(modesService,\n                                             settingsService,\n                                             templateModeService,\n                                             sprayTemplateService,\n                                             gameService,\n                                             gameTemplatesService,\n                                             gameTemplateSelectionService,\n                                             gameModelsService) {\n      var template_actions = Object.create(templateModeService.actions);\n      template_actions.spraySize6 = function spraySize6(scope) {\n        var stamps = gameTemplateSelectionService.get('local', scope.game.template_selection);\n        return gameService.executeCommand('onTemplates', 'setSize', 6,\n                                          stamps, scope, scope.game);\n      };\n      template_actions.spraySize8 = function spraySize8(scope) {\n        var stamps = gameTemplateSelectionService.get('local', scope.game.template_selection);\n        return gameService.executeCommand('onTemplates', 'setSize', 8,\n                                          stamps, scope, scope.game);\n      };\n      template_actions.spraySize10 = function spraySize10(scope) {\n        var stamps = gameTemplateSelectionService.get('local', scope.game.template_selection);\n        return gameService.executeCommand('onTemplates', 'setSize', 10,\n                                          stamps, scope, scope.game);\n      };\n      template_actions.setOriginModel = function spraySetOriginModel(scope, event) {\n        var stamps = gameTemplateSelectionService.get('local', scope.game.template_selection);\n        return gameService.executeCommand('onTemplates', 'setOrigin',\n                                          scope.factions, event['click#'].target,\n                                          stamps, scope,  scope.game);\n      };\n      template_actions.setTargetModel = function spraySetTargetModel(scope, event) {\n        var stamps = gameTemplateSelectionService.get('local', scope.game.template_selection);\n        return R.pipeP(\n          gameTemplatesService.findStamp$(stamps[0]),\n          sprayTemplateService.origin,\n          function(origin) {\n            if(R.isNil(origin)) return;\n\n            return gameModelsService.findStamp(origin, scope.game.models);\n          },\n          function(origin_model) {\n            if(R.isNil(origin_model)) return;\n          \n            return gameService.executeCommand('onTemplates', 'setTarget',\n                                              scope.factions, origin_model, event['click#'].target,\n                                              stamps, scope,  scope.game);\n          }\n        )(scope.game.templates);\n      };\n      var moves = [\n        ['rotateLeft', 'left'],\n        ['rotateRight', 'right'],\n      ];\n      function buildTemplateMove(move, small) {\n        return function templateMove(scope) {\n          var stamps = gameTemplateSelectionService.get('local', scope.game.template_selection);\n          return R.pipeP(\n            function() {\n              return gameTemplatesService.findStamp(stamps[0], scope.game.templates);\n            },\n            sprayTemplateService.origin,\n            function(origin) {\n              if(R.isNil(origin)) return;\n              \n              return gameModelsService.findStamp(origin, scope.game.models);\n            },\n            function(origin_model) {\n              return gameService\n                .executeCommand('onTemplates', move[0],\n                                scope.factions, origin_model, small,\n                                stamps, scope, scope.game);\n            }\n          )();\n        };\n      }\n      R.forEach(function(move) {\n        template_actions[move[0]] = buildTemplateMove(move, false);\n        template_actions[move[0]+'Small'] = buildTemplateMove(move, true);\n      }, moves);\n      var template_default_bindings = {\n        setOriginModel: 'ctrl+clickModel',\n        setTargetModel: 'shift+clickModel',\n        spraySize6: '6',\n        spraySize8: '8',\n        spraySize10: '0',\n      };\n      var template_bindings = R.extend(Object.create(templateModeService.bindings),\n                                       template_default_bindings);\n\n      var template_buttons = R.concat([\n        [ 'Size', 'toggle', 'size' ],\n        [ 'Spray6', 'spraySize6', 'size' ],\n        [ 'Spray8', 'spraySize8', 'size' ],\n        [ 'Spray10', 'spraySize10', 'size' ],\n      ], templateModeService.buttons);\n\n      var template_mode = {\n        onEnter: function templateOnEnter(/*scope*/) {\n        },\n        onLeave: function templateOnLeave(/*scope*/) {\n        },\n        name: 'spray'+templateModeService.name,\n        actions: template_actions,\n        buttons: template_buttons,\n        bindings: template_bindings,\n      };\n      modesService.registerMode(template_mode);\n      settingsService.register('Bindings',\n                               template_mode.name,\n                               template_default_bindings,\n                               function(bs) {\n                                 R.extend(template_mode.bindings, bs);\n                               });\n      return template_mode;\n    }\n  ]);\n"]}