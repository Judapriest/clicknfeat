{"version":3,"sources":["../../es6/directives/gameModel.js"],"names":[],"mappings":"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","file":"gameModel.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.directives')\n  .directive('clickGameModel', [\n    'gameMap',\n    'gameFactions',\n    'gameModelSelection',\n    'model',\n    'labelElement',\n    'clickGameModelArea',\n    'clickGameModelAura',\n    'clickGameModelBase',\n    'clickGameModelCharge',\n    'clickGameModelCounter',\n    'clickGameModelDamage',\n    'clickGameModelIcon',\n    'clickGameModelLoS',\n    'clickGameModelMelee',\n    function(\n      gameMapService,\n      gameFactionsService,\n      gameModelSelectionService,\n      modelService,\n      labelElementService,\n      clickGameModelAreaService,\n      clickGameModelAuraService,\n      clickGameModelBaseService,\n      clickGameModelChargeService,\n      clickGameModelCounterService,\n      clickGameModelDamageService,\n      clickGameModelIconService,\n      clickGameModelLoSService,\n      clickGameModelMeleeService\n      // gameRulerService,\n    ) {\n      var clickGameModeDirective = {\n        restrict: 'A',\n        link: function(scope, el/*, attrs*/) {\n          gameFactionsService.getModelInfo(scope.model.state.info,\n                                           scope.factions)\n            .catch(function(reason) {\n              console.error('clickGameModel', reason);\n              return self.Promise.reject(reason);\n            })\n              .then(function(info) {\n                console.log('gameModel', scope.model, info);\n\n                return buildModelElement(info, scope.model, el[0], scope);\n              });\n        }\n      };\n      function buildModelElement(info, model, container, scope) {\n        var element = createModelElement(info, model, container);\n        \n        scope.$on('$destroy', gameModelOnDestroy(element));\n        scope.onGameEvent('mapFlipped',\n                          gameModelOnMapFlipped(info, model, element),\n                          scope);\n        var updateModel = gameModelOnUpdate(scope.factions,\n                                            info,\n                                            model,\n                                            scope.game,\n                                            scope,\n                                            element);\n        scope.onGameEvent('changeModel-'+model.state.stamp,\n                          updateModel,\n                          scope);\n        updateModel();\n\n        // scope.onGameEvent('changeSingleModelSelection',\n        //                   gameModelOnchangeSingleModelSelection(scope.factions, model, element),\n        //                   scope);\n        // scope.onGameEvent('disableSingleModelSelection',\n        //                   gameModelOnDisableSingleModelSelection(element),\n        //                   scope);\n\n        // scope.onGameEvent('changeSingleAoESelection',\n        //                   gameModelOnchangeSingleAoESelection(scope.factions, model, element),\n        //                   scope);\n        // scope.onGameEvent('disableSingleAoESelection',\n        //                   gameModelOnDisableSingleAoESelection(),\n        //                   scope);\n      }\n      function createModelElement(info, model, parent) {\n        var map = document.getElementById('map');\n        var under_models_container = document.getElementById('game-under-models');\n        var over_models_container = document.getElementById('game-over-models');\n        var svgNS = map.namespaceURI;\n\n        var aura = clickGameModelAuraService.create(svgNS, parent);\n        var melee = clickGameModelMeleeService.create(svgNS, parent);\n        var base = clickGameModelBaseService.create(svgNS, info, model, parent);\n        var damage = clickGameModelDamageService.create(svgNS, info, parent);\n        var los = clickGameModelLoSService.create(svgNS, info, parent);\n        var label = labelElementService.create(svgNS, over_models_container);\n        var counter = clickGameModelCounterService.create(svgNS, over_models_container, parent);\n        var unit = labelElementService.create(svgNS, parent);\n        var icon = clickGameModelIconService.create(svgNS, parent);\n        var area = clickGameModelAreaService.create(svgNS, parent);\n        var charge = clickGameModelChargeService.create(svgNS,\n                                                        under_models_container,\n                                                        over_models_container,\n                                                        parent);\n        \n        return { container: parent,\n                 aura: aura,\n                 base: base,\n                 damage: damage,\n                 los: los,\n                 label: label,\n                 counter: counter,\n                 unit: unit,\n                 icon: icon,\n                 area: area,\n                 melee: melee,\n                 charge: charge,\n               };\n      }\n      function gameModelOnDestroy(element) {\n        return function _gameModelOnDestroy() {\n          console.log('gameModelOnDestroy');\n\n          var under_models_container = document.getElementById('game-under-models');\n          var over_models_container = document.getElementById('game-over-models');\n          over_models_container.removeChild(element.label.label);\n          clickGameModelCounterService.cleanup(under_models_container,\n                                               over_models_container,\n                                               element.counter);\n          clickGameModelChargeService.cleanup(under_models_container,\n                                              over_models_container,\n                                              element.charge);\n        };\n      }\n      function gameModelOnMapFlipped(info, model, element) {\n        return function _gameModelOnMapFlipped() {\n          var map = document.getElementById('map');\n\n          var label_center = computeLabelCenter(info, model);\n          labelElementService.updateOnFlipMap(map,\n                                              label_center.flip,\n                                              element.label);\n          labelElementService.updateOnFlipMap(map,\n                                              model.state,\n                                              element.counter[0]);\n          if(modelService.isCharging(model) ||\n             modelService.isPlacing(model)) {\n            labelElementService.updateOnFlipMap(map,\n                                                model.state.cha.s,\n                                                element.charge[2]);\n          }\n        };\n      }\n      // function gameModelOnChangeSingleModelSelection(factions, model, element) {\n      //   return function _gameModelOnchangeSingleModelSelection(event, selected_model) {\n      //     // console.log('changeSingleModelSelection',\n      //     //             selected_model.state.stamp,\n      //     //             scope.model.state.stamp);\n      //     if(selected_model.state.stamp !== model.state.stamp) {\n      //       var dist = modelService.distanceTo(factions,\n      //                                          selected_model,\n      //                                          model);\n      //       if(dist < -0.1) {\n      //         element.container.classList.add('overlap');\n      //         element.container.classList.remove('b2b');\n      //         return;\n      //       }\n      //       else if(dist < 0.1) {\n      //         element.container.classList.remove('overlap');\n      //         element.container.classList.add('b2b');\n      //         return;\n      //       }\n      //     }\n      //     element.container.classList.remove('overlap');\n      //     element.container.classList.remove('b2b');\n      //   };\n      // }\n      // function gameModelOnDisableSingleModelSelection(element) {\n      //   return function _gameModelOnDisableSingleModelSelection() {\n      //     // console.log('disableSingleModelSelection',\n      //     //             scope.model.state.stamp);\n      //     element.container.classList.remove('overlap');\n      //     element.container.classList.remove('b2b');\n      //   };\n      // }\n      // function gameModelOnChangeSingleAoESelection(factions, model, element) {\n      //   return function _gameModelOnchangeSingleAoESelection(event, selected_aoe) {\n      //     // console.log('changeSingleAoESelection',\n      //     //             selected_aoe.state.stamp,\n      //     //             scope.model.state.stamp);\n      //     if(R.exists(selected_aoe)) {\n      //       var dist = modelService.distanceToAoE(factions,\n      //                                             selected_aoe,\n      //                                             model);\n      //       if(dist <= 0) {\n      //         element.container.classList.add('under-aoe');\n      //         return;\n      //       }\n      //     }\n      //     element.container.classList.remove('under-aoe');\n      //   };\n      // }\n      // function gameModelOnDisableSingleAoESelection(element) {\n      //   return function _gameModelOnDisableSingleAoESelection() {\n      //     // console.log('disableSingleAoESelection',\n      //     //             scope.model.state.stamp);\n      //     element.container.classList.remove('under-aoe');\n      //     element.container.classList.remove('b2b');\n      //   };\n      // }\n      function gameModelOnUpdate(factions, info, model, game, scope, element) {\n        return function _gameModelOnUpdate() {\n          var map = document.getElementById('map');\n\n          var map_flipped = gameMapService.isFlipped(map);\n          var zoom_factor = gameMapService.zoomFactor(map);\n          var is_wreck = modelService.isWreckDisplayed(model);\n          (is_wreck ?\n           modelService.getWreckImage(factions, model) :\n           modelService.getImage(factions, model))\n            .then(function(img) {\n              var label_text = modelService.fullLabel(model);\n              var label_center = computeLabelCenter(info, model);\n\n              updateModelPosition(img, model, element);\n              updateModelSelection(game.model_selection, game.ruler,\n                                   model, element);\n              clickGameModelAuraService.update(info, model, img, element.aura);\n              clickGameModelBaseService.update(info, model, img, element.base);\n              clickGameModelDamageService.update(info, model, img, element.damage);\n              labelElementService.update(map_flipped,\n                                         zoom_factor,\n                                         label_center.flip,\n                                         label_center.text,\n                                         label_text,\n                                         element.label);\n              clickGameModelCounterService.update(map_flipped, zoom_factor,\n                                                  info, model, img, element.counter);\n              updateUnit(map_flipped, zoom_factor,\n                         img, info, model, element);\n              clickGameModelIconService.update(info, model, img, element.icon);\n              clickGameModelAreaService.update(factions, info, model, img, element.area);\n              clickGameModelMeleeService.update(info, model, img, element.melee);\n              clickGameModelChargeService.update(map_flipped, zoom_factor, scope.game,\n                                                 scope.factions, info, model, img, element.charge);\n\n              self.requestAnimationFrame(function _updateModel2() {\n                if(gameModelSelectionService.inSingle('local',\n                                                      model.state.stamp,\n                                                      game.model_selection)) {\n                  scope.gameEvent('changeSingleModelSelection', model);\n                }\n              });\n            });\n        };\n      }\n      function updateModelPosition(img, model, element) {\n        element.container.setAttribute('transform', [\n          'translate(',\n          model.state.x-img.width/2,\n          ',',\n          model.state.y-img.height/2,\n          ') rotate(',\n          model.state.r,\n          ',',\n          img.width/2,\n          ',',\n          img.height/2,\n          ')'\n        ].join(''));\n      }\n      function updateModelSelection(selection, ruler, model, element) {\n        var container = element.container;\n        var stamp = model.state.stamp;\n        if(gameModelSelectionService.in('local', stamp, selection)) {\n          container.classList.add('local-selection');\n        }\n        else {\n          container.classList.remove('local-selection');\n        }\n        if(gameModelSelectionService.in('remote', stamp, selection)) {\n          container.classList.add('remote-selection');\n        }\n        else {\n          container.classList.remove('remote-selection');\n        }\n        if(gameModelSelectionService.inSingle('local', stamp, selection)) {\n          container.classList.add('single-local');\n          container.classList.remove('single-remote');\n        }\n        else if(gameModelSelectionService.inSingle('remote', stamp, selection)) {\n          container.classList.remove('single-local');\n          container.classList.add('single-remote');\n        }\n        else {\n          container.classList.remove('single-local');\n          container.classList.remove('single-remote');\n        }\n      }\n      function updateUnit(map_flipped, zoom_factor, img, info, model, element) {\n        var unit = modelService.unit(model);\n        unit = R.exists(unit) ? unit : '';\n        var unit_text = modelService.isUnitDisplayed(model) ? unit+'' : '';\n        unit_text = R.length(unit_text) > 0 ? 'U'+unit_text : unit_text;\n        var unit_center = computeUnitCenter(img, info, model);\n\n        labelElementService.update(map_flipped,\n                                   zoom_factor,\n                                   unit_center.flip,\n                                   unit_center.text,\n                                   unit_text,\n                                   element.unit);\n      }\n      function computeLabelCenter(info, model) {\n        var label_text_center_y_down = model.state.y + info.base_radius + 6;\n        var label_text_center_y_up = model.state.y - info.base_radius - 2;\n        var orientation = ((model.state.r % 360) + 360) % 360;\n        var model_looking_down =  orientation > 90 && orientation < 270;\n        var label_text_center = { x: model.state.x,\n                                  y: model_looking_down ?\n                                  label_text_center_y_down : label_text_center_y_up\n                                };\n        var label_flip_center = { x: label_text_center.x,\n                                  y: label_text_center.y - 2\n                                };\n        return { text: label_text_center,\n                 flip: label_flip_center\n               };\n      }\n      function computeUnitCenter(img, info/*, model*/) {\n        var counter_flip_center = { x: img.width/2, y: img.height/2 };\n        var counter_text_center = { x: counter_flip_center.x - info.base_radius*0.7 - 5,\n                                    y: counter_flip_center.y - info.base_radius*0.7 - 5 };\n        return { text: counter_text_center,\n                 flip: counter_flip_center,\n               };\n      }\n      return clickGameModeDirective;\n    }\n  ])\n  .directive('clickGameModelsList', [\n    function() {\n      return {\n        restrict: 'A',\n        templateUrl: 'partials/game/models_list.html',\n        scope: true,\n        link: function(scope, element/*, attrs*/) {\n          scope.type = element[0].getAttribute('click-game-models-list');\n          console.log('clickGameModelsList', scope.type);\n        }\n      };\n    }\n  ]);\n"]}