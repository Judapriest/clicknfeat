{"version":3,"sources":["los.es6"],"names":[],"mappings":"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","file":"los.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('gameLos', gameLosModelFactory);\n\n  gameLosModelFactory.$inject = [\n    'gameSegment',\n    'circle',\n    'gameFactions',\n    'gameModels',\n  ];\n  function gameLosModelFactory(gameSegmentModel,\n                               circleModel,\n                               gameFactionsModel,\n                               gameModelsModel) {\n    const base = gameSegmentModel('los');\n    const gameLosModel = Object.create(base);\n    R.deepExtend(gameLosModel, {\n      create: gameLosCreate,\n      toggleDisplay: gameLosToggleDisplay,\n      setRemote: gameLosSetRemote,\n      resetRemote: gameLosResetRemote,\n      origin: gameLosOrigin,\n      clearOrigin: gameLosClearOrigin,\n      setOrigin: gameLosSetOrigin,\n      target: gameLosTarget,\n      setOriginResetTarget: gameLosSetOriginResetTarget,\n      clearTarget: gameLosClearTarget,\n      setTarget: gameLosSetTarget,\n      toggleIgnoreModel: gameLosToggleIgnoreModel,\n      updateOriginTarget: gameLosUpdateOriginTarget,\n      render:  gameLosRender,\n      renderEnveloppe:  gameLosRenderEnveloppe\n    });\n\n    const setOriginTarget$ = R.curry(setOriginTarget);\n\n    R.curryService(gameLosModel);\n    return gameLosModel;\n\n    function gameLosCreate() {\n      return R.deepExtend(base.create(), {\n        computed: {}\n      });\n    }\n    function gameLosToggleDisplay(los) {\n      return R.thread(los)(\n        base.toggleDisplay,\n        setOriginTarget$({})\n      );\n    }\n    function gameLosSetRemote(start, end, _state_, los) {\n      return R.thread(los)(\n        base.setRemote$(start, end),\n        setOriginTarget$({})\n      );\n    }\n    function gameLosResetRemote(remote, los) {\n      return R.thread(los)(\n        base.resetRemote$(remote),\n        setOriginTarget$({})\n      );\n    }\n    function gameLosOrigin(los) {\n      return R.path(['remote', 'origin'], los);\n    }\n    function gameLosClearOrigin(los) {\n      return setOriginTarget({ origin: null,\n                               ignore: null,\n                               display: false\n                             }, los);\n    }\n    function gameLosSetOrigin(origin_model, los) {\n      const origin = origin_model.state.stamp;\n      let target = gameLosModel.target(los);\n      target = (target === origin) ? null : target;\n      const display = (target && origin);\n      return setOriginTarget({ origin: origin,\n                               target: target,\n                               ignore: null,\n                               display: display\n                             }, los);\n    }\n    function gameLosSetOriginResetTarget(origin_model, _state_, los) {\n      const origin = origin_model.state.stamp;\n      return setOriginTarget({ origin: origin,\n                               target: null,\n                               ignore: null,\n                               display: true\n                             }, los);\n    }\n    function gameLosTarget(los) {\n      return R.path(['remote', 'target'], los);\n    }\n    function gameLosClearTarget(los) {\n      return setOriginTarget({ target: null,\n                               ignore: null,\n                               display: false\n                             }, los);\n    }\n    function gameLosSetTarget(target_model, los) {\n      let origin = gameLosModel.origin(los);\n      const target = target_model.state.stamp;\n      origin = (origin === target) ? null : origin;\n      const display = (target && origin);\n      return setOriginTarget({ origin: origin,\n                               target: target,\n                               ignore: null,\n                               display: display\n                             }, los);\n    }\n    function gameLosToggleIgnoreModel(model, los) {\n      let ignore = R.pathOr([], ['remote','ignore'], los);\n      const is_ignored = R.find(R.equals(model.state.stamp),\n                                ignore);\n      ignore = ( is_ignored\n                 ? R.reject(R.equals(model.state.stamp), ignore)\n                 : R.append(model.state.stamp, ignore)\n               );\n      console.log('toggleIgnoreModel', ignore);\n\n      return setOriginTarget({ ignore: ignore }, los);\n    }\n    function gameLosUpdateOriginTarget(los) {\n      return setOriginTarget({}, los);\n    }\n\n    function setOriginTarget(update, los) {\n      const {\n        origin = R.path(['remote','origin'], los),\n        target = R.path(['remote','target'], los),\n        ignore = R.pathOr([], ['remote','ignore'], los),\n        display = R.path(['remote','display'], los),\n      } = update;\n\n      los = R.thread(los)(\n        R.assocPath(['remote','origin'], origin),\n        R.assocPath(['remote','target'], target),\n        R.assocPath(['remote','display'], display),\n        R.assocPath(['remote','ignore'], R.defaultTo([], ignore))\n      );\n\n      return los;\n    }\n    function gameLosRender({ in_los_mode,\n                             factions, models }, los) {\n      const local = {\n        show: los.local.display,\n        x1: los.local.start.x,\n        y1: los.local.start.y,\n        x2: los.local.end.x,\n        y2: los.local.end.y\n      };\n      const remote = {\n        show: los.remote.display,\n        x1: los.remote.start.x,\n        y1: los.remote.start.y,\n        x2: los.remote.end.x,\n        y2: los.remote.end.y\n      };\n      let origin;\n      if(R.exists(los.remote.origin) &&\n         (los.remote.display || in_los_mode)) {\n        const origin_model = gameModelsModel\n                .findStamp(los.remote.origin, models);\n        if(R.exists(origin_model)) {\n          const origin_info = gameFactionsModel\n                  .getModelInfo(origin_model.state.info, factions);\n          if(R.exists(origin_info)) {\n            origin = {\n              cx: origin_model.state.x,\n              cy: origin_model.state.y,\n              radius: origin_info.base_radius\n            };\n          }\n        }\n      }\n      let target;\n      if(R.exists(los.remote.target) &&\n         (los.remote.display || in_los_mode)) {\n        const target_model = gameModelsModel\n                .findStamp(los.remote.target, models);\n        if(R.exists(target_model)) {\n          const target_info = gameFactionsModel\n                  .getModelInfo(target_model.state.info, factions);\n          if(R.exists(target_info)) {\n            target = {\n              cx: target_model.state.x,\n              cy: target_model.state.y,\n              radius: target_info.base_radius\n            };\n          }\n        }\n      }\n      return {\n        local, remote, origin, target\n      };\n    }\n    function gameLosRenderEnveloppe(state, los) {\n      los.computed = {\n        envelope: null,\n        darkness: [],\n        shadow: []\n      };\n      const display = ( los.remote.display &&\n                        los.remote.origin &&\n                        los.remote.target\n                      );\n      if(display) {\n        updateEnveloppes(state, los);\n      }\n      const {\n        left:  { start: { x: x1 = 0, y: y1 = 0 } = {},\n                 end:   { x: x2 = 0, y: y2 = 0 } = {}\n               } = {},\n        right: { start: { x: x4 = 0, y: y4 = 0 } = {},\n                 end:   { x: x3 = 0, y: y3 = 0 } = {}\n               } = {}\n      } = R.pathOr({}, ['computed', 'envelope'], los);\n      const enveloppe = [\n        [ x1, y1 ].join(','),\n        [ x2, y2 ].join(','),\n        [ x3, y3 ].join(','),\n        [ x4, y4 ].join(','),\n      ].join(' ');\n      const shadow = R.map((sh) => {\n        const {\n          left:  { start: { x: x1 = 0, y: y1 = 0 } = {},\n                   end:   { x: x2 = 0, y: y2 = 0 } = {}\n                 } = {},\n          right: { start: { x: x4 = 0, y: y4 = 0 } = {},\n                   end:   { x: x3 = 0, y: y3 = 0 } = {}\n                 } = {}\n        } = sh;\n        return [\n          [ x1, y1 ].join(','),\n          [ x2, y2 ].join(','),\n          [ x3, y3 ].join(','),\n          [ x4, y4 ].join(','),\n        ].join(' ');\n      }, R.pathOr([], ['computed', 'shadow'], los));\n      const darkness = R.map((dk) => {\n        const {\n          left:  { start: { x: x1 = 0, y: y1 = 0 } = {},\n                   end:   { x: x2 = 0, y: y2 = 0 } = {}\n                 } = {},\n          right: { start: { x: x4 = 0, y: y4 = 0 } = {},\n                   end:   { x: x3 = 0, y: y3 = 0 } = {}\n                 } = {}\n        } = dk;\n        return [\n          [ x1, y1 ].join(','),\n          [ x2, y2 ].join(','),\n          [ x3, y3 ].join(','),\n          [ x4, y4 ].join(','),\n        ].join(' ');\n      }, R.pathOr([], ['computed', 'darkness'], los));\n\n      return {\n        display, enveloppe, shadow, darkness\n      };\n    }\n    function updateEnveloppes(state, los) {\n      R.thread()(\n        () => getOriginTargetInfo(state,\n                                  los.remote.origin,\n                                  los.remote.target),\n        ([origin_state, origin_info, target_state, target_info]) => {\n          const origin_circle = {\n            x: origin_state.x,\n            y: origin_state.y,\n            radius: origin_info.base_radius\n          };\n          const target_circle = {\n            x: target_state.x,\n            y: target_state.y,\n            radius: target_info.base_radius\n          };\n          const envelope = circleModel.envelopeTo(target_circle, origin_circle);\n          los.computed.envelope = envelope;\n\n          return R.thread()(\n            () => computeIntervenings(state, los.remote.ignore,\n                                      los.remote.target, target_circle,\n                                      los.remote.origin, envelope),\n            (intervenings) => [ origin_circle, intervenings ]\n          );\n        },\n        ([ origin_circle, intervenings ]) => {\n          const darkness = computeDarkness(origin_circle, intervenings);\n          los.computed.darkness = darkness;\n\n          const shadow = computeShadow(origin_circle, intervenings);\n          los.computed.shadow = shadow;\n        }\n      );\n    }\n    function getOriginTargetInfo(state, origin, target) {\n      return R.thread()(\n        () => [\n          gameModelsModel.findStamp(origin, state.game.models),\n          gameModelsModel.findStamp(target, state.game.models),\n        ],\n        ([{ state: origin_state }, { state: target_state }]) => {\n          return R.thread()(\n            () => [\n              gameFactionsModel.getModelInfo(origin_state.info, state.factions),\n              gameFactionsModel.getModelInfo(target_state.info, state.factions),\n            ],\n            ([origin_info, target_info]) => [\n              origin_state, origin_info,\n              target_state, target_info,\n            ]\n          );\n        }\n      );\n    }\n    function computeIntervenings(state, ignore,\n                                 target, target_circle,\n                                 origin, envelope) {\n      return R.thread(state.game.models)(\n        gameModelsModel.all,\n        R.map(getModelCircle),\n        R.reject(circleIsNotIntervening),\n        R.filter(circleModel.isInEnvelope$(envelope))\n      );\n\n      function getModelCircle(model) {\n        return R.thread()(\n          () => gameFactionsModel\n            .getModelInfo(model.state.info, state.factions),\n          (info) => R.assoc('radius', info.base_radius, model.state)\n        );\n      }\n      function circleIsNotIntervening(circle) {\n        return (target === circle.stamp ||\n                origin === circle.stamp ||\n                target_circle.radius > circle.radius ||\n                R.find(R.equals(circle.stamp), ignore)\n               );\n      }\n    }\n    function computeDarkness(origin_circle,\n                             intervenings) {\n      return R.map((circle) => circleModel\n                   .outsideEnvelopeTo(circle, [], origin_circle),\n                   intervenings);\n    }\n    function computeShadow(origin_circle,\n                           intervenings) {\n      return R.map((circle) => circleModel\n                   .outsideEnvelopeTo(circle, intervenings, origin_circle),\n                   intervenings);\n    }\n  }\n})();\n"]}