{"version":3,"sources":["elements.es6"],"names":[],"mappings":"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","file":"elements.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('gameElements', gameElementsModelFactory);\n\n  gameElementsModelFactory.$inject = [\n    'point',\n  ];\n  function gameElementsModelFactory(pointModel) {\n    return function buildGameElementsModel(type, model) {\n      const gameElementsModel = {\n        create: elementsCreate,\n        all: elementsAll,\n        findStamp: elementsFindStamp,\n        findAnyStamps: elementsFindAnyStamps,\n        fromStampsP: elementsFromStampsP,\n        onStampsP: elementsOnStampsP,\n        setStateStamps: elementsSetStateStamps,\n        lockStamps: elementsLockStamps,\n        add: elementsAdd,\n        removeStamps: elementsRemoveStamps,\n        copyStamps: elementsCopyStamps\n      };\n\n      const fromStampsP$ = R.curry(fromStampsP);\n      const updateElements$ = R.curry(updateElements);\n\n      R.curryService(gameElementsModel);\n      return gameElementsModel;\n\n      function elementsCreate() {\n        return {\n          active: [],\n          locked: []\n        };\n      }\n      function elementsAll(elements) {\n        return R.concat(elements.active, elements.locked);\n      }\n      function elementsFindStamp(stamp, elements) {\n        return R.thread(elements)(\n          gameElementsModel.all,\n          R.find(R.pathEq(['state','stamp'], stamp))\n        );\n      }\n      function elementsFindAnyStamps(stamps, elements) {\n        return R.map(gameElementsModel.findStamp$(R.__, elements), stamps);\n      }\n      function elementsFromStampsP(method, args, stamps, elements) {\n        return fromStampsP(() => R.always(null),\n                           method, args, stamps, elements);\n      }\n      function elementsOnStampsP(method, args, stamps, elements) {\n        return R.threadP(elements)(\n          fromStampsP$(R.always, method, args, stamps),\n          updateElements$(elements)\n        );\n      }\n      function elementsSetStateStamps(states, stamps, elements) {\n        return R.thread(elements)(\n          gameElementsModel.findAnyStamps$(stamps),\n          R.addIndex(R.map)(setStateIndex),\n          R.reject(R.isNil),\n          updateElements$(elements)\n        );\n\n        function setStateIndex(element, index) {\n          return ( R.isNil(element)\n                   ? null\n                   : model.setState(states[index], element)\n                 );\n        }\n      }\n      function elementsLockStamps(lock, stamps, elements) {\n        return R.thread(elements)(\n          gameElementsModel.findAnyStamps$(stamps),\n          R.reject(R.isNil),\n          R.map(model.setLock$(lock)),\n          updateElements$(elements)\n        );\n      }\n      function elementsAdd(news, elements) {\n        const new_stamps = R.map(R.path(['state','stamp']), news);\n        return R.thread(elements)(\n          gameElementsModel.removeStamps$(new_stamps),\n          updateElements$(R.__, news)\n        );\n      }\n      function elementsRemoveStamps(stamps, elements) {\n        return R.thread(elements)(\n          R.over(R.lensProp('active'), R.reject(inStamps)),\n          R.over(R.lensProp('locked'), R.reject(inStamps))\n        );\n\n        function inStamps(element) {\n          return R.find(R.equals(R.path(['state', 'stamp'], element)), stamps);\n        }\n      }\n      function elementsCopyStamps(stamps, elements) {\n        return R.thread(elements)(\n          gameElementsModel.findAnyStamps$(stamps),\n          R.reject(R.isNil),\n          makeCreate\n        );\n\n        function makeCreate(selection) {\n          const base = R.thread(selection)(\n            R.head,\n            R.defaultTo({ state: { x: 240, y: 240, r: 0 } }),\n            R.prop('state'),\n            R.pick(['x','y','r'])\n          );\n          return {\n            base: base,\n            [`${type}s`]: R.map(R.compose(pointModel.differenceFrom$(base),\n                                          model.saveState),\n                                selection)\n          };\n        }\n      }\n      function fromStampsP(onError, method, args, stamps, elements) {\n        return R.threadP()(\n          checkIfMethodExists,\n          () => gameElementsModel.findAnyStamps(stamps, elements),\n          R.reject(R.isNil),\n          R.map(callMethodOnElementP),\n          R.allP\n        );\n\n        function checkIfMethodExists() {\n          return R.threadP(model)(\n            R.prop(method),\n            R.type,\n            R.rejectIfP(R.complement(R.equals('Function')),\n                       `Unknown method \"${method}\" on ${type}s`)\n          );\n        }\n        function callMethodOnElementP(element) {\n          return R.resolveP(model[method].apply(model, [...args, element]))\n            .catch(onError(element));\n        }\n      }\n      function updateElements(elements, news) {\n        return R.thread(elements)(\n          gameElementsModel.all,\n          R.concat(news),\n          R.uniqBy(R.path(['state','stamp'])),\n          R.partition(model.isLocked),\n          ([locked, active]) => ({\n            active: active,\n            locked: locked\n          })\n        );\n      }\n    };\n  }\n})();\n"]}