{"version":3,"sources":["templates.es6"],"names":[],"mappings":";;;;AAAA,CAAC,YAAW;AACV,UAAQ,MAAR,CAAe,mBAAf,EACG,OADH,CACW,eADX,EAC4B,yBAD5B,EADU;;AAIV,4BAA0B,OAA1B,GAAoC,CAClC,UADkC,EAElC,cAFkC,CAApC,CAJU;AAQV,WAAS,yBAAT,CAAmC,aAAnC,EACmC,iBADnC,EACsD;AACpD,QAAM,OAAO,kBAAkB,UAAlB,EAA8B,aAA9B,CAAP,CAD8C;AAEpD,QAAM,qBAAqB,OAAO,MAAP,CAAc,IAAd,CAArB,CAF8C;AAGpD,MAAE,UAAF,CAAa,kBAAb,EAAiC;AAC/B,qBAAe,0BAAf;AACA,mBAAa,wBAAb;AACA,iBAAW,sBAAX;KAHF,EAHoD;;AASpD,QAAM,eAAe,EAAE,KAAF,CAAQ,WAAR,CAAf,CAT8C;AAUpD,QAAM,mBAAmB,EAAE,KAAF,CAAQ,eAAR,CAAnB,CAV8C;;AAYpD,MAAE,YAAF,CAAe,kBAAf,EAZoD;AAapD,WAAO,kBAAP,CAboD;;AAepD,aAAS,0BAAT,CAAoC,KAApC,EAA2C,SAA3C,EAAsD;AACpD,aAAO,EAAE,OAAF,CAAU,SAAV,EACL,mBAAmB,WAAnB,CAA+B,KAA/B,CADK,EAEL,EAAE,IAAF,CAAO,CAAC,OAAD,EAAS,MAAT,CAAP,CAFK,EAGL,EAAE,SAAF,CAAY,KAAZ,CAHK,EAIL,UAAC,IAAD,EAAU;AACR,eAAO,OAAK,UAAL,CADC;OAAV,CAJF,CADoD;KAAtD;AAUA,aAAS,wBAAT,CAAkC,MAAlC,EAA0C,IAA1C,EAAgD,MAAhD,EAAwD,SAAxD,EAAmE;AACjE,aAAO,aAAa,EAAE,OAAF,CAAU,EAAE,MAAF,EAAU,EAAE,MAAF,CAAS,IAAT,CAApB,CAAb,EACa,MADb,EACqB,IADrB,EAC2B,MAD3B,EACmC,SADnC,CAAP,CADiE;KAAnE;AAIA,aAAS,sBAAT,CAAgC,MAAhC,EAAwC,IAAxC,EAA8C,MAA9C,EAAsD,SAAtD,EAAiE;AAC/D,aAAO,EAAE,OAAF,CAAU,SAAV,EACL,aAAa,EAAE,MAAF,EAAU,MAAvB,EAA+B,IAA/B,EAAqC,MAArC,CADK,EAEL,iBAAiB,SAAjB,CAFK,CAAP,CAD+D;KAAjE;AAMA,aAAS,WAAT,CAAqB,OAArB,EAA8B,MAA9B,EAAsC,IAAtC,EAA4C,MAA5C,EAAoD,SAApD,EAA+D;AAC7D,aAAO,EAAE,OAAF,CAAU,SAAV,EACL,mBAAmB,eAAnB,CAAmC,MAAnC,CADK,EAEL,EAAE,MAAF,CAAS,EAAE,KAAF,CAFJ,EAGL,EAAE,GAAF,CAAM,oBAAN,CAHK,EAIL,EAAE,UAAF,CAJF,CAD6D;;AAQ7D,eAAS,oBAAT,CAA8B,QAA9B,EAAwC;AACtC,eAAO,KAAK,OAAL,CACJ,OADI,CACI,cAAc,KAAd,CAAoB,MAApB,EAA4B,IAA5B,EAAkC,QAAlC,CADJ,EAEJ,KAFI,CAEE,QAAQ,QAAR,CAFF,CAAP,CADsC;OAAxC;KARF;AAcA,aAAS,eAAT,CAAyB,SAAzB,EAAoC,IAApC,EAA0C;AACxC,aAAO,EAAE,MAAF,CAAS,SAAT,EACL,mBAAmB,GAAnB,EACA,EAAE,MAAF,CAAS,IAAT,CAFK,EAGL,EAAE,MAAF,CAAS,EAAE,IAAF,CAAO,CAAC,OAAD,EAAS,OAAT,CAAP,CAAT,CAHK,EAIL,EAAE,SAAF,CAAY,cAAc,QAAd,CAJP,EAKL,gBAAsB;;;YAApB,kBAAoB;YAAZ,kBAAY;;AACpB,eAAO;AACL,kBAAQ,MAAR;AACA,kBAAQ,MAAR;SAFF,CADoB;OAAtB,CALF,CADwC;KAA1C;GAlDF;CARD,CAAD","file":"templates.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('gameTemplates', gameTemplatesModelFactory);\n\n  gameTemplatesModelFactory.$inject = [\n    'template',\n    'gameElements',\n  ];\n  function gameTemplatesModelFactory(templateModel,\n                                     gameElementsModel) {\n    const base = gameElementsModel('template', templateModel);\n    const gameTemplatesModel = Object.create(base);\n    R.deepExtend(gameTemplatesModel, {\n      modeForStampP: gameTemplatesModeForStampP,\n      fromStampsP: gameTemplatesFromStampsP,\n      onStampsP: gameTemplatesOnStampsP\n    });\n\n    const fromStampsP$ = R.curry(fromStampsP);\n    const updateTemplates$ = R.curry(updateTemplates);\n\n    R.curryService(gameTemplatesModel);\n    return gameTemplatesModel;\n\n    function gameTemplatesModeForStampP(stamp, templates) {\n      return R.threadP(templates)(\n        gameTemplatesModel.findStampP$(stamp),\n        R.path(['state','type']),\n        R.defaultTo('aoe'),\n        (type) => {\n          return type+'Template';\n        }\n      );\n    }\n    function gameTemplatesFromStampsP(method, args, stamps, templates) {\n      return fromStampsP$(R.compose(R.always, R.always(null)),\n                          method, args, stamps, templates);\n    }\n    function gameTemplatesOnStampsP(method, args, stamps, templates) {\n      return R.threadP(templates)(\n        fromStampsP$(R.always, method, args, stamps),\n        updateTemplates$(templates)\n      );\n    }\n    function fromStampsP(onError, method, args, stamps, templates) {\n      return R.threadP(templates)(\n        gameTemplatesModel.findAnyStampsP$(stamps),\n        R.reject(R.isNil),\n        R.map(callMethodOnTemplate),\n        R.promiseAll\n      );\n\n      function callMethodOnTemplate(template) {\n        return self.Promise\n          .resolve(templateModel.callP(method, args, template))\n          .catch(onError(template));\n      }\n    }\n    function updateTemplates(templates, news) {\n      return R.thread(templates)(\n        gameTemplatesModel.all,\n        R.concat(news),\n        R.uniqBy(R.path(['state','stamp'])),\n        R.partition(templateModel.isLocked),\n        ([locked, active]) => {\n          return {\n            active: active,\n            locked: locked\n          };\n        }\n      );\n    }\n  }\n})();\n"]}