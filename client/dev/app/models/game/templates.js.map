{"version":3,"sources":["templates.es6"],"names":[],"mappings":";;;;AAAA,CAAC,YAAW;AACV,UAAQ,MAAR,CAAe,mBAAf,EACG,OADH,CACW,eADX,EAC4B,yBAD5B,EADU;;AAIV,4BAA0B,OAA1B,GAAoC,CAClC,UADkC,EAElC,cAFkC,CAApC,CAJU;AAQV,WAAS,yBAAT,CAAmC,aAAnC,EACmC,iBADnC,EACsD;AACpD,QAAM,OAAO,kBAAkB,UAAlB,EAA8B,aAA9B,CAAP,CAD8C;AAEpD,QAAM,qBAAqB,OAAO,MAAP,CAAc,IAAd,CAArB,CAF8C;AAGpD,MAAE,UAAF,CAAa,kBAAb,EAAiC;AAC/B,mBAAa,wBAAb;AACA,iBAAW,sBAAX;KAFF,EAHoD;;AAQpD,QAAM,eAAe,EAAE,KAAF,CAAQ,WAAR,CAAf,CAR8C;AASpD,QAAM,mBAAmB,EAAE,KAAF,CAAQ,eAAR,CAAnB,CAT8C;;AAWpD,MAAE,YAAF,CAAe,kBAAf,EAXoD;AAYpD,WAAO,kBAAP,CAZoD;;AAcpD,aAAS,wBAAT,CAAkC,MAAlC,EAA0C,IAA1C,EAAgD,MAAhD,EAAwD,SAAxD,EAAmE;AACjE,aAAO,aAAa,EAAE,OAAF,CAAU,EAAE,MAAF,EAAU,EAAE,MAAF,CAAS,IAAT,CAApB,CAAb,EACa,MADb,EACqB,IADrB,EAC2B,MAD3B,EACmC,SADnC,CAAP,CADiE;KAAnE;AAIA,aAAS,sBAAT,CAAgC,MAAhC,EAAwC,IAAxC,EAA8C,MAA9C,EAAsD,SAAtD,EAAiE;AAC/D,aAAO,EAAE,OAAF,CAAU,SAAV,EACL,aAAa,EAAE,MAAF,EAAU,MAAvB,EAA+B,IAA/B,EAAqC,MAArC,CADK,EAEL,iBAAiB,SAAjB,CAFK,CAAP,CAD+D;KAAjE;AAMA,aAAS,WAAT,CAAqB,OAArB,EAA8B,MAA9B,EAAsC,IAAtC,EAA4C,MAA5C,EAAoD,SAApD,EAA+D;AAC7D,aAAO,EAAE,OAAF,CAAU,SAAV,EACL,mBAAmB,cAAnB,CAAkC,MAAlC,CADK,EAEL,EAAE,MAAF,CAAS,EAAE,KAAF,CAFJ,EAGL,EAAE,GAAF,CAAM,qBAAN,CAHK,EAIL,EAAE,IAAF,CAJF,CAD6D;;AAQ7D,eAAS,qBAAT,CAA+B,QAA/B,EAAyC;AACvC,eAAO,EAAE,QAAF,CAAW,cAAc,KAAd,CAAoB,MAApB,EAA4B,IAA5B,EAAkC,QAAlC,CAAX,EACJ,KADI,CACE,QAAQ,QAAR,CADF,CAAP,CADuC;OAAzC;KARF;AAaA,aAAS,eAAT,CAAyB,SAAzB,EAAoC,IAApC,EAA0C;AACxC,aAAO,EAAE,MAAF,CAAS,SAAT,EACL,mBAAmB,GAAnB,EACA,EAAE,MAAF,CAAS,IAAT,CAFK,EAGL,EAAE,MAAF,CAAS,EAAE,IAAF,CAAO,CAAC,OAAD,EAAS,OAAT,CAAP,CAAT,CAHK,EAIL,EAAE,SAAF,CAAY,cAAc,QAAd,CAJP,EAKL;;;YAAE;YAAQ;eAAa;AACrB,kBAAQ,MAAR;AACA,kBAAQ,MAAR;;OAFF,CALF,CADwC;KAA1C;GAtCF;CARD,CAAD","file":"templates.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('gameTemplates', gameTemplatesModelFactory);\n\n  gameTemplatesModelFactory.$inject = [\n    'template',\n    'gameElements',\n  ];\n  function gameTemplatesModelFactory(templateModel,\n                                     gameElementsModel) {\n    const base = gameElementsModel('template', templateModel);\n    const gameTemplatesModel = Object.create(base);\n    R.deepExtend(gameTemplatesModel, {\n      fromStampsP: gameTemplatesFromStampsP,\n      onStampsP: gameTemplatesOnStampsP\n    });\n\n    const fromStampsP$ = R.curry(fromStampsP);\n    const updateTemplates$ = R.curry(updateTemplates);\n\n    R.curryService(gameTemplatesModel);\n    return gameTemplatesModel;\n\n    function gameTemplatesFromStampsP(method, args, stamps, templates) {\n      return fromStampsP$(R.compose(R.always, R.always(null)),\n                          method, args, stamps, templates);\n    }\n    function gameTemplatesOnStampsP(method, args, stamps, templates) {\n      return R.threadP(templates)(\n        fromStampsP$(R.always, method, args, stamps),\n        updateTemplates$(templates)\n      );\n    }\n    function fromStampsP(onError, method, args, stamps, templates) {\n      return R.threadP(templates)(\n        gameTemplatesModel.findAnyStamps$(stamps),\n        R.reject(R.isNil),\n        R.map(callMethodOnTemplateP),\n        R.allP\n      );\n\n      function callMethodOnTemplateP(template) {\n        return R.resolveP(templateModel.callP(method, args, template))\n          .catch(onError(template));\n      }\n    }\n    function updateTemplates(templates, news) {\n      return R.thread(templates)(\n        gameTemplatesModel.all,\n        R.concat(news),\n        R.uniqBy(R.path(['state','stamp'])),\n        R.partition(templateModel.isLocked),\n        ([locked, active]) => ({\n          active: active,\n          locked: locked\n        })\n      );\n    }\n  }\n})();\n"]}