{"version":3,"sources":["templates.es6"],"names":[],"mappings":"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","file":"templates.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('gameTemplates', [\n    'template',\n    function gameTemplatesServiceFactory(templateService) {\n      var gameTemplatesService = {\n        create: function() {\n          return {\n            active: [],\n            locked: []\n          };\n        },\n        all: function templatesAll(templates) {\n          return R.concat(templates.active, templates.locked);\n        },\n        findStampIn: function templatesFindStampIn(stamp, where, templates) {\n          return new self.Promise((resolve, reject) => {\n            var find = R.pipe(\n              R.prop(where),\n              R.find(R.pathEq(['state','stamp'], stamp))\n            )(templates);\n            return (R.exists(find) ?\n                    resolve(find) :\n                    reject(`stamp ${stamp} not found in ${where}`)\n                   );\n          });\n        },\n        findStamp: function templatesFindStamp(stamp, templates) {\n          return gameTemplatesService\n            .findStampIn(stamp, 'active', templates)\n            .catch(() => {\n              return gameTemplatesService\n                .findStampIn(stamp, 'locked', templates);\n            });\n        },\n        findAnyStamps: function templatesFindAnyStamps(stamps, templates) {\n          return R.pipePromise(\n            R.map((stamp) => {\n              return gameTemplatesService\n                .findStamp(stamp, templates)\n                .catch(R.always(null));\n            }),\n            R.promiseAll,\n            (stamps) => {\n              if(R.isEmpty(R.reject(R.isNil, stamps))) {\n                return self.Promise.reject('No template found');\n              }\n              return stamps;\n            }\n          )(stamps);\n        },\n        fromStamps: function templatesFromStamps(method, args, stamps, templates) {\n          return fromStamps$(R.compose(R.always, R.always(null)),\n                             method, args, stamps, templates);\n        },\n        onStamps: function templatesOnStamps(method, args, stamps, templates) {\n          return R.pipeP(\n            fromStamps$(R.always, method, args, stamps),\n            updateTemplates$(templates)\n          )(templates);\n        },\n        setStateStamps: function templatesSetStateStamps(states, stamps, templates) {\n          return R.pipeP(\n            gameTemplatesService.findAnyStamps$(stamps),\n            R.addIndex(R.map)((template, index) => {\n              return ( R.isNil(template) ?\n                       null :\n                       templateService.setState(states[index], template)\n                     );\n            }),\n            R.reject(R.isNil),\n            updateTemplates$(templates)\n          )(templates);\n        },\n        add: function templatesAdd(temps, templates) {\n          return R.pipe(\n            gameTemplatesService.removeStamps$(R.map(R.path(['state','stamp']), temps)),\n            (templates) => {\n              return R.assoc('active', R.concat(templates.active, temps), templates);\n            }\n          )(templates);\n        },\n        removeStamps: function templatesRemoveStamps(stamps, templates) {\n          function inStamps(template) {\n            return R.find(R.equals(R.path(['state', 'stamp'], template)), stamps);\n          }\n          return R.pipe(\n            R.assoc('active', R.reject(inStamps, templates.active)),\n            R.assoc('locked', R.reject(inStamps, templates.locked))\n          )(templates);\n        },\n        isActive: function templatesIsLocked(stamp, templates) {\n          return R.find(R.pathEq(['state','stamp'], stamp), templates.active);\n        },\n        isLocked: function templatesIsLocked(stamp, templates) {\n          return R.find(R.pathEq(['state','stamp'], stamp), templates.locked);\n        },\n        lockStamps: function templatesLockStamps(lock, stamps, templates) {\n          return R.pipePromise(\n            gameTemplatesService.findAnyStamps$(stamps),\n            R.reject(R.isNil),\n            R.map(templateService.setLock$(lock)),\n            updateTemplates$(templates)\n          )(templates);\n        },\n        modeForStamp: function templateSelectionModeForStamp(stamp, templates) {\n          return R.pipeP(\n            gameTemplatesService.findStamp$(stamp),\n            R.path(['state','type']),\n            R.defaultTo('aoe'),\n            (type) => {\n              return type+'Template';\n            }\n          )(templates);\n        }\n      };\n      var fromStamps$ = R.curry((onError, method, args, stamps, templates) => {\n        return R.pipeP(\n          gameTemplatesService.findAnyStamps$(stamps),\n          R.reject(R.isNil),\n          R.map((template) => {\n            return self.Promise\n              .resolve(templateService.call(method, args, template))\n              .catch(onError(template));\n          }),\n          R.promiseAll\n        )(templates);\n      });\n      var updateTemplates$ = R.curry((templates, news) => {\n        return R.pipe(\n          gameTemplatesService.all,\n          R.concat(news),\n          R.uniqBy(R.path(['state','stamp'])),\n          R.partition(templateService.isLocked),\n          ([locked, active]) => {\n            return {\n              active: active,\n              locked: locked\n            };\n          }\n        )(templates);\n      });\n      R.curryService(gameTemplatesService);\n      return gameTemplatesService;\n    }\n  ]);\n"]}