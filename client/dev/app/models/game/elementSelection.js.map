{"version":3,"sources":["elementSelection.es6"],"names":[],"mappings":"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","file":"elementSelection.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('gameElementSelection', gameElementSelectionModelFactory);\n\n  gameElementSelectionModelFactory.$inject = [];\n  function gameElementSelectionModelFactory() {\n    return function buildElementSelectionModel(type) {\n      const gameElementSelectionModel = {\n        create: elementSelectionCreate,\n        'in': elementSelectionIn,\n        get: elementSelectionGet,\n        checkModeP: elementSelectionCheckModeP,\n        set: elementSelectionSet,\n        addTo: elementSelectionAddTo,\n        removeFrom: elementSelectionRemoveFrom,\n        clear: elementSelectionClear\n      };\n\n      const emitChangeEvent$ = R.curry(emitChangeEvent);\n      R.curryService(gameElementSelectionModel);\n      return gameElementSelectionModel;\n\n      function elementSelectionCreate() {\n        return {\n          local: [],\n          remote: []\n        };\n      }\n      function elementSelectionIn(where, stamp, selection) {\n        const stamps = R.prop(where, selection);\n        return R.find(R.equals(stamp), stamps);\n      }\n      function elementSelectionGet(where, selection) {\n        return R.propOr([], where, selection);\n      }\n      function elementSelectionCheckModeP(state, selection) {\n        return R.threadP(selection)(\n          gameElementSelectionModel.get$('local'),\n          R.head,\n          R.rejectIf(R.isNil, `No ${type} selection`),\n          () => {\n            state.queueEventP('Modes.switchTo', s.capitalize(type));\n          }\n        );\n      }\n      function elementSelectionSet(where, stamps, state, selection) {\n        const previous = gameElementSelectionModel.get(where, selection);\n        const ret = R.assoc(where, stamps, selection);\n\n        checkSelection(where, state);\n\n        R.forEach(emitChangeEvent$(state), stamps);\n        R.forEach(emitChangeEvent$(state), previous);\n\n        return ret;\n      }\n      function elementSelectionAddTo(where, stamps, state, selection) {\n        const previous = gameElementSelectionModel.get(where, selection);\n        const new_selection = R.uniq(R.concat(previous, stamps));\n        const ret = R.assoc(where, new_selection, selection);\n\n        checkSelection(where, state);\n\n        R.forEach(emitChangeEvent$(state), new_selection);\n\n        return ret;\n      }\n      function elementSelectionRemoveFrom(where, stamps, state, selection) {\n        const previous = R.prop(where, selection);\n        const new_selection = R.difference(previous, stamps);\n        const ret = R.assoc(where, new_selection, selection);\n\n        checkSelection(where, state);\n\n        R.forEach(emitChangeEvent$(state),\n                  R.uniq(R.concat(previous, stamps)));\n\n        return ret;\n      }\n      function elementSelectionClear(where, state, selection) {\n        const previous = R.prop(where, selection);\n        return gameElementSelectionModel\n          .removeFrom(where, previous, state, selection);\n      }\n      function checkSelection(where, state) {\n        if('local' === where) {\n          state.queueChangeEventP(`Game.selection.local.change`);\n          state.queueChangeEventP(`Game.${type}.selection.local.change`);\n        }\n      }\n      function emitChangeEvent(state, stamp) {\n        state.queueChangeEventP(`Game.${type}.change.${stamp}`);\n      }\n    };\n  }\n})();\n"]}