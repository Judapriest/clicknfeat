{"version":3,"sources":["terrainSelection.es6"],"names":[],"mappings":"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","file":"terrainSelection.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('gameTerrainSelection', gameTerrainSelectionModelFactory);\n\n  gameTerrainSelectionModelFactory.$inject = [];\n  function gameTerrainSelectionModelFactory() {\n    const gameTerrainSelectionModel = {\n      create: terrainSelectionCreate,\n      'in': terrainSelectionIn,\n      get: terrainSelectionGet,\n      checkModeP: terrainSelectionCheckModeP,\n      set: terrainSelectionSet,\n      addTo: terrainSelectionAddTo,\n      removeFrom: terrainSelectionRemoveFrom,\n      clear: terrainSelectionClear\n    };\n\n    const emitChangeEvent$ = R.curry(emitChangeEvent);\n    R.curryService(gameTerrainSelectionModel);\n    return gameTerrainSelectionModel;\n\n    function terrainSelectionCreate() {\n      return {\n        local: [],\n        remote: []\n      };\n    }\n    function terrainSelectionIn(where, stamp, selection) {\n      const stamps = R.prop(where, selection);\n      return R.find(R.equals(stamp), stamps);\n    }\n    function terrainSelectionGet(where, selection) {\n      return R.propOr([], where, selection);\n    }\n    function terrainSelectionCheckModeP(state, selection) {\n      return R.threadP(selection)(\n        gameTerrainSelectionModel.get$('local'),\n        R.head,\n        R.rejectIf(R.isNil, 'No terrain selection'),\n        () => {\n          state.queueEventP('Modes.switchTo', 'Terrain');\n        }\n      );\n    }\n    function terrainSelectionSet(where, stamps, state, selection) {\n      const previous = gameTerrainSelectionModel.get(where, selection);\n      const ret = R.assoc(where, stamps, selection);\n\n      checkSelection(where, state);\n\n      R.forEach(emitChangeEvent$(state), stamps);\n      R.forEach(emitChangeEvent$(state), previous);\n\n      return ret;\n    }\n    function terrainSelectionAddTo(where, stamps, state, selection) {\n      const previous = gameTerrainSelectionModel.get(where, selection);\n      const new_selection = R.uniq(R.concat(previous, stamps));\n      const ret = R.assoc(where, new_selection, selection);\n\n      checkSelection(where, state);\n\n      R.forEach(emitChangeEvent$(state), new_selection);\n\n      return ret;\n    }\n    function terrainSelectionRemoveFrom(where, stamps, state, selection) {\n      const previous = R.prop(where, selection);\n      const new_selection = R.difference(previous, stamps);\n      const ret = R.assoc(where, new_selection, selection);\n\n      checkSelection(where, state);\n\n      R.forEach(emitChangeEvent$(state),\n                R.uniq(R.concat(previous, stamps)));\n\n      return ret;\n    }\n    function terrainSelectionClear(where, state, selection) {\n      const previous = R.prop(where, selection);\n      return gameTerrainSelectionModel\n        .removeFrom(where, previous, state, selection);\n    }\n    function checkSelection(where, state) {\n      if('local' === where) {\n        state.queueEventP('Modes.switchTo', 'Default');\n        state.queueChangeEventP('Game.terrain.selection.local.change');\n      }\n    }\n    function emitChangeEvent(state, stamp) {\n      state.queueChangeEventP(`Game.terrain.change.${stamp}`);\n    }\n  }\n})();\n"]}