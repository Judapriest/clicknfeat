{"version":3,"sources":["terrainSelection.es6"],"names":[],"mappings":"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","file":"terrainSelection.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('gameTerrainSelection', [\n    function gameTerrainSelectionServiceFactory() {\n      function checkSelection(where, state) {\n        if('local' === where) {\n          state.event('Modes.switchTo', 'Default');\n          state.changeEvent('Game.terrain.selection.local.change');\n        }\n      }\n      var gameTerrainSelectionService = {\n        create: function terrainSelectionCreate() {\n          return {\n            local: [],\n            remote: []\n          };\n        },\n        'in': function terrainSelectionIn(where, stamp, selection) {\n          var stamps = R.prop(where, selection);\n          return R.find(R.equals(stamp), stamps);\n        },\n        get: function terrainSelectionGet(where, selection = {}) {\n          R.spyError('titi', arguments);\n          return R.propOr([], where, selection);\n        },\n        checkMode: function terrainSelectionCheckMode(state, selection) {\n          return R.pipePromise(\n            (selection) => {\n              return gameTerrainSelectionService.get('local', selection);\n            },\n            R.head,\n            (stamp) => {\n              if(R.isNil(stamp)) {\n                return self.Promise.reject('No terrain selection');\n              }\n\n              return state.event('Modes.switchTo', 'Terrain');\n            }\n          )(selection);\n        },\n        set: function terrainSelectionSet(where, stamps, state, selection) {\n          var previous = gameTerrainSelectionService.get(where, selection);\n          var ret = R.assoc(where, stamps, selection);\n\n          checkSelection(where, state);\n          \n          R.forEach((stamp) => {\n            state.changeEvent(`Game.terrain.change.${stamp}`);\n          }, stamps);\n          R.forEach((stamp) => {\n            state.changeEvent(`Game.terrain.change.${stamp}`);\n          }, previous);\n\n          return ret;\n        },\n        addTo: function terrainSelectionSet(where, stamps, state, selection) {\n          var previous = gameTerrainSelectionService.get(where, selection);\n          var new_selection = R.uniq(R.concat(previous, stamps));\n          var ret = R.assoc(where, new_selection, selection);\n\n          checkSelection(where, state);\n          \n          R.forEach((stamp) => {\n            state.changeEvent(`Game.terrain.change.${stamp}`);\n          }, new_selection);\n\n          return ret;\n        },\n        removeFrom: function terrainSelectionRemoveFrom(where, stamps, state, selection) {\n          var previous = R.prop(where, selection);\n          var new_selection = R.difference(previous, stamps);\n          var ret = R.assoc(where, new_selection, selection);\n          \n          checkSelection(where, state);\n\n          R.forEach((stamp) => {\n            state.changeEvent(`Game.terrain.change.${stamp}`);\n          }, R.uniq(R.concat(previous, stamps)));\n\n          return ret;\n        },\n        clear: function terrainSelectionClear(where, state, selection) {\n          var previous = R.prop(where, selection);\n          return gameTerrainSelectionService\n            .removeFrom(where, previous, state, selection);\n        }\n      };\n      R.curryService(gameTerrainSelectionService);\n      return gameTerrainSelectionService;\n    }\n  ]);\n"]}