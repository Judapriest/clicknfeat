{"version":3,"sources":["ruler.es6"],"names":[],"mappings":"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","file":"ruler.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('gameRuler', [\n    'point',\n    'model',\n    'gameModels',\n    function gameRulerServiceFactory(pointService,\n                                     modelService,\n                                     gameModelsService) {\n      var gameRulerService = {\n        create: function gameRulerCreate() {\n          return {\n            local: {\n              display: false,\n              start: { x: 0, y: 0 },\n              end: { x: 0, y: 0 },\n              length: null\n            },\n            remote: {\n              display: false,\n              start: { x: 0, y: 0 },\n              end: { x: 0, y: 0 },\n              length: null\n            }\n          };\n        },\n        isDisplayed: function gameRulerIsDisplayed(ruler) {\n          return R.path(['remote','display'], ruler);\n        },\n        maxLength: function gameRulerMaxLength(ruler) {\n          return R.pathOr(0, ['remote','max'], ruler);\n        },\n        setMaxLength: function gameRulerSetMaxLength(length, state, ruler) {\n          ruler = R.pipe(\n            R.assocPath(['local', 'max'], length),\n            R.assocPath(['remote', 'max'], length)\n          )(ruler);\n          return setupRemoteRuler(state, ruler);\n        },\n        origin: function gameRulerOrigin(ruler) {\n          return R.path(['remote', 'origin'], ruler);\n        },\n        clearOrigin: function gameRulerClearOrigin(state, ruler) {\n          return setOriginTarget(null,\n                                 ruler.remote.target,\n                                 ruler.remote.max,\n                                 state, ruler);\n        },\n        setOrigin: function gameRulerSetOrigin(origin_model, state, ruler) {\n          var origin = origin_model.state.stamp;\n          var target = gameRulerService.target(ruler);\n          target = (target === origin) ? null : target;\n          var max_length = modelService.rulerMaxLength(origin_model);\n          return setOriginTarget(origin, target, max_length, state, ruler);\n        },\n        setOriginResetTarget: function gameRulerSetOrigin(origin_model, state, ruler) {\n          var origin = origin_model.state.stamp;\n          var max_length = modelService.rulerMaxLength(origin_model);\n          return setOriginTarget(origin, null, max_length, state, ruler);\n        },\n        target: function gameRulerTarget(ruler) {\n          return R.path(['remote', 'target'], ruler);\n        },\n        targetReached: function gameRulerTargetReached(ruler) {\n          return R.path(['remote', 'reached'], ruler);\n        },\n        clearTarget: function gameRulerClearTarget(state, ruler) {\n          return setOriginTarget(ruler.remote.origin,\n                                 null,\n                                 null,\n                                 state, ruler);\n        },\n        setTarget: function gameRulerSetTarget(target_model, state, ruler) {\n          var origin = gameRulerService.origin(ruler);\n          var target = target_model.state.stamp;\n          origin = (origin === target) ? null : origin;\n          return setOriginTarget(origin, target, null, state, ruler);\n        },\n        updateOriginTarget: function gameRulerUpdateOriginTarget(state, ruler) {\n          return setupRemoteRuler(state, ruler);\n        },\n        toggleDisplay: function gameRulerToggleDisplay(state, ruler) {\n          var path = ['remote','display'];\n          ruler = R.assocPath(path, !R.path(path, ruler), ruler);\n          state.changeEvent('Game.ruler.remote.change');\n          return ruler;\n        },\n        setLocal: function gameRulerSetLocal(start, end, state, ruler) {\n          return R.pipe(\n            R.prop('local'),\n            R.assoc('start', R.clone(start)),\n            enforceEndToMaxLength(end),\n            R.assoc('length', null),\n            R.assoc('display', true),\n            (local) => {\n              state.changeEvent('Game.ruler.local.change');\n\n              return R.assoc('local', local, ruler);\n            }\n          )(ruler);\n        },\n        setRemote: function gameRulerSetRemote(start, end, state, ruler) {\n          ruler = R.assocPath(['local','display'], false, ruler);          \n          state.changeEvent('Game.ruler.local.change');\n\n          let remote = R.pipe(\n            R.assoc('origin', null),\n            R.assoc('target', null),\n            R.assoc('start', R.clone(start)),\n            R.assoc('end', R.clone(end)),\n            R.assoc('display', true)\n          )(ruler.remote);\n          ruler = R.assoc('remote', remote, ruler);\n          \n          return setupRemoteRuler(state, ruler);\n        },\n        saveRemoteState: function gameRulerSaveRemoteState(ruler) {\n          return R.clone(R.prop('remote', ruler));\n        },\n        resetRemote: function gameRulerResetRemote(remote, state, ruler) {\n          var ret = R.assoc('remote', R.clone(remote), ruler);\n          state.changeEvent('Game.ruler.remote.change');\n          return ret;\n        },\n        targetAoEPosition: function gameRulerTargetAoEPosition(models, ruler) {\n          var dir = pointService.directionTo(ruler.remote.end, ruler.remote.start);\n          var max = ruler.remote.length / 2;\n          var end = ruler.remote.end;\n          var target = gameRulerService.target(ruler);\n          return R.pipePromise(\n            (end) => {\n              if( R.exists(target) &&\n                  gameRulerService.targetReached(ruler) ) {\n                return R.pipeP(\n                  gameModelsService.findStamp$(target),\n                  R.prop('state')\n                )(models);\n              }\n              return end;\n            },\n            R.pick(['x', 'y']),\n            R.assoc('r', dir),\n            R.assoc('m', max)\n          )(end);\n        }\n      };\n      var enforceEndToMaxLength = R.curry(function _enforceEndToMaxLength(end, ruler) {\n        var length = pointService.distanceTo(end, ruler.start);\n        var dir = pointService.directionTo(end, ruler.start);\n        var max = 10 * R.defaultTo(length/10, ruler.max);\n        length = Math.min(length, max);\n        end = pointService.translateInDirection(length, dir, ruler.start);\n        return R.assoc('end', end, ruler);\n      });\n      function setOriginTarget(origin, target, max_length, state, ruler) {\n        var display = R.exists(origin) && R.exists(target);\n        ruler = R.assoc('remote', R.pipe(\n          R.assoc('origin', origin),\n          R.assoc('target', target),\n          R.assoc('display', display),\n          (remote) => {\n            if(R.exists(max_length)) {\n              return R.assoc('max', max_length, remote);\n            }\n            return remote;\n          }\n        )(ruler.remote), ruler);\n        return setupRemoteRuler(state, ruler);\n      }\n      function setupRemoteRuler(state, ruler) {\n        return R.pipeP(\n          () => {\n            var origin = R.path(['remote','origin'], ruler);\n            if(R.exists(origin)) {\n              return gameModelsService.findStamp(origin, state.game.models)\n                .catch(R.always(null));\n            }\n            return self.Promise.resolve(null);\n          },\n          (origin_model) => {\n            return R.pipeP(\n              () => {\n                var target = R.path(['remote','target'], ruler);\n                if(R.exists(target)) {\n                  return gameModelsService.findStamp(target, state.game.models)\n                    .catch(R.always(null));\n                }\n                return self.Promise.resolve(null);\n              },\n              (target_model) => {\n                if(R.exists(origin_model) &&\n                   R.exists(target_model)) {\n                  return modelService.shortestLineTo(state.factions,\n                                                     target_model,\n                                                     origin_model);\n                }\n                if(R.exists(origin_model)) {\n                  return {\n                    start: R.pick(['x','y'], origin_model.state),\n                    end: R.pick(['x','y'], origin_model.state)\n                  };\n                }\n                if(R.exists(target_model)) {\n                  return {\n                    start: R.pick(['x','y'], target_model.state),\n                    end: R.pick(['x','y'], target_model.state)\n                  };\n                }\n                return R.pick(['start', 'end'], R.prop('remote', ruler));\n              },\n              ({ start, end }) => {\n                var models_dist = pointService.distanceTo(end, start);\n                ruler = R.over(R.lensProp('remote'), R.pipe(\n                  R.assoc('start', start),\n                  enforceEndToMaxLength(end),\n                  (remote) => {\n                    var ruler_length = pointService.distanceTo(remote.end, remote.start);\n                    return R.pipe(\n                      R.assoc('reached', ruler_length >= models_dist - 0.1),\n                      R.assoc('length', Math.round(ruler_length * 10) / 100)\n                    )(remote);\n                  }\n                ), ruler);\n\n                state.changeEvent('Game.ruler.remote.change');\n\n                return ruler;\n              }\n            )();\n          }\n        )();\n      }\n      R.curryService(gameRulerService);\n      return gameRulerService;\n    }\n  ]);\n"]}