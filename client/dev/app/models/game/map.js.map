{"version":3,"sources":["map.es6"],"names":[],"mappings":"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","file":"map.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('gameMap', [\n    'gameModels',\n    'gameTemplates',\n    'gameTerrains',\n    function gameMapServiceFactory(gameModelsService,\n                                   gameTemplatesService,\n                                   gameTerrainsService) {\n      var gameMapService = {\n        isFlipped: function mapIsFlipped(map) {\n          return map.classList.contains('flipped');\n        },\n        zoomFactor: function mapZoomFactor(map) {\n          var map_rect = map.getBoundingClientRect();\n          return map_rect.width / 480;\n        },\n        eventToMapCoordinates: function gameMapEventToMapCoordinates(map, event) {\n          var map_flipped = gameMapService.isFlipped(map);\n          var rect = map.getBoundingClientRect();\n          var map_x = (event.clientX - rect.left) * 480 / rect.width;\n          var map_y = (event.clientY - rect.top) * 480 / rect.height;\n          map_x = ( map_flipped ? 480 - map_x : map_x );\n          map_y = ( map_flipped ? 480 - map_y : map_y );\n          return { x: map_x, y: map_y };\n        },\n        mapToScreenCoordinates: function gameMapMapToScreenCoordinates(map, coord) {\n          var map_flipped = gameMapService.isFlipped(map);\n          var rect = map.getBoundingClientRect();\n          var x = (coord.x * rect.width / 480);\n          var y = (coord.y * rect.height / 480);\n          if(map_flipped) {\n            x = rect.width - x;\n            y = rect.height - y;\n          }\n          x = x + rect.left;\n          y = y + rect.top;\n          return { x: x, y: y };\n        },\n        findEventTarget: function gameMapFindEventTarget(game, event) {\n          var stamp;\n          var not_found = {\n            type: 'Map',\n            target: null\n          };\n          if(event.target.classList.contains('template') &&\n             event.target.hasAttribute('data-stamp')) {\n            stamp = event.target.getAttribute('data-stamp');\n            return R.pipeP(\n              gameTemplatesService.findStamp$(stamp),\n              (template) => {\n                return { type: 'Template',\n                         target: template\n                       };\n              }\n            )(game.templates).catch(R.always(not_found));\n          }\n          if(event.target.classList.contains('model-base') &&\n             event.target.hasAttribute('data-stamp')) {\n            stamp = event.target.getAttribute('data-stamp');\n            return R.pipeP(\n              gameModelsService.findStamp$(stamp),\n              (model) => {\n                return { type: 'Model',\n                         target: model\n                       };\n              }\n            )(game.models).catch(R.always(not_found));\n          }\n          if(event.target.classList.contains('terrain-image') &&\n             event.target.hasAttribute('data-stamp')) {\n            stamp = event.target.getAttribute('data-stamp');\n            return R.pipeP(\n              gameTerrainsService.findStamp$(stamp),\n              (terrain) => {\n                return { type: 'Terrain',\n                         target: terrain\n                       };\n              }\n            )(game.terrains).catch(R.always(not_found));\n          }\n          return self.Promise.resolve(not_found);\n        }\n      };\n      R.curryService(gameMapService);\n      return gameMapService;\n    }\n  ]);\n"]}