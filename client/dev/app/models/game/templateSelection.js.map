{"version":3,"sources":["templateSelection.es6"],"names":[],"mappings":"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","file":"templateSelection.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('gameTemplateSelection', [\n    'modes',\n    'gameTemplates',\n    function gameTemplateSelectionServiceFactory(modesService,\n                                                 gameTemplatesService) {\n      function checkSelection(where, state) {\n        if('local' === where) {\n          state.event('Modes.switchTo', 'Default');\n          state.changeEvent('Game.template.selection.local.change');\n        }\n      }\n      var gameTemplateSelectionService = {\n        create: function templateSelectionCreate() {\n          return {\n            local: [],\n            remote: []\n          };\n        },\n        'in': function templateSelectionIn(where, stamp, selection) {\n          var stamps = R.prop(where, selection);\n          return R.find(R.equals(stamp), stamps);\n        },\n        get: function templateSelectionGet(where, selection) {\n          return R.propOr([], where, selection);\n        },\n        checkMode: function templateSelectionCheckMode(state, selection) {\n          return R.pipePromise(\n            gameTemplateSelectionService.get$('local'),\n            R.head,\n            (stamp) => {\n              if(R.isNil(stamp)) {\n                return self.Promise.reject('No template selection');\n              }\n\n              return R.pipeP(\n                gameTemplatesService.modeForStamp$(stamp),\n                (mode) => {\n                  return state.event('Modes.switchTo', mode);\n                }\n              )(state.game.templates);\n            }\n          )(selection);\n        },\n        set: function templateSelectionSet(where, stamps, state, selection) {\n          var previous = gameTemplateSelectionService.get(where, selection);\n          var ret = R.assoc(where, stamps, selection);\n\n          checkSelection(where, state);\n          \n          R.forEach((stamp) => {\n            state.changeEvent(`Game.template.change.${stamp}`);\n          }, stamps);\n          R.forEach((stamp) => {\n            state.changeEvent(`Game.template.change.${stamp}`);\n          }, previous);\n\n          return ret;\n        },\n        removeFrom: function templateSelectionRemoveFrom(where, stamps, state, selection) {\n          var previous = R.prop(where, selection);\n          var new_selection = R.difference(previous, stamps);\n          var ret = R.assoc(where, new_selection, selection);\n          \n          checkSelection(where, state);\n\n          R.forEach((stamp) => {\n            state.changeEvent(`Game.template.change.${stamp}`);\n          }, R.uniq(R.concat(previous, stamps)));\n\n          return ret;\n        },\n        clear: function templateSelectionClear(where, state, selection) {\n          var previous = R.prop(where, selection);\n          return gameTemplateSelectionService\n            .removeFrom(where, previous, state, selection);\n        }\n      };\n      R.curryService(gameTemplateSelectionService);\n      return gameTemplateSelectionService;\n    }\n  ]);\n"]}