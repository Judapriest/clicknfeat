{"version":3,"sources":["element.es6"],"names":[],"mappings":"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","file":"element.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('element', elementModelFactory);\n\n  elementModelFactory.$inject = [\n    'point',\n  ];\n  function elementModelFactory(pointModel) {\n    const STATE_LENS = R.lensProp('state');\n    const STAMP_LENS = R.lensPath(['state', 'stamp']);\n    const LOCK_LENS = R.lensPath(['state', 'lk']);\n    const LABEL_LENS = R.lensPath(['state', 'l']);\n    const X_LENS = R.lensPath(['state', 'x']);\n    const Y_LENS = R.lensPath(['state', 'y']);\n    const R_LENS = R.lensPath(['state', 'y']);\n    const saturateXY = R.compose(R.max(0), R.min(480));\n    return function buildElementModel(type, MOVES) {\n      const elementModel = {\n        createDefault: elementCreateDefault,\n        create: elementCreate,\n        stamp: elementStamp,\n        state: elementState,\n        saveState: elementSaveState,\n        setState: elementSetState,\n        checkState: elementCheckState,\n        isLocked: elementIsLocked,\n        setLock: elementSetLock,\n        addLabel: elementAddLabel,\n        removeLabel: elementRemoveLabel,\n        fullLabel: elementFullLabel,\n        clearLabel: elementClearLabel,\n        setPositionP: moveElementP(elementSetPosition),\n        shiftPositionP: moveElementP(elementShiftPosition),\n        setOrientationP: moveElementP(elementSetOrientation),\n        moveFrontP: moveElementP(elementMoveFront),\n        moveBackP: moveElementP(elementMoveBack),\n        rotateLeftP: moveElementP(elementRotateLeft),\n        rotateRightP: moveElementP(elementRotateRight),\n        shiftLeftP: moveElementP(elementShiftLeft),\n        shiftRightP: moveElementP(elementShiftRight),\n        shiftUpP: moveElementP(elementShiftUp),\n        shiftDownP: moveElementP(elementShiftDown),\n        renderLabel: elementRenderLabel,\n        renderText: elementRenderText\n      };\n\n      R.curryService(elementModel);\n      return elementModel;\n\n      function elementCreateDefault() {\n        return {\n          state: {\n            x: 0, y: 0, r: 0,\n            l: [],\n            lk: false,\n            stamp: R.guid()\n          }\n        };\n      }\n      function elementCreate(temp) {\n        return R.thread(temp)(\n          this.createDefault,\n          R.tap((element) => {\n            R.deepExtend(element.state, temp);\n          }),\n          this.checkState\n        );\n      }\n      function elementStamp(element) {\n        return R.set(STAMP_LENS, element);\n      }\n      function elementState(element) {\n        return R.view(STATE_LENS, element);\n      }\n      function elementSaveState(element) {\n        return R.clone(R.view(STATE_LENS, element));\n      }\n      function elementSetState(state, element) {\n        return R.set(STATE_LENS, R.clone(state), element);\n      }\n      function elementCheckState(element) {\n        return R.thread(element)(\n          R.over(X_LENS, saturateXY),\n          R.over(Y_LENS, saturateXY)\n        );\n      }\n      function elementIsLocked(element) {\n        return R.view(LOCK_LENS, element);\n      }\n      function elementSetLock(set, element) {\n        return R.set(LOCK_LENS, set, element);\n      }\n      function moveElementP(move) {\n        return function(...args) {\n          const element = R.last(args);\n          const params = R.init(args);\n          return R.threadP(element)(\n            R.rejectIfP(this.isLocked,\n                       `${s.capitalize(type)} is locked`),\n            (element) => move(...params, element),\n            this.checkState\n          );\n        };\n      }\n      function elementSetPosition(pos, element) {\n        return R.thread(element)(\n          R.set(X_LENS, pos.x),\n          R.set(Y_LENS, pos.y)\n        );\n      }\n      function elementShiftPosition(shift, element) {\n        return R.thread(element)(\n          R.set(X_LENS, element.state.x + shift.x),\n          R.set(Y_LENS, element.state.y + shift.y)\n        );\n      }\n      function elementSetOrientation(orientation, element) {\n        return R.set(R_LENS, orientation, element);\n      }\n      function elementMoveFront(small, element) {\n        const dist = MOVES[small ? 'MoveSmall' : 'Move'];\n        return R.over(\n          STATE_LENS,\n          pointModel.moveFront$(dist),\n          element\n        );\n      }\n      function elementMoveBack(small, element) {\n        const dist = MOVES[small ? 'MoveSmall' : 'Move'];\n        return R.over(\n          STATE_LENS,\n          pointModel.moveBack$(dist),\n          element\n        );\n      }\n      function elementRotateLeft(small, element) {\n        const angle = MOVES[small ? 'RotateSmall' : 'Rotate'];\n        return R.over(\n          STATE_LENS,\n          pointModel.rotateLeft$(angle),\n          element\n        );\n      }\n      function elementRotateRight(small, element) {\n        const angle = MOVES[small ? 'RotateSmall' : 'Rotate'];\n        return R.over(\n          STATE_LENS,\n          pointModel.rotateRight$(angle),\n          element\n        );\n      }\n      function elementShiftLeft(small, element) {\n        const dist = MOVES[small ? 'MoveSmall' : 'Move'];\n        return R.over(\n          STATE_LENS,\n          pointModel.shiftLeft$(dist),\n          element\n        );\n      }\n      function elementShiftRight(small, element) {\n        const dist = MOVES[small ? 'MoveSmall' : 'Move'];\n        return R.over(\n          STATE_LENS,\n          pointModel.shiftRight$(dist),\n          element\n        );\n      }\n      function elementShiftUp(small, element) {\n        const dist = MOVES[small ? 'MoveSmall' : 'Move'];\n        return R.over(\n          STATE_LENS,\n          pointModel.shiftUp$(dist),\n          element\n        );\n      }\n      function elementShiftDown(small, element) {\n        const dist = MOVES[small ? 'MoveSmall' : 'Move'];\n        return R.over(\n          STATE_LENS,\n          pointModel.shiftDown$(dist),\n          element\n        );\n      }\n      function elementAddLabel(label, element) {\n        return R.over(\n          LABEL_LENS,\n          R.compose(R.uniq, R.append(label)),\n          element\n        );\n      }\n      function elementRemoveLabel(label, element) {\n        return R.over(\n          LABEL_LENS,\n          R.reject(R.equals(label)),\n          element\n        );\n      }\n      function elementClearLabel(element) {\n        return R.set(LABEL_LENS, [], element);\n      }\n      function elementFullLabel(element) {\n        return R.viewOr([], LABEL_LENS, element).join(' ');\n      }\n      function elementRenderLabel({ rotate_with_model = false,\n                                    flipped = false,\n                                    flip_center = { x: 240, y: 240 },\n                                    text_center = { x: 240, y: 240 },\n                                  }, element_state) {\n        const text = R.propOr([], 'l', element_state).join(' ');\n        const show = R.length(text) > 0 ? true : false;\n        let rotate = (rotate_with_model\n                      ? element_state.r\n                      : 0\n                     );\n        const label = elementModel.renderText({\n          rotate, flipped, flip_center, text_center\n        }, text);\n        label.show = show;\n        return label;\n      }\n      function elementRenderText({ rotate = 0,\n                                   flipped = false,\n                                   flip_center = { x: 240, y: 240 },\n                                   text_center = { x: 240, y: 240 },\n                                 }, text) {\n        text += '';\n        rotate += (flipped ? 180 : 0);\n        const transform = `rotate(${rotate},${flip_center.x},${flip_center.y})`;\n        const x = text_center.x;\n        const y = text_center.y;\n        const bkg_width = R.length(text) * 5;\n        const bkg_x = text_center.x - bkg_width / 2;\n        const bkg_y = text_center.y - 5;\n        return {\n          text,\n          x, y, transform,\n          bkg_x, bkg_y, bkg_width\n        };\n      }\n    };\n  }\n})();\n"]}