{"version":3,"sources":["deleteTerrain.es6"],"names":[],"mappings":"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","file":"deleteTerrain.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('deleteTerrainCommand', [\n    'commands',\n    'terrain',\n    'gameTerrains',\n    'gameTerrainSelection',\n    function deleteTerrainCommandServiceFactory(commandsService,\n                                                terrainService,\n                                                gameTerrainsService,\n                                                gameTerrainSelectionService) {\n      var deleteTerrainCommandService = {\n        execute: function deleteTerrainExecute(stamps, state, game) {\n          return R.pipeP(\n            (stamps) => {\n              return gameTerrainsService.findAnyStamps(stamps, game.terrains);\n            },\n            R.reject(R.isNil),\n            R.map(terrainService.saveState),\n            (states) => {\n              var ctxt = {\n                terrains: states,\n                desc: ''\n              };\n              return R.pipe(\n                gameTerrainsService.removeStamps$(stamps),\n                (game_terrains) => {\n                  game = R.assoc('terrains', game_terrains, game);\n\n                  return gameTerrainSelectionService\n                    .removeFrom('local', stamps, state, game.terrain_selection);\n                },\n                gameTerrainSelectionService.removeFrom$('remote', stamps, state),\n                (selection) => {\n                  game = R.assoc('terrain_selection', selection, game);\n                  \n                  state.changeEvent('Game.terrain.create');\n                  \n                  return [ctxt, game];\n                }\n              )(game.terrains);\n            }\n          )(stamps);\n        },\n        replay: function deleteTerrainReplay(ctxt, state, game) {\n          return R.pipe(\n            R.pluck('stamp'),\n            (stamps) => {\n              return R.pipe(\n                () => {\n                  return gameTerrainsService.removeStamps(stamps, game.terrains);\n                },\n                (game_terrains) => {\n                  game = R.assoc('terrains', game_terrains, game);\n\n                  return gameTerrainSelectionService\n                    .removeFrom('local', stamps, state, game.terrain_selection);\n                },\n                gameTerrainSelectionService.removeFrom$('remote', stamps, state),\n                (selection) => {\n                  game = R.assoc('terrain_selection', selection, game);\n                  \n                  state.changeEvent('Game.terrain.create');\n\n                  return game;\n                }\n              )();\n            }\n          )(ctxt.terrains);\n        },\n        undo: function deleteTerrainUndo(ctxt, state, game) {\n          return R.pipePromise(\n            R.map((terrain) => {\n              return self.Promise\n                .resolve(terrainService.create(terrain))\n                .catch(R.always(null));\n            }),\n            R.promiseAll,\n            R.reject(R.isNil),\n            (terrains) => {\n              if(R.isEmpty(terrains)) {\n                return self.Promise.reject('No valid terrain definition');\n              }\n              \n              return R.pipe(\n                gameTerrainsService.add$(terrains),\n                (game_terrains) => {\n                  game = R.assoc('terrains', game_terrains, game);\n\n                  var stamps = R.map(R.path(['state','stamp']), terrains);\n                  return gameTerrainSelectionService\n                    .set('remote', stamps, state, game.terrain_selection);\n                },\n                (selection) => {\n                  game = R.assoc('terrain_selection', selection, game);\n                  \n                  state.changeEvent('Game.terrain.create');\n\n                  return game;\n                }\n              )(game.terrains);\n            }\n          )(ctxt.terrains);\n        }\n      };\n      commandsService.registerCommand('deleteTerrain', deleteTerrainCommandService);\n      return deleteTerrainCommandService;\n    }\n  ]);\n"]}