{"version":3,"sources":["createModel.es6"],"names":[],"mappings":"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","file":"createModel.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('createModelCommand', [\n    'commands',\n    'point',\n    'model',\n    'gameModels',\n    'gameModelSelection',\n    function createModelCommandServiceFactory(commandsService,\n                                              pointService,\n                                              modelService,\n                                              gameModelsService,\n                                              gameModelSelectionService) {\n      var createModelCommandService = {\n        execute: function createModelExecute(create, is_flipped, state, game) {\n          var add$ = pointService.addToWithFlip$(is_flipped);\n          return R.pipePromise(\n            R.prop('models'),\n            R.map((model) => {\n              return R.pipe(\n                add$(create.base),\n                R.omit(['stamp']),\n                (model) => {\n                  return modelService\n                    .create(state.factions, model)\n                    .catch(R.always(null));\n                }\n              )(model);\n            }),\n            R.promiseAll,\n            R.reject(R.isNil),\n            (models) => {\n              if(R.isEmpty(models)) {\n                return self.Promise.reject('No valid model definition');\n              }\n            \n              var ctxt = {\n                models: R.map(modelService.saveState, models),\n                desc: models[0].state.info.join('.')\n              };\n              return R.pipe(\n                gameModelsService.add$(models),\n                (game_models) => {\n                  game = R.assoc('models', game_models, game);\n              \n                  return gameModelSelectionService.set('local',\n                                                       R.map(R.path(['state','stamp']), models),\n                                                       state, game.model_selection);\n                },\n                (selection) => {\n                  game = R.assoc('model_selection', selection, game);\n\n                  state.changeEvent('Game.model.create');\n                  \n                  return [ctxt, game];\n                }\n              )(game.models);\n            }\n          )(create);\n        },\n        replay: function createModelReplay(ctxt, state, game) {\n          return R.pipePromise(\n            R.prop('models'),\n            R.map((model) => {\n              return modelService.create(state.factions, model)\n                .catch(R.always(null));\n            }),\n            R.promiseAll,\n            R.reject(R.isNil),\n            (models) => {\n              if(R.isEmpty(models)) {\n                return self.Promise.reject('No valid model definition');\n              }\n              \n              return R.pipe(\n                gameModelsService.add$(models),\n                (game_models) => {\n                  game = R.assoc('models', game_models, game);\n                  \n                  return gameModelSelectionService.set('remote',\n                                                       R.map(R.path(['state','stamp']), models),\n                                                       state, game.model_selection);\n                },\n                (selection) => {\n                  game = R.assoc('model_selection', selection, game);\n                  \n                  state.changeEvent('Game.model.create');\n\n                  return game;\n                }\n              )(game.models);\n            }\n          )(ctxt);\n        },\n        undo: function createModelUndo(ctxt, state, game) {\n          var stamps = R.pluck('stamp', ctxt.models);\n          game = R.pipe(\n            R.over(R.lensProp('models'),\n                   gameModelsService.removeStamps$(stamps)),\n            R.over(R.lensProp('model_selection'),\n                   gameModelSelectionService.removeFrom$('local', stamps, state)),\n            R.over(R.lensProp('model_selection'),\n                   gameModelSelectionService.removeFrom$('remote', stamps, state))\n          )(game);\n          R.forEach((stamp) => { state.changeEvent(`Game.model.delete.${stamp}`); }, stamps);\n          state.changeEvent('Game.model.create');\n          return game;\n        }\n      };\n      commandsService.registerCommand('createModel', createModelCommandService);\n      return createModelCommandService;\n    }\n  ]);\n"]}