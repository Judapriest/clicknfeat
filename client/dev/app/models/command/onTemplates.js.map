{"version":3,"sources":["onTemplates.es6"],"names":[],"mappings":"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","file":"onTemplates.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('onTemplatesCommand', [\n    'commands',\n    'template',\n    'gameTemplates',\n    'gameTemplateSelection',\n    function onTemplatesCommandServiceFactory(commandsService,\n                                              templateService,\n                                              gameTemplatesService,\n                                              gameTemplateSelectionService) {\n      var onTemplatesCommandService = {\n        execute: function onTemplatesExecute(method, args, stamps, state, game) {\n          var ctxt = {\n            before: [],\n            after: [],\n            desc: method\n          };\n\n          return R.pipePromise(\n            gameTemplatesService.fromStamps$('saveState', [], stamps),\n            (before) => {\n              ctxt.before = before;\n\n              return gameTemplatesService\n                .onStamps(method, args, stamps, game.templates);\n            },\n            (templates) => {\n              game = R.assoc('templates', templates, game);\n              \n              return gameTemplatesService\n                .fromStamps('saveState', [], stamps, game.templates);\n            },\n            (after) => {\n              ctxt.after = after;\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.template.change.${stamp}`);\n              }, stamps);\n              \n              return [ctxt, game];\n            }\n          )(game.templates);\n        },\n        replay: function onTemplatesRedo(ctxt, state, game) {\n          let stamps = R.pluck('stamp', ctxt.after);\n          return R.pipePromise(\n            gameTemplatesService.setStateStamps$(ctxt.after, stamps),\n            (templates) => {\n              game = R.assoc('templates', templates, game);\n              \n              return gameTemplateSelectionService\n                .set('remote', stamps, state, game.template_selection);\n            },\n            (selection) => {\n              game = R.assoc('template_selection', selection, game);\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.template.change.${stamp}`);\n              }, stamps);\n              \n              return game;\n            }\n          )(game.templates);\n        },\n        undo: function onTemplatesUndo(ctxt, state, game) {\n          let stamps = R.pluck('stamp', ctxt.before);\n          return R.pipePromise(\n            gameTemplatesService.setStateStamps$(ctxt.before, stamps),\n            (templates) => {\n              game = R.assoc('templates', templates, game);\n              \n              return gameTemplateSelectionService\n                .set('remote', stamps, state, game.template_selection);\n            },\n            (selection) => {\n              game = R.assoc('template_selection', selection, game);\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.template.change.${stamp}`);\n              }, stamps);\n              \n              return game;\n            }\n          )(game.templates);\n        }\n      };\n      commandsService.registerCommand('onTemplates', onTemplatesCommandService);\n      return onTemplatesCommandService;\n    }\n  ]);\n"]}