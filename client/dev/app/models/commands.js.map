{"version":3,"sources":["commands.es6"],"names":[],"mappings":"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","file":"commands.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('commands', commandsModelFactory)\n    .factory('allCommands', [\n      // 'createModelCommand',\n      // 'deconsteModelCommand',\n      // 'setModelSelectionCommand',\n      // 'lockModelsCommand',\n      // 'onModelsCommand',\n      // 'createTemplateCommand',\n      // 'deconsteTemplatesCommand',\n      // 'lockTemplatesCommand',\n      // 'onTemplatesCommand',\n      // 'createTerrainCommand',\n      // 'deconsteTerrainCommand',\n      // 'lockTerrainsCommand',\n      // 'onTerrainsCommand',\n      // 'rollDiceCommand',\n      // 'rollDeviationCommand',\n      'setBoardCommand',\n      'setLayersCommand',\n      // 'setLosCommand',\n      // 'setRulerCommand',\n      // 'setScenarioCommand',\n      () => ({ })\n    ]);\n\n  commandsModelFactory.$inject = [];\n  function commandsModelFactory() {\n    const CMDS_REG = {};\n    const commandsModel = {\n      registerCommand: commandsRegister,\n      executeP: commandsExecuteP,\n      undoP: commandsUndoP,\n      replayP: commandsReplayP,\n      replayBatchP: commandsReplayBatchP\n    };\n    R.curryService(commandsModel);\n    return commandsModel;\n\n    function commandsRegister(name, command) {\n      console.log('register command', name, command);\n      CMDS_REG[name] = command;\n    }\n    function commandsExecuteP(name, args, state, game) {\n      return R.threadP(name)(\n        findTypeP,\n        (cmd) => {\n          return cmd.executeP\n            .apply(null, [...args, state, game]);\n        },\n        updateCommandType\n      );\n\n      function updateCommandType([ctxt, game]) {\n        return [ R.assoc('type', name, ctxt),\n                 game\n               ];\n      }\n    }\n    function commandsUndoP(ctxt, state, game) {\n      return R.threadP(ctxt)(\n        findCtxtTypeP,\n        (cmd) => {\n          return cmd.undoP(ctxt, state, game);\n        }\n      );\n    }\n    function commandsReplayP(ctxt, state, game) {\n      return R.threadP(ctxt)(\n        findCtxtTypeP,\n        (cmd) => {\n          return cmd.replayP(ctxt, state, game);\n        }\n      );\n    }\n    function findCtxtTypeP(ctxt) {\n      return R.threadP(ctxt)(\n        R.prop('type'),\n        findTypeP\n      );\n    }\n    function findTypeP(type) {\n      return R.threadP(CMDS_REG)(\n        R.prop(type),\n        R.rejectIf(R.isNil, `Game: unknown command \"${type}\"`)\n      );\n    }\n    function commandsReplayBatchP(commands, state, game) {\n      if(R.isEmpty(commands)) {\n        return self.Promise.resolve(game);\n      }\n      return R.threadP(game)(\n        replayNextCommand,\n        recurP\n      );\n\n      function replayNextCommand(game) {\n        return commandsModel.replayP(commands[0], state, game)\n          .catch(R.always(game));\n      }\n      function recurP(game) {\n        return commandsReplayBatchP(R.tail(commands), state, game);\n      }\n    }\n  }\n})();\n"]}