{"version":3,"sources":["ruler.es6"],"names":[],"mappings":";;;;AAAA,QAAQ,MAAR,CAAe,mBAAf,EACG,OADH,CACW,iBADX,EAC8B,CAC1B,UAD0B,EAE1B,WAF0B,EAG1B,SAAS,6BAAT,CAAuC,eAAvC,EACuC,gBADvC,EACyD;AACvD,MAAI,yBAAyB;AAC3B,aAAS,SAAS,eAAT,CAAyB,MAAzB,EAAiC,IAAjC,EAAuC,KAAvC,EAA8C,IAA9C,EAAoD;AAC3D,UAAG,eAAe,EAAE,IAAF,CAAO,iBAAiB,MAAjB,CAAP,CAAf,EAAiD;AAClD,eAAO,KAAK,OAAL,CAAa,MAAb,2BAA4C,MAA5C,CAAP,CADkD;OAApD;;AAIA,UAAI,OAAO;AACT,gBAAQ,EAAR;AACA,eAAO,EAAP;AACA,cAAM,MAAN;OAHE,CALuD;;AAW3D,aAAO,EAAE,WAAF,CACL,iBAAiB,eAAjB,EACA,UAAC,MAAD,EAAY;AACV,aAAK,MAAL,GAAc,MAAd,CADU;;AAGV,eAAO,iBAAiB,MAAjB,EACJ,KADI,CACE,IADF,+BACY,QAAM,OAAO,KAAK,KAAL,EADzB,CAAP,CAHU;OAAZ,EAMA,UAAC,KAAD,EAAW;AACT,eAAO,EAAE,KAAF,CAAQ,OAAR,EAAiB,KAAjB,EAAwB,IAAxB,CAAP,CADS;;AAGT,eAAO,iBAAiB,eAAjB,CAAiC,KAAK,KAAL,CAAxC,CAHS;OAAX,EAKA,UAAC,KAAD,EAAW;AACT,aAAK,KAAL,GAAa,KAAb,CADS;;AAGT,cAAM,WAAN,CAAkB,0BAAlB,EAHS;;AAKT,eAAO,CAAC,IAAD,EAAO,IAAP,CAAP,CALS;OAAX,CAbK,CAoBL,KAAK,KAAL,CApBF,CAX2D;KAApD;AAiCT,YAAQ,SAAS,YAAT,CAAsB,IAAtB,EAA4B,KAA5B,EAAmC,IAAnC,EAAyC;AAC/C,aAAO,EAAE,IAAF,CAAO,EAAE,QAAF,CAAW,OAAX,CAAP,EACO,iBAAiB,YAAjB,CAA8B,KAAK,KAAL,EAAY,KAA1C,CADP,EAEO,IAFP,CAAP,CAD+C;AAI/C,YAAM,WAAN,CAAkB,0BAAlB,EAJ+C;AAK/C,aAAO,IAAP,CAL+C;KAAzC;AAOR,UAAM,SAAS,YAAT,CAAsB,IAAtB,EAA4B,KAA5B,EAAmC,IAAnC,EAAyC;AAC7C,aAAO,EAAE,IAAF,CAAO,EAAE,QAAF,CAAW,OAAX,CAAP,EACO,iBAAiB,YAAjB,CAA8B,KAAK,MAAL,EAAa,KAA3C,CADP,EAEO,IAFP,CAAP,CAD6C;AAI7C,YAAM,WAAN,CAAkB,0BAAlB,EAJ6C;AAK7C,aAAO,IAAP,CAL6C;KAAzC;GAzCJ,CADmD;AAkDvD,kBAAgB,eAAhB,CAAgC,UAAhC,EAA4C,sBAA5C,EAlDuD;AAmDvD,SAAO,sBAAP,CAnDuD;CADzD,CAJJ","file":"ruler.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('setRulerCommand', [\n    'commands',\n    'gameRuler',\n    function setRulerCommandServiceFactory(commandsService,\n                                           gameRulerService) {\n      var setRulerCommandService = {\n        execute: function setRulerExecute(method, args, state, game) {\n          if('Function' !== R.type(gameRulerService[method])) {\n            return self.Promise.reject(`Ruler unknown method ${method}`);\n          }\n\n          var ctxt = {\n            before: [],\n            after: [],\n            desc: method\n          };\n\n          return R.pipePromise(\n            gameRulerService.saveRemoteState,\n            (before) => {\n              ctxt.before = before;\n              \n              return gameRulerService[method]\n                .apply(null, [...args, state, game.ruler]);\n            },\n            (ruler) => {\n              game = R.assoc('ruler', ruler, game);\n              \n              return gameRulerService.saveRemoteState(game.ruler);\n            },\n            (after) => {\n              ctxt.after = after;\n\n              state.changeEvent('Game.ruler.remote.change');\n              \n              return [ctxt, game];\n            }\n          )(game.ruler);\n        },\n        replay: function setRulerRedo(ctxt, state, game) {\n          game = R.over(R.lensProp('ruler'),\n                        gameRulerService.resetRemote$(ctxt.after, state),\n                        game);\n          state.changeEvent('Game.ruler.remote.change');\n          return game;\n        },\n        undo: function setRulerUndo(ctxt, state, game) {\n          game = R.over(R.lensProp('ruler'),\n                        gameRulerService.resetRemote$(ctxt.before, state),\n                        game);\n          state.changeEvent('Game.ruler.remote.change');\n          return game;\n        }\n      };\n      commandsService.registerCommand('setRuler', setRulerCommandService);\n      return setRulerCommandService;\n    }\n  ]);\n"]}