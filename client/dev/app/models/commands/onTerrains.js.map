{"version":3,"sources":["onTerrains.es6"],"names":[],"mappings":"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","file":"onTerrains.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('onTerrainsCommand', [\n    'commands',\n    'terrain',\n    'gameTerrains',\n    'gameTerrainSelection',\n    function onTerrainsCommandServiceFactory(commandsService,\n                                             terrainService,\n                                             gameTerrainsService,\n                                             gameTerrainSelectionService) {\n      var onTerrainsCommandService = {\n        execute: function onTerrainsExecute(method, args, stamps, state, game) {\n          if('Function' !== R.type(terrainService[method])) {\n            return self.Promise.reject(`Unknown method \"${method}\" on terrain`);\n          }\n          \n          var ctxt = {\n            before: [],\n            after: [],\n            desc: method\n          };\n\n          return R.pipeP(\n            gameTerrainsService.fromStamps$('saveState', [], stamps),\n            (before) => {\n              ctxt.before = before;\n              \n              return gameTerrainsService\n                .onStamps(method, args, stamps, game.terrains);\n            },\n            (terrains) => {\n              game = R.assoc('terrains', terrains, game);\n\n              return gameTerrainsService\n                .fromStamps('saveState', [], stamps, game.terrains);\n            },\n            (after) => {\n              ctxt.after = after;\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.terrain.change.${stamp}`);\n              }, stamps);\n              \n              return [ctxt, game];\n            }\n          )(game.terrains);\n        },\n        replay: function onTerrainsRedo(ctxt, state, game) {\n          var stamps = R.pluck('stamp', ctxt.after);\n          return R.pipeP(\n            gameTerrainsService.setStateStamps$(ctxt.after, stamps),\n            (terrains) => {\n              game = R.assoc('terrains', terrains, game);\n              \n              return gameTerrainSelectionService\n                .set('remote', stamps, state, game.terrain_selection);\n            },\n            (selection) => {\n              game = R.assoc('terrain_selection', selection, game);\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.terrain.change.${stamp}`);\n              }, stamps);\n              \n              return game;\n            }\n          )(game.terrains);\n        },\n        undo: function onTerrainsUndo(ctxt, state, game) {\n          var stamps = R.pluck('stamp', ctxt.before);\n          return R.pipeP(\n            gameTerrainsService.setStateStamps$(ctxt.before, stamps),\n            (terrains) => {\n              game = R.assoc('terrains', terrains, game);\n              \n              return gameTerrainSelectionService\n                .set('remote', stamps, state, game.terrain_selection);\n            },\n            (selection) => {\n              game = R.assoc('terrain_selection', selection, game);\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.terrain.change.${stamp}`);\n              }, stamps);\n              \n              return game;\n            }\n          )(game.terrains);\n        }\n      };\n      commandsService.registerCommand('onTerrains', onTerrainsCommandService);\n      return onTerrainsCommandService;\n    }\n  ]);\n"]}