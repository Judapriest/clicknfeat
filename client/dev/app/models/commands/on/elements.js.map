{"version":3,"sources":["elements.es6"],"names":[],"mappings":"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","file":"elements.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('onElementsCommand', onElementsCommandModelFactory);\n\n  onElementsCommandModelFactory.$inject = [];\n  function onElementsCommandModelFactory() {\n    return function buildOnElementsCommandModel(type,\n                                                elementModel,\n                                                gameElementsModel,\n                                                gameElementSelectionModel,\n                                                options = {}) {\n      const {\n        checkIfModelRespondToMethod = true\n      } = options;\n      const onElementsCommandModel = {\n        executeP: onElementsExecuteP,\n        replayP: onElementsReplayP,\n        undoP: onElementsUndoP\n      };\n      const applyMethodOnGameElementsP$ = R.curry(applyMethodOnGameElementsP);\n      const setStates$ = R.curry(setStates);\n      const saveStatesP$ = R.curry(saveStatesP);\n      const setRemoteSelection$ = R.curry(setRemoteSelection);\n      return onElementsCommandModel;\n\n      function onElementsExecuteP(method, args, stamps, game) {\n        const ctxt = {\n          before: [],\n          after: [],\n          desc: method\n        };\n        return R.threadP(elementModel)(\n          checkMethod,\n          () => game,\n          saveStatesP$(ctxt, 'before', stamps),\n          applyMethodOnGameElementsP$(method, args, stamps),\n          saveStatesP$(ctxt, 'after', stamps),\n          (game) => [ctxt, game]\n        );\n\n        function checkMethod() {\n          return ( checkIfModelRespondToMethod\n                   ? R.threadP(elementModel)(\n                     R.prop(method),\n                     R.type,\n                     R.rejectIfP(R.complement(R.equals('Function')),\n                                `Unknown method \"${method}\" on ${type}`)\n                   )\n                   : true\n                 );\n        }\n      }\n      function onElementsReplayP(ctxt, game) {\n        const stamps = R.pluck('stamp', ctxt.after);\n        return R.thread(game)(\n          setStates$(ctxt.after, stamps),\n          setRemoteSelection$(stamps)\n        );\n      }\n      function onElementsUndoP(ctxt, game) {\n        const stamps = R.pluck('stamp', ctxt.before);\n        return R.thread(game)(\n          setStates$(ctxt.before, stamps),\n          setRemoteSelection$(stamps)\n        );\n      }\n\n      function applyMethodOnGameElementsP(method, args, stamps, game) {\n        return R.threadP(game)(\n          R.prop(`${type}s`),\n          gameElementsModel.onStampsP$(method, args, stamps),\n          R.assoc(`${type}s`, R.__, game)\n        );\n      }\n      function setStates(states, stamps, game) {\n        return R.over(\n          R.lensProp(`${type}s`),\n          gameElementsModel.setStateStamps$(states, stamps),\n          game\n        );\n      }\n      function saveStatesP(ctxt, prop, stamps, game) {\n        return R.threadP(game)(\n          R.prop(`${type}s`),\n          gameElementsModel.fromStampsP$('saveState', [], stamps),\n          (states) => {\n            ctxt[prop] = states;\n            return game;\n          }\n        );\n      }\n      function setRemoteSelection(stamps, game) {\n        return R.over(\n          R.lensProp(`${type}_selection`),\n          gameElementSelectionModel.set$('remote', stamps),\n          game\n        );\n      }\n    };\n  }\n})();\n"]}