{"version":3,"sources":["models.es6"],"names":[],"mappings":"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","file":"models.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('onModelsCommand', [\n    'commands',\n    'model',\n    'gameModels',\n    'gameModelSelection',\n    function onModelsCommandServiceFactory(commandsService,\n                                           modelService,\n                                           gameModelsService,\n                                           gameModelSelectionService) {\n      var onModelsCommandService = {\n        execute: function onModelsExecute(method, args, stamps, state, game) {\n          if('Function' !== R.type(modelService[method])) {\n            return self.Promise\n              .reject(`Unknown method ${method} on model`);\n          }\n          \n          var ctxt = {\n            before: [],\n            after: [],\n            desc: method\n          };\n\n          return R.pipeP(\n            gameModelsService.fromStamps$('saveState', [], stamps),\n            (before) => {\n              ctxt.before = before;\n              \n              return gameModelsService\n                .onStamps(method, args, stamps, game.models);\n            },\n            (models) => {\n              game = R.assoc('models', models, game);\n              \n              return gameModelsService\n                .fromStamps('saveState', [], stamps, game.models);\n            },\n            (after) => {\n              ctxt.after = after;\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.model.change.${stamp}`);\n              }, stamps);\n              \n              return [ctxt, game];\n            }\n          )(game.models);\n        },\n        replay: function onModelsRedo(ctxt, state, game) {\n          var stamps = R.pluck('stamp', ctxt.after);\n          return R.pipeP(\n            gameModelsService.setStateStamps$(ctxt.after, stamps),\n            (models) => {\n              game = R.assoc('models', models, game);\n\n              return gameModelSelectionService\n                .set('remote', stamps, state, game.model_selection);\n            },\n            (selection) => {\n              game = R.assoc('model_selection', selection, game);\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.model.change.${stamp}`);\n              }, stamps);\n              \n              return game;\n            }\n          )(game.models);\n        },\n        undo: function onModelsUndo(ctxt, state, game) {\n          var stamps = R.pluck('stamp', ctxt.before);\n          return R.pipeP(\n            gameModelsService.setStateStamps$(ctxt.before, stamps),\n            (models) => {\n              game = R.assoc('models', models, game);\n\n              return gameModelSelectionService\n                .set('remote', stamps, state, game.model_selection);\n            },\n            (selection) => {\n              game = R.assoc('model_selection', selection, game);\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.model.change.${stamp}`);\n              }, stamps);\n              \n              return game;\n            }\n          )(game.models);\n        }\n      };\n      commandsService.registerCommand('onModels', onModelsCommandService);\n      return onModelsCommandService;\n    }\n  ]);\n"]}