{"version":3,"sources":["deleteTemplates.es6"],"names":[],"mappings":"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","file":"deleteTemplates.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('deleteTemplatesCommand', [\n    'commands',\n    'template',\n    'gameTemplates',\n    'gameTemplateSelection',\n    function deleteTemplatesCommandServiceFactory(commandsService,\n                                                  templateService,\n                                                  gameTemplatesService,\n                                                  gameTemplateSelectionService) {\n      var deleteTemplatesCommandService = {\n        execute: function deleteTemplatesExecute(stamps, state, game) {\n          return R.pipeP(\n            gameTemplatesService.findAnyStamps$(stamps),\n            R.reject(R.isNil),\n            R.map(templateService.saveState),\n            (states) => {\n              var ctxt = {\n                templates: states,\n                desc: ''\n              };\n\n              return R.pipe(\n                gameTemplatesService.removeStamps$(stamps),\n                (game_templates) => {\n                  game = R.assoc('templates', game_templates, game);\n                  \n                  return gameTemplateSelectionService\n                    .removeFrom('local', stamps, state, game.template_selection);\n                },\n                gameTemplateSelectionService\n                  .removeFrom$('remote', stamps, state),\n                (selection) => {\n                  game = R.assoc('template_selection', selection, game);\n\n                  state.changeEvent('Game.template.create');\n\n                  return [ctxt, game];\n                }\n              )(game.templates);\n            }\n          )(game.templates);\n        },\n        replay: function deleteTemplatesReplay(ctxt, state, game) {\n          return R.pipe(\n            R.pluck('stamp'),\n            (stamps) => {\n              return R.pipe(\n                gameTemplatesService.removeStamps$(stamps),\n                (game_templates) => {\n                  game = R.assoc('templates', game_templates, game);\n                  \n                  return gameTemplateSelectionService\n                    .removeFrom('local', stamps, state, game.template_selection);\n                },\n                gameTemplateSelectionService\n                  .removeFrom$('remote', stamps, state),\n                (selection) => {\n                  game = R.assoc('template_selection', selection, game);\n                  \n                  state.changeEvent('Game.template.create');\n\n                  return game;\n                }\n              )(game.templates);\n            }\n          )(ctxt.templates);\n        },\n        undo: function deleteTemplatesUndo(ctxt, state, game) {\n          return R.pipePromise(\n            R.map(templateService.create),\n            R.promiseAll,\n            R.reject(R.isNil),\n            (templates) => {\n              if(R.isEmpty(templates)) {\n                return self.Promise.reject('No valid template definition');\n              }\n\n              return R.pipe(\n                gameTemplatesService.add$(templates),\n                (game_templates) => {\n                  game = R.assoc('templates', game_templates, game);\n          \n                  return gameTemplateSelectionService\n                    .set('remote', R.map(R.path(['state','stamp']), templates),\n                         state, game.template_selection);\n                },\n                (selection) => {\n                  game = R.assoc('template_selection', selection, game);\n\n                  state.changeEvent('Game.template.create');\n\n                  return game;\n                }\n              )(game.templates);\n            }\n          )(ctxt.templates);\n        }\n      };\n      commandsService.registerCommand('deleteTemplates', deleteTemplatesCommandService);\n      return deleteTemplatesCommandService;\n    }\n  ]);\n"]}