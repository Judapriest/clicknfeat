{"version":3,"sources":["element.es6"],"names":[],"mappings":"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","file":"element.js","sourcesContent":["(function() {\n  angular.module('clickApp.models')\n    .factory('deleteElementCommand', deleteElementCommandModelFactory);\n\n  deleteElementCommandModelFactory.$inject = [];\n  function deleteElementCommandModelFactory() {\n    return function buildDeleteElementCommandModel(type,\n                                                   elementModel,\n                                                   gameElementsModel,\n                                                   gameElementSelectionModel,\n                                                   createElementFn) {\n      const deleteElementCommandModel = {\n        executeP: deleteElementExecuteP,\n        replayP: deleteElementReplayP,\n        undoP: deleteElementUndoP\n      };\n      const onDeletedStates$ = R.curry(onDeletedStates);\n      createElementFn = R.thread(createElementFn)(\n        R.defaultTo(tryToCreateElement),\n        R.curry\n      );\n      return deleteElementCommandModel;\n\n      function deleteElementExecuteP(stamps, game) {\n        return R.thread(game)(\n          R.prop(`${type}s`),\n          gameElementsModel.findAnyStamps$(stamps),\n          R.reject(R.isNil),\n          R.map(elementModel.saveState),\n          onNewDeletedStates\n        );\n\n        function onNewDeletedStates(states) {\n          const ctxt = {\n            [`${type}s`]: states,\n            desc: ''\n          };\n          return R.thread(states)(\n            onDeletedStates$(game),\n            (game) => [ctxt, game]\n          );\n        }\n      }\n      function deleteElementReplayP(ctxt, game) {\n        return onDeletedStates(game, ctxt[`${type}s`]);\n      }\n      function deleteElementUndoP(ctxt, game) {\n        return R.threadP(ctxt)(\n          R.prop(`${type}s`),\n          R.map(createElementFn),\n          R.reject(R.isNil),\n          R.rejectIfP(R.isEmpty, `No valid ${type} definition`),\n          onNewCreatedElements\n        );\n\n        function onNewCreatedElements(elements) {\n          const stamps = R.map(R.path(['state','stamp']), elements);\n          return R.thread(game)(\n            addToGameElements,\n            addToGameElementSelection\n          );\n\n          function addToGameElements(game) {\n            return R.thread(game)(\n              R.prop(`${type}s`),\n              gameElementsModel.add$(elements),\n              R.assoc(`${type}s`, R.__, game)\n            );\n          }\n          function addToGameElementSelection(game) {\n            return R.thread(game)(\n              R.prop(`${type}_selection`),\n              gameElementSelectionModel.set$('remote', stamps),\n              R.assoc(`${type}_selection`, R.__, game)\n            );\n          }\n        }\n      }\n      function onDeletedStates(game, states) {\n        const stamps = R.pluck('stamp', states);\n        return R.thread(game)(\n          removeFromGameElements,\n          removeFromGameElementSelection\n        );\n        function removeFromGameElements(game){\n          return R.thread(game)(\n            R.prop(`${type}s`),\n            gameElementsModel.removeStamps$(stamps),\n            R.assoc(`${type}s`, R.__, game)\n          );\n        }\n        function removeFromGameElementSelection(game) {\n          return R.thread(game)(\n            R.prop(`${type}_selection`),\n            gameElementSelectionModel.removeFrom$('local', stamps),\n            gameElementSelectionModel.removeFrom$('remote', stamps),\n            R.assoc(`${type}_selection`, R.__, game)\n          );\n        }\n      }\n      function tryToCreateElement(element) {\n        return elementModel.create(element);\n      }\n    };\n  }\n})();\n"]}