{"version":3,"sources":["element.es6"],"names":[],"mappings":"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","file":"element.js","sourcesContent":["(function() {\n  angular.module('clickApp.models')\n    .factory('deleteElementCommand', deleteElementCommandModelFactory);\n\n  deleteElementCommandModelFactory.$inject = [];\n  function deleteElementCommandModelFactory() {\n    return function buildDeleteElementCommandModel(type,\n                                                   elementModel,\n                                                   gameElementsModel,\n                                                   gameElementSelectionModel) {\n      const deleteElementCommandModel = {\n        executeP: deleteElementExecuteP,\n        replayP: deleteElementReplayP,\n        undoP: deleteElementUndoP\n      };\n\n      const onDeletedStates$ = R.curry(onDeletedStates);\n      const emitCreateEvent$ = R.curry(emitCreateEvent);\n\n      return deleteElementCommandModel;\n\n      function deleteElementExecuteP(stamps, state, game) {\n        return R.threadP(game)(\n          R.prop(`${type}s`),\n          gameElementsModel.findAnyStampsP$(stamps),\n          R.reject(R.isNil),\n          R.map(elementModel.saveState),\n          onNewDeletedStates\n        );\n\n        function onNewDeletedStates(states) {\n          const ctxt = {\n            [`${type}s`]: states,\n            desc: ''\n          };\n          return R.thread(states)(\n            onDeletedStates$(state, game),\n            (game) => {\n              return [ctxt, game];\n            }\n          );\n        }\n      }\n      function deleteElementReplayP(ctxt, state, game) {\n        return onDeletedStates(state, game, ctxt[`${type}s`]);\n      }\n      function deleteElementUndoP(ctxt, state, game) {\n        return R.threadP(ctxt)(\n          R.prop(`${type}s`),\n          R.map(tryToCreateElement),\n          R.promiseAll,\n          R.reject(R.isNil),\n          R.rejectIf(R.isEmpty, `No valid ${type} definition`),\n          onNewCreatedElements\n        );\n\n        function tryToCreateElement(element) {\n          return elementModel\n            .createP(element)\n            .catch(R.always(null));\n        }\n        function onNewCreatedElements(elements) {\n          const stamps = R.map(R.path(['state','stamp']), elements);\n          return R.thread(game)(\n            addToGameElements,\n            addToGameElementSelection,\n            emitCreateEvent$(state)\n          );\n\n          function addToGameElements(game) {\n            return R.thread(game)(\n              R.prop(`${type}s`),\n              gameElementsModel.add$(elements),\n              (game_elements) => {\n                return R.assoc(`${type}s`, game_elements, game);\n              }\n            );\n          }\n          function addToGameElementSelection(game) {\n            return R.thread(game)(\n              R.prop(`${type}_selection`),\n              gameElementSelectionModel.set$('remote', stamps, state),\n              (selection) => {\n                return R.assoc(`${type}_selection`, selection, game);\n              }\n            );\n          }\n        }\n      }\n      function onDeletedStates(state, game, states) {\n        const stamps = R.pluck('stamp', states);\n        return R.thread(game)(\n          removeFromGameElements,\n          removeFromGameElementSelection,\n          emitCreateEvent$(state)\n        );\n        function removeFromGameElements(game){\n          return R.thread(game)(\n            R.prop(`${type}s`),\n            gameElementsModel.removeStamps$(stamps),\n            (game_elements) => {\n              return R.assoc(`${type}s`, game_elements, game);\n            }\n          );\n        }\n        function removeFromGameElementSelection(game) {\n          return R.thread(game)(\n            R.prop(`${type}_selection`),\n            gameElementSelectionModel.removeFrom$('local', stamps, state),\n            gameElementSelectionModel.removeFrom$('remote', stamps, state),\n            (selection) => {\n              return R.assoc(`${type}_selection`, selection, game);\n            }\n          );\n        }\n      }\n      function emitCreateEvent(state, game) {\n        state.queueChangeEventP(`Game.${type}.create`);\n        return game;\n      }\n    };\n  }\n})();\n"]}