{"version":3,"sources":["deviation.es6"],"names":[],"mappings":";;;;AAAA,CAAC,YAAW;AACV,UAAQ,MAAR,CAAe,mBAAf,EACG,OADH,CACW,sBADX,EACmC,gCADnC,EADU;;AAIV,mCAAiC,OAAjC,GAA2C,CACzC,UADyC,EAEzC,oBAFyC,CAA3C,CAJU;AAQV,WAAS,gCAAT,CAA0C,aAA1C,EAC0C,uBAD1C,EACmE;AACjE,QAAM,YAAY,EAAE,QAAF,CAAW,MAAX,CAAZ,CAD2D;AAEjE,QAAM,4BAA4B;AAChC,gBAAU,qBAAV;AACA,eAAS,eAAT;AACA,aAAO,aAAP;KAHI,CAF2D;;AAQjE,kBAAc,eAAd,CAA8B,eAA9B,EAA+C,yBAA/C,EARiE;AASjE,WAAO,yBAAP,CATiE;;AAWjE,aAAS,qBAAT,CAA+B,MAA/B,EAAuC,IAAvC,EAA6C;AAC3C,UAAM,YAAY,EAAE,WAAF,CAAc,CAAd,EAAiB,CAAjB,CAAZ,CADqC;AAE3C,UAAM,WAAW,EAAE,WAAF,CAAc,CAAd,EAAiB,CAAjB,CAAX,CAFqC;;AAI3C,aAAO,EAAE,OAAF,GACL;eAAM,wBACH,QADG,CACM,SADN,EACiB,CAAE,SAAF,EAAa,QAAb,CADjB,EAC0C,MAD1C,EACkD,IADlD;OAAN,EAEA,gBAAkB;;;YAAhB,gBAAgB;YAAV,gBAAU;;AAChB,eAAO,EAAE,MAAF,CAAS,IAAT,EACL,EAAE,KAAF,CAAQ,MAAR,iCACqC,4BAAuB,cAD5D,CADK,EAGL,EAAE,KAAF,CAAQ,GAAR,EAAa,SAAb,CAHK,EAIL,EAAE,KAAF,CAAQ,GAAR,EAAa,QAAb,CAJK,CAAP,CADgB;AAOhB,eAAO,CAAC,IAAD,EAAO,IAAP,CAAP,CAPgB;OAAlB,CAHF,CAJ2C;KAA7C;AAkBA,aAAS,eAAT,CAAyB,IAAzB,EAA+B,IAA/B,EAAqC;AACnC,aAAO,EAAE,OAAF,GACL;eAAM,wBACH,OADG,CACK,IADL,EACW,IADX;OAAN,EAEA,EAAE,IAAF,CAAO,SAAP,EAAkB,EAAE,IAAF,CAAO,EAAE,SAAF,CAAY,EAAZ,CAAP,EAAwB,EAAE,MAAF,CAAS,IAAT,CAAxB,CAAlB,CAHK,CAAP,CADmC;KAArC;AAOA,aAAS,aAAT,CAAuB,IAAvB,EAA6B,IAA7B,EAAmC;AACjC,aAAO,EAAE,OAAF,GACL;eAAM,wBACH,KADG,CACG,IADH,EACS,IADT;OAAN,EAEA,EAAE,IAAF,CAAO,SAAP,EAAkB,EAAE,IAAF,CAAO,EAAE,SAAF,CAAY,EAAZ,CAAP,EACO,EAAE,MAAF,CAAS,EAAE,MAAF,CAAS,OAAT,EAAkB,KAAK,KAAL,CAA3B,CADP,CAAlB,CAHK,CAAP,CADiC;KAAnC;GArCF;CARD,CAAD","file":"deviation.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('rollDeviationCommand', rollDeviationCommandModelFactory);\n\n  rollDeviationCommandModelFactory.$inject = [\n    'commands',\n    'onTemplatesCommand',\n  ];\n  function rollDeviationCommandModelFactory(commandsModel,\n                                            onTemplatesCommandModel) {\n    const DICE_LENS = R.lensProp('dice');\n    const rollDeviationCommandModel = {\n      executeP: rollDeviationExecuteP,\n      replayP: rollDiceReplayP,\n      undoP: rollDiceUndoP\n    };\n\n    commandsModel.registerCommand('rollDeviation', rollDeviationCommandModel);\n    return rollDeviationCommandModel;\n\n    function rollDeviationExecuteP(stamps, game) {\n      const direction = R.randomRange(1, 6);\n      const distance = R.randomRange(1, 6);\n\n      return R.threadP()(\n        () => onTemplatesCommandModel\n          .executeP('deviate', [ direction, distance ], stamps, game),\n        ([ctxt, game]) => {\n          ctxt = R.thread(ctxt)(\n            R.assoc('desc',\n                    `AoE deviation : direction ${direction}, distance ${distance}\"`),\n            R.assoc('r', direction),\n            R.assoc('d', distance)\n          );\n          return [ctxt, game];\n        }\n      );\n    }\n    function rollDiceReplayP(ctxt, game) {\n      return R.threadP()(\n        () => onTemplatesCommandModel\n          .replayP(ctxt, game),\n        R.over(DICE_LENS, R.pipe(R.defaultTo([]), R.append(ctxt)))\n      );\n    }\n    function rollDiceUndoP(ctxt, game) {\n      return R.threadP()(\n        () => onTemplatesCommandModel\n          .undoP(ctxt, game),\n        R.over(DICE_LENS, R.pipe(R.defaultTo([]),\n                                 R.reject(R.propEq('stamp', ctxt.stamp))))\n      );\n    }\n  }\n})();\n"]}