{"version":3,"sources":["element.es6"],"names":[],"mappings":"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","file":"element.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('createElementCommand', createElementCommandModelFactory);\n\n  createElementCommandModelFactory.$inject = [\n    'point',\n  ];\n  function createElementCommandModelFactory(pointModel) {\n    return function buildCreateElementCommandModel(type,\n                                                   elementModel,\n                                                   gameElementsModel,\n                                                   gameElementSelectionModel,\n                                                   createElementFn) {\n      const createElementCommandModel = {\n        executeP: createElementExecuteP,\n        replayP: createElementReplayP,\n        undoP: createElementUndoP\n      };\n      const onCreatedElements$ = R.curry(onCreatedElements);\n      createElementFn = R.thread(createElementFn)(\n        R.defaultTo(tryToCreateElement),\n        R.curry\n      );\n      return createElementCommandModel;\n\n      function createElementExecuteP(create, is_flipped, game) {\n        const add$ = pointModel.addToWithFlip$(is_flipped);\n        return R.threadP(create)(\n          R.prop(`${type}s`),\n          R.map(addElement),\n          R.reject(R.isNil),\n          R.rejectIfP(R.isEmpty, `No valid ${type} definition`),\n          onNewElements\n        );\n\n        function addElement(element) {\n          return R.thread(element)(\n            add$(create.base),\n            R.omit(['stamp']),\n            createElementFn\n          );\n        }\n        function onNewElements(elements) {\n          const ctxt = {\n            [`${type}s`]: R.map(elementModel.saveState, elements),\n            desc: R.thread(elements)(\n              R.head,\n              R.pathOr([], ['state','info']),\n              R.join('.')\n            )\n          };\n          return R.thread(elements)(\n            onCreatedElements$('local', game),\n            (game) => [ctxt, game]\n          );\n        }\n      }\n      function createElementReplayP(ctxt, game) {\n        return R.threadP(ctxt)(\n          R.prop(`${type}s`),\n          R.map(createElementFn),\n          R.reject(R.isNil),\n          R.rejectIfP(R.isEmpty, `No valid ${type} definition`),\n          onCreatedElements$('remote', game)\n        );\n      }\n      function createElementUndoP(ctxt, game) {\n        const stamps = R.pluck('stamp', R.prop(`${type}s`, ctxt));\n        return R.thread(game)(\n          R.over(R.lensProp(`${type}s`),\n                 gameElementsModel.removeStamps$(stamps)),\n          R.over(R.lensProp(`${type}_selection`),\n                 gameElementSelectionModel.removeFrom$('local', stamps)),\n          R.over(R.lensProp(`${type}_selection`),\n                 gameElementSelectionModel.removeFrom$('remote', stamps))\n        );\n      }\n      function tryToCreateElement(element) {\n        return elementModel.create(element);\n      }\n      function onCreatedElements(selection, game, elements) {\n        return R.thread(game)(\n          addToGameElements,\n          addToGameElementSelection\n        );\n\n        function addToGameElements(game) {\n          return R.over(\n            R.lensProp(`${type}s`),\n            gameElementsModel.add$(elements),\n            game\n          );\n        }\n        function addToGameElementSelection(game) {\n          const stamps = R.map(R.path(['state','stamp']), elements);\n          return R.over(\n            R.lensProp(`${type}_selection`),\n            gameElementSelectionModel.set$(selection, stamps),\n            game\n          );\n        }\n      }\n    };\n  }\n})();\n"]}