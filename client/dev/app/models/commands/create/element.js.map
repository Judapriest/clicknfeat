{"version":3,"sources":["element.es6"],"names":[],"mappings":"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","file":"element.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('createElementCommand', createElementCommandModelFactory);\n\n  createElementCommandModelFactory.$inject = [\n    'point',\n  ];\n  function createElementCommandModelFactory(pointModel) {\n    return function buildCreateElementCommandModel(type,\n                                                   elementModel,\n                                                   gameElementsModel,\n                                                   gameElementSelectionModel) {\n      const createElementCommandModel = {\n        executeP: createElementExecuteP,\n        replayP: createElementReplayP,\n        undoP: createElementUndoP\n      };\n\n      const emitCreateEvent$ = R.curry(emitCreateEvent);\n      const onCreatedElements$ = R.curry(onCreatedElements);\n\n      return createElementCommandModel;\n\n      function createElementExecuteP(create, is_flipped, state, game) {\n        const add$ = pointModel.addToWithFlip$(is_flipped);\n        return R.threadP(create)(\n          R.prop(`${type}s`),\n          R.map(addElementP),\n          R.promiseAll,\n          R.reject(R.isNil),\n          R.rejectIf(R.isEmpty, `No valid ${type} definition`),\n          onNewElements\n        );\n\n        function addElementP(element) {\n          return R.thread(element)(\n            add$(create.base),\n            R.omit(['stamp']),\n            tryToCreateElementP\n          );\n        }\n        function onNewElements(elements) {\n          const ctxt = {\n            [`${type}s`]: R.map(elementModel.saveState, elements),\n            desc: R.thread(elements)(\n              R.head,\n              R.pathOr([], ['state','info']),\n              R.join('.')\n            )\n          };\n          return R.thread(elements)(\n            onCreatedElements$('local', state, game),\n            (game) => {\n              return [ctxt, game];\n            }\n          );\n        }\n      }\n      function createElementReplayP(ctxt, state, game) {\n        return R.threadP(ctxt)(\n          R.prop(`${type}s`),\n          R.map(tryToCreateElementP),\n          R.promiseAll,\n          R.reject(R.isNil),\n          R.rejectIf(R.isEmpty, `No valid ${type} definition`),\n          onCreatedElements$('remote', state, game)\n        );\n      }\n      function createElementUndoP(ctxt, state, game) {\n        const stamps = R.pluck('stamp', R.prop(`${type}s`, ctxt));\n        return R.thread(game)(\n          R.over(R.lensProp(`${type}s`),\n                 gameElementsModel.removeStamps$(stamps)),\n          R.over(R.lensProp(`${type}_selection`),\n                 gameElementSelectionModel.removeFrom$('local', stamps, state)),\n          R.over(R.lensProp(`${type}_selection`),\n                 gameElementSelectionModel.removeFrom$('remote', stamps, state)),\n          emitCreateEvent$(state)\n        );\n      }\n      function tryToCreateElementP(element) {\n        return elementModel\n          .createP(element)\n          .catch(R.always(null));\n      }\n      function onCreatedElements(selection, state, game, elements) {\n        return R.thread(game)(\n          addToGameElements,\n          addToGameElementSelection,\n          emitCreateEvent$(state)\n        );\n\n        function addToGameElements(game) {\n          return R.thread(game)(\n            R.prop(`${type}s`),\n            gameElementsModel.add$(elements),\n            (game_elements) => {\n              return R.assoc(`${type}s`, game_elements, game);\n            }\n          );\n        }\n        function addToGameElementSelection(game) {\n          const stamps = R.map(R.path(['state','stamp']), elements);\n          return R.thread(game)(\n            R.prop(`${type}_selection`),\n            gameElementSelectionModel\n              .set$(selection, stamps, state),\n            (selection) => {\n              return R.assoc(`${type}_selection`, selection, game);\n            }\n          );\n        }\n      }\n      function emitCreateEvent(state, game) {\n        state.queueChangeEventP(`Game.${type}.create`);\n        return game;\n      }\n    };\n  }\n})();\n"]}