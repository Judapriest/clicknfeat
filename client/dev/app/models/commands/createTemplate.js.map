{"version":3,"sources":["createTemplate.es6"],"names":[],"mappings":"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","file":"createTemplate.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('createTemplateCommand', [\n    'commands',\n    'point',\n    'template',\n    'gameTemplates',\n    'gameTemplateSelection',\n    function createTemplateCommandServiceFactory(commandsService,\n                                                 pointService,\n                                                 templateService,\n                                                 gameTemplatesService,\n                                                 gameTemplateSelectionService) {\n      var createTemplateCommandService = {\n        execute: function createTemplateExecute(create, is_flipped, state, game) {\n          var add$ = pointService.addToWithFlip$(is_flipped);\n          return R.pipePromise(\n            R.prop('templates'),\n            R.map((temp) => {\n              return R.pipe(\n                add$(create.base),\n                R.omit(['stamp']),\n                (temp) => {\n                  return templateService\n                    .create(temp)\n                    .catch(R.always(null));\n                }\n              )(temp);\n            }),\n            R.promiseAll,\n            R.reject(R.isNil),\n            (templates)  => {\n              if(R.isEmpty(templates)) {\n                return self.Promise.reject('No valid template definition');\n              }\n\n              var ctxt = {\n                templates: R.map(templateService.saveState, templates),\n                desc: templates[0].type\n              };\n              return R.pipe(\n                gameTemplatesService.add$(templates),\n                (game_templates) => {\n                  game = R.assoc('templates', game_templates, game);\n\n                  return gameTemplateSelectionService\n                    .set('local', R.map(R.path(['state','stamp']), templates),\n                         state, game.template_selection);\n                },\n                (selection) => {\n                  game = R.assoc('template_selection', selection, game);\n\n                  state.changeEvent('Game.template.create');\n\n                  return [ctxt, game];\n                }\n              )(game.templates);\n            }\n          )(create);\n        },\n        replay: function createTemplateReplay(ctxt, state, game) {\n          return R.pipePromise(\n            R.map((temp) => {\n              return templateService.create(temp)\n                .catch(R.always(null));\n            }),\n            R.promiseAll,\n            R.reject(R.isNil),\n            (templates) => {\n              if(R.isEmpty(templates)) {\n                return self.Promise.reject('No valid template definition');\n              }\n              return templates;\n            },\n            (templates) => {\n              return R.pipe(\n                gameTemplatesService.add$(templates),\n                (game_templates) => {\n                  game = R.assoc('templates', game_templates, game);\n            \n                  return gameTemplateSelectionService\n                    .set('remote', R.map(R.path(['state','stamp']), templates),\n                         state, game.template_selection);\n                },\n                (selection) => {\n                  game = R.assoc('template_selection', selection, game);\n\n                  state.changeEvent('Game.template.create');\n\n                  return game;\n                }\n              )(game.templates);\n            }\n          )(ctxt.templates);\n        },\n        undo: function createTemplateUndo(ctxt, state, game) {\n          return R.pipe(\n            R.pluck('stamp'),\n            (stamps) => {\n              return R.pipe(\n                gameTemplatesService.removeStamps$(stamps),\n                (game_templates) => {\n                  game = R.assoc('templates', game_templates, game);\n\n                  return gameTemplateSelectionService\n                    .removeFrom('local', stamps, state, game.template_selection);\n                },\n                (selection) => {\n                  game = R.assoc('template_selection', selection, game);\n              \n                  return gameTemplateSelectionService\n                    .removeFrom('remote', stamps, state, game.template_selection);\n                },\n                (selection) => {\n                  game = R.assoc('template_selection', selection, game);\n          \n                  state.changeEvent('Game.template.create');\n\n                  return game;\n                }\n              )(game.templates);\n            }\n          )(ctxt.templates);\n        }\n      };\n      commandsService.registerCommand('createTemplate', createTemplateCommandService);\n      return createTemplateCommandService;\n    }\n  ]);\n"]}