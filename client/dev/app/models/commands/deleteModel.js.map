{"version":3,"sources":["deleteModel.es6"],"names":[],"mappings":";;AAAA,QAAQ,MAAR,CAAe,mBAAf,EACG,OADH,CACW,oBADX,EACiC,CAC7B,UAD6B,EAE7B,OAF6B,EAG7B,YAH6B,EAI7B,oBAJ6B,EAK7B,SAAS,gCAAT,CAA0C,eAA1C,EAC0C,YAD1C,EAE0C,iBAF1C,EAG0C,yBAH1C,EAGqE;AACnE,MAAI,4BAA4B;AAC9B,aAAS,SAAS,kBAAT,CAA4B,MAA5B,EAAoC,KAApC,EAA2C,IAA3C,EAAiD;AACxD,aAAO,EAAE,KAAF,CACL,UAAC,MAAD,EAAY;AACV,eAAO,kBAAkB,aAAlB,CAAgC,MAAhC,EAAwC,KAAK,MAAL,CAA/C,CADU;OAAZ,EAGA,EAAE,MAAF,CAAS,EAAE,KAAF,CAJJ,EAKL,EAAE,GAAF,CAAM,aAAa,SAAb,CALD,EAML,UAAC,MAAD,EAAY;AACV,YAAI,OAAO;AACT,kBAAQ,MAAR;AACA,gBAAM,EAAN;SAFE,CADM;AAKV,eAAO,EAAE,IAAF,CACL,kBAAkB,aAAlB,CAAgC,MAAhC,CADK,EAEL,UAAC,WAAD,EAAiB;AACf,iBAAO,EAAE,KAAF,CAAQ,QAAR,EAAkB,WAAlB,EAA+B,IAA/B,CAAP,CADe;;AAGf,iBAAO,0BACJ,UADI,CACO,OADP,EACgB,MADhB,EACwB,KADxB,EAC+B,KAAK,eAAL,CADtC,CAHe;SAAjB,EAMA,0BAA0B,WAA1B,CAAsC,QAAtC,EAAgD,MAAhD,EAAwD,KAAxD,CARK,EASL,UAAC,SAAD,EAAe;AACb,iBAAO,EAAE,KAAF,CAAQ,iBAAR,EAA2B,SAA3B,EAAsC,IAAtC,CAAP,CADa;;AAGb,YAAE,OAAF,CAAU,UAAC,KAAD,EAAW;AACnB,kBAAM,WAAN,wBAAuC,KAAvC,EADmB;WAAX,EAEP,MAFH,EAHa;AAMb,gBAAM,WAAN,CAAkB,mBAAlB,EANa;;AAQb,iBAAO,CAAC,IAAD,EAAO,IAAP,CAAP,CARa;SAAf,CATK,CAmBL,KAAK,MAAL,CAnBF,CALU;OAAZ,CANK,CAgCL,MAhCK,CAAP,CADwD;KAAjD;AAmCT,YAAQ,SAAS,iBAAT,CAA2B,IAA3B,EAAiC,KAAjC,EAAwC,IAAxC,EAA8C;AACpD,aAAO,EAAE,IAAF,CACL,EAAE,KAAF,CAAQ,OAAR,CADK,EAEL,UAAC,MAAD,EAAY;AACV,eAAO,EAAE,IAAF,CACL,YAAM;AACJ,iBAAO,kBAAkB,YAAlB,CAA+B,MAA/B,EAAuC,KAAK,MAAL,CAA9C,CADI;SAAN,EAGA,UAAC,WAAD,EAAiB;AACf,iBAAO,EAAE,KAAF,CAAQ,QAAR,EAAkB,WAAlB,EAA+B,IAA/B,CAAP,CADe;;AAGf,iBAAO,0BACJ,UADI,CACO,OADP,EACgB,MADhB,EACwB,KADxB,EAC+B,KAAK,eAAL,CADtC,CAHe;SAAjB,EAMA,0BAA0B,WAA1B,CAAsC,QAAtC,EAAgD,MAAhD,EAAwD,KAAxD,CAVK,EAWL,UAAC,SAAD,EAAe;AACb,iBAAO,EAAE,KAAF,CAAQ,iBAAR,EAA2B,SAA3B,EAAsC,IAAtC,CAAP,CADa;;AAGb,YAAE,OAAF,CAAU,UAAC,KAAD,EAAW;AACnB,kBAAM,WAAN,wBAAuC,KAAvC,EADmB;WAAX,EAEP,MAFH,EAHa;AAMb,gBAAM,WAAN,CAAkB,mBAAlB,EANa;;AAQb,iBAAO,IAAP,CARa;SAAf,CAXK,EAAP,CADU;OAAZ,CAFK,CA0BL,KAAK,MAAL,CA1BF,CADoD;KAA9C;AA6BR,UAAM,SAAS,eAAT,CAAyB,IAAzB,EAA+B,KAA/B,EAAsC,IAAtC,EAA4C;AAChD,aAAO,EAAE,WAAF,CACL,EAAE,GAAF,CAAM,UAAC,KAAD,EAAW;AACf,eAAO,aAAa,MAAb,CAAoB,MAAM,QAAN,EAAgB,KAApC,EACJ,KADI,CACE,EAAE,MAAF,CAAS,IAAT,CADF,CAAP,CADe;OAAX,CADD,EAKL,EAAE,UAAF,EACA,EAAE,MAAF,CAAS,EAAE,KAAF,CANJ,EAOL,UAAC,MAAD,EAAY;AACV,YAAG,EAAE,OAAF,CAAU,MAAV,CAAH,EAAsB;AACpB,iBAAO,KAAK,OAAL,CAAa,MAAb,CAAoB,2BAApB,CAAP,CADoB;SAAtB;;AAIA,eAAO,EAAE,IAAF,CACL,kBAAkB,IAAlB,CAAuB,MAAvB,CADK,EAEL,UAAC,WAAD,EAAiB;AACf,iBAAO,EAAE,KAAF,CAAQ,QAAR,EAAkB,WAAlB,EAA+B,IAA/B,CAAP,CADe;;AAGf,cAAI,SAAS,EAAE,GAAF,CAAM,EAAE,IAAF,CAAO,CAAC,OAAD,EAAS,OAAT,CAAP,CAAN,EAAiC,MAAjC,CAAT,CAHW;AAIf,iBAAO,0BACJ,GADI,CACA,QADA,EACU,MADV,EACkB,KADlB,EACyB,KAAK,eAAL,CADhC,CAJe;SAAjB,EAOA,UAAC,SAAD,EAAe;AACb,iBAAO,EAAE,KAAF,CAAQ,iBAAR,EAA2B,SAA3B,EAAsC,IAAtC,CAAP,CADa;;AAGb,gBAAM,WAAN,CAAkB,mBAAlB,EAHa;;AAKb,iBAAO,IAAP,CALa;SAAf,CATK,CAgBL,KAAK,MAAL,CAhBF,CALU;OAAZ,CAPK,CA8BL,KAAK,MAAL,CA9BF,CADgD;KAA5C;GAjEJ,CAD+D;AAoGnE,kBAAgB,eAAhB,CAAgC,aAAhC,EAA+C,yBAA/C,EApGmE;AAqGnE,SAAO,yBAAP,CArGmE;CAHrE,CANJ","file":"deleteModel.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('deleteModelCommand', [\n    'commands',\n    'model',\n    'gameModels',\n    'gameModelSelection',\n    function deleteModelCommandServiceFactory(commandsService,\n                                              modelService,\n                                              gameModelsService,\n                                              gameModelSelectionService) {\n      var deleteModelCommandService = {\n        execute: function deleteModelExecute(stamps, state, game) {\n          return R.pipeP(\n            (stamps) => {\n              return gameModelsService.findAnyStamps(stamps, game.models);\n            },\n            R.reject(R.isNil),\n            R.map(modelService.saveState),\n            (states) => {\n              var ctxt = {\n                models: states,\n                desc: ''\n              };\n              return R.pipe(\n                gameModelsService.removeStamps$(stamps),\n                (game_models) => {\n                  game = R.assoc('models', game_models, game);\n\n                  return gameModelSelectionService\n                    .removeFrom('local', stamps, state, game.model_selection);\n                },\n                gameModelSelectionService.removeFrom$('remote', stamps, state),\n                (selection) => {\n                  game = R.assoc('model_selection', selection, game);\n                  \n                  R.forEach((stamp) => {\n                    state.changeEvent(`Game.model.delete.${stamp}`);\n                  }, stamps);\n                  state.changeEvent('Game.model.create');\n\n                  return [ctxt, game];\n                }\n              )(game.models);\n            }\n          )(stamps);\n        },\n        replay: function deleteModelReplay(ctxt, state, game) {\n          return R.pipe(\n            R.pluck('stamp'),\n            (stamps) => {\n              return R.pipe(\n                () => {\n                  return gameModelsService.removeStamps(stamps, game.models);\n                },\n                (game_models) => {\n                  game = R.assoc('models', game_models, game);\n\n                  return gameModelSelectionService\n                    .removeFrom('local', stamps, state, game.model_selection);\n                },\n                gameModelSelectionService.removeFrom$('remote', stamps, state),\n                (selection) => {\n                  game = R.assoc('model_selection', selection, game);\n                  \n                  R.forEach((stamp) => {\n                    state.changeEvent(`Game.model.delete.${stamp}`);\n                  }, stamps);\n                  state.changeEvent('Game.model.create');\n\n                  return game;\n                }\n              )();\n            }\n          )(ctxt.models);\n        },\n        undo: function deleteModelUndo(ctxt, state, game) {\n          return R.pipePromise(\n            R.map((model) => {\n              return modelService.create(state.factions, model)\n                .catch(R.always(null));\n            }),\n            R.promiseAll,\n            R.reject(R.isNil),\n            (models) => {\n              if(R.isEmpty(models)) {\n                return self.Promise.reject('No valid model definition');\n              }\n              \n              return R.pipe(\n                gameModelsService.add$(models),\n                (game_models) => {\n                  game = R.assoc('models', game_models, game);\n\n                  var stamps = R.map(R.path(['state','stamp']), models);\n                  return gameModelSelectionService\n                    .set('remote', stamps, state, game.model_selection);\n                },\n                (selection) => {\n                  game = R.assoc('model_selection', selection, game);\n                  \n                  state.changeEvent('Game.model.create');\n\n                  return game;\n                }\n              )(game.models);\n            }\n          )(ctxt.models);\n        }\n      };\n      commandsService.registerCommand('deleteModel', deleteModelCommandService);\n      return deleteModelCommandService;\n    }\n  ]);\n"]}