{"version":3,"sources":["template.es6"],"names":[],"mappings":"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","file":"template.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('template', templateModelFactory)\n    .factory('allTemplates', [\n      'aoeTemplate',\n      'sprayTemplate',\n      'wallTemplate',\n      () => ({})\n    ]);\n\n  templateModelFactory.$inject = [\n    'settings',\n    'element',\n  ];\n  function templateModelFactory(settingsModel,\n                                elementModel) {\n    const TEMPS_REG = {};\n    const DEFAULT_MOVES = {\n      Move: 10,\n      MoveSmall: 1,\n      Rotate: 60,\n      RotateSmall: 6,\n      Shift: 10,\n      ShiftSmall: 1\n    };\n    const MOVES = R.clone(DEFAULT_MOVES);\n    settingsModel.register('Misc',\n                           'Template',\n                           DEFAULT_MOVES,\n                           (moves) => {\n                             R.extend(MOVES, moves);\n                           });\n\n    const base = elementModel('template', MOVES);\n    const templateModel = Object.create(base);\n    R.deepExtend(templateModel, {\n      registerTemplate: templateRegister,\n      createDefault: templateCreateDefault,\n      respondTo: templateRespondTo,\n      callP: templateCallP,\n      render: templateRender\n    });\n\n    R.curryService(templateModel);\n    return templateModel;\n\n    function templateRegister(type, model) {\n      TEMPS_REG[type] = model;\n    }\n    function templateCreateDefault(temp) {\n      return R.thread(temp.type)(\n        R.unless(\n          (type) => R.exists(TEMPS_REG[type]),\n          () => null\n        ),\n        R.ifElse(\n          R.exists,\n          (type) => R.thread(base.createDefault())(\n            R.assocPath(['state','type'], type),\n            TEMPS_REG[type]._create\n          ),\n          () => base.createDefault()\n        )\n      );\n    }\n    function templateRespondTo(method, template) {\n      return ( R.exists(TEMPS_REG[template.state.type]) &&\n               R.exists(TEMPS_REG[template.state.type][method])\n             );\n    }\n    function templateCallP(method, args, template) {\n      return R.threadP(template)(\n        R.rejectIfP(R.complement(templateModel.respondTo$(method)),\n                   `Unknown call ${method} on ${template.state.type} template`),\n        () => TEMPS_REG[template.state.type][method]\n          .apply(TEMPS_REG[template.state.type],\n                 [...args, template])\n      );\n    }\n    function templateRender({is_flipped}, temp) {\n      const render = {\n        stamp: temp.state.stamp,\n        type: temp.state.type,\n        x: 0,\n        y: 0,\n        transform: ''\n      };\n      const label_options = TEMPS_REG[temp.state.type]\n              .render(temp, render);\n      label_options.flipped = is_flipped;\n      render.label = base\n        .renderLabel(label_options, temp);\n      return render;\n    }\n  }\n})();\n"]}