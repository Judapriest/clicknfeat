{"version":3,"sources":["aoe.es6"],"names":[],"mappings":"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","file":"aoe.js","sourcesContent":["(function() {\n  angular.module('clickApp.models')\n    .factory('aoeTemplate', aoeTemplateModelFactory);\n\n  aoeTemplateModelFactory.$inject = [\n    'template',\n    'point',\n  ];\n  function aoeTemplateModelFactory(templateModel,\n                                   pointModel) {\n    const SIZE_LENS = R.lensPath(['state','s']);\n    const MAX_DEVIATION_LENS = R.lensPath(['state','m']);\n    const aoeTemplateModel = Object.create(templateModel);\n    R.deepExtend(aoeTemplateModel, {\n      _create: aoeTemplateCreate,\n      setSizeP: aoeTemplateSetSizeP,\n      size: aoeTemplateSize,\n      deviate: aoeTemplateDeviateP,\n      maxDeviation: aoeTemplateMaxDeviation,\n      setMaxDeviation: aoeTemplateSetMaxDeviation,\n      setToRulerP: aoeTemplateSetToRulerP,\n      setTargetP: aoeTemplateSetTargetP,\n      render: aoeTemplateRender\n    });\n\n    templateModel.registerTemplate('aoe', aoeTemplateModel);\n    R.curryService(aoeTemplateModel);\n    return aoeTemplateModel;\n\n    function aoeTemplateCreate(temp) {\n      return R.set(SIZE_LENS, 15, temp);\n    }\n    function aoeTemplateSetSizeP(size, temp) {\n      return R.threadP(size)(\n        (size) => R.find(R.equals(size), [3,4,5]),\n        R.rejectIfP(R.isNil, 'Invalid size for an AoE'),\n        () => R.set(SIZE_LENS, size * 5, temp)\n      );\n    }\n    function aoeTemplateSize(temp) {\n      return R.view(SIZE_LENS, temp);\n    }\n    function aoeTemplateDeviateP(dir, len, temp) {\n      return R.threadP(temp)(\n        R.rejectIfP(templateModel.isLocked, 'Template is locked'),\n        (temp) => {\n          dir = temp.state.r + 60 * (dir-1);\n          const max_len = R.viewOr(len, MAX_DEVIATION_LENS, temp);\n          len = Math.min(len, max_len);\n          return R.thread(temp)(\n            R.over(R.lensProp('state'),\n                   pointModel.translateInDirection$(len * 10, dir)),\n            R.assocPath(['state','r'], dir),\n            templateModel.checkState\n          );\n        }\n      );\n    }\n    function aoeTemplateMaxDeviation(temp) {\n      return R.viewOr(0, MAX_DEVIATION_LENS, temp);\n    }\n    function aoeTemplateSetMaxDeviation(max, temp) {\n      return R.set(MAX_DEVIATION_LENS, max, temp);\n    }\n    function aoeTemplateSetToRulerP(pos, temp) {\n      return R.threadP(temp)(\n        R.rejectIfP(templateModel.isLocked, 'Template is locked'),\n        (temp) => {\n          const state = R.thread(temp.state)(\n            R.assoc('x', pos.x),\n            R.assoc('y', pos.y),\n            R.assoc('r', pos.r),\n            R.assoc('m', pos.m)\n          );\n          return R.thread(temp)(\n            R.assoc('state', state),\n            templateModel.checkState\n          );\n        }\n      );\n    }\n    function aoeTemplateSetTargetP(target, temp) {\n      return templateModel.setPositionP(target.state, temp);\n    }\n    function aoeTemplateRender(temp, base_render) {\n      const state = temp.state;\n      R.deepExtend(base_render, {\n        x: state.x,\n        y: state.y,\n        radius: state.s || 15,\n        dx: state.x,\n        dy: state.y - (state.s || 15),\n        dtransform: `rotate(${state.r},${state.x},${state.y})`\n      });\n      return {\n        text_center: { x: state.x,\n                       y: state.y + state.s + 5\n                     },\n        flip_center: temp.state,\n        rotate_with_model: false\n      };\n    }\n  }\n})();\n"]}