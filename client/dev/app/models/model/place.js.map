{"version":3,"sources":["place.es6"],"names":[],"mappings":"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","file":"place.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('modelPlace', [\n    'point',\n    function modelPlaceServiceFactory(pointService) {\n      var PLACE_EPSILON = 0.1;\n      return function(MOVES, modelService) {\n        var modelPlaceService = {\n          startPlace: function modelStartPlace(model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            return R.assocPath(['state','pla'],\n                               { s: R.pick(['x','y','r'], model.state) },\n                               model);\n          },\n          isPlacing: function modelIsPlarging(model) {\n            return R.exists(model.state.pla);\n          },\n          endPlace: function modelEndPlace(model) {\n            return R.assocPath(['state','pla'], null, model);\n          },\n          setPlaceOrigin: function modelSetPlaceOrigin(factions, other, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var direction = pointService.directionTo(model.state.pla.s, other.state);\n            model = R.pipe(\n              R.over(R.lensProp('state'),\n                     pointService.rotateAroundTo$(direction, model.state.pla.s)),\n              R.assocPath(['state','pla','s','r'], direction)\n            )(model);\n            return modelService.checkState(factions, null, model);\n          },\n          setPlaceTarget: function modelSetPlaceTarget(factions, other, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var direction = pointService.directionTo(other.state, model.state.pla.s);\n            model = R.pipe(\n              R.over(R.lensProp('state'),\n                     pointService.rotateAroundTo$(direction, model.state.pla.s)),\n              R.assocPath(['state','pla','s','r'], direction)\n            )(model);\n            return modelService.checkState(factions, null, model);\n          },\n          placeMaxLength: function modelPlaceMaxLength(model) {\n            return R.head(R.path(['state','pml'], model));\n          },\n          setPlaceMaxLength: function modelSetPlaceMaxLength(factions, value, model) {\n            model = R.assocPath(['state','pml'], [ value, model.state.pml[1] ], model);\n            return modelService.checkState(factions, null, model);\n          },\n          placeWithin: function modelPlaceWithin(model) {\n            return R.nth(1, R.pathOr([], ['state','pml'], model));\n          },\n          setPlaceWithin: function modelSetPlaceWithin(factions, value, model) {\n            model = R.assocPath(['state','pml'], [ model.state.pml[0], value ], model);\n            return modelService.checkState(factions, null, model);\n          },\n          moveFrontPlace: function modelMoveFrontPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var dist = MOVES[small ? 'MoveSmall' : 'Move'];\n            var direction = model.state.pla.s.r;\n            model = R.over(R.lensProp('state'),\n                           pointService.translateInDirection$(dist, direction),\n                           model);\n            return modelService.checkState(factions, null, model);\n          },\n          moveBackPlace: function modelMoveBackPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var dist = MOVES[small ? 'MoveSmall' : 'Move'];\n            var direction = model.state.pla.s.r+180;\n            var distance = pointService.distanceTo(model.state, model.state.pla.s);\n            if(dist > distance) dist = distance;\n            model = R.over(R.lensProp('state'),\n                           pointService.translateInDirection$(dist, direction),\n                           model);\n            return modelService.checkState(factions, null, model);\n          },\n          rotateLeftPlace: function modelRotateLeftPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var angle = MOVES[small ? 'RotateChargeSmall' : 'RotateCharge'];\n            model = R.pipe(\n              R.over(R.lensProp('state'),\n                     pointService.rotateLeftAround$(angle, model.state.pla.s)),\n              R.over(R.lensPath(['state','pla','s','r']), R.subtract(R.__, angle))\n            )(model);\n            return modelService.checkState(factions, null, model);\n          },\n          rotateRightPlace: function modelRotateRightPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var angle = MOVES[small ? 'RotateChargeSmall' : 'RotateCharge'];\n            model = R.pipe( \n              R.over(R.lensProp('state'),\n                     pointService.rotateRightAround$(angle, model.state.pla.s)),\n              R.over(R.lensPath(['state', 'pla','s','r']), R.add(angle))\n            )(model);\n            return modelService.checkState(factions, null, model);\n          },\n          shiftLeftPlace: function modelShiftLeftPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n            model = R.over(R.lensProp('state'),\n                           pointService.shiftLeft$(dist),\n                           model);\n            return modelService.checkState(factions, null, model);\n          },\n          shiftRightPlace: function modelShiftRightPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n            model = R.over(R.lensProp('state'),\n                           pointService.shiftRight$(dist),\n                           model);\n            return modelService.checkState(factions, null, model);\n          },\n          shiftUpPlace: function modelShiftUpPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n            model = R.over(R.lensProp('state'),\n                           pointService.shiftUp$(dist),\n                           model);\n            return modelService.checkState(factions, null, model);\n          },\n          shiftDownPlace: function modelShiftDownPlace(factions, small, model) {\n            if(modelService.isLocked(model)) {\n              return self.Promise.reject('Model is locked');\n            }\n            var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n            model = R.over(R.lensProp('state'),\n                           pointService.shiftDown$(dist),\n                           model);\n            return modelService.checkState(factions, null, model);\n          }\n        };\n        var ensurePlaceLength = R.curry(function _ensurePlaceLength(info, target, state) {\n          if(R.exists(state.pla) &&\n             R.exists(state.pml) &&\n             state.pml[0] > 0) {\n            var distance = pointService.distanceTo(state, state.pla.s);\n            var max_dist = state.pml[0] * 10 + (state.pml[1] ? info.base_radius * 2 : 0);\n            if(distance > max_dist) {\n              var direction = pointService.directionTo(state, state.pla.s);\n              var position = pointService.translateInDirection(max_dist, direction,\n                                                               state.pla.s);\n              return R.pipe(\n                R.assoc('x', position.x),\n                R.assoc('y', position.y)\n              )(state);\n            }\n          }\n          return state;\n        });\n        modelService.state_checkers = R.append(ensurePlaceLength, modelService.state_checkers);\n        \n        var updatePlaceDirection = R.curry(function _updatePlaceDirection(state) {\n          if(R.exists(state.pla)) {\n            var distance = pointService.distanceTo(state, state.pla.s);\n            if(distance > PLACE_EPSILON) {\n              var direction = pointService.directionTo(state, state.pla.s);\n              return R.assocPath(['pla','s','r'], direction, state);\n            }\n          }\n          return state;\n        });\n        modelService.state_updaters = R.append(updatePlaceDirection, modelService.state_updaters);\n\n        return modelPlaceService;\n      };\n    }\n  ]);\n"]}