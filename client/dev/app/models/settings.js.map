{"version":3,"sources":["settings.es6"],"names":[],"mappings":"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","file":"settings.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('settings', settingsModelFactory);\n\n  settingsModelFactory.$inject = [\n    'localStorage',\n  ];\n  function settingsModelFactory(localStorageService) {\n    const SETTINGS_STORAGE_KEY = 'clickApp.settings';\n    const DEFAULT_SETTINGS = {};\n    const UPDATERS = {};\n    const settingsModel = {\n      register: settingsRegister,\n      loadP: settingsLoadP,\n      initP: settingsInitP,\n      bind: settingsBind,\n      update: settingsUpdate,\n      store: settingsStore\n    };\n\n    R.curryService(settingsModel);\n    return settingsModel;\n\n    function settingsRegister(type, name, settings, updater) {\n      DEFAULT_SETTINGS[type] = R.defaultTo({}, DEFAULT_SETTINGS[type]);\n      UPDATERS[type] = R.defaultTo({}, UPDATERS[type]);\n      console.log('Settings: register', type, name, settings);\n      // Object.freeze(settings);\n\n      DEFAULT_SETTINGS[type][name] = settings;\n      UPDATERS[type][name] = updater;\n    }\n    function settingsLoadP() {\n      return R.threadP(SETTINGS_STORAGE_KEY)(\n        (key) => {\n          return localStorageService.loadP(key)\n            .catch(R.spy('settings: failed to load data'));\n        },\n        R.defaultTo({}),\n        R.spyWarn('Settings load')\n      );\n    }\n    function settingsInitP() {\n      return R.threadP()(\n        settingsModel.loadP,\n        settingsModel.bind,\n        settingsModel.update\n      );\n    }\n    function settingsBind(settings) {\n      settings = R.defaultTo({}, settings);\n      return R.thread(DEFAULT_SETTINGS)(\n        R.keys,\n        R.reduce((mem, type) => {\n          const settings_type = R.propOr({}, type, settings);\n          mem[type] = R.thread(DEFAULT_SETTINGS[type])(\n            R.keys,\n            R.reduce((mem, name) => {\n              const base = Object.create(DEFAULT_SETTINGS[type][name]);\n              R.extend(base, R.propOr({}, name, settings_type));\n              mem[name] = base;\n              return mem;\n            }, {})\n          );\n          return mem;\n        }, {}),\n        (binded) => {\n          return {\n            default: DEFAULT_SETTINGS,\n            current: binded\n          };\n        }\n      );\n    }\n    function settingsUpdate(settings) {\n      R.thread(settings.current)(\n        R.keys,\n        R.forEach((type) => {\n          R.thread(settings.current[type])(\n            R.keys,\n            R.filter((name) => {\n              return R.exists(UPDATERS[type][name]);\n            }),\n            R.forEach((name) => {\n              UPDATERS[type][name](settings.current[type][name]);\n            })\n          );\n        })\n      );\n      return settings;\n    }\n    function settingsStore(settings) {\n      return R.thread(settings.current)(\n        R.spyWarn('Settings store'),\n        localStorageService.save$(SETTINGS_STORAGE_KEY)\n      );\n    }\n  }\n})();\n"]}