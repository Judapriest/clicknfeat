{"version":3,"sources":["exports.es6"],"names":[],"mappings":"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","file":"exports.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('stateExports', stateExportsServiceFactory);\n\n  stateExportsServiceFactory.$inject = [\n    'fileExport',\n  ];\n  function stateExportsServiceFactory(fileExportService) {\n    const stateExportsService = {\n      create: stateExportsCreate,\n      exportP: stateExportsExportDataP\n    };\n\n    const cleanupExport$ = R.curry(cleanupExport);\n\n    R.curryService(stateExportsService);\n    return stateExportsService;\n\n    function stateExportsCreate(state) {\n      state.exports = {};\n      return state;\n    }\n    function stateExportsExportDataP(name, buildData, state) {\n      return R.thread(state)(\n        generateDataUrlP,\n        R.condErrorP([\n          [ R.equals('nil'), R.always(null) ],\n          [ R.equals('unchanged'), R.rejectP ],\n          [ R.T, (error) => {\n            console.warn('Exports: error', name, error);\n            return null;\n          } ]\n        ]),\n        updateExportsP,\n        R.condErrorP([\n          [ R.T, R.always(null) ]\n        ])\n      );\n\n      function generateDataUrlP(state) {\n        return R.threadP(state)(\n          buildData,\n          R.rejectIfP(dataUnchanged, 'unchanged'),\n          memoizeData,\n          R.rejectIfP(R.isNil, 'nil'),\n          fileExportService.generate$('json')\n        );\n      }\n      function dataUnchanged(data) {\n        return R.equals(R.path(['exports',`_${name}`], state), data);\n      }\n      function memoizeData(data) {\n        state.exports = R.assoc(`_${name}`, data, state.exports);\n        return data;\n      }\n      function updateExportsP(url) {\n        return R.threadP(url)(\n          updateExports,\n          emitExportsEvent\n        );\n      }\n      function updateExports(url) {\n        state.exports = R.thread(state.exports)(\n          R.defaultTo({}),\n          cleanupExport$([name]),\n          R.assocPath([name], {\n            name: `clicknfeat_${name}.json`,\n            url: url\n          })\n        );\n      }\n      function emitExportsEvent() {\n        console.warn('Exports', state.exports);\n        state.queueChangeEventP(`Exports.${name}`);\n      }\n    }\n    function cleanupExport(path, exports) {\n      return R.thread(exports)(\n        R.path([ ...path, 'url' ]),\n        fileExportService.cleanup,\n        R.always(exports),\n        R.assocPath([ ...path, 'url' ], null)\n      );\n    }\n  }\n})();\n"]}