{"version":3,"sources":["game.es6"],"names":[],"mappings":"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","file":"game.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('stateGame', stateGameModelFactory);\n\n  stateGameModelFactory.$inject = [\n    'fileExport',\n    'fileImport',\n    'appState',\n    'state',\n    'modes',\n    'games',\n    'game',\n    'gameBoard',\n    'gameConnection',\n    'gameFactions',\n    'gameModels',\n    'gameModelSelection',\n    'gameScenario',\n    'gameTerrains',\n    // 'gameTemplates',\n    'gameTemplateSelection',\n    'gameTerrainSelection',\n    'allCommands',\n  ];\n  function stateGameModelFactory(fileExportService,\n                                 fileImportService,\n                                 appStateService,\n                                 stateModel,\n                                 modesModel,\n                                 gamesModel,\n                                 gameModel,\n                                 gameBoardModel,\n                                 gameConnectionModel,\n                                 gameFactionsModel,\n                                 gameModelsModel,\n                                 gameModelSelectionModel,\n                                 gameScenarioModel,\n                                 gameTerrainsModel,\n                                 // gameTemplatesModel,\n                                 gameTemplateSelectionModel,\n                                 gameTerrainSelectionModel) {\n    const GAME_LENS = R.lensProp('game');\n    const UI_STATE_LENS = R.lensProp('ui_state');\n    const stateGameModel = {\n      create: stateGamesCreate,\n      onUpdate: stateGameOnUpdate,\n      onSet: stateGameOnSet,\n      onLoad: stateGameOnLoad,\n      onLoadDataReady: stateGameOnLoadDataReady,\n      onLoadDataLoaded: stateGameOnLoadDataLoaded,\n      onLoadGameLoaded: stateGameOnLoadGameLoaded,\n      onConnectionClose: stateGameOnConnectionClose,\n      onCommandExecute: stateGameOnCommandExecute,\n      onCommandUndo: stateGameOnCommandUndo,\n      onCommandUndoLast: stateGameOnCommandUndoLast,\n      onCommandReplay: stateGameOnCommandReplay,\n      onCommandReplayNext: stateGameOnCommandReplayNext,\n      onCommandReplayBatch: stateGameOnCommandReplayBatch,\n      onSetCmds: stateGameOnSetCmds,\n      onSetPlayers: stateGameOnSetPlayers,\n      onNewChatMsg: stateGameOnNewChatMsg,\n      onUiStateFlip: stateGameOnUiStateFlip,\n      onInvitePlayer: stateGameOnInvitePlayer,\n      onModelCreate: stateGameOnModelCreate,\n      onModelCopy: stateGameOnModelCopy,\n      onModelImportList: stateGameOnModelImportList,\n      onModelImportFile: stateGameOnModelImportFile,\n      onModelImportFileData: stateGameOnModelImportFileData,\n      onTemplateCreate: stateGameOnTemplateCreate,\n      onTerrainCreate: stateGameOnTerrainCreate,\n      onTerrainReset: stateGameOnTerrainReset,\n      onBoardSet: stateGameOnBoardSet,\n      onBoardSetRandom: stateGameOnBoardSetRandom,\n      onBoardImportFile: stateGameOnBoardImportFile,\n      onScenarioSet: stateGameOnScenarioSet,\n      onScenarioSetRandom: stateGameOnScenarioSetRandom,\n      // onScenarioRefresh: stateGameOnScenarioRefresh,\n      onScenarioGenerateObjectives: stateGameOnScenarioGenerateObjectives,\n      updateExport: stateGameUpdateExport,\n      updateBoardExport: stateGameUpdateBoardExport,\n      updateModelsExport: stateGameUpdateModelsExport,\n      saveCurrent: stateGameSaveCurrent,\n      checkMode: stateGameCheckMode,\n      closeOsd: stateGameCloseOsd\n    };\n    R.curryService(stateGameModel);\n    stateModel.register(stateGameModel);\n    return stateGameModel;\n\n    function stateGamesCreate(state) {\n      appStateService\n        .addReducer('Game.update'              , stateGameModel.onUpdate)\n        .addReducer('Game.set'                 , stateGameModel.onSet)\n        .addReducer('Game.load'                , stateGameModel.onLoad)\n        .addReducer('Game.load.dataReady'      , stateGameModel.onLoadDataReady)\n        .addReducer('Game.load.dataLoaded'     , stateGameModel.onLoadDataLoaded)\n        .addReducer('Game.load.gameLoaded'     , stateGameModel.onLoadGameLoaded)\n        .addReducer('Game.connection.close'    , stateGameModel.onConnectionClose)\n        .addReducer('Game.command.execute'     , stateGameModel.onCommandExecute)\n        .addReducer('Game.command.undo'        , stateGameModel.onCommandUndo)\n        .addReducer('Game.command.replay'      , stateGameModel.onCommandReplay)\n        .addReducer('Game.command.replayBatch' , stateGameModel.onCommandReplayBatch)\n        .addReducer('Game.command.undoLast'    , stateGameModel.onCommandUndoLast)\n        .addReducer('Game.command.replayNext'  , stateGameModel.onCommandReplayNext)\n        .addReducer('Game.invitePlayer'        , stateGameModel.onInvitePlayer)\n        .addReducer('Game.setCmds'             , stateGameModel.onSetCmds)\n        .addReducer('Game.setPlayers'          , stateGameModel.onSetPlayers)\n        .addReducer('Game.newChatMsg'          , stateGameModel.onNewChatMsg)\n        .addReducer('Game.uiState.flip'        , stateGameModel.onUiStateFlip)\n        .addReducer('Game.board.set'           , stateGameModel.onBoardSet)\n        .addReducer('Game.board.setRandom'     , stateGameModel.onBoardSetRandom)\n        .addReducer('Game.scenario.set'        , stateGameModel.onScenarioSet)\n        .addReducer('Game.scenario.setRandom'  , stateGameModel.onScenarioSetRandom)\n        .addReducer('Game.scenario.generateObjectives',\n                    stateGameModel.onScenarioGenerateObjectives)\n        .addReducer('Game.model.create'        , stateGameModel.onModelCreate)\n        .addReducer('Game.model.copy'          , stateGameModel.onModelCopy)\n        .addReducer('Game.model.importList'    , stateGameModel.onModelImportList)\n        .addReducer('Game.model.importFile'    , stateGameModel.onModelImportFile)\n        .addReducer('Game.model.importFileData', stateGameModel.onModelImportFileData)\n        .addReducer('Game.template.create'     , stateGameModel.onTemplateCreate)\n        .addReducer('Game.terrain.create'      , stateGameModel.onTerrainCreate)\n        .addReducer('Game.terrain.reset'       , stateGameModel.onTerrainReset)\n        .addReducer('Game.board.importFile'    , stateGameModel.onBoardImportFile)\n        .addListener('Game.change'             , stateGameModel.saveCurrent)\n        .addListener('Modes.change',\n                     stateGameModel.closeOsd)\n        .addListener('Game.template_selection.local.change',\n                     stateGameModel.checkMode)\n        .addListener('Game.terrain_selection.local.change',\n                     stateGameModel.checkMode)\n        .addListener('Game.model_selection.local.change',\n                     stateGameModel.checkMode);\n        // .addReducer('Game.scenario.refresh'    , stateGameModel.onScenarioRefresh)\n\n      appStateService\n        .onChange('AppState.change',\n                  'Game.change',\n                  R.view(GAME_LENS));\n      const game_export_cell = appStateService\n              .cell('Game.change',\n                    stateGameModel.updateExport,\n                    {});\n      const board_export_cell = appStateService\n              .cell([ 'Game.board.change',\n                      'Game.terrains.change' ],\n                    stateGameModel.updateBoardExport,\n                    {});\n      const models_export_cell = appStateService\n              .cell([ 'Game.models.change',\n                      'Game.model_selection.local.change' ],\n                    stateGameModel.updateModelsExport,\n                    {});\n      appStateService\n        .onChange('Game.change',\n                  'Game.layers.change',\n                  R.pipe(R.defaultTo({}), R.prop('layers')));\n      appStateService\n        .onChange('AppState.change',\n                  'Modes.change',\n                  R.path(['modes','current','name']));\n      appStateService\n        .onChange('Game.change',\n                  'Game.command.change',\n                  [ R.prop('commands'),\n                    R.prop('commands_log'),\n                    R.prop('undo'),\n                    R.prop('undo_log')\n                  ]);\n      appStateService\n        .onChange('AppState.change',\n                  'Game.view.flipMap',\n                  R.pipe(R.view(UI_STATE_LENS), R.prop('flipped')));\n      appStateService\n        .onChange('Game.change',\n                  'Game.dice.change',\n                  R.prop('dice'));\n      appStateService\n        .onChange('Game.change',\n                  'Game.board.change',\n                  R.prop('board'));\n      appStateService\n        .onChange('Game.change',\n                  'Game.scenario.change',\n                  R.prop('scenario'));\n      appStateService\n        .onChange('AppState.change',\n                  'Create.base.change',\n                  R.path(['create','base']));\n      appStateService\n        .onChange('Game.change',\n                  'Game.models.change',\n                  R.prop(['models']));\n      appStateService\n        .onChange('Game.change',\n                  'Game.model_selection.change',\n                  R.prop('model_selection'));\n      appStateService\n        .onChange('Game.model_selection.change',\n                  'Game.model_selection.local.change',\n                  R.prop('local'));\n      appStateService\n        .onChange('Game.change',\n                  'Game.templates.change',\n                  R.prop(['templates']));\n      appStateService\n        .onChange('Game.change',\n                  'Game.template_selection.change',\n                  R.prop('template_selection'));\n      appStateService\n        .onChange('Game.template_selection.change',\n                  'Game.template_selection.local.change',\n                  R.prop('local'));\n      appStateService\n        .onChange('Game.change',\n                  'Game.terrains.change',\n                  R.prop(['terrains']));\n      appStateService\n        .onChange('Game.change',\n                  'Game.terrain_selection.change',\n                  R.prop('terrain_selection'));\n      appStateService\n        .onChange('Game.terrain_selection.change',\n                  'Game.terrain_selection.local.change',\n                  R.prop('local'));\n      appStateService\n        .onChange('Game.change',\n                  'Game.ruler.remote.change',\n                  R.path(['ruler','remote']));\n      appStateService\n        .onChange('Game.change',\n                  'Game.ruler.local.change',\n                  R.path(['ruler','local']));\n      appStateService\n        .onChange('Game.change',\n                  'Game.los.remote.change',\n                  R.path(['los','remote']));\n      appStateService\n        .onChange('Game.change',\n                  'Game.los.local.change',\n                  R.path(['los','local']));\n\n      return R.thread(state)(\n        R.set(UI_STATE_LENS, { flipped: false }),\n        R.set(GAME_LENS, {}),\n        R.assocPath(['exports', 'game'], game_export_cell),\n        R.assocPath(['exports', 'board'], board_export_cell),\n        R.assocPath(['exports', 'models'], models_export_cell)\n      );\n    }\n    function stateGameOnUpdate(state, _event_, [fn]) {\n      return R.over(GAME_LENS, fn, state);\n    }\n    function stateGameOnSet(state, _event_, [game]) {\n      return R.set(GAME_LENS, game, state);\n    }\n    function stateGameOnLoad(state, _event_, [is_online, is_private, id]) {\n      return waitForDataReady()\n        .then(() => appStateService\n              .reduce('Game.load.dataReady', is_online, is_private, id));\n\n      function waitForDataReady() {\n        return R.allP([\n          state.data_ready,\n          state.user_ready,\n          state.games_ready\n        ]);\n      }\n    }\n    function stateGameOnLoadDataReady(state, _event_, [is_online, is_private, id]) {\n      return R.threadP()(\n        R.ifElse(\n          () => is_online,\n          () => gamesModel.loadOnlineGameP(is_private, id),\n          () => gamesModel.loadLocalGameP(id, state.local_games)\n        ),\n        (data) => appStateService\n          .reduce('Game.load.dataLoaded', data)\n      );\n    }\n    function stateGameOnLoadDataLoaded(state, _event_, [data]) {\n      appStateService.emit('Game.loading');\n      R.threadP(data)(\n        gameModel.loadP,\n        (game) => appStateService\n          .reduce('Game.load.gameLoaded', game)\n      );\n      return R.assoc('modes', modesModel.init(), state);\n    }\n    function stateGameOnLoadGameLoaded(state, _event_, [game]) {\n      appStateService.emit('Game.loaded');\n      const user = R.path(['user','state','name'], state);\n      return R.threadP(game)(\n        R.when(\n          gameModel.isOnline,\n          gameConnectionModel.openP$(user)\n        ),\n        (game) => appStateService\n          .reduce('Game.set', game)\n      );\n    }\n    function stateGameOnConnectionClose(state, _event_) {\n      return R.over(\n        GAME_LENS,\n        gameConnectionModel.cleanup,\n        state\n      );\n    }\n    function stateGameOnCommandExecute(state, _event_, [cmd, args]) {\n      return R.threadP(state.game)(\n        gameModel.executeCommandP$(cmd, args),\n        (game) => appStateService.reduce('Game.set', game)\n      ).catch((error) => appStateService.emit('Game.error', error));\n    }\n    function stateGameOnCommandUndo(state, _event_, [cmd]) {\n      return R.threadP(state.game)(\n        gameModel.undoCommandP$(cmd),\n        (game) => appStateService.reduce('Game.set', game)\n      ).catch((error) => appStateService.emit('Game.error', error));\n    }\n    function stateGameOnCommandUndoLast(state, _event_) {\n      return R.threadP(state.game)(\n        gameModel.undoLastCommandP,\n        (game) => appStateService.reduce('Game.set', game)\n      ).catch((error) => appStateService.emit('Game.error', error));\n    }\n    function stateGameOnCommandReplay(state, _event_, [cmd]) {\n      return R.threadP(state.game)(\n        gameModel.replayCommandP$(cmd),\n        (game) => appStateService.reduce('Game.set', game)\n      ).catch((error) => appStateService.emit('Game.error', error));\n    }\n    function stateGameOnCommandReplayBatch(state, _event_, [cmds]) {\n      return R.threadP(state.game)(\n        gameModel.replayCommandsBatchP$(cmds),\n        (game) => appStateService.reduce('Game.set', game)\n      ).catch((error) => appStateService.emit('Game.error', error));\n    }\n    function stateGameOnCommandReplayNext(state, _event_) {\n      return R.threadP(state.game)(\n        gameModel.replayNextCommandP,\n        (game) => appStateService.reduce('Game.set', game)\n      ).catch((error) => appStateService.emit('Game.error', error));\n    }\n    function stateGameOnSetCmds(state, _event_, [set]) {\n      return R.over(\n        GAME_LENS,\n        R.assoc(set.where, set.cmds),\n        state\n      );\n    }\n    function stateGameOnSetPlayers(state, _event_, [players]) {\n      return R.over(\n        GAME_LENS,\n        R.assoc('players', players),\n        state\n      );\n    }\n    function stateGameOnNewChatMsg(state, _event_, [msg]) {\n      return R.over(\n        GAME_LENS,\n        R.over(R.lensProp('chat'),\n               R.compose(R.append(msg.chat), R.defaultTo([]))),\n        state\n      );\n    }\n    function stateGameOnUiStateFlip(state) {\n      return R.over(\n        UI_STATE_LENS,\n        R.over(R.lensProp('flipped'), R.not),\n        state\n      );\n    }\n    function stateGameOnInvitePlayer(state, _event_, to) {\n      const msg = [\n        s.capitalize(R.pathOr('Unknown', ['user','state','name'], state)),\n        'has invited you to join a game'\n      ].join(' ');\n      const link = self.window.location.hash;\n      console.log('Invite player', to, msg, link);\n\n      appStateService\n        .chainReduce('User.sendChatMsg',\n                     { to: [to], msg: msg, link: link });\n    }\n    function stateGameOnModelCreate(state, _event_, [model_path, repeat]) {\n      appStateService.chainReduce('Modes.switchTo', 'CreateModel');\n      return R.assoc('create', {\n        base: { x: 240, y: 240, r: 0 },\n        models: R.times((i) => ({\n          info: model_path,\n          x: 20*i, y: 0, r: 0\n        }), R.defaultTo(1, repeat))\n      }, state);\n    }\n    function stateGameOnModelCopy(state, _event_, [create]) {\n      appStateService.chainReduce('Modes.switchTo', 'CreateModel');\n      return R.assoc('create', create, state);\n    }\n    function stateGameOnModelImportList(state, _event_, [list]) {\n      const user = R.pathOr('Unknown', ['user','state','name'], state);\n      appStateService.chainReduce('Modes.switchTo', 'CreateModel');\n      return R.assoc(\n        'create',\n        gameFactionsModel.buildModelsList(list, user, state.factions.references),\n        state\n      );\n    }\n    function stateGameOnModelImportFile(_state_, _event_, [file]) {\n      return R.threadP(file)(\n        fileImportService.readP$('json'),\n        (create) => {\n          appStateService.reduce('Game.model.importFileData', create);\n        }\n      ).catch(error => appStateService.emit('Game.error', error));\n    }\n    function stateGameOnModelImportFileData(state, _event_, [create]) {\n      appStateService.chainReduce('Modes.switchTo', 'CreateModel');\n      return R.assoc('create', create, state);\n    }\n    // function stateGameOnModelSelectionLocalChange(state, _event_) {\n    //   // console.warn('onModelSelectionLocalChange', arguments);\n    //   const local_model_selection = gameModelSelectionModel\n    //           .get('local', state.game.model_selection);\n    //   const length = R.length(local_model_selection);\n    //   const previous_selection = R.path(['_model_selection_listener','stamp'], state);\n    //   if(length === 1 &&\n    //      local_model_selection[0] === previous_selection) {\n    //     return;\n    //   }\n    //   cleanupModelSelectionListener(state);\n    //   if(length === 1) {\n    //     setupModelSelectionListener(local_model_selection[0], state);\n    //   }\n    //   else {\n    //     appStateService.emit('Game.model.selection.local.updateSingle',\n    //                             null, null);\n    //   }\n    // }\n    // function setupModelSelectionListener(stamp, state) {\n    //   // console.warn('setupModelSelectionListener', arguments);\n    //   state._model_selection_listener = {\n    //     stamp: stamp,\n    //     unsubscribe: state\n    //       .onChangeEvent(`Game.model.change.${stamp}`,\n    //                      onModelSelectionChange(stamp, state))\n    //   };\n    // }\n    // function onModelSelectionChange(stamp, state) {\n    //   return () => {\n    //     // console.warn('onModelSelectionChange', arguments);\n    //     return R.threadP(state.game)(\n    //       R.prop('models'),\n    //       gameModelsModel.findStampP$(stamp),\n    //       (model) => {\n    //         appStateService.emit('Game.model.selection.local.updateSingle',\n    //                                 stamp, model);\n    //       }\n    //     );\n    //   };\n    // }\n    // function cleanupModelSelectionListener(state) {\n    //   // console.warn('cleanupModelSelectionListener', arguments);\n    //   const unsubscribe = R.thread(state)(\n    //     R.path(['_model_selection_listener','unsubscribe']),\n    //     R.defaultTo(() => {})\n    //   );\n    //   unsubscribe();\n    //   state._model_selection_listener = {};\n    // }\n    function stateGameOnTemplateCreate(state, _event_, [type]) {\n      appStateService.chainReduce('Modes.switchTo', 'CreateTemplate');\n      return R.assoc('create', {\n        base: { x: 240, y: 240, r: 0 },\n        templates: [ { type: type, x: 0, y: 0, r: 0 } ]\n      }, state);\n    }\n    // function stateGameOnTemplateSelectionLocalChange(state, _event_) {\n    //   console.warn('onTemplateSelectionLocalChange', arguments);\n    //   const local_template_selection = gameTemplateSelectionModel\n    //           .get('local', state.game.template_selection);\n    //   const length = R.length(local_template_selection);\n    //   const previous_selection =\n    //           R.path(['_template_selection_listener','stamp'], state);\n    //   if(length === 1 &&\n    //      local_template_selection[0] === previous_selection) {\n    //     return;\n    //   }\n    //   cleanupTemplateSelectionListener(state);\n    //   if(length === 1) {\n    //     setupTemplateSelectionListener(local_template_selection[0], state);\n    //   }\n    //   else {\n    //     appStateService.emit('Game.template.selection.local.updateSingle',\n    //                             null, null);\n    //   }\n    // }\n    // function setupTemplateSelectionListener(stamp, state) {\n    //   console.warn('setupTemplateSelectionListener', arguments);\n    //   state._template_selection_listener = {\n    //     stamp: stamp,\n    //     unsubscribe: state\n    //       .onChangeEvent(`Game.template.change.${stamp}`,\n    //                      onTemplateSelectionChange(stamp, state))\n    //   };\n    // }\n    // function onTemplateSelectionChange(stamp, state) {\n    //   return () => {\n    //     console.warn('onTemplateSelectionChange', arguments);\n    //     return R.threadP(state.game)(\n    //       R.prop('templates'),\n    //       gameTemplatesModel.findStampP$(stamp),\n    //       (template) => {\n    //         appStateService.emit('Game.template.selection.local.updateSingle',\n    //                                 stamp, template);\n    //       }\n    //     );\n    //   };\n    // }\n    // function cleanupTemplateSelectionListener(state) {\n    //   console.warn('cleanupTemplateSelectionListener', arguments);\n    //   const unsubscribe = R.thread(state)(\n    //     R.path(['_template_selection_listener','unsubscribe']),\n    //     R.defaultTo(() => {})\n    //   );\n    //   unsubscribe();\n    //   state._template_selection_listener = {};\n    // }\n    function stateGameOnTerrainCreate(state, _event_, [path]) {\n      appStateService.chainReduce('Modes.switchTo', 'CreateTerrain');\n      return R.assoc('create', {\n        base: { x: 240, y: 240, r: 0 },\n        terrains: [ {\n          info: path,\n          x: 0, y: 0, r: 0\n        } ]\n      }, state);\n    }\n    function stateGameOnTerrainReset(state) {\n      return R.threadP(state)(\n        R.view(GAME_LENS),\n        R.prop('terrains'),\n        gameTerrainsModel.all,\n        R.pluck('state'),\n        R.pluck('stamp'),\n        (stamps) => {\n          appStateService.reduce('Game.command.execute',\n                                 'deleteTerrain', [stamps]);\n        }\n      ).catch((error) => appStateService.emit('Game.error', error));\n    }\n    function stateGameOnBoardSet(state, _event_, [name]) {\n      const board = gameBoardModel.forName(name, state.boards);\n      self.window.requestAnimationFrame(() => {\n        appStateService.reduce('Game.command.execute',\n                               'setBoard', [board]);\n      });\n    }\n    function stateGameOnBoardSetRandom(state, _event_) {\n      let board, name = gameBoardModel.name(state.game.board);\n      while(name === gameBoardModel.name(state.game.board)) {\n        board = state.boards[R.randomRange(0, state.boards.length-1)];\n        name = gameBoardModel.name(board);\n      }\n      self.window.requestAnimationFrame(() => {\n        appStateService.reduce('Game.command.execute',\n                               'setBoard', [board]);\n      });\n    }\n    function stateGameOnBoardImportFile(_state_, _event_, [file]) {\n      R.threadP(file)(\n        fileImportService.readP$('json'),\n        R.spyWarn('import'),\n        R.tap(R.pipe(\n          R.prop('board'),\n          R.rejectIfP(R.isNil, 'No board'),\n          R.spyWarn('import'),\n          (board) => {\n            appStateService\n              .chainReduce('Game.command.execute',\n                           'setBoard', [board]);\n          }\n        )),\n        R.tap((data) => R.thread(data)(\n          R.path(['terrain', 'terrains']),\n          R.rejectIfP(R.isEmpty, 'No terrain'),\n          R.spyWarn('import', data),\n          () => {\n            appStateService\n              .chainReduce('Game.terrain.reset');\n            appStateService\n              .chainReduce('Game.command.execute',\n                           'createTerrain', [data.terrain, false]);\n          }\n        ))\n      ).catch(R.spyAndDiscardError('Import board file'));\n    }\n    function stateGameOnScenarioSet(_state_, _event_, [name, group]) {\n      const scenario = gameScenarioModel.forName(name, group);\n      self.window.requestAnimationFrame(() => {\n        appStateService.reduce('Game.command.execute',\n                               'setScenario', [scenario]);\n      });\n    }\n    function stateGameOnScenarioSetRandom(state, _event_) {\n      const group = gameScenarioModel.group('SR15', state.scenarios);\n      let scenario, name = gameScenarioModel.name(state.game.scenario);\n      while(name === gameScenarioModel.name(state.game.scenario)) {\n        scenario = group[1][R.randomRange(0, group[1].length-1)];\n        name = gameScenarioModel.name(scenario);\n      }\n      self.window.requestAnimationFrame(() => {\n        appStateService.reduce('Game.command.execute',\n                               'setScenario', [scenario]);\n      });\n    }\n    // function stateGameOnScenarioRefresh(state, _event_) {\n    //   appStateService.emit('Game.scenario.refresh');\n    // }\n    function stateGameOnScenarioGenerateObjectives(state, _event_) {\n      R.thread(state.game)(\n        deleteCurrentObjectives,\n        () => gameScenarioModel\n          .createObjectives(state.game.scenario),\n        (objectives) => {\n          const is_flipped = R.path(['ui_state','flip_map'], state);\n          return appStateService\n            .chainReduce('Game.command.execute',\n                         'createModel',\n                         [objectives, is_flipped]);\n        }\n      ).catch(gameModel.actionError$(state));\n\n      function deleteCurrentObjectives(game) {\n        return R.threadP(game)(\n          R.prop('models'),\n          gameModelsModel.all,\n          R.filter(R.pipe(\n            R.path(['state','info']),\n            R.head,\n            R.equals('scenario')\n          )),\n          R.map(R.path(['state','stamp'])),\n          R.unless(\n            R.isEmpty,\n            (stamps) => {\n              appStateService\n                .chainReduce('Game.command.execute',\n                             'deleteModel', [stamps]);\n            }\n          )\n        );\n      }\n    }\n    function stateGameUpdateExport(exp, current_game) {\n      fileExportService.cleanup(exp.url);\n      return {\n        name: 'clicknfeat_game.json',\n        url: fileExportService.generate('json', current_game)\n      };\n    }\n    function stateGameSaveCurrent(_event_, [game]) {\n      if(R.isNil(R.prop('local_stamp', R.defaultTo({}, game)))) {\n        return;\n      }\n      self.window.requestAnimationFrame(() => {\n        appStateService.reduce('Games.local.update', game);\n      });\n    }\n    function stateGameUpdateModelsExport(exp) {\n      fileExportService.cleanup(exp.url);\n      const state = appStateService.current();\n      const data = R.thread(state)(\n         R.path(['game','model_selection']),\n         gameModelSelectionModel.get$('local'),\n         gameModelsModel\n           .copyStamps$(R.__, R.path(['game', 'models'], state))\n      );\n      return {\n        name: 'clicknfeat_models.json',\n        url: fileExportService.generate('json', data)\n      };\n    }\n    function stateGameUpdateBoardExport(exp) {\n      fileExportService.cleanup(exp.url);\n      const state = appStateService.current();\n      const data = R.thread(state)(\n        R.prop('game'),\n        (game) => ({\n          board: game.board,\n          terrain: {\n            base: { x: 0, y: 0, r: 0 },\n            terrains: R.thread(game.terrains)(\n              gameTerrainsModel.all,\n              R.pluck('state'),\n              R.map(R.pick(['x','y','r','info','lk']))\n            )\n          }\n        })\n      );\n      return {\n        name: 'clicknfeat_board.json',\n        url: fileExportService.generate('json', data)\n      };\n    }\n    function stateGameCheckMode() {\n      const state = appStateService.current();\n      const game = R.propOr({}, 'game', state);\n      const current_mode = modesModel.currentModeName(state.modes);\n      const mode = R.thread()(\n        () => gameTerrainSelectionModel\n          .checkMode(R.propOr({}, 'terrain_selection', game)),\n        R.unless(\n          R.exists,\n          () => gameTemplateSelectionModel\n            .checkMode(R.propOr({}, 'template_selection', game))\n        ),\n        R.unless(\n          R.exists,\n          () => gameModelSelectionModel\n            .checkMode(game.models, R.propOr({}, 'model_selection', game))\n        ),\n        R.defaultTo('Default')\n      );\n      if(R.exists(mode) &&\n         mode !== current_mode) {\n        appStateService.chainReduce('Modes.switchTo', mode);\n      }\n    }\n    function stateGameCloseOsd() {\n      appStateService.emit('Game.selectionDetail.close');\n      appStateService.emit('Game.editDamage.close');\n      appStateService.emit('Game.editLabel.close');\n    }\n  }\n})();\n"]}