{"version":3,"sources":["games.es6"],"names":[],"mappings":"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","file":"games.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('stateGames', stateGamesModelFactory);\n\n  stateGamesModelFactory.$inject = [\n    'game',\n    'games',\n    'fileImport',\n  ];\n  function stateGamesModelFactory(gameModel,\n                                  gamesModel,\n                                  fileImportService) {\n    const stateGamesService = {\n      create: stateGamesCreate,\n      save: stateGamesSave,\n      onStateInit: stateGamesOnInit,\n      onGamesLocalCreate: stateGamesOnLocalCreate,\n      onGamesLocalLoad: stateOnGamesLocalLoad,\n      onGamesLocalLoadFile: stateOnGamesLocalLoadFile,\n      onGamesLocalDelete: stateOnGamesLocalDelete,\n      loadNewLocalGame: loadNewLocalGame\n    };\n    const setLocalGames$ = R.curry(setLocalGames);\n    const loadNewLocalGame$ = R.curry(loadNewLocalGame);\n\n    R.curryService(stateGamesService);\n    return stateGamesService;\n\n    function stateGamesCreate(state) {\n      state.local_games = {};\n      state.games_ready = new self.Promise((resolve) => {\n        state.onEvent('State.init',\n                      stateGamesService.onStateInit$(state, resolve));\n      });\n\n      state.onEvent('Games.local.create',\n                    stateGamesService.onGamesLocalCreate$(state));\n      state.onEvent('Games.local.load',\n                    stateGamesService.onGamesLocalLoad$(state));\n      state.onEvent('Games.local.loadFile',\n                    stateGamesService.onGamesLocalLoadFile$(state));\n      state.onEvent('Games.local.delete',\n                    stateGamesService.onGamesLocalDelete$(state));\n\n      return state;\n    }\n    function stateGamesSave(state) {\n      return state;\n    }\n    function stateGamesOnInit(state, ready, _event_) {\n      return R.threadP()(\n        gamesModel.loadLocalGamesP,\n        setLocalGames$(state),\n        ready\n      );\n    }\n    function stateGamesOnLocalCreate(state, _event_) {\n      return R.thread(state.user.state)(\n        gameModel.create,\n        loadNewLocalGame$(state)\n      );\n    }\n    function stateOnGamesLocalLoad(state, _event_, index) {\n      state.queueChangeEventP('Games.local.load', index);\n    }\n    function stateOnGamesLocalLoadFile(state, _event_, file) {\n      return R.threadP(file)(\n        fileImportService.readP$('json'),\n        stateGamesService.loadNewLocalGame$(state)\n      );\n    }\n    function stateOnGamesLocalDelete(state, _event_, id) {\n      return R.thread(state.local_games)(\n        gamesModel.removeLocalGame$(id),\n        setLocalGames$(state)\n      );\n    }\n    function setLocalGames(state, games) {\n      state.local_games = games;\n      console.log('stateSetLocalGames', state.local_games);\n      state.queueChangeEventP('Games.local.change');\n    }\n    function loadNewLocalGame(state, game) {\n      return R.thread(state.local_games)(\n        gamesModel.newLocalGame$(game),\n        setLocalGames$(state),\n        () => {\n          state.queueChangeEventP(\n            'Games.local.load',\n            R.prop('local_stamp', R.last(state.local_games))\n          );\n        }\n      );\n    }\n  }\n})();\n"]}