{"version":3,"sources":["games.es6"],"names":[],"mappings":"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","file":"games.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('stateGames', stateGamesModelFactory);\n\n  stateGamesModelFactory.$inject = [\n    'game',\n    'games',\n    'fileImport',\n    'state',\n    'appState',\n  ];\n  function stateGamesModelFactory(gameModel,\n                                  gamesModel,\n                                  fileImportService,\n                                  stateModel,\n                                  appStateService) {\n    const LOCAL_GAMES_LENS = R.lensProp('local_games');\n    const stateGamesModel = {\n      create: stateGamesCreate,\n      onLocalSet: stateGamesOnLocalSet,\n      onLocalUpdate: stateGamesOnLocalUpdate,\n      onLocalCreate: stateGamesOnLocalCreate,\n      onLocalLoadFile: stateGamesOnLocalLoadFile,\n      onLocalLoadNew: stateGamesOnLocalLoadNew,\n      onLocalLoad: stateGamesOnLocalLoad,\n      onLocalDelete: stateGamesOnLocalDelete,\n      onOnlineCreate: stateGamesOnOnlineCreate,\n      onOnlineLoadFile: stateGamesOnOnlineLoadFile,\n      loadNewOnlineGameP: loadNewOnlineGameP,\n      onOnlineLoad: stateGamesOnOnlineLoad\n    };\n    R.curryService(stateGamesModel);\n    stateModel.register(stateGamesModel);\n    return stateGamesModel;\n\n    function stateGamesCreate(state) {\n      appStateService\n        .addReducer('Games.local.set'       , stateGamesModel.onLocalSet)\n        .addReducer('Games.local.update'    , stateGamesModel.onLocalUpdate)\n        .addReducer('Games.local.create'    , stateGamesModel.onLocalCreate)\n        .addReducer('Games.local.loadFile'  , stateGamesModel.onLocalLoadFile)\n        .addReducer('Games.local.loadNew'   , stateGamesModel.onLocalLoadNew)\n        .addReducer('Games.local.load'      , stateGamesModel.onLocalLoad)\n        .addReducer('Games.local.delete'    , stateGamesModel.onLocalDelete)\n        .addReducer('Games.online.create'   , stateGamesModel.onOnlineCreate)\n        .addReducer('Games.online.load'     , stateGamesModel.onOnlineLoad)\n        .addReducer('Games.online.loadFile' , stateGamesModel.onOnlineLoadFile);\n\n      appStateService\n        .onChange('AppState.change',\n                  'Games.local.change',\n                  R.view(LOCAL_GAMES_LENS));\n\n      const local_games_ready = R.threadP()(\n        gamesModel.loadLocalGamesP,\n        (games) => appStateService.reduce('Games.local.set', games)\n      );\n\n      return R.thread(state)(\n        R.set(LOCAL_GAMES_LENS, []),\n        R.assoc('local_games_ready', local_games_ready)\n      );\n    }\n    function stateGamesOnLocalSet(state, _event_, [games]) {\n      return R.set(LOCAL_GAMES_LENS, games, state);\n    }\n    function stateGamesOnLocalUpdate(state, _event_, [game]) {\n      return R.over(\n        LOCAL_GAMES_LENS,\n        gamesModel.updateLocalGame$(game),\n        state\n      );\n    }\n    function stateGamesOnLocalCreate(state, _event_) {\n      return R.thread(state.user.state)(\n        gameModel.create,\n        (game) => stateGamesModel\n          .onLocalLoadNew(state, _event_, [game])\n      );\n    }\n    function stateGamesOnLocalLoadFile(_state_, _event_, [file]) {\n      return R.threadP(file)(\n        fileImportService.readP$('json'),\n        (data) => appStateService\n          .reduce('Games.local.loadNew', data)\n      );\n    }\n    function stateGamesOnLocalLoadNew(state, _event_, [game]) {\n      return R.thread(state)(\n        R.over(LOCAL_GAMES_LENS, gamesModel.newLocalGame$(game)),\n        R.tap((state) => R.thread(state)(\n          R.view(LOCAL_GAMES_LENS),\n          R.last,\n          R.prop('local_stamp'),\n          (id) => stateGamesModel.onLocalLoad(state, _event_, [id])\n        ))\n      );\n    }\n    function stateGamesOnLocalLoad(_state_, _event_, [index]) {\n      appStateService.emit('Games.local.load', index);\n    }\n    function stateGamesOnLocalDelete(state, _event_, [id]) {\n      return R.over(\n        LOCAL_GAMES_LENS,\n        gamesModel.removeLocalGame$(id),\n        state\n      );\n    }\n    function stateGamesOnOnlineCreate(state) {\n      return R.thread(state)(\n        R.pathOr({}, ['user','state']),\n        gameModel.create,\n        stateGamesModel.loadNewOnlineGameP\n      );\n    }\n    function stateGamesOnOnlineLoadFile(_state_, _event_, [file]) {\n      return R.threadP(file)(\n        fileImportService.readP$('json'),\n        stateGamesModel.loadNewOnlineGameP\n      ).catch(R.spyAndDiscardError('Failed to open online game file'));\n    }\n    function loadNewOnlineGameP(game) {\n      return R.threadP(game)(\n        gamesModel.newOnlineGameP,\n        R.prop('private_stamp'),\n        (id) => appStateService\n          .emit('Games.online.load', 'private', id)\n      );\n    }\n    function stateGamesOnOnlineLoad(_state_, _event_, [id]) {\n      appStateService\n        .emit('Games.online.load', 'public', id);\n    }\n  }\n})();\n"]}