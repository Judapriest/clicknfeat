{"version":3,"sources":["games.es6"],"names":[],"mappings":"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","file":"games.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('stateGames', stateGamesModelFactory);\n\n  stateGamesModelFactory.$inject = [\n    'game',\n    'games',\n    'fileImport',\n  ];\n  function stateGamesModelFactory(gameModel,\n                                  gamesModel,\n                                  fileImportService) {\n    const stateGamesModel = {\n      create: stateGamesCreate,\n      save: stateGamesSave,\n      onStateInit: stateGamesOnInit,\n      onGamesLocalCreate: stateGamesOnLocalCreate,\n      onGamesLocalLoad: stateGamesOnLocalLoad,\n      onGamesLocalLoadFile: stateGamesOnLocalLoadFile,\n      onGamesLocalDelete: stateGamesOnLocalDelete,\n      loadNewLocalGame: loadNewLocalGame,\n      onGamesOnlineCreate: stateGamesOnOnlineCreate,\n      onGamesOnlineLoad: stateGamesOnOnlineLoad,\n      onGamesOnlineLoadFile: stateGamesOnOnlineLoadFile,\n      loadNewOnlineGame: loadNewOnlineGame\n    };\n    const setLocalGames$ = R.curry(setLocalGames);\n\n    R.curryService(stateGamesModel);\n    return stateGamesModel;\n\n    function stateGamesCreate(state) {\n      state.local_games = {};\n      state.games_ready = new self.Promise((resolve) => {\n        state.onEvent('State.init',\n                      stateGamesModel.onStateInit$(state, resolve));\n      });\n\n      state.onEvent('Games.local.create',\n                    stateGamesModel.onGamesLocalCreate$(state));\n      state.onEvent('Games.local.load',\n                    stateGamesModel.onGamesLocalLoad$(state));\n      state.onEvent('Games.local.loadFile',\n                    stateGamesModel.onGamesLocalLoadFile$(state));\n      state.onEvent('Games.local.delete',\n                    stateGamesModel.onGamesLocalDelete$(state));\n      state.onEvent('Games.online.create',\n                    stateGamesModel.onGamesOnlineCreate$(state));\n      state.onEvent('Games.online.load',\n                    stateGamesModel.onGamesOnlineLoad$(state));\n      state.onEvent('Games.online.loadFile',\n                    stateGamesModel.onGamesOnlineLoadFile$(state));\n\n      return state;\n    }\n    function stateGamesSave(state) {\n      return state;\n    }\n    function stateGamesOnInit(state, ready, _event_) {\n      return R.threadP()(\n        gamesModel.loadLocalGamesP,\n        setLocalGames$(state),\n        ready\n      );\n    }\n    function stateGamesOnLocalCreate(state, _event_) {\n      return R.thread(state.user.state)(\n        gameModel.create,\n        stateGamesModel.loadNewLocalGame$(state)\n      );\n    }\n    function stateGamesOnLocalLoad(state, _event_, index) {\n      state.queueChangeEventP('Games.local.load', index);\n    }\n    function stateGamesOnLocalLoadFile(state, _event_, file) {\n      return R.threadP(file)(\n        fileImportService.readP$('json'),\n        stateGamesModel.loadNewLocalGame$(state)\n      );\n    }\n    function stateGamesOnLocalDelete(state, _event_, id) {\n      return R.thread(state.local_games)(\n        gamesModel.removeLocalGame$(id),\n        setLocalGames$(state)\n      );\n    }\n    function setLocalGames(state, games) {\n      state.local_games = games;\n      console.log('stateSetLocalGames', state.local_games);\n      state.queueChangeEventP('Games.local.change');\n    }\n    function loadNewLocalGame(state, game) {\n      return R.thread(state.local_games)(\n        gamesModel.newLocalGame$(game),\n        setLocalGames$(state),\n        () => {\n          state.queueChangeEventP(\n            'Games.local.load',\n            R.prop('local_stamp', R.last(state.local_games))\n          );\n        }\n      );\n    }\n    function stateGamesOnOnlineCreate(state, _event_) {\n      return R.thread(state)(\n        R.pathOr({}, ['user','state']),\n        gameModel.create,\n        stateGamesModel.loadNewOnlineGame$(state)\n      );\n    }\n    function stateGamesOnOnlineLoad(state, _event_, id) {\n      state.queueChangeEventP('Games.online.load', 'public', id);\n    }\n    function stateGamesOnOnlineLoadFile(state, _event_, file) {\n      return R.threadP(file)(\n        fileImportService.readP$('json'),\n        stateGamesModel.loadNewOnlineGame$(state)\n      ).catch(R.spyAndDiscardError('Failed to open online game file'));\n    }\n    function loadNewOnlineGame(state, game) {\n      return R.threadP(game)(\n        gamesModel.newOnlineGameP,\n        R.prop('private_stamp'),\n        (stamp) => {\n          state.queueChangeEventP('Games.online.load', 'private', stamp);\n        }\n      );\n    }\n  }\n})();\n"]}