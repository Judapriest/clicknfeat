{"version":3,"sources":["modes.es6"],"names":[],"mappings":";;;;;;AAAA,CAAC,YAAW;AACV,UAAQ,MAAR,CAAe,mBAAf,EACG,OADH,CACW,YADX,EACyB,sBADzB,EADU;;AAIV,yBAAuB,OAAvB,GAAiC,CAC/B,OAD+B,EAE/B,UAF+B,EAG/B,OAH+B,EAI/B,UAJ+B,CAAjC,CAJU;AAUV,WAAS,sBAAT,CAAgC,UAAhC,EACgC,eADhC,EAEgC,UAFhC,EAE4C;AAC1C,QAAM,aAAa,EAAE,QAAF,CAAW,OAAX,CAAb,CADoC;AAE1C,QAAM,kBAAkB;AACtB,cAAQ,gBAAR;AACA,uBAAiB,oBAAjB;AACA,4BAAsB,yBAAtB;AACA,oBAAc,iBAAd;AACA,mBAAa,gBAAb;KALI,CAFoC;AAS1C,MAAE,YAAF,CAAe,eAAf,EAT0C;AAU1C,eAAW,QAAX,CAAoB,eAApB,EAV0C;AAW1C,WAAO,eAAP,CAX0C;;AAa1C,aAAS,gBAAT,CAA0B,KAA1B,EAAiC;AAC/B,sBACG,UADH,CACc,gBADd,EACuC,gBAAgB,eAAhB,CADvC,CAEG,UAFH,CAEc,sBAFd,EAEuC,gBAAgB,oBAAhB,CAFvC,CAGG,UAHH,CAGc,aAHd,EAGuC,gBAAgB,YAAhB,CAHvC,CAIG,UAJH,CAIc,YAJd,EAIuC,gBAAgB,WAAhB,CAJvC,CAD+B;;AAO/B,sBACG,QADH,CACY,iBADZ,EAEY,cAFZ,EAGY,EAAE,MAAF,CAAS,EAAT,EAAa,CAAC,OAAD,EAAS,SAAT,CAAb,CAHZ,EAP+B;;AAY/B,aAAO,EAAE,MAAF,CAAS,KAAT,EACL,EAAE,KAAF,CAAQ,OAAR,EAAiB,EAAjB,CADK,CAAP,CAZ+B;KAAjC;AAgBA,aAAS,oBAAT,CAA8B,KAA9B,EAAqC,OAArC,QAAoD;;;UAAL,cAAK;;AAClD,aAAO,EAAE,IAAF,CACL,UADK,EAEL,WAAW,aAAX,CAAyB,EAAzB,CAFK,EAGL,KAHK,CAAP,CADkD;KAApD;AAOA,aAAS,yBAAT,CAAmC,KAAnC,EAA0C,OAA1C,SAAmE;;;UAAf,kBAAe;UAAP,gBAAO;;AACjE,UAAM,QAAQ,EAAE,IAAF,CAAO,IAAP,CAAR,CAD2D;AAEjE,UAAG,EAAE,MAAF,CAAS,EAAE,IAAF,CAAO,gBAAP,EAAyB,KAAzB,CAAT,CAAH,EAA8C;AAC5C,cAAM,cAAN,GAD4C;OAA9C;;AAIA,aAAO,EAAE,MAAF,CAAS,MAAM,KAAN,CAAT,CACL,WAAW,mBAAX,CAA+B,MAA/B,GAAwC,iCAAU,MAAlD,CADK,EAEL,EAAE,IAAF,CACE,UAAC,GAAD;eAAU,cAAc,EAAE,IAAF,CAAO,GAAP,CAAd;OAAV,EACA,UAAC,GAAD;eAAS,EAAE,QAAF,CAAW,GAAX,EACN,KADM,CACA,UAAC,KAAD;iBAAW,gBAAgB,IAAhB,CAAqB,YAArB,EAAmC,KAAnC;SAAX;OADT,CAJG,CAAP,CANiE;KAAnE;AAeA,aAAS,iBAAT,CAA2B,KAA3B,EAAkC;AAChC,aAAO,EAAE,GAAF,CAAM,UAAN,EAAkB,WAAW,IAAX,EAAlB,EAAqC,KAArC,CAAP,CADgC;KAAlC;AAGA,aAAS,gBAAT,CAA0B,KAA1B,EAAiC,OAAjC,EAA0C;AACxC,aAAO,EAAE,IAAF,CACL,UADK,EAEL,WAAW,IAAX,EACA,KAHK,CAAP,CADwC;KAA1C;GAxDF;CAVD,CAAD","file":"modes.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('stateModes', stateModesModelFactory);\n\n  stateModesModelFactory.$inject = [\n    'modes',\n    'appState',\n    'state',\n    'allModes',\n  ];\n  function stateModesModelFactory(modesModel,\n                                  appStateService,\n                                  stateModel) {\n    const MODES_LENS = R.lensProp('modes');\n    const stateModesModel = {\n      create: stateModesCreate,\n      onModesSwitchTo: stateModesOnSwitchTo,\n      onModesCurrentAction: stateModesOnCurrentAction,\n      onModesReset: stateModesOnReset,\n      onModesExit: stateModesOnExit\n    };\n    R.curryService(stateModesModel);\n    stateModel.register(stateModesModel);\n    return stateModesModel;\n\n    function stateModesCreate(state) {\n      appStateService\n        .addReducer('Modes.switchTo'       , stateModesModel.onModesSwitchTo)\n        .addReducer('Modes.current.action' , stateModesModel.onModesCurrentAction)\n        .addReducer('Modes.reset'          , stateModesModel.onModesReset)\n        .addReducer('Modes.exit'           , stateModesModel.onModesExit);\n\n      appStateService\n        .onChange('AppState.change',\n                  'Modes.change',\n                  R.pathOr({}, ['modes','current']));\n\n      return R.thread(state)(\n        R.assoc('modes', {})\n      );\n    }\n    function stateModesOnSwitchTo(state, _event_, [to]) {\n      return R.over(\n        MODES_LENS,\n        modesModel.switchToMode$(to),\n        state\n      );\n    }\n    function stateModesOnCurrentAction(state, _event_, [action, args]) {\n      const event = R.last(args);\n      if(R.exists(R.prop('preventDefault', event))) {\n        event.preventDefault();\n      }\n\n      return R.thread(state.modes)(\n        modesModel.currentModeActionP$(action, [state, ...args]),\n        R.when(\n          (res) => ('Promise' === R.type(res)),\n          (res) => R.resolveP(res)\n            .catch((error) => appStateService.emit('Game.error', error))\n        )\n      );\n    }\n    function stateModesOnReset(state) {\n      return R.set(MODES_LENS, modesModel.init(), state);\n    }\n    function stateModesOnExit(state, _event_) {\n      return R.over(\n        MODES_LENS,\n        modesModel.exit,\n        state\n      );\n    }\n  }\n})();\n"]}