{"version":3,"sources":["user.es6"],"names":[],"mappings":";;AAAA,QAAQ,MAAR,CAAe,mBAAf,EACG,OADH,CACW,WADX,EACwB,CACpB,MADoB,EAEpB,gBAFoB,EAGpB,QAHoB,EAIpB,SAAS,uBAAT,CAAiC,WAAjC,EACiC,qBADjC,EAEiC,aAFjC,EAEgD;AAC9C,MAAI,mBAAmB;AACrB,UAAM,SAAS,aAAT,CAAuB,KAAvB,EAA8B;AAClC,YAAM,IAAN,GAAa,EAAb,CADkC;AAElC,YAAM,UAAN,GAAmB,EAAE,KAAF,CACjB,YAAY,IAAZ,EACA,SAAS,KAAT,CAFiB,EAGjB,KAHiB,CAAnB,CAFkC;;AAOlC,YAAM,OAAN,CAAc,UAAd,EACc,iBAAiB,UAAjB,CAA4B,KAA5B,CADd,EAPkC;AASlC,YAAM,OAAN,CAAc,mBAAd,EACc,iBAAiB,mBAAjB,CAAqC,KAArC,CADd,EATkC;AAWlC,YAAM,OAAN,CAAc,kBAAd,EACc,iBAAiB,kBAAjB,CAAoC,KAApC,CADd,EAXkC;AAalC,YAAM,OAAN,CAAc,uBAAd,EACc,iBAAiB,sBAAjB,CAAwC,KAAxC,CADd,EAbkC;AAelC,YAAM,OAAN,CAAc,qBAAd,EACc,iBAAiB,qBAAjB,CAAuC,KAAvC,CADd,EAfkC;AAiBlC,YAAM,OAAN,CAAc,qBAAd,EACc,iBAAiB,qBAAjB,CAAuC,KAAvC,CADd,EAjBkC;AAmBlC,YAAM,OAAN,CAAc,iBAAd,EACc,iBAAiB,iBAAjB,CAAmC,KAAnC,CADd,EAnBkC;;AAsBlC,aAAO,KAAP,CAtBkC;KAA9B;AAwBN,UAAM,SAAS,aAAT,CAAuB,KAAvB,EAA8B;AAClC,aAAO,gBAAgB,KAAhB,CAAP,CADkC;KAA9B;AAGN,eAAW,SAAS,cAAT,CAAwB,KAAxB,EAA+B,KAA/B,EAAsC,UAAtC,EAAkD;AAC3D,aAAO,EAAE,WAAF,CACL,EAAE,KAAF,CAAQ,OAAR,EAAiB,UAAjB,CADK,EAEL,YAAY,YAAZ,CAAyB,KAAzB,CAFK,EAGL,SAAS,KAAT,CAHK,EAIL,MAAM,IAAN,CAJF,CAD2D;KAAlD;AAOX,wBAAoB,SAAS,uBAAT,CAAiC,KAAjC,EAAwC,KAAxC,EAA+C;AACjE,cAAQ,KAAR,CADiE;AAEjE,aAAO,EAAE,WAAF,CACL,YAAY,aAAZ,CAA0B,KAA1B,CADK,EAEL,SAAS,KAAT,CAFK,EAGL,MAAM,IAAN,CAHF,CAFiE;KAA/C;AAOpB,uBAAmB,SAAS,sBAAT,CAAgC,KAAhC,EAAuC,KAAvC,EAA8C,IAA9C,EAAoD;AACrE,aAAO,sBACJ,SADI,CACM,IADN,EACY,MAAM,IAAN,CADnB,CADqE;KAApD;AAInB,2BAAuB,SAAS,0BAAT,CAAoC,KAApC,EAA2C,KAA3C,EAAkD;AACvE,cAAQ,KAAR,CADuE;AAEvE,aAAO,EAAE,WAAF,CACL,YAAY,MAAZ,EACA,UAAC,MAAD,EAAY;AACV,YAAG,CAAC,MAAD,EAAS;AACV,iBAAO,KAAK,OAAL,CACJ,MADI,CACG,uCADH,CAAP,CADU;SAAZ;;AAKA,eAAO,cACJ,MADI,CACG,OADH,EACW,yBADX,EAEJ,KAFI,CAEE,EAAE,MAAF,CAAS,IAAT,CAFF,CAAP,CANU;OAAZ,EAUA,EAAE,MAAF,CAAS,MAAM,IAAN,CAZJ,EAaL,YAAY,aAAZ,CAA0B,KAA1B,CAbK,EAcL,SAAS,KAAT,CAdK,EAeL,MAAM,IAAN,CAfF,CAFuE;KAAlD;AAmBvB,0BAAsB,SAAS,yBAAT,CAAmC,KAAnC,EAA0C,KAA1C,EAAiD,KAAjD,EAAwD;AAC5E,aAAO,EAAE,WAAF,CACL,EAAE,SAAF,CAAY,CAAC,YAAD,EAAc,OAAd,CAAZ,EAAoC,KAApC,CADK,EAEL,SAAS,KAAT,CAFK,EAGL,MAAM,IAAN,CAHF,CAD4E;KAAxD;AAMtB,0BAAsB,SAAS,yBAAT,CAAmC,KAAnC,EAA0C,KAA1C,EAAiD,KAAjD,EAAwD;AAC5E,aAAO,EAAE,WAAF,CACL,EAAE,SAAF,CAAY,CAAC,YAAD,EAAc,OAAd,CAAZ,EAAoC,KAApC,CADK,EAEL,SAAS,KAAT,CAFK,EAGL,MAAM,IAAN,CAHF,CAD4E;KAAxD;AAMtB,sBAAkB,SAAS,qBAAT,CAA+B,KAA/B,EAAsC,KAAtC,EAA6C,GAA7C,EAAkD;AAClE,YAAM,WAAN,CAAkB,WAAlB,EAA+B,GAA/B,EADkE;AAElE,aAAO,EAAE,WAAF,CACL,EAAE,SAAF,CAAY,CAAC,YAAD,EAAc,MAAd,CAAZ,EAAmC,EAAE,IAAF,CACjC,EAAE,MAAF,CAAS,EAAT,EAAa,CAAC,YAAD,EAAc,MAAd,CAAb,CADiC,EAEjC,EAAE,MAAF,CAAS,GAAT,CAFiC,EAGjC,MAAM,IAAN,CAHF,CADK,EAKL,SAAS,KAAT,CALK,EAML,MAAM,IAAN,CANF,CAFkE;KAAlD;GA7EhB,CAD0C;AAyF9C,MAAI,WAAW,EAAE,KAAF,CAAQ,UAAC,KAAD,EAAQ,IAAR,EAAiB;AACtC,UAAM,IAAN,GAAa,IAAb,CADsC;AAEtC,YAAQ,GAAR,CAAY,cAAZ,EAA4B,MAAM,IAAN,CAA5B,CAFsC;AAGtC,UAAM,WAAN,CAAkB,aAAlB,EAHsC;GAAjB,CAAnB,CAzF0C;AA8F9C,WAAS,eAAT,CAAyB,KAAzB,EAAgC;AAC9B,QAAG,MAAM,KAAN,KAAgB,MAAM,IAAN,EAAY,OAAO,IAAP,CAA/B;AACA,UAAM,KAAN,GAAc,MAAM,IAAN,CAFgB;AAG9B,WAAO,YAAY,IAAZ,CAAiB,MAAM,IAAN,CAAxB,CAH8B;GAAhC;AAKA,IAAE,YAAF,CAAe,gBAAf,EAnG8C;AAoG9C,SAAO,gBAAP,CApG8C;CAFhD,CALJ","file":"user.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('stateUser', [\n    'user',\n    'userConnection',\n    'prompt',\n    function stateUserServiceFactory(userService,\n                                     userConnectionService,\n                                     promptService) {\n      var stateUserService = {\n        init: function stateUserInit(state) {\n          state.user = {};\n          state.user_ready = R.pipeP(\n            userService.init,\n            setUser$(state)\n          )(state);\n\n          state.onEvent('User.set',\n                        stateUserService.onUserSet$(state));\n          state.onEvent('User.toggleOnline',\n                        stateUserService.onUserToggleOnline$(state));\n          state.onEvent('User.sendChatMsg',\n                        stateUserService.onUserSendChatMsg$(state));\n          state.onEvent('User.connection.close',\n                        stateUserService.onUserConnectionClose$(state));\n          state.onEvent('User.setOnlineUsers',\n                        stateUserService.onUserSetOnlineUsers$(state));\n          state.onEvent('User.setOnlineGames',\n                        stateUserService.onUserSetOnlineGames$(state));\n          state.onEvent('User.newChatMsg',\n                        stateUserService.onUserNewChatMsg$(state));\n\n          return state;\n        },\n        save: function stateUserSave(state) {\n          return saveCurrentUser(state);\n        },\n        onUserSet: function stateOnUserSet(state, event, user_state) {\n          return R.pipePromise(\n            R.assoc('state', user_state),\n            userService.checkOnline$(state),\n            setUser$(state)\n          )(state.user);\n        },\n        onUserToggleOnline: function stateOnUserToggleOnline(state, event) {\n          event = event;\n          return R.pipePromise(\n            userService.toggleOnline$(state),\n            setUser$(state)\n          )(state.user);\n        },\n        onUserSendChatMsg: function stateOnUserSendChatMsg(state, event, chat) {\n          return userConnectionService\n            .sendChat$(chat, state.user);\n        },\n        onUserConnectionClose: function stateOnUserConnectionClose(state, event) {\n          event = event;\n          return R.pipePromise(\n            userService.online,\n            (online) => {\n              if(!online) {\n                return self.Promise\n                  .reject('User not online when connection close');\n              }\n\n              return promptService\n                .prompt('alert','Server connection lost.')\n                .catch(R.always(null));\n            },\n            R.always(state.user),\n            userService.toggleOnline$(state),\n            setUser$(state)\n          )(state.user);\n        },\n        onUserSetOnlineUsers: function stateOnUserSetOnlineUsers(state, event, users) {\n          return R.pipePromise(\n            R.assocPath(['connection','users'], users),\n            setUser$(state)\n          )(state.user);\n        },\n        onUserSetOnlineGames: function stateOnUserSetOnlineGames(state, event, games) {\n          return R.pipePromise(\n            R.assocPath(['connection','games'], games),\n            setUser$(state)\n          )(state.user);\n        },\n        onUserNewChatMsg: function stateOnUserNewChatMsg(state, event, msg) {\n          state.changeEvent('User.chat', msg);\n          return R.pipePromise(\n            R.assocPath(['connection','chat'], R.pipe(\n              R.pathOr([], ['connection','chat']),\n              R.append(msg)\n            )(state.user)),\n            setUser$(state)\n          )(state.user);\n        }\n      };\n      var setUser$ = R.curry((state, user) => {\n        state.user = user;\n        console.log('stateSetUser', state.user);\n        state.changeEvent('User.change');\n      });\n      function saveCurrentUser(state) {\n        if(state._user === state.user) return null;\n        state._user = state.user;\n        return userService.save(state.user);\n      }\n      R.curryService(stateUserService);\n      return stateUserService;\n    }\n  ]);\n"]}