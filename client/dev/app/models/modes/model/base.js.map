{"version":3,"sources":["base.es6"],"names":[],"mappings":"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","file":"base.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('modelBaseMode', modelBaseModeModelFactory);\n\n  modelBaseModeModelFactory.$inject = [\n    'settings',\n    'modelsMode',\n    'sprayTemplateMode',\n    'model',\n    'gameModels',\n    'gameModelSelection',\n  ];\n  function modelBaseModeModelFactory(settingsModel,\n                                     modelsModeModel,\n                                     sprayTemplateModeModel,\n                                     modelModel,\n                                     gameModelsModel,\n                                     gameModelSelectionModel) {\n    const model_actions = Object.create(modelsModeModel.actions);\n    model_actions.createAoEOnModel = modelCreateAoEOnModel;\n    model_actions.createSprayOnModel = modelCreateSprayOnModel;\n    model_actions.selectAllFriendly = modelSelectAllFriendly;\n    model_actions.selectAllUnit = modelSelectAllUnit;\n    model_actions.setB2B = modelSetB2B;\n    model_actions.openEditLabel = modelOpenEditLabel;\n    model_actions.openEditDamage = modelOpenEditDamage;\n\n    const model_default_bindings = {\n      'createAoEOnModel': 'ctrl+a',\n      'createSprayOnModel': 'ctrl+s',\n      'selectAllUnit': 'ctrl+u',\n      'selectAllFriendly': 'ctrl+f',\n      'setB2B': 'ctrl+shift+clickModel',\n      'openEditLabel': 'shift+l',\n      'openEditDamage': 'shift+d'\n    };\n    const model_bindings = R.extend(Object.create(modelsModeModel.bindings),\n                                    model_default_bindings);\n\n    const model_mode = {\n      onEnter: () => { },\n      onLeave: () => { },\n      name: 'ModelBase',\n      actions: model_actions,\n      buttons: [],\n      bindings: model_bindings\n    };\n    settingsModel.register('Bindings',\n                             model_mode.name,\n                             model_default_bindings,\n                             (bs) => {\n                               R.extend(model_mode.bindings, bs);\n                             });\n    return model_mode;\n\n    function modelCreateAoEOnModel(state) {\n      const stamps = gameModelSelectionModel\n              .get('local', state.game.model_selection);\n      return R.threadP(state.game)(\n        R.prop('models'),\n        gameModelsModel.findStampP$(stamps[0]),\n        (model) => R.pick(['x','y'], model.state),\n        R.assoc('type', 'aoe'),\n        (position) => ({\n          base: { x: 0, y: 0, r: 0 },\n          templates: [ R.assoc('r', 0, position) ]\n        }),\n        (create) => {\n          const is_flipped = R.path(['ui_state','flip_map'], state);\n          return state.eventP('Game.command.execute',\n                              'createTemplate',\n                              [create, is_flipped]);\n        }\n      );\n    }\n    function modelCreateSprayOnModel(state) {\n      const stamps = gameModelSelectionModel\n              .get('local', state.game.model_selection);\n      return R.threadP(state.game)(\n        R.prop('models'),\n        gameModelsModel.findStampP$(stamps[0]),\n        (model) => R.threadP(model)(\n          R.prop('state'),\n          R.pick(['x','y']),\n          R.assoc('type', 'spray'),\n          (position) => ({\n            base: { x: 0, y: 0, r: 0 },\n            templates: [ R.assoc('r', 0 , position) ]\n          }),\n          (create) => {\n            const is_flipped = R.path(['ui_state','flip_map'], state);\n            return R.threadP()(\n              () => state.eventP('Game.command.execute',\n                                 'createTemplate',\n                                 [create, is_flipped]),\n              // simulate set-origin-model in sprayTemplateMode\n              () => sprayTemplateModeModel.actions\n                .setOriginModel(state, { 'click#': { target: model } })\n            );\n          }\n        )\n      );\n    }\n    function modelSelectAllFriendly(state) {\n      const selection = gameModelSelectionModel\n              .get('local', state.game.model_selection);\n      return R.threadP(state.game)(\n        R.prop('models'),\n        gameModelsModel.findStampP$(selection[0]),\n        modelModel.user,\n        (user) => R.thread(state.game)(\n          R.prop('models'),\n          gameModelsModel.all,\n          R.filter(modelModel.userIs$(user)),\n          R.map(modelModel.stamp)\n        ),\n        (stamps) => state.eventP('Game.command.execute',\n                                 'setModelSelection',\n                                 ['set', stamps])\n      );\n    }\n    function modelSelectAllUnit(state) {\n      const selection = gameModelSelectionModel\n              .get('local', state.game.model_selection);\n      return R.threadP(state.game)(\n        R.prop('models'),\n        gameModelsModel.findStampP$(selection[0]),\n        (model) => R.threadP(model)(\n          modelModel.unit,\n          R.rejectIfP(R.isNil,\n                     'Model not in unit'),\n          (unit) => R.thread(state.game)(\n            R.prop('models'),\n            gameModelsModel.all,\n            R.filter(modelModel.userIs$(modelModel.user(model))),\n            R.filter(modelModel.unitIs$(unit)),\n            R.map(modelModel.stamp)\n          )\n        ),\n        (stamps) => state.eventP('Game.command.execute',\n                                 'setModelSelection',\n                                 ['set', stamps])\n      );\n    }\n    function modelSetB2B(state, event) {\n      const stamps = gameModelSelectionModel\n              .get('local', state.game.model_selection);\n      return R.threadP(state.game)(\n        R.prop('models'),\n        gameModelsModel.findStampP$(stamps[0]),\n        (model) => {\n          if(model.state.stamp === event['click#'].target.state.stamp) return null;\n\n          return state.eventP('Game.command.execute',\n                              'onModels', [\n                                'setB2BP',\n                                [state.factions, event['click#'].target],\n                                stamps\n                              ]);\n        }\n      );\n    }\n    function modelOpenEditLabel(state) {\n      const stamps = gameModelSelectionModel\n              .get('local', state.game.model_selection);\n      return R.threadP(state.game)(\n        R.prop('models'),\n        gameModelsModel.findStampP$(stamps[0]),\n        (model) => {\n          state.queueChangeEventP('Game.editLabel.open', 'onModels', model);\n        }\n      );\n    }\n    function modelOpenEditDamage(state) {\n      const stamps = gameModelSelectionModel\n              .get('local', state.game.model_selection);\n      return R.threadP(state.game)(\n        R.prop('models'),\n        gameModelsModel.findStampP$(stamps[0]),\n        (model) => {\n          state.queueChangeEventP('Game.editDamage.toggle', model);\n        }\n      );\n    }\n  }\n})();\n"]}