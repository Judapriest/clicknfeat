{"version":3,"sources":["base.es6"],"names":[],"mappings":"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","file":"base.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('modelBaseMode', modelBaseModeModelFactory);\n\n  modelBaseModeModelFactory.$inject = [\n    'appState',\n    'settings',\n    'modelsMode',\n    'model',\n    'gameModels',\n    'gameModelSelection',\n  ];\n  function modelBaseModeModelFactory(appStateService,\n                                     settingsModel,\n                                     modelsModeModel,\n                                     modelModel,\n                                     gameModelsModel,\n                                     gameModelSelectionModel) {\n    const FLIP_MAP_LENS = R.lensPath(['view','flip_map']);\n    const MODELS_LENS = R.lensPath(['game', 'models']);\n    const model_actions = Object.create(modelsModeModel.actions);\n    model_actions.createAoEOnModel = modelCreateAoEOnModel;\n    model_actions.createSprayOnModel = modelCreateSprayOnModel;\n    model_actions.selectAllFriendly = modelSelectAllFriendly;\n    model_actions.selectAllUnit = modelSelectAllUnit;\n    model_actions.setB2B = modelSetB2B;\n    model_actions.openEditLabel = modelOpenEditLabel;\n    model_actions.openEditDamage = modelOpenEditDamage;\n\n    const model_default_bindings = {\n      'createAoEOnModel': 'ctrl+a',\n      'createSprayOnModel': 'ctrl+s',\n      'selectAllUnit': 'ctrl+u',\n      'selectAllFriendly': 'ctrl+f',\n      'setB2B': 'ctrl+shift+clickModel',\n      'openEditLabel': 'shift+l',\n      'openEditDamage': 'shift+d'\n    };\n    const model_bindings = R.extend(Object.create(modelsModeModel.bindings),\n                                    model_default_bindings);\n\n    const model_mode = {\n      onEnter: () => { },\n      onLeave: () => { },\n      name: 'ModelBase',\n      actions: model_actions,\n      buttons: [],\n      bindings: model_bindings\n    };\n    settingsModel.register('Bindings',\n                             model_mode.name,\n                             model_default_bindings,\n                             (bs) => {\n                               R.extend(model_mode.bindings, bs);\n                             });\n    return model_mode;\n\n    function modelCreateAoEOnModel(state) {\n      const stamps = gameModelSelectionModel\n              .get('local', state.game.model_selection);\n      return R.thread(state)(\n        R.view(MODELS_LENS),\n        gameModelsModel.findStamp$(stamps[0]),\n        R.unless(\n          R.isNil,\n          R.pipe(\n            (model) => R.pick(['x','y'], model.state),\n            R.assoc('type', 'aoe'),\n            (position) => ({\n              base: { x: 0, y: 0, r: 0 },\n              templates: [ R.assoc('r', 0, position) ]\n            }),\n            (create) => {\n              const is_flipped = R.viewOr(false, FLIP_MAP_LENS, state);\n              return appStateService\n                .onAction(state, [ 'Game.command.execute',\n                                   'createTemplate',\n                                   [create, is_flipped] ]);\n            }\n          )\n        )\n      );\n    }\n    function modelCreateSprayOnModel(state) {\n      const stamps = gameModelSelectionModel\n              .get('local', state.game.model_selection);\n      return R.thread(state)(\n        R.view(MODELS_LENS),\n        gameModelsModel.findStamp$(stamps[0]),\n        R.unless(\n          R.isNil,\n          R.pipe(\n            (model) => R.thread(model)(\n              modelModel.baseEdgeInDirection$(model.state.r),\n              R.assoc('o', model.state.stamp),\n              R.assoc('r', model.state.r),\n              R.assoc('type', 'spray'),\n              (position) => ({\n                base: { x: 0, y: 0, r: 0 },\n                templates: [ position ]\n              }),\n              (create) => {\n                const is_flipped = R.viewOr(false, FLIP_MAP_LENS, state);\n                return appStateService\n                  .onAction(state, [ 'Game.command.execute',\n                                     'createTemplate',\n                                     [create, is_flipped] ]);\n              }\n            )\n          )\n        )\n      );\n    }\n    function modelSelectAllFriendly(state) {\n      const selection = gameModelSelectionModel\n              .get('local', state.game.model_selection);\n      return R.thread(state)(\n        R.view(MODELS_LENS),\n        gameModelsModel.findStamp$(selection[0]),\n        R.unless(\n          R.isNil,\n          R.pipe(\n            modelModel.user,\n            (user) => R.thread(state.game)(\n              R.prop('models'),\n              gameModelsModel.all,\n              R.filter(modelModel.userIs$(user)),\n              R.map(R.path(['state','stamp']))\n            ),\n            (stamps) => appStateService\n              .onAction(state, [ 'Game.command.execute',\n                                 'setModelSelection',\n                                 ['set', stamps] ])\n          )\n        )\n      );\n    }\n    function modelSelectAllUnit(state) {\n      const selection = gameModelSelectionModel\n              .get('local', state.game.model_selection);\n      return R.thread(state)(\n        R.view(MODELS_LENS),\n        gameModelsModel.findStamp$(selection[0]),\n        R.unless(\n          R.isNil,\n          R.pipe(\n            (model) => R.thread(model)(\n              modelModel.unit,\n              R.unless(\n                R.equals(0),\n                R.pipe(\n                  (unit) => R.thread(state)(\n                    R.view(MODELS_LENS),\n                    gameModelsModel.all,\n                    R.spyError('toto'),\n                    R.filter(modelModel.userIs$(modelModel.user(model))),\n                    R.spyError('toto'),\n                    R.filter(modelModel.unitIs$(unit)),\n                    R.spyError('toto'),\n                    R.map(R.path(['state','stamp'])),\n                    R.spyError('toto')\n                  ),\n                  (stamps) => appStateService\n                    .onAction(state, [ 'Game.command.execute',\n                                       'setModelSelection',\n                                       ['set', stamps] ])\n                )\n              )\n            )\n          )\n        )\n      );\n    }\n    function modelSetB2B(state, event) {\n      const stamps = gameModelSelectionModel\n              .get('local', state.game.model_selection);\n      return R.thread(state)(\n        R.view(MODELS_LENS),\n        gameModelsModel.findStamp$(stamps[0]),\n        R.unless(\n          R.isNil,\n          (model) => {\n            if(model.state.stamp === event['click#'].target.state.stamp) return state;\n\n            return appStateService\n              .onAction(state, [ 'Game.command.execute',\n                                 'onModels', [\n                                   'setB2BP',\n                                   [event['click#'].target],\n                                   stamps\n                                 ]\n                               ]);\n          }\n        )\n      );\n    }\n    function modelOpenEditLabel(state) {\n      const stamps = gameModelSelectionModel\n              .get('local', state.game.model_selection);\n      const model = R.thread(state)(\n        R.view(MODELS_LENS),\n        gameModelsModel.findStamp$(stamps[0])\n      );\n      if(R.isNil(model)) return null;\n      return R.assocPath(['view','edit_label'], {\n        type: 'model', element: model\n      }, state);\n    }\n    function modelOpenEditDamage(state) {\n      const stamps = gameModelSelectionModel\n              .get('local', state.game.model_selection);\n      const model = R.thread(state)(\n        R.view(MODELS_LENS),\n        gameModelsModel.findStamp$(stamps[0])\n      );\n      if(R.isNil(model)) return null;\n      return R.assocPath(['view','edit_damage'], {\n        selection: model\n      }, state);\n    }\n  }\n})();\n"]}