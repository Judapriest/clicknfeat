{"version":3,"sources":["segment.es6"],"names":[],"mappings":"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","file":"segment.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('segmentMode', segmentModeModelFactory);\n\n  segmentModeModelFactory.$inject = [\n    'appAction',\n    'appGame',\n    'appState',\n    'modes',\n    'settings',\n    'commonMode',\n    'gameModels',\n    'gameModelSelection',\n  ];\n  function segmentModeModelFactory(appActionService,\n                                   appGameService,\n                                   appStateService,\n                                   modesModel,\n                                   settingsModel,\n                                   commonModeModel,\n                                   gameModelsModel,\n                                   gameModelSelectionModel) {\n    return function buildSegmentModeModel(type, gameSegmentModel, default_bindings) {\n      const TYPE_LENS = R.lensPath(['game',type]);\n      const MODELS_LENS = R.lensPath(['game','models']);\n      const segment_actions = Object.create(commonModeModel.actions);\n      segment_actions[`exit${s.capitalize(type)}Mode`] =\n        commonModeModel.actions.modeBackToDefault;\n      segment_actions.dragStartMap = segmentDragStartMap;\n      segment_actions.dragMap = segmentDragMap;\n      segment_actions.dragEndMap = segmentDragEndMap;\n      segment_actions.dragStartTemplate = segment_actions.dragStartMap;\n      segment_actions.dragTemplate = segment_actions.dragMap;\n      segment_actions.dragEndTemplate = segment_actions.dragEndMap;\n      segment_actions.dragStartModel = segment_actions.dragStartMap;\n      segment_actions.dragModel = segment_actions.dragMap;\n      segment_actions.dragEndModel = segment_actions.dragEndMap;\n\n      const segment_bindings = R.extend(Object.create(commonModeModel.bindings),\n                                        default_bindings);\n      const segment_buttons = [];\n      const segment_mode = {\n        onEnter: segmentOnEnter,\n        name: s.capitalize(type),\n        actions: segment_actions,\n        buttons: segment_buttons,\n        bindings: segment_bindings\n      };\n      modesModel.registerMode(segment_mode);\n      settingsModel.register('Bindings',\n                             segment_mode.name,\n                             default_bindings,\n                             (bs) => {\n                               R.extend(segment_mode.bindings, bs);\n                             });\n      return segment_mode;\n\n      function segmentDragStartMap(state, drag) {\n        return R.over(\n          TYPE_LENS,\n          gameSegmentModel.setLocal$(drag.start, drag.now),\n          state\n        );\n      }\n      function segmentDragMap(state, drag) {\n        return R.over(\n          TYPE_LENS,\n          gameSegmentModel.setLocal$(drag.start, drag.now),\n          state\n        );\n      }\n      function segmentDragEndMap(state, drag) {\n        return appStateService\n          .onAction(state, [\n            'Game.command.execute',\n            `set${s.capitalize(type)}`, [\n              'setRemote',\n              [drag.start, drag.now, R.view(MODELS_LENS, state)]\n            ]\n          ]);\n      }\n      function segmentOnEnter() {\n        const selection = appGameService.models\n                .selection.sample();\n        const models = appGameService.models\n                .models.sample();\n        return R.thread(selection)(\n          gameModelSelectionModel.get$('local'),\n          (stamps) => {\n            if(R.length(stamps) !== 1) return null;\n\n            return gameModelsModel\n              .findStamp(stamps[0], models);\n          },\n          (model) => {\n            if(R.isNil(model)) return;\n\n            appActionService\n              .defer('Game.command.execute',\n                     `set${s.capitalize(type)}`, [\n                       'setOriginResetTarget',\n                       [model, models]\n                     ]);\n          }\n        );\n      }\n    };\n  }\n})();\n"]}