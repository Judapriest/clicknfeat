{"version":3,"sources":["segment.es6"],"names":[],"mappings":"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","file":"segment.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('segmentMode', segmentModeModelFactory);\n\n  segmentModeModelFactory.$inject = [\n    'appState',\n    'modes',\n    'settings',\n    'commonMode',\n    'gameModels',\n    'gameModelSelection',\n  ];\n  function segmentModeModelFactory(appStateService,\n                                   modesModel,\n                                   settingsModel,\n                                   commonModeModel,\n                                   gameModelsModel,\n                                   gameModelSelectionModel) {\n    return function buildSegmentModeModel(type, gameSegmentModel, default_bindings) {\n      const TYPE_LENS = R.lensPath(['game',type]);\n      const segment_actions = Object.create(commonModeModel.actions);\n      segment_actions[`exit${s.capitalize(type)}Mode`] =\n        commonModeModel.actions.modeBackToDefault;\n      segment_actions.dragStartMap = segmentDragStartMap;\n      segment_actions.dragMap = segmentDragMap;\n      segment_actions.dragEndMap = segmentDragEndMap;\n      segment_actions.dragStartTemplate = segment_actions.dragStartMap;\n      segment_actions.dragTemplate = segment_actions.dragMap;\n      segment_actions.dragEndTemplate = segment_actions.dragEndMap;\n      segment_actions.dragStartModel = segment_actions.dragStartMap;\n      segment_actions.dragModel = segment_actions.dragMap;\n      segment_actions.dragEndModel = segment_actions.dragEndMap;\n\n      const segment_bindings = R.extend(Object.create(commonModeModel.bindings),\n                                        default_bindings);\n      const segment_buttons = [];\n      const segment_mode = {\n        onEnter: segmentOnEnter,\n        onLeave: segmentOnLeave,\n        name: s.capitalize(type),\n        actions: segment_actions,\n        buttons: segment_buttons,\n        bindings: segment_bindings\n      };\n      modesModel.registerMode(segment_mode);\n      settingsModel.register('Bindings',\n                             segment_mode.name,\n                             default_bindings,\n                             (bs) => {\n                               R.extend(segment_mode.bindings, bs);\n                             });\n      return segment_mode;\n\n      function segmentDragStartMap(state, drag) {\n        return R.over(TYPE_LENS,\n                      gameSegmentModel.setLocal$(drag.start, drag.now),\n                      state);\n      }\n      function segmentDragMap(state, drag) {\n        return R.over(TYPE_LENS,\n                      gameSegmentModel.setLocal$(drag.start, drag.now),\n                      state);\n      }\n      function segmentDragEndMap(state, drag) {\n        appStateService\n          .chainReduce('Game.command.execute',\n                       `set${s.capitalize(type)}`, [\n                         'setRemote',\n                         [drag.start, drag.now, state]\n                       ]);\n      }\n      function segmentOnEnter(state) {\n        R.thread(state)(\n          R.path(['game','model_selection']),\n          gameModelSelectionModel.get$('local'),\n          (stamps) => {\n            if(R.length(stamps) !== 1) return null;\n\n            return gameModelsModel\n              .findStamp(stamps[0], state.game.models);\n          },\n          (model) => {\n            if(R.isNil(model)) return;\n\n            appStateService\n              .chainReduce('Game.command.execute',\n                           `set${s.capitalize(type)}`, [\n                             'setOriginResetTarget',\n                             [model, state]\n                           ]);\n          }\n        );\n      }\n      function segmentOnLeave() {\n        appStateService.emit(`Game.${type}.remote.change`);\n      }\n    };\n  }\n})();\n"]}