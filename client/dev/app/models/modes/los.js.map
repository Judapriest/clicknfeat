{"version":3,"sources":["los.es6"],"names":[],"mappings":"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","file":"los.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('losMode', [\n    'modes',\n    'settings',\n    'commonMode',\n    'game',\n    'gameLos',\n    'gameModels',\n    'gameModelSelection',\n    function losModeServiceFactory(modesService,\n                                   settingsService,\n                                   commonModeService,\n                                   gameService,\n                                   gameLosService,\n                                   gameModelsService,\n                                   gameModelSelectionService) {\n      let los_actions = Object.create(commonModeService.actions);\n      los_actions.exitLosMode = commonModeService.actions.modeBackToDefault;\n      los_actions.dragStartMap = (state, drag) => {\n        return state.event('Game.update', R.lensProp('los'),\n                           gameLosService.setLocal$(drag.start, drag.now, state));\n      };\n      los_actions.dragMap = (state, drag) => {\n        return state.event('Game.update', R.lensProp('los'),\n                           gameLosService.setLocal$(drag.start, drag.now, state));\n      };\n      los_actions.dragEndMap = (state, drag) => {\n        return state.event('Game.command.execute',\n                           'setLos', ['setRemote', [drag.start, drag.now]]);\n      };\n      los_actions.dragStartTemplate = los_actions.dragStartMap;\n      los_actions.dragTemplate = los_actions.dragMap;\n      los_actions.dragEndTemplate = los_actions.dragEndMap;\n      los_actions.dragStartModel = los_actions.dragStartMap;\n      los_actions.dragModel = los_actions.dragMap;\n      los_actions.dragEndModel = los_actions.dragEndMap;\n      los_actions.setOriginModel = (state, event) => {\n        return state.event('Game.command.execute',\n                           'setLos', ['setOrigin', [event['click#'].target]]);\n      };\n      los_actions.setTargetModel = (state, event) => {\n        return state.event('Game.command.execute',\n                           'setLos', ['setTarget', [event['click#'].target]]);\n      };\n      los_actions.toggleIgnoreModel = (state, event) => {\n        return state.event('Game.command.execute',\n                           'setLos', ['toggleIgnoreModel', [event['click#'].target]]);\n      };\n      let los_default_bindings = {\n        exitLosMode: 'ctrl+l',\n        toggleIgnoreModel: 'clickModel',\n        setOriginModel: 'ctrl+clickModel',\n        setTargetModel: 'shift+clickModel'\n      };\n      let los_bindings = R.extend(Object.create(commonModeService.bindings),\n                                  los_default_bindings);\n      let los_buttons = [];\n      let los_mode = {\n        onEnter: (state) => {\n          return R.pipePromise(\n            R.path(['game','model_selection']),\n            gameModelSelectionService.get$('local'),\n            (stamps) => {\n              if(R.length(stamps) !== 1) return null;\n\n              return gameModelsService\n                .findStamp(stamps[0], state.game.models)\n                .catch(R.always(null));\n            },\n            (model) => {\n              if(R.isNil(model)) return null;\n\n              return state\n                .event('Game.command.execute',\n                       'setLos', ['setOriginResetTarget', [model]]);\n            }\n          )(state);\n        },\n        onLeave: (state) => {\n          state.changeEvent('Game.los.remote.change');\n        },\n        name: 'LoS',\n        actions: los_actions,\n        buttons: los_buttons,\n        bindings: los_bindings\n      };\n      modesService.registerMode(los_mode);\n      settingsService.register('Bindings',\n                               los_mode.name,\n                               los_default_bindings,\n                               (bs) => {\n                                 R.extend(los_mode.bindings, bs);\n                               });\n      return los_mode;\n    }\n  ]);\n"]}