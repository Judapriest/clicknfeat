{"version":3,"sources":["aoe.es6"],"names":[],"mappings":"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","file":"aoe.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('aoeTemplateMode', aoeTemplateModeModelFactory);\n\n  aoeTemplateModeModelFactory.$inject = [\n    'modes',\n    'settings',\n    'templateMode',\n    'game',\n    'gameTemplates',\n    'gameTemplateSelection',\n    // 'gameRuler',\n    'prompt',\n  ];\n  function aoeTemplateModeModelFactory(modesModel,\n                                       settingsModel,\n                                       templateModeModel,\n                                       gameModel,\n                                       gameTemplatesModel,\n                                       gameTemplateSelectionModel,\n                                       // gameRulerModel,\n                                       promptService) {\n    const template_actions = Object.create(templateModeModel.actions);\n    template_actions.aoeSize3 = aoeSize3;\n    template_actions.aoeSize4 = aoeSize4;\n    template_actions.aoeSize5 = aoeSize5;\n    template_actions.setTargetModel = setTargetModel;\n    template_actions.setMaxDeviation = setMaxDeviation;\n    template_actions.deviate = deviate;\n    // template_actions.setToRulerTarget = setToRulerTarget;\n\n    const template_default_bindings = {\n      setTargetModel: 'shift+clickModel',\n      aoeSize3: '3',\n      aoeSize4: '4',\n      aoeSize5: '5',\n      deviate: 'd',\n      setMaxDeviation: 'shift+d',\n      // setToRulerTarget: 'shift+r'\n    };\n    const template_bindings = R.extend(Object.create(templateModeModel.bindings),\n                                     template_default_bindings);\n    const template_buttons = R.concat([\n      [ 'Size'         , 'toggle'           , 'size' ],\n      [ 'Aoe3'         , 'aoeSize3'         , 'size' ],\n      [ 'Aoe4'         , 'aoeSize4'         , 'size' ],\n      [ 'Aoe5'         , 'aoeSize5'         , 'size' ],\n      [ 'Deviate'      , 'deviate'          ],\n      // [ 'Set to Ruler' , 'setToRulerTarget' ],\n    ], templateModeModel.buttons);\n\n    const template_mode = {\n      onEnter: (/*state*/) => {},\n      onLeave: (/*state*/) => {},\n      name: 'aoe'+templateModeModel.name,\n      actions: template_actions,\n      buttons: template_buttons,\n      bindings: template_bindings\n    };\n    modesModel.registerMode(template_mode);\n    settingsModel.register('Bindings',\n                             template_mode.name,\n                             template_default_bindings,\n                             (bs) => {\n                               R.extend(template_mode.bindings, bs);\n                             });\n    return template_mode;\n\n    function aoeSize3(state) {\n      const stamps = gameTemplateSelectionModel\n            .get('local', state.game.template_selection);\n      return state.eventP('Game.command.execute',\n                          'onTemplates',\n                          ['setSizeP', [3], stamps]);\n    }\n    function aoeSize4(state) {\n      const stamps = gameTemplateSelectionModel\n            .get('local', state.game.template_selection);\n      return state.eventP('Game.command.execute',\n                          'onTemplates',\n                          ['setSizeP', [4], stamps]);\n    }\n    function aoeSize5(state) {\n      const stamps = gameTemplateSelectionModel\n            .get('local', state.game.template_selection);\n      return state.eventP('Game.command.execute',\n                          'onTemplates',\n                          ['setSizeP', [5], stamps]);\n    }\n    function setTargetModel(state, event) {\n      const stamps = gameTemplateSelectionModel\n            .get('local', state.game.template_selection);\n      return state.eventP('Game.command.execute',\n                          'onTemplates',\n                          [ 'setTargetP',\n                            [state.factions, null, event['click#'].target],\n                            stamps\n                          ]);\n    }\n    function setMaxDeviation(state) {\n      const stamps = gameTemplateSelectionModel\n            .get('local', state.game.template_selection);\n      return R.threadP(state.game)(\n        R.prop('templates'),\n        gameTemplatesModel.fromStampsP$('maxDeviation', [], stamps),\n        askForMax,\n        (value) => ((value === 0) ? null : value),\n        (value) => state.eventP('Game.update', R.lensProp('templates'),\n                                gameTemplatesModel\n                                .onStampsP$('setMaxDeviation', [value], stamps))\n      );\n\n      function askForMax(maxes) {\n        const max = maxes[0];\n        return promptService\n          .promptP('prompt', 'Set AoE max deviation :', max)\n          .catch(R.spyAndDiscardError());\n      }\n    }\n    function deviate(state) {\n      const stamps = gameTemplateSelectionModel\n            .get('local', state.game.template_selection);\n      return R.threadP()(\n        () => state.eventP('Game.command.execute',\n                           'rollDeviation', []),\n        R.always(state),\n        R.path(['game','dice']),\n        R.last,\n        (deviation) => state.eventP('Game.command.execute',\n                                    'onTemplates',\n                                    [ 'deviate',\n                                      [deviation.r, deviation.d],\n                                      stamps\n                                    ])\n      );\n    }\n    // function setToRulerTarget(state) {\n    //   if(!gameRulerModel.isDisplayed(state.game.ruler)) return null;\n\n    //   const stamps = gameTemplateSelectionModel\n    //         .get('local', state.game.template_selection);\n    //   return R.threadP(state.game)(\n    //     R.prop('ruler'),\n    //     gameRulerModel.targetAoEPosition$(state.game.models),\n    //     (position) => state.eventP('Game.command.execute',\n    //                                'onTemplates',\n    //                                [ 'setToRuler',\n    //                                  [position],\n    //                                  stamps\n    //                                ])\n    //   );\n    // }\n  }\n})();\n"]}