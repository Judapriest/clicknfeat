{"version":3,"sources":["aoe.es6"],"names":[],"mappings":"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","file":"aoe.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('aoeTemplateMode', aoeTemplateModeModelFactory);\n\n  aoeTemplateModeModelFactory.$inject = [\n    'appAction',\n    'appError',\n    'appState',\n    'modes',\n    'settings',\n    'templateMode',\n    'gameTemplates',\n    'gameTemplateSelection',\n    // 'gameRuler',\n    'prompt',\n  ];\n  function aoeTemplateModeModelFactory(appActionService,\n                                       appErrorService,\n                                       appStateService,\n                                       modesModel,\n                                       settingsModel,\n                                       templateModeModel,\n                                       gameTemplatesModel,\n                                       gameTemplateSelectionModel,\n                                       // gameRulerModel,\n                                       promptService) {\n    const template_actions = Object.create(templateModeModel.actions);\n    template_actions.aoeSize3 = aoeSize3;\n    template_actions.aoeSize4 = aoeSize4;\n    template_actions.aoeSize5 = aoeSize5;\n    template_actions.setTargetModel = setTargetModel;\n    template_actions.setMaxDeviation = setMaxDeviation;\n    template_actions.deviate = deviate;\n    template_actions.setToRulerTarget = setToRulerTarget;\n\n    const template_default_bindings = {\n      setTargetModel: 'shift+clickModel',\n      aoeSize3: '3',\n      aoeSize4: '4',\n      aoeSize5: '5',\n      deviate: 'd',\n      setMaxDeviation: 'shift+d',\n      setToRulerTarget: 'shift+r'\n    };\n    const template_bindings = R.extend(Object.create(templateModeModel.bindings),\n                                       template_default_bindings);\n    const template_buttons = R.concat([\n      [ 'Size'         , 'toggle'           , 'size' ],\n      [ 'Aoe3'         , 'aoeSize3'         , 'size' ],\n      [ 'Aoe4'         , 'aoeSize4'         , 'size' ],\n      [ 'Aoe5'         , 'aoeSize5'         , 'size' ],\n      [ 'Deviate'      , 'deviate'          ],\n      [ 'Set Max Dev.' , 'setMaxDeviation'  ],\n      [ 'Set to Ruler' , 'setToRulerTarget' ],\n    ], templateModeModel.buttons);\n\n    const template_mode = {\n      onEnter: () => {},\n      onLeave: () => {},\n      name: 'aoe'+templateModeModel.name,\n      actions: template_actions,\n      buttons: template_buttons,\n      bindings: template_bindings\n    };\n    modesModel.registerMode(template_mode);\n    settingsModel.register('Bindings',\n                           template_mode.name,\n                           template_default_bindings,\n                           (bs) => {\n                             R.extend(template_mode.bindings, bs);\n                           });\n    return template_mode;\n\n    function aoeSize3(state) {\n      const stamps = gameTemplateSelectionModel\n            .get('local', state.game.template_selection);\n      return appStateService\n        .onAction(state, [ 'Game.command.execute',\n                           'onTemplates',\n                           ['setSizeP', [3], stamps] ]);\n    }\n    function aoeSize4(state) {\n      const stamps = gameTemplateSelectionModel\n            .get('local', state.game.template_selection);\n      return appStateService\n        .onAction(state, [ 'Game.command.execute',\n                           'onTemplates',\n                           ['setSizeP', [4], stamps] ]);\n    }\n    function aoeSize5(state) {\n      const stamps = gameTemplateSelectionModel\n            .get('local', state.game.template_selection);\n      return appStateService\n        .onAction(state, [ 'Game.command.execute',\n                           'onTemplates',\n                           ['setSizeP', [5], stamps] ]);\n    }\n    function setTargetModel(state, event) {\n      const stamps = gameTemplateSelectionModel\n            .get('local', state.game.template_selection);\n      return appStateService\n        .onAction(state, [ 'Game.command.execute',\n                           'onTemplates',\n                           [ 'setTargetP',\n                             [event['click#'].target],\n                             stamps\n                           ] ]);\n    }\n    function setMaxDeviation(state) {\n      const stamps = gameTemplateSelectionModel\n            .get('local', state.game.template_selection);\n      return R.threadP(state.game)(\n        R.prop('templates'),\n        gameTemplatesModel.fromStampsP$('maxDeviation', [], stamps),\n        askForMaxP,\n        (value) => ((value === 0) ? null : value),\n        R.defaultTo(null),\n        (max) => appActionService\n          .do('Game.templates.setDeviationMax', stamps, max)\n      );\n\n      function askForMaxP(maxes) {\n        const max = maxes[0];\n        return promptService\n          .promptP('prompt', 'Set AoE max deviation :', max)\n          .catch(() => null);\n      }\n    }\n    function deviate(state) {\n      const stamps = gameTemplateSelectionModel\n            .get('local', state.game.template_selection);\n      return appStateService\n        .onAction(state, [ 'Game.command.execute',\n                           'rollDeviation', [stamps] ]);\n    }\n    function setToRulerTarget(_state_) {\n      // if(!gameRulerModel.isDisplayed(state.game.ruler)) return;\n\n      // const stamps = gameTemplateSelectionModel\n      //       .get('local', state.game.template_selection);\n      // R.thread(state.game)(\n      //   R.prop('ruler'),\n      //   gameRulerModel.targetAoEPosition$(state.game.models),\n      //   (position) => {\n      // return appStateService.onAction(state, [ 'Game.command.execute',\n      //                    'onTemplates',\n      //                    [ 'setToRulerP',\n      //                      [position],\n      //                      stamps\n      //                    ]);\n      //   }\n      // );\n    }\n  }\n})();\n"]}