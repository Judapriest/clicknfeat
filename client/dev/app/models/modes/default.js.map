{"version":3,"sources":["default.es6"],"names":[],"mappings":"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","file":"default.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('defaultMode', [\n    'modes',\n    'settings',\n    'commonMode',\n    'game',\n    'template',\n    'gameTemplateSelection',\n    'gameModels',\n    'gameModelSelection',\n    'gameTerrainSelection',\n    function defaultModeServiceFactory(modesService,\n                                       settingsService,\n                                       commonModeService,\n                                       gameService,\n                                       templateService,\n                                       gameTemplateSelectionService,\n                                       gameModelsService,\n                                       gameModelSelectionService,\n                                       gameTerrainSelectionService) {\n      let DEFAULT_MOVES = {\n        DragEpsilon: 3\n      };\n      let MOVES = R.clone(DEFAULT_MOVES);\n      settingsService.register('Moves',\n                               'Default',\n                               DEFAULT_MOVES,\n                               (moves) => {\n                                 R.extend(MOVES, moves);\n                               });\n      let default_actions = Object.create(commonModeService.actions);\n      function clearTemplateSelection$(state) {\n        return () => {\n          return state.event('Game.update', R.lensProp('template_selection'),\n                             gameTemplateSelectionService.clear$('local', state));\n        };\n      }\n      function clearTerrainSelection$(state) {\n        return () => {\n          return state.event('Game.update', R.lensProp('terrain_selection'),\n                             gameTerrainSelectionService.clear$('local', state));\n        };\n      }\n      default_actions.setModelSelection = (state, event) => {\n        return R.pipePromise(\n          clearTemplateSelection$(state),\n          clearTerrainSelection$(state),\n          () => {\n            var stamp = event['click#'].target.state.stamp;\n            return state.event('Game.command.execute',\n                               'setModelSelection', ['set', [stamp]]);\n          }\n        )();\n      };\n      default_actions.toggleModelSelection = (state, event) => {\n        return R.pipePromise(\n          clearTemplateSelection$(state),\n          clearTerrainSelection$(state),\n          () => {\n            var stamp = event['click#'].target.state.stamp;\n            if(gameModelSelectionService.in('local', stamp, state.game.model_selection)) {\n              return state.event('Game.command.execute',\n                                 'setModelSelection', ['removeFrom', [stamp]]);\n            }\n            else {\n              return state.event('Game.command.execute',\n                                 'setModelSelection', ['addTo', [stamp]]);\n            }\n          }\n        )();\n      };\n      default_actions.modelSelectionDetail = (state, event) => {\n        return R.pipePromise(\n          clearTemplateSelection$(state),\n          clearTerrainSelection$(state),\n          () => {\n            var stamp = event['click#'].target.state.stamp;\n            state.changeEvent('Game.selectionDetail.open',\n                              'model', event['click#'].target);\n            return state.event('Game.command.execute',\n                               'setModelSelection', ['set', [stamp]]);\n          }\n        )();\n      };\n      default_actions.selectTemplate = (state, event) => {\n        return R.pipePromise(\n          clearTerrainSelection$(state),\n          () => {\n            return state\n              .event('Game.update', R.lensProp('template_selection'),\n                     gameTemplateSelectionService.set$('local',\n                                                       [event['click#'].target.state.stamp],\n                                                       state));\n          }\n        )();\n      };\n      default_actions.templateSelectionDetail = (state, event) => {\n        return R.pipePromise(\n          clearTerrainSelection$(state),\n          () => {\n            return state\n              .event('Game.update', R.lensProp('template_selection'),\n                     gameTemplateSelectionService.set$('local',\n                                                       [event['click#'].target.state.stamp],\n                                                       state));\n          },\n          () => { return state.changeEvent('Game.selectionDetail.open',\n                                           'template', event['click#'].target); }\n        )();\n      };\n      default_actions.selectTerrain = (state, event) => {\n        return R.pipePromise(\n          clearTemplateSelection$(state),\n          () => {\n            return state\n              .event('Game.update', R.lensProp('terrain_selection'),\n                     gameTerrainSelectionService.set$('local',\n                                                      [event['click#'].target.state.stamp],\n                                                      state));\n          }\n        )();\n      };\n      default_actions.enterRulerMode = (state) => {\n        return state.event('Modes.switchTo', 'Ruler');\n      };\n      default_actions.enterLosMode = (state) => {\n        return state.event('Modes.switchTo', 'LoS');\n      };\n      default_actions.dragStartMap = (state, event) => {\n        state.changeEvent('Game.dragBox.enable', event.start, event.now);\n      };\n      default_actions.dragMap = (state, event) => {\n        state.changeEvent('Game.dragBox.enable', event.start, event.now);\n      };\n      default_actions.dragEndMap = (state, event) => {\n        state.changeEvent('Game.dragBox.disable');\n        var top_left = {\n          x: Math.min(event.now.x, event.start.x),\n          y: Math.min(event.now.y, event.start.y)\n        };\n        var bottom_right = {\n          x: Math.max(event.now.x, event.start.x),\n          y: Math.max(event.now.y, event.start.y)\n        };\n        return R.pipeP(\n          gameModelsService.findStampsBetweenPoints$(top_left, bottom_right),\n          function(stamps) {\n            if(R.isEmpty(stamps)) {\n              return null;\n            }\n            return state.event('Game.command.execute',\n                               'setModelSelection', ['set', stamps]);\n          }\n        )(state.game.models);\n      };\n\n      var default_default_bindings = {\n        enterRulerMode: 'ctrl+r',\n        enterLosMode: 'ctrl+l',\n        setModelSelection: 'clickModel',\n        toggleModelSelection: 'ctrl+clickModel',\n        modelSelectionDetail: 'rightClickModel',\n        selectTemplate: 'clickTemplate',\n        templateSelectionDetail: 'rightClickTemplate',\n        selectTerrain: 'clickTerrain'\n      };\n      var default_bindings = R.extend(Object.create(commonModeService.bindings),\n                                      default_default_bindings);\n      var default_buttons = [];\n      var default_mode = {\n        name: 'Default',\n        onEnter: (state) => {\n          gameTemplateSelectionService\n            .checkMode(state, state.game.template_selection)\n            .catch(() => {\n              return gameTerrainSelectionService\n                .checkMode(state, state.game.terrain_selection);\n            })\n            .catch(() => {\n              return gameModelSelectionService\n                .checkMode(state, state.game.model_selection);\n            })\n            .catch(R.always(null));\n        },\n        actions: default_actions,\n        buttons: default_buttons,\n        bindings: default_bindings,\n        moves: () => MOVES\n      };\n      modesService.registerMode(default_mode);\n      settingsService.register('Bindings',\n                               default_mode.name,\n                               default_default_bindings,\n                               (bs) => {\n                                 R.extend(default_mode.bindings, bs);\n                               });\n      return default_mode;\n    }\n  ]);\n"]}