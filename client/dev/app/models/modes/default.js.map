{"version":3,"sources":["default.es6"],"names":[],"mappings":"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","file":"default.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('defaultMode', defaultModeModelFactory);\n\n  defaultModeModelFactory.$inject = [\n    'modes',\n    'settings',\n    'commonMode',\n    'gameTemplateSelection',\n    'gameModels',\n    'gameModelSelection',\n    'gameTerrainSelection',\n  ];\n  function defaultModeModelFactory(modesModel,\n                                   settingsModel,\n                                   commonModeModel,\n                                   gameTemplateSelectionModel,\n                                   gameModelsModel,\n                                   gameModelSelectionModel,\n                                   gameTerrainSelectionModel) {\n    const default_actions = Object.create(commonModeModel.actions);\n    default_actions.setModelSelection = setModelSelection;\n    default_actions.toggleModelSelection = toggleModelSelection;\n    default_actions.modelSelectionDetail = modelSelectionDetail;\n    default_actions.selectTemplate = selectTemplate;\n    default_actions.templateSelectionDetail = templateSelectionDetail;\n    default_actions.selectTerrain = selectTerrain;\n    // default_actions.enterRulerMode = enterRulerMode;\n    default_actions.enterLosMode = enterLosMode;\n    default_actions.dragStartMap = dragStartMap;\n    default_actions.dragMap = dragMap;\n    default_actions.dragEndMap = dragEndMap;\n\n    const default_default_bindings = {\n      // enterRulerMode: 'ctrl+r',\n      enterLosMode: 'ctrl+l',\n      setModelSelection: 'clickModel',\n      toggleModelSelection: 'ctrl+clickModel',\n      modelSelectionDetail: 'rightClickModel',\n      selectTemplate: 'clickTemplate',\n      templateSelectionDetail: 'rightClickTemplate',\n      selectTerrain: 'clickTerrain'\n    };\n    const default_bindings = R.extend(Object.create(commonModeModel.bindings),\n                                      default_default_bindings);\n    const default_buttons = [];\n    const default_mode = {\n      name: 'Default',\n      onEnter: onEnter,\n      actions: default_actions,\n      buttons: default_buttons,\n      bindings: default_bindings\n    };\n    modesModel.registerMode(default_mode);\n    settingsModel.register('Bindings',\n                           default_mode.name,\n                           default_default_bindings,\n                           (bs) => {\n                             R.extend(default_mode.bindings, bs);\n                           });\n    return default_mode;\n\n    function setModelSelection(state, event) {\n      return R.threadP()(\n        clearTemplateSelection$(state),\n        clearTerrainSelection$(state),\n        () => event['click#'].target.state.stamp,\n        (stamp) => state.eventP('Game.command.execute',\n                                'setModelSelection',\n                                ['set', [stamp]])\n      );\n    }\n    function toggleModelSelection(state, event) {\n      return R.threadP()(\n        clearTemplateSelection$(state),\n        clearTerrainSelection$(state),\n        () => event['click#'].target.state.stamp,\n        (stamp) => {\n          if(gameModelSelectionModel.in('local', stamp,\n                                        state.game.model_selection)) {\n            return state.eventP('Game.command.execute',\n                                'setModelSelection',\n                                ['removeFrom', [stamp]]);\n          }\n          else {\n            return state.eventP('Game.command.execute',\n                                'setModelSelection',\n                                ['addTo', [stamp]]);\n          }\n        }\n      );\n    }\n    function modelSelectionDetail(state, event) {\n      return R.threadP()(\n        clearTemplateSelection$(state),\n        clearTerrainSelection$(state),\n        () => event['click#'].target.state.stamp,\n        (stamp) => {\n          state.queueChangeEventP('Game.selectionDetail.open',\n                                  'model', event['click#'].target);\n          return state.eventP('Game.command.execute',\n                              'setModelSelection', ['set', [stamp]]);\n        }\n      );\n    }\n    function selectTemplate(state, event) {\n      return R.threadP()(\n        clearTerrainSelection$(state),\n        () => state.eventP(\n          'Game.update', R.lensProp('template_selection'),\n          gameTemplateSelectionModel.set$(\n            'local',\n            [event['click#'].target.state.stamp],\n            state\n          )\n        )\n      );\n    }\n    function templateSelectionDetail(state, event) {\n      return R.threadP()(\n        clearTerrainSelection$(state),\n        () => state.eventP(\n          'Game.update', R.lensProp('template_selection'),\n          gameTemplateSelectionModel.set$(\n            'local',\n            [event['click#'].target.state.stamp],\n            state\n          )\n        ),\n        () => {\n          state.queueChangeEventP(\n            'Game.selectionDetail.open',\n            'template', event['click#'].target\n          );\n        }\n      );\n    }\n    function selectTerrain(state, event) {\n      return R.threadP()(\n        clearTemplateSelection$(state),\n        () => state.eventP(\n          'Game.update', R.lensProp('terrain_selection'),\n          gameTerrainSelectionModel.set$(\n            'local',\n            [event['click#'].target.state.stamp],\n            state\n          )\n        )\n      );\n    }\n    // function enterRulerMode(state) {\n    //   return state.eventP('Modes.switchTo', 'Ruler');\n    // }\n    function enterLosMode(state) {\n      return state.eventP('Modes.switchTo', 'Los');\n    }\n    function dragStartMap(state, event) {\n      state.queueChangeEventP('Game.dragBox.enable', event.start, event.now);\n    }\n    function dragMap(state, event) {\n      state.queueChangeEventP('Game.dragBox.enable', event.start, event.now);\n    }\n    function dragEndMap(state, event) {\n      state.queueChangeEventP('Game.dragBox.disable');\n      const top_left = {\n        x: Math.min(event.now.x, event.start.x),\n        y: Math.min(event.now.y, event.start.y)\n      };\n      const bottom_right = {\n        x: Math.max(event.now.x, event.start.x),\n        y: Math.max(event.now.y, event.start.y)\n      };\n      return R.threadP(state.game)(\n        R.prop('models'),\n        (models) => gameModelsModel\n          .findStampsBetweenPointsP(top_left, bottom_right, models)\n          .catch(R.always([])),\n        (stamps) => {\n          if(R.isEmpty(stamps)) return null;\n          return state.eventP('Game.command.execute',\n                              'setModelSelection',\n                              ['set', stamps]);\n        }\n      );\n    }\n    function onEnter(state) {\n      return R.thread()(\n        () => gameTemplateSelectionModel\n          .checkModeP(state, state.game.template_selection),\n        R.condErrorP([\n          [ R.T, () => gameTerrainSelectionModel\n            .checkModeP(state, state.game.terrain_selection) ]\n        ]),\n        R.condErrorP([\n          [ R.T, () => gameModelSelectionModel\n            .checkModeP(state, state.game.model_selection) ]\n        ]),\n        R.condErrorP([\n          [ R.T, R.always(null) ]\n        ])\n      );\n    }\n    function clearTemplateSelection$(state) {\n      return () => state.eventP(\n        'Game.update', R.lensProp('template_selection'),\n        gameTemplateSelectionModel.clear$('local', state)\n      );\n    }\n    function clearTerrainSelection$(state) {\n      return () => state.eventP(\n        'Game.update', R.lensProp('terrain_selection'),\n        gameTerrainSelectionModel.clear$('local', state)\n      );\n    }\n  }\n})();\n"]}