{"version":3,"sources":["default.es6"],"names":[],"mappings":"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","file":"default.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('defaultMode', defaultModeModelFactory);\n\n  defaultModeModelFactory.$inject = [\n    'appAction',\n    'appState',\n    'modes',\n    'settings',\n    'commonMode',\n    'gameModels',\n    'gameModelSelection',\n    'gameTemplateSelection',\n    'gameTerrainSelection',\n  ];\n  function defaultModeModelFactory(appActionService,\n                                   appStateService,\n                                   modesModel,\n                                   settingsModel,\n                                   commonModeModel,\n                                   gameModelsModel,\n                                   gameModelSelectionModel,\n                                   gameTemplateSelectionModel,\n                                   gameTerrainSelectionModel) {\n    const DRAG_BOX_LENS = R.lensPath(['view','drag_box']);\n    const MODEL_SELECTION_LENS = R.lensPath(['game','model_selection']);\n    const TEMPLATE_SELECTION_LENS = R.lensPath(['game','template_selection']);\n    const TERRAIN_SELECTION_LENS = R.lensPath(['game','terrain_selection']);\n\n    const default_actions = Object.create(commonModeModel.actions);\n    default_actions.setModelSelection = setModelSelection;\n    default_actions.toggleModelSelection = toggleModelSelection;\n    default_actions.modelSelectionDetail = modelSelectionDetail;\n    default_actions.selectTemplate = selectTemplate;\n    default_actions.templateSelectionDetail = templateSelectionDetail;\n    default_actions.selectTerrain = selectTerrain;\n    default_actions.enterRulerMode = enterRulerMode;\n    default_actions.enterLosMode = enterLosMode;\n    default_actions.dragStartMap = dragMap;\n    default_actions.dragMap = dragMap;\n    default_actions.dragEndMap = dragEndMap;\n\n    const default_default_bindings = {\n      enterRulerMode: 'ctrl+r',\n      enterLosMode: 'ctrl+l',\n      setModelSelection: 'clickModel',\n      toggleModelSelection: 'ctrl+clickModel',\n      modelSelectionDetail: 'rightClickModel',\n      selectTemplate: 'clickTemplate',\n      templateSelectionDetail: 'rightClickTemplate',\n      selectTerrain: 'clickTerrain'\n    };\n    const default_bindings = R.extend(Object.create(commonModeModel.bindings),\n                                      default_default_bindings);\n    const default_buttons = [];\n    const default_mode = {\n      name: 'Default',\n      actions: default_actions,\n      buttons: default_buttons,\n      bindings: default_bindings\n    };\n    modesModel.registerMode(default_mode);\n    settingsModel.register('Bindings',\n                           default_mode.name,\n                           default_default_bindings,\n                           (bs) => {\n                             R.extend(default_mode.bindings, bs);\n                           });\n    return default_mode;\n\n    function setModelSelection(state, event) {\n      const stamp = event['click#'].target.state.stamp;\n      appActionService\n        .defer('Game.command.execute',\n               'setModelSelection',\n               [ 'set', [stamp] ]);\n      return R.thread(state)(\n        clearTemplateSelection,\n        clearTerrainSelection\n      );\n    }\n    function toggleModelSelection(state, event) {\n      const stamp = event['click#'].target.state.stamp;\n      const is_in_local = gameModelSelectionModel\n              .in('local', stamp, R.view(MODEL_SELECTION_LENS, state));\n      if(is_in_local) {\n        appActionService\n          .defer('Game.command.execute',\n                 'setModelSelection',\n                 ['removeFrom', [stamp]]);\n      }\n      else {\n        appActionService\n          .defer('Game.command.execute',\n                 'setModelSelection',\n                 ['addTo', [stamp]]);\n      }\n      return R.thread(state)(\n        clearTemplateSelection,\n        clearTerrainSelection\n      );\n    }\n    function modelSelectionDetail(state, event) {\n      return R.thread(state)(\n        R.assocPath(['view','detail'], {\n          type: 'model',\n          element: event['click#'].target\n        }),\n        (state) => setModelSelection(state, event)\n      );\n    }\n    function selectTemplate(state, event) {\n      return R.thread(state)(\n        clearTerrainSelection,\n        R.over(\n          TEMPLATE_SELECTION_LENS,\n          gameTemplateSelectionModel.set$(\n            'local',\n            [event['click#'].target.state.stamp]\n          )\n        )\n      );\n    }\n    function templateSelectionDetail(state, event) {\n      return R.thread(state)(\n        (state) => selectTemplate(state, event),\n        R.assocPath(['view','detail'], {\n          type: 'template',\n          element: event['click#'].target\n        })\n      );\n    }\n    function selectTerrain(state, event) {\n      return R.thread(state)(\n        clearTemplateSelection,\n        R.over(\n          TERRAIN_SELECTION_LENS,\n          gameTerrainSelectionModel.set$(\n            'local',\n            [event['click#'].target.state.stamp]\n          )\n        )\n      );\n    }\n    function enterRulerMode(state) {\n      return appStateService\n        .onAction(state, ['Modes.switchTo', 'Ruler']);\n    }\n    function enterLosMode(state) {\n      return appStateService\n        .onAction(state, ['Modes.switchTo', 'Los']);\n    }\n    function dragMap(state, event) {\n      return R.set(\n        DRAG_BOX_LENS,\n        convertDragEventToBox(event),\n        state\n      );\n    }\n    function dragEndMap(state, event) {\n      const box = convertDragEventToBox(event);\n      R.thread(state.game)(\n        R.prop('models'),\n        (models) => gameModelsModel\n          .findStampsBetweenPoints(box.top_left, box.bottom_right, models),\n        (stamps) => {\n          if(R.isEmpty(stamps)) return;\n          appActionService\n            .defer('Game.command.execute',\n                   'setModelSelection',\n                   ['set', stamps]);\n        }\n      );\n      return R.set(DRAG_BOX_LENS, {}, state);\n    }\n    function clearTemplateSelection(state) {\n      return R.over(\n        TEMPLATE_SELECTION_LENS,\n        R.unless(\n          gameTemplateSelectionModel.isEmpty$('local'),\n          gameTemplateSelectionModel.clear$('local')\n        ),\n        state\n      );\n    }\n    function clearTerrainSelection(state) {\n      return R.over(\n        TERRAIN_SELECTION_LENS,\n        R.unless(\n          gameTerrainSelectionModel.isEmpty$('local'),\n          gameTerrainSelectionModel.clear$('local')\n        ),\n        state\n      );\n    }\n    function convertDragEventToBox(event) {\n      return {\n        top_left: { x: Math.min(event.start.x, event.now.x),\n                    y: Math.min(event.start.y, event.now.y)\n                  },\n        bottom_right: { x: Math.max(event.start.x, event.now.x),\n                        y: Math.max(event.start.y, event.now.y)\n                      }\n      };\n    }\n  }\n})();\n"]}