{"version":3,"sources":["ruler.es6"],"names":[],"mappings":"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","file":"ruler.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('rulerMode', rulerModeModelFactory);\n\n  rulerModeModelFactory.$inject = [\n    'segmentMode',\n    'modes',\n    'settings',\n    'commonMode',\n    'game',\n    'gameRuler',\n    'model',\n    'gameModels',\n    'gameModelSelection',\n    'prompt',\n  ];\n  function rulerModeModelFactory(segmentModeModel,\n                                 modesModel,\n                                 settingsModel,\n                                 commonModeModel,\n                                 gameModel,\n                                 gameRulerModel,\n                                 modelModel,\n                                 gameModelsModel,\n                                 gameModelSelectionModel,\n                                 promptModel) {\n    const ruler_default_bindings = {\n      exitRulerMode: 'ctrl+r',\n      setMaxLength: 'shift+r',\n      setOriginModel: 'ctrl+clickModel',\n      setTargetModel: 'shift+clickModel',\n      createAoEOnTarget: 'ctrl+a'\n    };\n\n    const ruler_mode =\n            segmentModeModel('ruler', gameRulerModel, ruler_default_bindings);\n    ruler_mode.actions.setOriginModel = rulerSetOriginModel;\n    ruler_mode.actions.setTargetModel = rulerSetTargetModel;\n    ruler_mode.actions.setMaxLength = rulerSetMaxLength;\n    ruler_mode.actions.createAoEOnTarget = rulerCreateAoEOnTarget;\n\n    ruler_mode.buttons = R.concat(ruler_mode.buttons, [\n      [ 'Set Max Len.', 'setMaxLength' ],\n      [ 'AoE on Target', 'createAoEOnTarget' ],\n    ]);\n    const baseOnEnter = ruler_mode.onEnter;\n    ruler_mode.onEnter = rulerOnEnter;\n\n    return ruler_mode;\n\n    function rulerSetOriginModel(state, event) {\n      return R.threadP()(\n        () => state.eventP('Game.command.execute',\n                           'setRuler', [\n                             'setOrigin',\n                             [event['click#'].target]\n                           ]),\n        () => updateMaxLengthButton(state)\n      );\n    }\n    function rulerSetTargetModel(state, event) {\n      return state.eventP('Game.command.execute',\n                          'setRuler', [\n                            'setTarget',\n                            [event['click#'].target]\n                          ]);\n    }\n    function rulerSetMaxLength(state) {\n      return R.threadP()(\n        () => promptModel\n          .promptP('prompt', 'Set ruler max length :',\n                   gameRulerModel.maxLength(state.game.ruler))\n          .catch(R.always(null)),\n        (value) => (value === 0) ? null : value,\n        (value) => R.threadP()(\n            () => state.eventP('Game.command.execute',\n                               'setRuler', [\n                                 'setMaxLength', [value]\n                               ]),\n          () => {\n            const origin = gameRulerModel.origin(state.game.ruler);\n            if(R.isNil(origin)) return null;\n\n            return state.eventP('Game.command.execute',\n                                'onModels', [\n                                  'setRulerMaxLength',\n                                  [value],\n                                  [origin]\n                                ]);\n          }\n        ),\n        () => updateMaxLengthButton(state)\n      );\n    }\n    function rulerCreateAoEOnTarget(state) {\n      return R.threadP(state.game.ruler)(\n        gameRulerModel\n          .targetAoEPositionP$(state.game.models),\n        (position) => ({\n          base: { x: 0, y: 0, r: 0 },\n          templates: [ R.assoc('type', 'aoe', position) ]\n        }),\n        (create) => state.eventP('Game.command.execute',\n                                 'createTemplate', [\n                                   create, false\n                                 ])\n      );\n    }\n    function rulerOnEnter(state) {\n      return R.threadP()(\n        () => baseOnEnter(state),\n        () => updateMaxLengthButton(state)\n      );\n    }\n    function updateMaxLengthButton(state) {\n      const max = gameRulerModel.maxLength(state.game.ruler);\n      ruler_mode.buttons[0][0] = `Set Max Len. (${max})`;\n      state.queueChangeEventP('Modes.buttons.update');\n    }\n  }\n})();\n"]}