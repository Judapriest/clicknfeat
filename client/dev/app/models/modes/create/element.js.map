{"version":3,"sources":["element.es6"],"names":[],"mappings":"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","file":"element.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('createElementMode', createElementModeModelFactory);\n\n  createElementModeModelFactory.$inject = [\n    'appAction',\n    'appState',\n    'commonMode',\n  ];\n  function createElementModeModelFactory(appActionService,\n                                         appStateService,\n                                         commonModeModel) {\n    const CREATE_LENS = R.lensProp('create');\n    const BASE_LENS = R.lensProp('base');\n    return function createElementModeModel(type) {\n      const createElement_actions = Object.create(commonModeModel.actions);\n      createElement_actions.modeBackToDefault = modeBackToDefault;\n      createElement_actions.moveMap = moveMap;\n      createElement_actions.create = create;\n\n      const createElement_default_bindings = {\n        'create': 'clickMap'\n      };\n      const createElement_bindings = R.extend(Object.create(commonModeModel.bindings),\n                                              createElement_default_bindings);\n      const createElement_buttons = [];\n\n      const createElement_mode = {\n        onEnter: onEnter,\n        onLeave: onLeave,\n        name: `Create${s.capitalize(type)}`,\n        actions: createElement_actions,\n        buttons: createElement_buttons,\n        bindings: createElement_bindings\n      };\n      const updateCreateBase$ = R.curry(updateCreateBase);\n      return createElement_mode;\n\n      function onEnter() {\n        appActionService.defer('Game.view.moveMap', true);\n      }\n      function onLeave() {\n        appActionService.defer('Game.view.moveMap', false);\n      }\n      function modeBackToDefault(state) {\n        return R.thread(state)(\n          R.set(CREATE_LENS, null),\n          commonModeModel.actions.modeBackToDefault\n        );\n      }\n      function moveMap(state, coord) {\n        return R.over(\n          CREATE_LENS,\n          updateCreateBase$(coord),\n          state\n        );\n      }\n      function create(state, event) {\n        const is_flipped = R.pathOr(false, ['view','flip_map'], state);\n        const create = R.thread(state)(\n          R.view(CREATE_LENS),\n          updateCreateBase$(event['click#']),\n          R.assoc('factions', state.factions)\n        );\n        return R.thread(state)(\n          appStateService.onAction$(R.__, [ 'Game.command.execute',\n                                            `create${s.capitalize(type)}`,\n                                            [ create, is_flipped ] ]),\n          R.defaultTo(state),\n          appStateService.onAction$(R.__, [ 'Modes.switchTo', 'Default' ]),\n          R.set(CREATE_LENS, null)\n        );\n      }\n      function updateCreateBase(coord, create) {\n        return R.over(\n          BASE_LENS,\n          R.pipe(\n            R.assoc('x', coord.x),\n            R.assoc('y', coord.y)\n          ),\n          create\n        );\n      }\n    };\n  }\n})();\n"]}