{"version":3,"sources":["aoeTemplate.es6"],"names":[],"mappings":"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","file":"aoeTemplate.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('aoeTemplateMode', [\n    'modes',\n    'settings',\n    'templateMode',\n    'game',\n    'gameTemplates',\n    'gameTemplateSelection',\n    'gameRuler',\n    'prompt',\n    function aoeTemplateModeServiceFactory(modesService,\n                                           settingsService,\n                                           templateModeService,\n                                           gameService,\n                                           gameTemplatesService,\n                                           gameTemplateSelectionService,\n                                           gameRulerService,\n                                           promptService) {\n      var template_actions = Object.create(templateModeService.actions);\n      template_actions.aoeSize3 = (state) => {\n        var stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return state.event('Game.command.execute',\n                           'onTemplates', ['setSize', [3], stamps]);\n      };\n      template_actions.aoeSize4 = (state) => {\n        var stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return state.event('Game.command.execute',\n                           'onTemplates', ['setSize', [4], stamps]);\n      };\n      template_actions.aoeSize5 = (state) => {\n        var stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return state.event('Game.command.execute',\n                           'onTemplates', ['setSize', [5], stamps]);\n      };\n      template_actions.setTargetModel = (state, event) => {\n        var stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return state.event('Game.command.execute',\n                           'onTemplates',\n                           ['setTarget', [state.factions, null, event['click#'].target],\n                            stamps\n                           ]);\n      };\n      template_actions.setMaxDeviation = (state) => {\n        var stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return R.pipeP(\n          gameTemplatesService.fromStamps$('maxDeviation', [], stamps),\n          (maxes) => {\n            var max = maxes[0];\n            return promptService\n              .prompt('prompt', 'Set AoE max deviation :', max)\n              .catch((error) => {\n                console.log(error);\n                return null;\n              });\n          },\n          (value) => {\n            value = (value === 0) ? null : value;\n            return state.event('Game.update', R.lensProp('templates'),\n                               gameTemplatesService.onStamps$('setMaxDeviation', [value], stamps));\n          }\n        )(state.game.templates);\n      };\n      template_actions.deviate = (state) => {\n        var stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return R.pipePromise(\n          function() {\n            return state.event('Game.command.execute',\n                               'rollDeviation', []);\n          },\n          R.always(state),\n          R.path(['game','dice']),\n          R.last,\n          function(deviation) {\n            return state.event('Game.command.execute',\n                               'onTemplates', [ 'deviate', [deviation.r, deviation.d],\n                                                stamps\n                                              ]);\n          }\n        )();\n      };\n      template_actions.setToRulerTarget = (state) => {\n        if(!gameRulerService.isDisplayed(state.game.ruler)) return null;\n        \n        var stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return R.pipeP(\n          gameRulerService.targetAoEPosition$(state.game.models),\n          (position) => {\n            return state.event('Game.command.execute',\n                               'onTemplates', [ 'setToRuler', [position],\n                                                stamps\n                                              ]);\n          }\n        )(state.game.ruler);\n      };\n\n      var template_default_bindings = {\n        setTargetModel: 'shift+clickModel',\n        aoeSize3: '3',\n        aoeSize4: '4',\n        aoeSize5: '5',\n        deviate: 'd',\n        setMaxDeviation: 'shift+d',\n        setToRulerTarget: 'shift+r'\n      };\n      var template_bindings = R.extend(Object.create(templateModeService.bindings),\n                                       template_default_bindings);\n      var template_buttons = R.concat([\n        [ 'Size', 'toggle', 'size' ],\n        [ 'Aoe3', 'aoeSize3', 'size' ],\n        [ 'Aoe4', 'aoeSize4', 'size' ],\n        [ 'Aoe5', 'aoeSize5', 'size' ],\n        [ 'Deviate', 'deviate' ],\n        [ 'Set to Ruler', 'setToRulerTarget' ],\n      ], templateModeService.buttons);\n\n      var template_mode = {\n        onEnter: (/*state*/) => {},\n        onLeave: (/*state*/) => {},\n        name: 'aoe'+templateModeService.name,\n        actions: template_actions,\n        buttons: template_buttons,\n        bindings: template_bindings\n      };\n      modesService.registerMode(template_mode);\n      settingsService.register('Bindings',\n                               template_mode.name,\n                               template_default_bindings,\n                               (bs) => {\n                                 R.extend(template_mode.bindings, bs);\n                               });\n      return template_mode;\n    }\n  ]);\n"]}