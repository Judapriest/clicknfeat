{"version":3,"sources":["terrain.es6"],"names":[],"mappings":"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","file":"terrain.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('terrain', [\n    'settings',\n    'point',\n    function terrainServiceFactory(settingsService,\n                                   pointService) {\n      let DEFAULT_MOVES = {\n        Move: 10,\n        MoveSmall: 1,\n        Rotate: 15,\n        RotateSmall: 5,\n        Shift: 10,\n        ShiftSmall: 1\n      };\n      let MOVES = R.clone(DEFAULT_MOVES);\n      settingsService.register('Moves',\n                               'Terrain',\n                               DEFAULT_MOVES,\n                               (moves) => {\n                                 R.extend(MOVES, moves);\n                               });\n      var terrainService = {\n        create: function terrainCreate(temp) {\n          var terrain = {\n            state: {\n              x: 0, y: 0, r: 0,\n              lk: false,\n              stamp: R.guid()\n            }\n          };\n          terrain.state = R.deepExtend(terrain.state, temp);\n          return terrainService.checkState(terrain);\n        },\n        stamp: function terrainStamp(terrain) {\n          return R.path(['state','stamp'], terrain);\n        },\n        eventName: function terrainEventName(terrain) {\n          return R.path(['state','stamp'], terrain);\n        },\n        state: function terrainState(terrain) {\n          return R.prop('state', terrain);\n        },\n        saveState: function terrainSaveState(terrain) {\n          return R.clone(R.prop('state', terrain));\n        },\n        setState: function terrainSetState(state, terrain) {\n          return R.assoc('state', R.clone(state), terrain);\n        },\n        checkState: function terrainCheckState(terrain) {\n          return R.pipe(\n            R.over(R.lensPath(['state','x']),\n                   R.compose(R.max(0), R.min(480))),\n            R.over(R.lensPath(['state','y']),\n                   R.compose(R.max(0), R.min(480)))\n          )(terrain);\n        },\n        isLocked: function terrainIsLocked(terrain) {\n          return R.path(['state', 'lk'], terrain);\n        },\n        setLock: function terrainSetLock(set, terrain) {\n          return R.assocPath(['state','lk'], set, terrain);\n        },\n        setPosition: function terrainSet(pos, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }          \n          return R.pipe(\n            R.assocPath(['state','x'], pos.x),\n            R.assocPath(['state','y'], pos.y),\n            terrainService.checkState\n          )(terrain);\n        },\n        shiftPosition: function terrainSet(shift, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          return R.pipe(\n            R.assocPath(['state','x'], terrain.state.x + shift.x),\n            R.assocPath(['state','y'], terrain.state.y + shift.y),\n            terrainService.checkState\n          )(terrain);\n        },\n        setOrientation: function terrainSet(orientation, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          return R.pipe(\n            R.assocPath(['state','r'], orientation, terrain),\n            terrainService.checkState\n          )(terrain);\n        },\n        moveFront: function terrainMoveFront(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var dist = MOVES[small ? 'MoveSmall' : 'Move'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.moveFront$(dist)),\n            terrainService.checkState\n          )(terrain);\n        },\n        moveBack: function terrainMoveBack(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var dist = MOVES[small ? 'MoveSmall' : 'Move'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.moveBack$(dist)),\n            terrainService.checkState\n          )(terrain);\n        },\n        rotateLeft: function terrainRotateLeft(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var angle = MOVES[small ? 'RotateSmall' : 'Rotate'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.rotateLeft$(angle)),\n            terrainService.checkState\n          )(terrain);\n        },\n        rotateRight: function terrainRotateRight(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var angle = MOVES[small ? 'RotateSmall' : 'Rotate'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.rotateRight$(angle)),\n            terrainService.checkState\n          )(terrain);\n        },\n        shiftLeft: function terrainShiftLeft(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.shiftLeft$(dist)),\n            terrainService.checkState\n          )(terrain);\n        },\n        shiftRight: function terrainShiftRight(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.shiftRight$(dist)),\n            terrainService.checkState\n          )(terrain);\n        },\n        shiftUp: function terrainShiftUp(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.shiftUp$(dist)),\n            terrainService.checkState\n          )(terrain);\n        },\n        shiftDown: function terrainShiftDown(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.shiftDown$(dist)),\n            terrainService.checkState\n          )(terrain);\n        }\n      };\n      R.curryService(terrainService);\n      return terrainService;\n    }\n  ]);\n"]}