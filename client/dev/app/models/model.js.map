{"version":3,"sources":["model.es6"],"names":[],"mappings":"AAAA;;AAEA,QAAQ,MAAR,CAAe,mBAAf,EACG,OADH,CACW,OADX,EACoB,CAChB,UADgB,EAEhB,OAFgB,EAGhB,cAHgB,EAIhB,WAJgB,EAKhB,WALgB,EAMhB,aANgB,EAOhB,cAPgB,EAQhB,aARgB,EAShB,aATgB,EAUhB,WAVgB,EAWhB,YAXgB,EAYhB,kBAZgB,EAahB,YAbgB,EAchB,aAdgB,EAehB,YAfgB,EAgBhB,WAhBgB,EAiBhB,YAjBgB,EAkBhB,YAlBgB,EAmBhB,WAnBgB,EAoBhB,YApBgB,EAqBhB,SAAS,mBAAT,CAA6B,eAA7B,EAC6B,YAD7B,EAE6B,mBAF7B,EAG6B,gBAH7B,EAI6B,gBAJ7B,EAK6B,kBAL7B,EAM6B,mBAN7B,EAO6B,kBAP7B,EAQ6B,kBAR7B,EAS6B,gBAT7B,EAU6B,iBAV7B,EAW6B,uBAX7B,EAY6B,iBAZ7B,EAa6B,kBAb7B,EAc6B,iBAd7B,EAe6B,gBAf7B,EAgB6B,iBAhB7B,EAiB6B,iBAjB7B,EAkB6B,gBAlB7B,EAmB6B,iBAnB7B,EAmBgD;AAC9C,MAAI,gBAAgB;AAClB,UAAM,EAAN;AACA,eAAW,CAAX;AACA,YAAQ,EAAR;AACA,iBAAa,CAAb;AACA,WAAO,EAAP;AACA,gBAAY,CAAZ;AACA,kBAAc,EAAd;AACA,uBAAmB,CAAnB;GARE,CAD0C;AAW9C,MAAI,QAAQ,EAAE,KAAF,CAAQ,aAAR,CAAR,CAX0C;AAY9C,kBAAgB,QAAhB,CAAyB,OAAzB,EACyB,OADzB,EAEyB,aAFzB,EAGyB,UAAC,KAAD,EAAW;AACT,MAAE,MAAF,CAAS,KAAT,EAAgB,KAAhB,EADS;GAAX,CAHzB,CAZ8C;AAkB9C,MAAI,eAAe;AACjB,YAAQ,SAAS,WAAT,CAAqB,QAArB,EAA+B,IAA/B,EAAqC;AAC3C,aAAO,EAAE,KAAF,CACL,oBAAoB,aAApB,CAAkC,KAAK,IAAL,CAD7B,EAEL,UAAC,IAAD,EAAU;AACR,YAAI,QAAQ;AACV,iBAAO;AACL,eAAG,CAAH,EAAM,GAAG,CAAH,EAAM,GAAG,CAAH;AACZ,iBAAK,CAAL;AACA,iBAAK,CAAC,GAAD,CAAL;AACA,iBAAK,EAAL;AACA,eAAG,EAAH;AACA,eAAG,CAAH,EAAM,GAAG,CAAH;AACN,eAAG,IAAH;AACA,iBAAK,IAAL;AACA,iBAAK,IAAL;AACA,iBAAK,IAAL;AACA,iBAAK,IAAL;AACA,iBAAK,CAAC,IAAD,EAAM,KAAN,CAAL;AACA,iBAAK,IAAL;AACA,iBAAK,IAAL;AACA,iBAAK,WAAW,KAAK,MAAL,CAAhB;AACA,mBAAO,EAAE,IAAF,EAAP;WAhBF;SADE,CADI;AAqBR,YAAG,KAAK,IAAL,KAAc,SAAd,IACA,KAAK,IAAL,KAAc,OAAd,IACA,KAAK,IAAL,KAAc,MAAd,EAAsB;AACvB,gBAAM,KAAN,CAAY,GAAZ,GAAkB,EAAE,MAAF,CAAS,GAAT,EAAc,MAAM,KAAN,CAAY,GAAZ,CAAhC,CADuB;SAFzB;AAKA,YAAG,KAAK,SAAL,EAAgB;AACjB,gBAAM,KAAN,CAAY,GAAZ,GAAkB,EAAE,MAAF,CAAS,IAAT,EAAe,MAAM,KAAN,CAAY,GAAZ,CAAjC,CADiB;SAAnB;AAGA,cAAM,KAAN,GAAc,EAAE,UAAF,CAAa,MAAM,KAAN,EAAa,IAA1B,CAAd,CA7BQ;AA8BR,eAAO,aAAa,UAAb,CAAwB,QAAxB,EAAkC,IAAlC,EAAwC,KAAxC,CAAP,CA9BQ;OAAV,CAFK,CAkCL,QAlCK,CAAP,CAD2C;KAArC;AAqCR,WAAO,SAAS,UAAT,CAAoB,KAApB,EAA2B;AAChC,aAAO,EAAE,IAAF,CAAO,CAAC,OAAD,EAAS,OAAT,CAAP,EAA0B,KAA1B,CAAP,CADgC;KAA3B;AAGP,eAAW,SAAS,cAAT,CAAwB,KAAxB,EAA+B;AACxC,aAAO,EAAE,IAAF,CAAO,CAAC,OAAD,EAAS,OAAT,CAAP,EAA0B,KAA1B,CAAP,CADwC;KAA/B;AAGX,UAAM,SAAS,SAAT,CAAmB,KAAnB,EAA0B;AAC9B,aAAO,EAAE,IAAF,CAAO,CAAC,OAAD,EAAU,MAAV,CAAP,EAA0B,KAA1B,CAAP,CAD8B;KAA1B;AAGN,YAAQ,SAAS,SAAT,CAAmB,IAAnB,EAAyB,KAAzB,EAAgC;AACtC,aAAO,EAAE,MAAF,CAAS,CAAC,OAAD,EAAU,MAAV,CAAT,EAA4B,IAA5B,EAAkC,KAAlC,CAAP,CADsC;KAAhC;AAGR,WAAO,SAAS,UAAT,CAAoB,KAApB,EAA2B;AAChC,aAAO,EAAE,IAAF,CAAO,OAAP,EAAgB,KAAhB,CAAP,CADgC;KAA3B;AAGP,eAAW,SAAS,cAAT,CAAwB,KAAxB,EAA+B;AACxC,aAAO,EAAE,KAAF,CAAQ,EAAE,IAAF,CAAO,OAAP,EAAgB,KAAhB,CAAR,CAAP,CADwC;KAA/B;AAGX,cAAU,SAAS,aAAT,CAAuB,KAAvB,EAA8B,KAA9B,EAAqC;AAC7C,aAAO,EAAE,KAAF,CAAQ,OAAR,EAAiB,EAAE,KAAF,CAAQ,KAAR,CAAjB,EAAiC,KAAjC,CAAP,CAD6C;KAArC;AAGV,oBAAgB,EAAhB;AACA,oBAAgB,EAAhB;AACA,gBAAY,SAAS,eAAT,CAAyB,QAAzB,EAAmC,MAAnC,EAA2C,KAA3C,EAAkD;AAC5D,aAAO,EAAE,KAAF,CACL,oBAAoB,aAApB,CAAkC,MAAM,KAAN,CAAY,IAAZ,CAD7B,EAEL,UAAC,IAAD,EAAU;AACR,YAAI,SAAS,KAAK,WAAL,CADL;AAER,eAAO,EAAE,IAAF,CACL,EAAE,KAAF,CAAQ,GAAR,EAAa,KAAK,GAAL,CAAS,IAAE,MAAF,EAAU,KAAK,GAAL,CAAS,MAAI,MAAJ,EAAY,MAAM,KAAN,CAAY,CAAZ,CAAxC,CAAb,CADK,EAEL,EAAE,KAAF,CAAQ,GAAR,EAAa,KAAK,GAAL,CAAS,IAAE,MAAF,EAAU,KAAK,GAAL,CAAS,MAAI,MAAJ,EAAY,MAAM,KAAN,CAAY,CAAZ,CAAxC,CAAb,CAFK,EAGL,UAAC,KAAD,EAAW;AACT,iBAAO,EAAE,MAAF,CAAS,UAAC,KAAD,EAAQ,OAAR,EAAoB;AAClC,mBAAO,QAAQ,IAAR,EAAc,MAAd,EAAsB,KAAtB,CAAP,CADkC;WAApB,EAEb,KAFI,EAEG,aAAa,cAAb,CAFV,CADS;SAAX,EAKA,UAAC,KAAD,EAAW;AACT,iBAAO,EAAE,MAAF,CAAS,UAAS,KAAT,EAAgB,OAAhB,EAAyB;AACvC,mBAAO,QAAQ,KAAR,CAAP,CADuC;WAAzB,EAEb,KAFI,EAEG,aAAa,cAAb,CAFV,CADS;SAAX,CARK,CAaL,MAAM,KAAN,CAbF,CAFQ;OAAV,EAiBA,UAAC,KAAD,EAAW;AACT,eAAO,EAAE,KAAF,CAAQ,OAAR,EAAiB,KAAjB,EAAwB,KAAxB,CAAP,CADS;OAAX,CAnBK,CAsBL,QAtBK,CAAP,CAD4D;KAAlD;AAyBZ,cAAU,SAAS,aAAT,CAAuB,KAAvB,EAA8B;AACtC,aAAO,EAAE,IAAF,CACL,EAAE,MAAF,CAAS,EAAT,EAAa,CAAC,OAAD,EAAU,KAAV,CAAb,CADK,EAEL,EAAE,IAAF,CAAO,EAAE,MAAF,CAAS,IAAT,CAAP,CAFK,EAGL,EAAE,MAAF,CAHK,CAIL,KAJK,CAAP,CADsC;KAA9B;AAOV,aAAS,SAAS,YAAT,CAAsB,GAAtB,EAA2B,KAA3B,EAAkC;AACzC,UAAG,GAAH,EAAQ;AACN,eAAO,EAAE,IAAF,CAAO,EAAE,QAAF,CAAW,CAAC,OAAD,EAAS,KAAT,CAAX,CAAP,EACO,EAAE,OAAF,CAAU,EAAE,IAAF,EAAQ,EAAE,MAAF,CAAS,IAAT,CAAlB,CADP,EAEO,KAFP,CAAP,CADM;OAAR,MAKK;AACH,eAAO,EAAE,IAAF,CAAO,EAAE,QAAF,CAAW,CAAC,OAAD,EAAS,KAAT,CAAX,CAAP,EACO,EAAE,MAAF,CAAS,EAAE,MAAF,CAAS,IAAT,CAAT,CADP,EAEO,KAFP,CAAP,CADG;OALL;KADO;AAYT,aAAS,SAAS,YAAT,CAAsB,KAAtB,EAA6B;AACpC,UAAG,aAAa,UAAb,CAAwB,KAAxB,CAAH,EAAmC;AACjC,eAAO,aAAP,CADiC;OAAnC;AAGA,UAAG,aAAa,SAAb,CAAuB,KAAvB,CAAH,EAAkC;AAChC,eAAO,YAAP,CADgC;OAAlC;AAGA,aAAO,OAAP,CAPoC;KAA7B;AAST,yBAAqB,SAAS,wBAAT,CAAkC,IAAlC,EAAwC,KAAxC,EAA+C;AAClE,aAAO,EAAE,IAAF,CACL,EAAE,KAAF,CAAQ,CAAC,WAAD,EAAc,MAAd,CAAR,CADK,EAEL,EAAE,OAAF,CAAU,aAAa,IAAb,CAAkB,KAAlB,CAAV,CAFK,EAGL,EAAE,MAAF,CAAS,EAAE,KAAF,CAHJ,EAIL,EAAE,IAAF,CAAO,GAAP,CAJK,EAKL,IALK,CAAP,CADkE;KAA/C;GAlHnB,CAlB0C;AA6I9C,WAAS,UAAT,CAAoB,IAApB,EAA0B;AACxB,QAAG,KAAK,IAAL,KAAc,SAAd,EAAyB;AAC1B,aAAO,EAAE,GAAG,CAAH,EAAM,GAAG,CAAH,EAAf,CAD0B;KAA5B;AAGA,WAAO,EAAE,IAAF,CACL,EAAE,IAAF,EACA,EAAE,MAAF,CAAS,EAAE,MAAF,CAAS,MAAT,CAAT,CAFK,EAGL,EAAE,MAAF,CAAS,EAAE,MAAF,CAAS,OAAT,CAAT,CAHK,EAIL,EAAE,MAAF,CAAS,EAAE,MAAF,CAAS,OAAT,CAAT,CAJK,EAKL,EAAE,MAAF,CAAS,EAAE,MAAF,CAAS,OAAT,CAAT,CALK,EAML,EAAE,MAAF,CAAS,UAAS,GAAT,EAAc,GAAd,EAAmB;AAC1B,aAAO,EAAE,KAAF,CAAQ,GAAR,EAAa,EAAE,GAAF,CAAM,EAAE,MAAF,CAAS,CAAT,CAAN,EAAmB,KAAK,GAAL,CAAnB,CAAb,EAA4C,GAA5C,CAAP,CAD0B;KAAnB,EAEN,EAFH,CANK,EASL,EAAE,KAAF,CAAQ,GAAR,EAAa,CAAb,CATK,EAUL,EAAE,KAAF,CAAQ,GAAR,EAAa,CAAb,CAVK,EAWL,IAXK,CAAP,CAJwB;GAA1B;AAiBA,IAAE,MAAF,CACE,YADF,EAEE,iBAAiB,YAAjB,CAFF,EAGE,iBAAiB,YAAjB,CAHF,EAIE,mBAAmB,KAAnB,EAA0B,YAA1B,CAJF,EAKE,oBAAoB,YAApB,CALF,EAME,mBAAmB,YAAnB,CANF,EAOE,mBAAmB,YAAnB,CAPF,EAQE,iBAAiB,YAAjB,CARF,EASE,kBAAkB,YAAlB,CATF,EAUE,wBAAwB,YAAxB,CAVF,EAWE,kBAAkB,YAAlB,CAXF,EAYE,mBAAmB,YAAnB,CAZF,EAaE,kBAAkB,KAAlB,EAAyB,YAAzB,CAbF,EAcE,kBAAkB,YAAlB,CAdF,EAeE,iBAAiB,KAAjB,EAAwB,YAAxB,CAfF,EAgBE,kBAAkB,YAAlB,CAhBF,EAiBE,iBAAiB,YAAjB,CAjBF,EAkBE,kBAAkB,YAAlB,CAlBF,EA9J8C;AAkL9C,IAAE,YAAF,CAAe,YAAf,EAlL8C;AAmL9C,SAAO,YAAP,CAnL8C;CAnBhD,CAtBJ","file":"model.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('model', [\n    'settings',\n    'point',\n    'gameFactions',\n    'modelArea',\n    'modelAura',\n    'modelCharge',\n    'modelCounter',\n    'modelDamage',\n    'modelEffect',\n    'modelGeom',\n    'modelImage',\n    'modelIncorporeal',\n    'modelLabel',\n    'modelLeader',\n    'modelMelee',\n    'modelMove',\n    'modelPlace',\n    'modelRuler',\n    'modelUnit',\n    'modelWreck',\n    function modelServiceFactory(settingsService,\n                                 pointService,\n                                 gameFactionsService,\n                                 modelAreaService,  \n                                 modelAuraService,  \n                                 modelChargeService,  \n                                 modelCounterService,  \n                                 modelDamageService, \n                                 modelEffectService,  \n                                 modelGeomService,  \n                                 modelImageService,\n                                 modelIncorporealService,\n                                 modelLabelService,\n                                 modelLeaderService,\n                                 modelMeleeService,\n                                 modelMoveService,\n                                 modelPlaceService,\n                                 modelRulerService,\n                                 modelUnitService,\n                                 modelWreckService) {\n      let DEFAULT_MOVES = {\n        Move: 10,\n        MoveSmall: 5,\n        Rotate: 15,\n        RotateSmall: 5,\n        Shift: 10,\n        ShiftSmall: 1,\n        RotateCharge: 10,\n        RotateChargeSmall: 2\n      };\n      let MOVES = R.clone(DEFAULT_MOVES);\n      settingsService.register('Moves',\n                               'Model',\n                               DEFAULT_MOVES,\n                               (moves) => {\n                                 R.extend(MOVES, moves);\n                               });\n      var modelService = {\n        create: function modelCreate(factions, temp) {\n          return R.pipeP(\n            gameFactionsService.getModelInfo$(temp.info),\n            (info) => {\n              let model = {\n                state: {\n                  x: 0, y: 0, r: 0,\n                  img: 0,\n                  dsp: ['i'],\n                  eff: [],\n                  l: [],\n                  c: 0, s: 0,\n                  u: null,\n                  aur: null,\n                  are: null,\n                  rml: null,\n                  cml: null,\n                  pml: [null,false],\n                  cha: null,\n                  pla: null,\n                  dmg: initDamage(info.damage),\n                  stamp: R.guid()\n                }\n              };\n              if(info.type === 'wardude' ||\n                 info.type === 'beast' ||\n                 info.type === 'jack') {\n                model.state.dsp = R.append('c', model.state.dsp);\n              }\n              if(info.immovable) {\n                model.state.dsp = R.append('lk', model.state.dsp);\n              }\n              model.state = R.deepExtend(model.state, temp);\n              return modelService.checkState(factions, null, model);\n            }\n          )(factions);\n        },\n        stamp: function modelStamp(model) {\n          return R.path(['state','stamp'], model);\n        },\n        eventName: function modelEventName(model) {\n          return R.path(['state','stamp'], model);\n        },\n        user: function modelUser(model) {\n          return R.path(['state', 'user'], model);\n        },\n        userIs: function modelUser(user, model) {\n          return R.pathEq(['state', 'user'], user, model);\n        },\n        state: function modelState(model) {\n          return R.prop('state', model);\n        },\n        saveState: function modelSaveState(model) {\n          return R.clone(R.prop('state', model));\n        },\n        setState: function modelSetState(state, model) {\n          return R.assoc('state', R.clone(state), model);\n        },\n        state_checkers: [],\n        state_updaters: [],\n        checkState: function modelCheckState(factions, target, model) {\n          return R.pipeP(\n            gameFactionsService.getModelInfo$(model.state.info),\n            (info) => {\n              var radius = info.base_radius;\n              return R.pipe(\n                R.assoc('x', Math.max(0+radius, Math.min(480-radius, model.state.x))),\n                R.assoc('y', Math.max(0+radius, Math.min(480-radius, model.state.y))),\n                (state) => {\n                  return R.reduce((state, checker) => {\n                    return checker(info, target, state);\n                  }, state, modelService.state_checkers);\n                },\n                (state) => {\n                  return R.reduce(function(state, updater) {\n                    return updater(state);\n                  }, state, modelService.state_updaters);\n                }\n              )(model.state);\n            },\n            (state) => {\n              return R.assoc('state', state, model);\n            }\n          )(factions);\n        },\n        isLocked: function modelIsLocked(model) {\n          return R.pipe(\n            R.pathOr([], ['state', 'dsp']),\n            R.find(R.equals('lk')),\n            R.exists\n          )(model);\n        },\n        setLock: function modelSetLock(set, model) {\n          if(set) {\n            return R.over(R.lensPath(['state','dsp']),\n                          R.compose(R.uniq, R.append('lk')),\n                          model);\n          }\n          else {\n            return R.over(R.lensPath(['state','dsp']),\n                          R.reject(R.equals('lk')),\n                          model);\n          }\n        },\n        modeFor: function modelModeFor(model) {\n          if(modelService.isCharging(model)) {\n            return 'ModelCharge';\n          }\n          if(modelService.isPlacing(model)) {\n            return 'ModelPlace';\n          }\n          return 'Model';\n        },\n        descriptionFromInfo: function modelDescriptionFromInfo(info, model) {\n          return R.pipe(\n            R.props(['unit_name', 'name']),\n            R.prepend(modelService.user(model)),\n            R.reject(R.isNil),\n            R.join('/')\n          )(info);\n        }\n      };\n      function initDamage(info) {\n        if(info.type === 'warrior') {\n          return { n: 0, t: 0 };\n        }\n        return R.pipe(\n          R.keys,\n          R.reject(R.equals('type')),\n          R.reject(R.equals('field')),\n          R.reject(R.equals('total')),\n          R.reject(R.equals('depth')),\n          R.reduce(function(mem, key) {\n            return R.assoc(key, R.map(R.always(0), info[key]), mem);\n          }, {}),\n          R.assoc('f', 0),\n          R.assoc('t', 0)\n        )(info);\n      }\n      R.extend(\n        modelService,\n        modelAreaService(modelService),\n        modelAuraService(modelService),\n        modelChargeService(MOVES, modelService),\n        modelCounterService(modelService),\n        modelDamageService(modelService),\n        modelEffectService(modelService),\n        modelGeomService(modelService),\n        modelImageService(modelService),\n        modelIncorporealService(modelService),\n        modelLabelService(modelService),\n        modelLeaderService(modelService),\n        modelPlaceService(MOVES, modelService),\n        modelMeleeService(modelService),\n        modelMoveService(MOVES, modelService),\n        modelRulerService(modelService),\n        modelUnitService(modelService),\n        modelWreckService(modelService)\n      );\n      R.curryService(modelService);\n      return modelService;\n    }\n  ]);\n"]}