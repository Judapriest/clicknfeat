{"version":3,"sources":["model.es6"],"names":[],"mappings":"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","file":"model.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('model', modelModelFactory);\n\n  modelModelFactory.$inject = [\n    'settings',\n    'element',\n    'gameFactions',\n    'modelArea',\n    'modelAura',\n    'modelCharge',\n    'modelCounter',\n    'modelDamage',\n    'modelEffect',\n    'modelGeom',\n    'modelImage',\n    'modelIncorporeal',\n    'modelLabel',\n    'modelLeader',\n    'modelMelee',\n    'modelMove',\n    'modelPlace',\n    'modelRuler',\n    'modelUnit',\n    'modelWreck',\n  ];\n  function modelModelFactory(settingsModel,\n                             elementModel,\n                             gameFactionsModel,\n                             modelAreaModel,\n                             modelAuraModel,\n                             modelChargeModel,\n                             modelCounterModel,\n                             modelDamageModel,\n                             modelEffectModel,\n                             modelGeomModel,\n                             modelImageModel,\n                             modelIncorporealModel,\n                             modelLabelModel,\n                             modelLeaderModel,\n                             modelMeleeModel,\n                             modelMoveModel,\n                             modelPlaceModel,\n                             modelUnitModel,\n                             modelWreckModel,\n                             modelRulerModel) {\n    const DEFAULT_MOVES = {\n      Move: 10,\n      MoveSmall: 5,\n      Rotate: 15,\n      RotateSmall: 5,\n      Shift: 10,\n      ShiftSmall: 1,\n      RotateCharge: 10,\n      RotateChargeSmall: 2\n    };\n    const MOVES = R.clone(DEFAULT_MOVES);\n    settingsModel.register('Misc',\n                           'Model',\n                           DEFAULT_MOVES,\n                           (moves) => {\n                             R.extend(MOVES, moves);\n                           });\n\n    const base = elementModel('model', MOVES);\n    const modelModel = Object.create(base);\n    R.deepExtend(\n      modelModel, {\n        createP: modelCreateP,\n        state_checkers: [],\n        state_updaters: [],\n        checkStateP: modelCheckStateP,\n        descriptionFromInfo: modelDescriptionFromInfo,\n        user: modelUser,\n        userIs: modelUserIs,\n        modeFor: modelModeFor\n      },\n      modelAreaModel(modelModel),\n      modelAuraModel(modelModel),\n      modelChargeModel(MOVES, modelModel),\n      modelCounterModel(modelModel),\n      modelDamageModel(modelModel),\n      modelEffectModel(modelModel),\n      modelGeomModel(modelModel),\n      modelImageModel(modelModel),\n      modelIncorporealModel(modelModel),\n      modelLeaderModel(modelModel),\n      modelMeleeModel(modelModel),\n      modelMoveModel(MOVES, modelModel),\n      modelPlaceModel(MOVES, modelModel),\n      modelRulerModel(modelModel),\n      modelUnitModel(modelModel),\n      modelWreckModel(modelModel)\n    );\n\n    R.curryService(modelModel);\n    return modelModel;\n\n    function modelCreateP(factions, temp) {\n      return R.threadP(factions)(\n        gameFactionsModel.getModelInfoP$(temp.info),\n        (info) => {\n          const model = {\n            state: {\n              x: 0, y: 0, r: 0,\n              img: 0,\n              dsp: ['i'],\n              eff: [],\n              l: [],\n              c: 0, s: 0,\n              u: null,\n              aur: null,\n              are: null,\n              rml: null,\n              cml: null,\n              pml: [null,false],\n              cha: null,\n              pla: null,\n              dmg: initDamage(info.damage),\n              stamp: R.guid()\n            }\n          };\n          if(info.type === 'wardude' ||\n             info.type === 'beast' ||\n             info.type === 'jack') {\n            model.state.dsp = R.append('c', model.state.dsp);\n          }\n          if(info.immovable) {\n            model.state.lk = true;\n          }\n          model.state = R.deepExtend(model.state, temp);\n          return modelModel.checkStateP(factions, null, model);\n        }\n      );\n    }\n    function modelUser(model) {\n      return R.path(['state', 'user'], model);\n    }\n    function modelUserIs(user, model) {\n      return R.pathEq(['state', 'user'], user, model);\n    }\n    function modelCheckStateP(factions, target, model) {\n      return R.threadP(factions)(\n        gameFactionsModel.getModelInfoP$(model.state.info),\n        (info) => {\n          const radius = info.base_radius;\n          return R.thread(model.state)(\n            R.assoc('x', Math.max(0+radius, Math.min(480-radius, model.state.x))),\n            R.assoc('y', Math.max(0+radius, Math.min(480-radius, model.state.y))),\n            (state) => R.reduce((state, checker) => {\n              return checker(info, target, state);\n            }, state, modelModel.state_checkers),\n            (state) => R.reduce(function(state, updater) {\n              return updater(state);\n            }, state, modelModel.state_updaters)\n          );\n        },\n        (state) => R.assoc('state', state, model)\n      );\n    }\n    function modelModeFor(model) {\n      if(modelModel.isCharging(model)) {\n        return 'ModelCharge';\n      }\n      if(modelModel.isPlacing(model)) {\n        return 'ModelPlace';\n      }\n      return 'Model';\n    }\n    function modelDescriptionFromInfo(info, model) {\n      return R.thread(info)(\n        R.props(['unit_name', 'name']),\n        R.prepend(modelModel.user(model)),\n        R.reject(R.isNil),\n        R.join('/')\n      );\n    }\n    function initDamage(info) {\n      if(info.type === 'warrior') {\n        return { n: 0, t: 0 };\n      }\n      return R.thread(info)(\n        R.keys,\n        R.reject(R.equals('type')),\n        R.reject(R.equals('field')),\n        R.reject(R.equals('total')),\n        R.reject(R.equals('depth')),\n        R.reduce((mem, key) => {\n          return R.assoc(key, R.map(R.always(0), info[key]), mem);\n        }, {}),\n        R.assoc('f', 0),\n        R.assoc('t', 0)\n      );\n    }\n  }\n})();\n"]}