{"version":3,"sources":["model.es6"],"names":[],"mappings":"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","file":"model.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('model', modelModelFactory);\n\n  modelModelFactory.$inject = [\n    'settings',\n    'element',\n    'gameFactions',\n    'modelArea',\n    'modelAura',\n    'modelCharge',\n    'modelCounter',\n    'modelDamage',\n    'modelEffect',\n    'modelGeom',\n    'modelImage',\n    'modelIncorporeal',\n    'modelLeader',\n    'modelMelee',\n    'modelMove',\n    'modelPlace',\n    'modelRuler',\n    'modelUnit',\n    'modelWreck',\n  ];\n  function modelModelFactory(settingsModel,\n                             elementModel,\n                             gameFactionsModel,\n                             modelAreaModel,\n                             modelAuraModel,\n                             modelChargeModel,\n                             modelCounterModel,\n                             modelDamageModel,\n                             modelEffectModel,\n                             modelGeomModel,\n                             modelImageModel,\n                             modelIncorporealModel,\n                             modelLeaderModel,\n                             modelMeleeModel,\n                             modelMoveModel,\n                             modelPlaceModel,\n                             modelUnitModel,\n                             modelWreckModel,\n                             modelRulerModel) {\n    const USER_LENS = R.lensPath(['state','user']);\n    const DEFAULT_MOVES = {\n      Move: 10,\n      MoveSmall: 5,\n      Rotate: 15,\n      RotateSmall: 5,\n      Shift: 10,\n      ShiftSmall: 1,\n      RotateCharge: 10,\n      RotateChargeSmall: 2\n    };\n    const MOVES = R.clone(DEFAULT_MOVES);\n    settingsModel.register('Misc',\n                           'Model',\n                           DEFAULT_MOVES,\n                           (moves) => {\n                             R.extend(MOVES, moves);\n                           });\n\n    const base = elementModel('model', MOVES);\n    const modelModel = Object.create(base);\n    R.deepExtend(\n      modelModel, {\n        create: modelCreate,\n        state_checkers: [],\n        state_updaters: [],\n        checkState: modelCheckState,\n        descriptionFromInfo: modelDescriptionFromInfo,\n        user: modelUser,\n        userIs: modelUserIs,\n        modeFor: modelModeFor,\n        render: modelRender\n      },\n      modelAreaModel(modelModel),\n      modelAuraModel(modelModel),\n      modelChargeModel(MOVES, modelModel),\n      modelCounterModel(modelModel),\n      modelDamageModel(modelModel),\n      modelEffectModel(modelModel),\n      modelGeomModel(modelModel),\n      modelImageModel(modelModel),\n      modelIncorporealModel(modelModel),\n      modelLeaderModel(modelModel),\n      modelMeleeModel(modelModel),\n      modelMoveModel(MOVES, modelModel),\n      modelPlaceModel(MOVES, modelModel),\n      modelRulerModel(modelModel),\n      modelUnitModel(modelModel),\n      modelWreckModel(modelModel)\n    );\n\n    R.curryService(modelModel);\n    return modelModel;\n\n    function modelCreate(factions, temp) {\n      return R.thread(factions)(\n        gameFactionsModel.getModelInfo$(temp.info),\n        R.unless(\n          R.isNil,\n          (info) => {\n            const model = {\n              info,\n              state: {\n                x: 0, y: 0, r: 0,\n                img: 0,\n                dsp: ['i'],\n                eff: [],\n                l: [],\n                c: 0, s: 0,\n                u: null,\n                aur: null,\n                are: null,\n                rml: null,\n                cml: null,\n                pml: [null,false],\n                cha: null,\n                pla: null,\n                dmg: initDamage(info.damage),\n                stamp: R.guid()\n              }\n            };\n            if(model.info.type === 'wardude' ||\n               model.info.type === 'beast' ||\n               model.info.type === 'jack') {\n              model.state.dsp = R.append('c', model.state.dsp);\n            }\n            if(model.info.immovable) {\n              model.state.lk = true;\n            }\n            model.state = R.deepExtend(model.state, temp);\n            return modelModel.checkState(null, model);\n          }\n        )\n      );\n    }\n    function modelUser(model) {\n      return R.view(USER_LENS, model);\n    }\n    function modelUserIs(user, model) {\n      return R.equals(user, R.view(USER_LENS, model));\n    }\n    function modelCheckState(target, model) {\n      const info = model.info;\n      const radius = info.base_radius;\n      const state = R.thread(model.state)(\n        R.assoc('x', Math.max(0+radius, Math.min(480-radius, model.state.x))),\n        R.assoc('y', Math.max(0+radius, Math.min(480-radius, model.state.y))),\n        (state) => R.reduce((state, checker) => {\n          return checker(target, info, state);\n        }, state, modelModel.state_checkers),\n        (state) => R.reduce((state, updater) => {\n          return updater(state);\n        }, state, modelModel.state_updaters)\n      );\n      return R.assoc('state', state, model);\n    }\n    function modelModeFor(model) {\n      if(modelModel.isCharging(model)) {\n        return 'ModelCharge';\n      }\n      if(modelModel.isPlacing(model)) {\n        return 'ModelPlace';\n      }\n      return 'Model';\n    }\n    function modelDescriptionFromInfo(model) {\n      return R.thread(model.info)(\n        R.props(['unit_name', 'name']),\n        R.prepend(modelModel.user(model)),\n        R.reject(R.isNil),\n        R.join('/')\n      );\n    }\n    function initDamage(info) {\n      if(info.type === 'warrior') {\n        return { n: 0, t: 0 };\n      }\n      return R.thread(info)(\n        R.keys,\n        R.reject(R.equals('type')),\n        R.reject(R.equals('field')),\n        R.reject(R.equals('total')),\n        R.reject(R.equals('depth')),\n        R.reduce((mem, key) => {\n          return R.assoc(key, R.map(R.always(0), info[key]), mem);\n        }, {}),\n        R.assoc('f', 0),\n        R.assoc('t', 0)\n      );\n    }\n    function modelRender({ is_flipped, charge_target }, model) {\n      const state = model.state;\n      const info = model.info;\n      const is_wreck = modelModel.isWreckDisplayed(model);\n      const img = (is_wreck\n                   ? modelModel.getWreckImage(model)\n                   : modelModel.getImage(model));\n      const cx = img.width / 2;\n      const cy = img.height / 2;\n      const radius = info.base_radius;\n      const dx = cx;\n      const dy = cy - info.base_radius;\n      const frx = cx - info.base_radius;\n      const flx = cx + info.base_radius;\n      const los = {\n        dy: cy - 700,\n        lx: cx - 700,\n        rx: cx + 700\n      };\n      const lock = {\n        show: modelModel.isLocked(model),\n        x: cx + radius - 5,\n        y: cy - 5\n      };\n      const path = { show: false, x: 0, y: 0, transform: '', length: {} };\n      let r = state.r % 360;\n      r = r > 0 ? r : 360 + r;\n      const text_y_top = cx + radius + 8;\n      const text_y_bottom = cx - radius - 2;\n      const text_center_y = ( r > 90 && r < 270\n                              ? (is_flipped ? text_y_bottom : text_y_top)\n                              : (is_flipped ? text_y_top : text_y_bottom)\n                            );\n      const label_options = {\n        flipped: is_flipped,\n        flip_center: { x: cx, y: cy },\n        text_center: { x: cx, y: text_center_y }\n      };\n      const label = base\n              .renderLabel(label_options, model);\n      return R.deepExtend(\n        {\n          stamp: state.stamp,\n          x: state.x, y: state.y,\n          transform: [ `translate(${state.x-cx},${state.y-cy})`,\n                       `rotate(${state.r},${cx},${cy})`\n                     ].join(' '),\n          cx, cy, radius, dx, dy, frx, flx, los,\n          width: img.width, height: img.height,\n          base_color: info.base_color,\n          title: modelModel.descriptionFromInfo(model),\n          label_transform: `translate(${state.x-cx},${state.y-cy})`,\n          label, lock, path\n        },\n        modelModel.renderArea(model),\n        modelModel.renderAura(model),\n        modelModel.renderCharge({ base, charge_target, is_flipped }, path, model),\n        modelModel.renderCounter({ base, cx, cy, is_flipped }, model),\n        modelModel.renderDamage({ cx, cy }, model),\n        modelModel.renderEffect({ img }, model),\n        modelModel.renderImage({ img }, model),\n        modelModel.renderLeader({ cx, cy }, model),\n        modelModel.renderMelee({ img }, model),\n        modelModel.renderPlace({ base, path }, model),\n        modelModel.renderUnit({ base, cx, cy }, model)\n      );\n    }\n  }\n})();\n"]}