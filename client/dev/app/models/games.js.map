{"version":3,"sources":["games.es6"],"names":[],"mappings":"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","file":"games.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('games', gamesModelFactory);\n\n  gamesModelFactory.$inject = [\n    'localStorage',\n    'http',\n    'game',\n  ];\n  function gamesModelFactory(localStorageService,\n                             httpService,\n                             gameModel) {\n    const LOCAL_GAME_STORAGE_KEY = 'clickApp.game.';\n    const gamesModel = {\n      loadLocalGamesP: gamesLoadLocalGamesP,\n      saveLocalGame: gamesSaveLocalGame,\n      loadLocalGameP: gamesLoadLocalGameP,\n      newLocalGame: gamesNewLocalGame,\n      removeLocalGame: gamesRemoveLocalGame,\n      updateLocalGame: gamesUpdateLocalGame,\n      newOnlineGameP: gamesNewOnlineGameP,\n      loadOnlineGameP: gamesLoadOnlineGameP\n    };\n    R.curryService(gamesModel);\n    return gamesModel;\n\n    function gamesLoadLocalGamesP() {\n      return R.threadP(localStorageService.keys())(\n        R.filter((k) => k.startsWith(LOCAL_GAME_STORAGE_KEY)),\n        R.map((k) => localStorageService\n              .loadP(k)\n              .catch(R.spyAndDiscardError('GamesModel: Failed to load local game', k))),\n        R.allP,\n        R.reject(R.isNil),\n        R.defaultTo([]),\n        R.spyWarn('Games local load')\n      );\n    }\n    function gamesSaveLocalGame(game) {\n      const key = LOCAL_GAME_STORAGE_KEY+game.local_stamp;\n      console.warn('Game save', key, game);\n      return localStorageService\n        .save(key, game);\n    }\n    function gamesLoadLocalGameP(id) {\n      const key = LOCAL_GAME_STORAGE_KEY+id;\n      console.warn('Game load', key);\n      return localStorageService\n        .loadP(key);\n    }\n    function gamesNewLocalGame(game, games) {\n      return R.thread(game)(\n        R.assoc('local_stamp', R.guid()),\n        gamesModel.saveLocalGame,\n        R.append(R.__, games)\n      );\n    }\n    function gamesRemoveLocalGame(id, games) {\n      return R.thread(LOCAL_GAME_STORAGE_KEY+id)(\n        localStorageService.removeItem,\n        () => R.reject(R.propEq('local_stamp', id), games)\n      );\n    }\n    function gamesUpdateLocalGame(game, games) {\n      const game_index =\n              R.findIndex(R.propEq('local_stamp', game.local_stamp),\n                          games);\n      return R.thread(game)(\n        gamesModel.saveLocalGame,\n        () => R.update(game_index, game, games)\n      );\n    }\n    function gamesNewOnlineGameP(game) {\n      return R.threadP(game)(\n        gameModel.pickForJson,\n        R.spyWarn('upload game'),\n        httpService.postP$('/api/games'),\n        R.spyWarn('upload game response')\n      );\n    }\n    function gamesLoadOnlineGameP(is_private, id) {\n      const url = [\n        '/api/games',\n        (is_private ? 'private' : 'public'),\n        id\n      ].join('/');\n      return R.threadP(url)(\n        httpService.getP,\n        R.spyWarn('Games: load online game')\n      );\n    }\n  }\n})();\n"]}