{"version":3,"sources":["games.es6"],"names":[],"mappings":"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","file":"games.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('games', [\n    'localStorage',\n    'http',\n    'game',\n    function gamesServiceFactory(localStorageService,\n                                 httpService,\n                                 gameService) {\n      var LOCAL_GAME_STORAGE_KEY = 'clickApp.game.';\n      var gamesService = {\n        loadLocalGames: function gamesLoadLocalGames() {\n          return R.pipePromise(\n            R.always(localStorageService.keys()),\n            R.filter((k) => { return k.startsWith(LOCAL_GAME_STORAGE_KEY); }),\n            R.map((k) => {\n              return localStorageService\n                .load(k)\n                .catch(R.spy('games: Failed to load local game', k));\n            }),\n            R.promiseAll,\n            R.reject(R.isNil),\n            R.defaultTo([]),\n            R.spyWarn('Games local load')\n          )();\n        },\n        saveLocalGame: function gamesSaveLocalGame(game) {\n          let key = LOCAL_GAME_STORAGE_KEY+game.local_stamp;\n          console.warn('Game save', key, game);\n          return localStorageService\n            .save(key, game);\n        },\n        loadLocalGame: function gamesLoadLocalGame(id) {\n          let key = LOCAL_GAME_STORAGE_KEY+id;\n          console.warn('Game load', key);\n          return localStorageService\n            .load(key);\n        },\n        newLocalGame: function gamesNewLocalGame(game, games) {\n          return R.pipePromise(\n            R.always(game),\n            R.assoc('local_stamp', R.guid()),\n            gamesService.saveLocalGame,\n            R.flip(R.append)(games)\n          )();\n        },\n        removeLocalGame: function gamesRemoveLocalGame(id, games) {\n          return R.pipePromise(\n            R.always(LOCAL_GAME_STORAGE_KEY+id),\n            localStorageService.removeItem,\n            R.always(games),\n            R.reject(R.propEq('local_stamp', id))\n          )();\n        },\n        updateLocalGame: function gamesUpdateLocalGame(game, games) {\n          return R.pipePromise(\n            R.always(game),\n            gamesService.saveLocalGame,\n            R.always(games),\n            R.update(R.findIndex(R.propEq('local_stamp', game.local_stamp), games),\n                     game)\n          )();\n        },\n        newOnlineGame: function gamesNewOnlineGame(game) {\n          return R.pipePromise(\n            gameService.pickForJson,\n            R.spyWarn('upload game'),\n            httpService.post$('/api/games'),\n            R.spyWarn('upload game response')\n          )(game);\n        },\n        loadOnlineGame: function gamesLoadOnlineGame(is_private, id) {\n          var url = [\n            '/api/games',\n            (is_private ? 'private' : 'public'),\n            id\n          ].join('/');\n          return R.pipeP(\n            httpService.get,\n            R.spyError('Games: load online game')\n          )(url);\n        }\n      };\n      R.curryService(gamesService);\n      return gamesService;\n    }\n  ]);\n"]}