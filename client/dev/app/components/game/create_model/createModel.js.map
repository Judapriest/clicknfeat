{"version":3,"sources":["createModel.es6"],"names":[],"mappings":";;AAAA,CAAC,YAAW;AACV,UAAQ,MAAR,CAAe,qBAAf,EACG,SADH,CACa,sBADb,EACqC,+BADrC,EADU;;AAIV,kCAAgC,OAAhC,GAA0C,CACxC,YADwC,EAExC,SAFwC,EAGxC,cAHwC,EAIxC,SAJwC,EAKxC,OALwC,CAA1C,CAJU;AAWV,WAAS,+BAAT,CAAyC,UAAzC,EACyC,cADzC,EAEyC,iBAFzC,EAGyC,cAHzC,EAIyC,UAJzC,EAIqD;AACnD,QAAM,2BAA2B;AAC/B,gBAAU,GAAV;AACA,mBAAa,oDAAb;AACA,YAAM,IAAN;KAHI,CAD6C;AAMnD,WAAO,wBAAP,CANmD;;AAQnD,aAAS,IAAT,CAAc,KAAd,EAAqB;AACnB,cAAQ,GAAR,CAAY,kBAAZ,EAAgC,MAAM,KAAN,CAAhC,CADmB;;AAGnB,UAAM,OAAO,kBACJ,YADI,CACS,MAAM,KAAN,CAAY,IAAZ,EACA,WAAW,KAAX,CAAiB,QAAjB,CAFhB,CAHa;AAMnB,YAAM,QAAN,CAAe,cAAf,EAA+B,eAAe,MAAf,EAAuB,KAAtD,EANmB;;AAQnB,eAAS,cAAT,CAAwB,MAAxB,EAAgC;AAC9B,YAAG,EAAE,KAAF,CAAQ,MAAR,KACA,EAAE,KAAF,CAAQ,EAAE,IAAF,CAAO,QAAP,EAAiB,MAAjB,CAAR,CADA,EACmC,OADtC;AAEA,kBAAU,KAAV,EAAiB,IAAjB,EAAuB,MAAvB,EAH8B;OAAhC;KARF;AAcA,aAAS,SAAT,CAAmB,KAAnB,EAA0B,IAA1B,EAAgC,MAAhC,EAAwC;AACtC,UAAM,MAAM,SAAS,cAAT,CAAwB,KAAxB,CAAN,CADgC;AAEtC,UAAM,OAAO,EAAE,MAAF,CAAS,EAAE,GAAG,CAAH,EAAM,GAAG,CAAH,EAAjB,EAAyB,MAAzB,EAAiC,MAAjC,CAAP,CAFgC;AAGtC,UAAM,QAAQ,MAAM,KAAN,CAHwB;AAItC,UAAM,aAAa,eAAe,SAAf,CAAyB,GAAzB,CAAb,CAJgC;AAKtC,UAAM,QAAQ,aAAa,CAAC,CAAD,GAAK,CAAlB,CALwB;AAMtC,YAAM,MAAN,GAAe,WAAW,MAAX,CAAkB,EAAC,sBAAD,EAAlB,EAAgC;AAC7C,kBAD6C;AAE7C,eAAO,EAAE,MAAF,CAAS,KAAT,EACL,EAAE,KAAF,CAAQ,GAAR,EAAa,KAAK,CAAL,GAAS,QAAQ,MAAM,CAAN,CADzB,EAEL,EAAE,KAAF,CAAQ,GAAR,EAAa,KAAK,CAAL,GAAS,QAAQ,MAAM,CAAN,CAFzB,CAAP;OAFa,CAAf,CANsC;AAatC,cAAQ,IAAR,CAAa,oBAAb,EAAmC,MAAM,MAAN,CAAnC,CAbsC;KAAxC;GA1BF;CAXD,CAAD","file":"createModel.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .directive('clickGameCreateModel', gameCreateModelDirectiveFactory);\n\n  gameCreateModelDirectiveFactory.$inject = [\n    '$rootScope',\n    'appGame',\n    'gameFactions',\n    'gameMap',\n    'model',\n  ];\n  function gameCreateModelDirectiveFactory($rootScope,\n                                           appGameService,\n                                           gameFactionsModel,\n                                           gameMapService,\n                                           modelModel) {\n    const gameCreateModelDirective = {\n      restrict: 'A',\n      templateUrl: 'app/components/game/create_model/create_model.html',\n      link: link\n    };\n    return gameCreateModelDirective;\n\n    function link(scope) {\n      console.log('clickCreateModel', scope.model);\n\n      const info = gameFactionsModel\n              .getModelInfo(scope.model.info,\n                            $rootScope.state.factions);\n      scope.bindCell(onCreateUpdate, appGameService.create, scope);\n\n      function onCreateUpdate(create) {\n        if(R.isNil(create) ||\n           R.isNil(R.prop('models', create))) return;\n        setRender(scope, info, create);\n      }\n    }\n    function setRender(scope, info, create) {\n      const map = document.getElementById('map');\n      const base = R.propOr({ x: 0, y: 0 }, 'base', create);\n      const model = scope.model;\n      const is_flipped = gameMapService.isFlipped(map);\n      const coeff = is_flipped ? -1 : 1;\n      scope.render = modelModel.render({is_flipped}, {\n        info,\n        state: R.thread(model)(\n          R.assoc('x', base.x + coeff * model.x),\n          R.assoc('y', base.y + coeff * model.y)\n        )\n      });\n      console.warn('createModel.update', scope.render);\n    }\n  }\n})();\n"]}