{"version":3,"sources":["gameRuler.es6"],"names":[],"mappings":"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","file":"gameRuler.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .directive('clickGameRuler', gameRulerDirectiveFactory);\n\n  gameRulerDirectiveFactory.$inject = [\n    'appGame',\n    'appModes',\n    'gameRuler',\n    'gameModels',\n    'modes',\n  ];\n  function gameRulerDirectiveFactory(appGameService,\n                                     appModesService,\n                                     gameRulerModel,\n                                     gameModelsModel,\n                                     modesModel) {\n    return {\n      restrict: 'A',\n      scope: true,\n      templateUrl: 'app/components/game/ruler/ruler.html',\n      link: link\n    };\n    function link(scope) {\n      scope.listenSignal(updateRuler, appGameService.ruler.changes, scope);\n\n      mount();\n\n      function mount() {\n        const modes = appModesService.modes.sample();\n        const models = appGameService.models.models.sample();\n        const ruler = appGameService.ruler.ruler.sample();\n\n        updateRuler([modes, models, false, ruler]);\n      }\n      function updateRuler([modes, models, flipped, ruler]) {\n        const label_center = {\n          x: (ruler.remote.end.x - ruler.remote.start.x) / 2 + ruler.remote.start.x,\n          y: (ruler.remote.end.y - ruler.remote.start.y) / 2 + ruler.remote.start.y\n        };\n        scope.render = {\n          local: { show: ruler.local.display,\n                   x1: ruler.local.start.x,\n                   y1: ruler.local.start.y,\n                   x2: ruler.local.end.x,\n                   y2: ruler.local.end.y\n                 },\n          remote: { show: ruler.remote.display,\n                    x1: ruler.remote.start.x,\n                    y1: ruler.remote.start.y,\n                    x2: ruler.remote.end.x,\n                    y2: ruler.remote.end.y\n                  },\n          label: renderText({ flipped,\n                              flip_center: label_center,\n                              text_center: label_center\n                            }, ruler.remote.length)\n        };\n        scope.render.label.show = ruler.remote.display;\n        const in_ruler_mode = modesModel.currentModeName(modes) === 'Ruler';\n        scope.render.origin =\n          updateOrigin(models, in_ruler_mode, ruler.remote);\n        scope.render.target =\n          updateTarget(models, in_ruler_mode, ruler.remote);\n        console.warn('RENDER RULER', arguments, scope.render);\n      }\n    }\n    function renderText({ rotate = 0,\n                          flipped = false,\n                          flip_center = { x: 240, y: 240 },\n                          text_center = { x: 240, y: 240 },\n                        }, text) {\n      text += '';\n      rotate += (flipped ? 180 : 0);\n      const transform = `rotate(${rotate},${flip_center.x},${flip_center.y})`;\n      const x = text_center.x;\n      const y = text_center.y;\n      const bkg_width = R.length(text) * 5;\n      const bkg_x = text_center.x - bkg_width / 2;\n      const bkg_y = text_center.y - 5;\n      return {\n        text,\n        x, y, transform,\n        bkg_x, bkg_y, bkg_width\n      };\n    }\n    function updateOrigin(models, in_ruler_mode, remote) {\n      if(R.isNil(remote.origin) ||\n         (!remote.display && !in_ruler_mode)) return null;\n\n      const origin_model = gameModelsModel\n              .findStamp(remote.origin, models);\n      if(R.isNil(origin_model)) return null;\n\n      const origin_info = origin_model.info;\n      return {\n        cx: origin_model.state.x,\n        cy: origin_model.state.y,\n        radius: origin_info.base_radius\n      };\n    }\n    function updateTarget(models, in_ruler_mode, remote) {\n      if(R.isNil(remote.target) ||\n         (!remote.display && !in_ruler_mode)) return null;\n\n      const target_model = gameModelsModel\n              .findStamp(remote.target, models);\n      if(R.isNil(target_model)) return null;\n\n      const target_info = target_model.info;\n      const reached = gameRulerModel.targetReached({ remote });\n      return {\n        cx: target_model.state.x,\n        cy: target_model.state.y,\n        radius: target_info.base_radius,\n        reached\n      };\n    }\n  }\n})();\n"]}