{"version":3,"sources":["editLabel.es6"],"names":[],"mappings":"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","file":"editLabel.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .controller('clickGameEditLabelCtrl', gameEditLabelCtrl)\n    .directive('clickGameEditLabel', gameEditLabelDirectiveFactory);\n\n  gameEditLabelCtrl.$inject = [\n    '$scope',\n  ];\n  function gameEditLabelCtrl($scope) {\n    const vm = this;\n    console.log('init clickGameEditLabelCtrl');\n\n    vm.new_label = '';\n    vm.doAddLabel = doAddLabel;\n\n    function doAddLabel() {\n      const new_label = s.trim(vm.new_label);\n      if(R.length(new_label) === 0) return;\n\n      $scope\n        .stateEvent('Game.command.execute',\n                    vm.cmd, [\n                      'addLabel',\n                      [new_label],\n                      [vm.selection.state.stamp]\n                    ]);\n      vm.new_label = '';\n      vm.doClose();\n    }\n  }\n\n  gameEditLabelDirectiveFactory.$inject = [\n    'gameMap',\n  ];\n  function gameEditLabelDirectiveFactory(gameMapService) {\n    return {\n      restrict: 'A',\n      templateUrl: 'app/components/game/edit_label/edit_label.html',\n      scope: true,\n      controller: 'clickGameEditLabelCtrl',\n      controllerAs: 'edit_label',\n      link: link\n    };\n\n    function link(scope, element) {\n      console.log('gameEditLabel');\n      const map = document.getElementById('map');\n      const container = element[0];\n      const input = container.querySelector('input');\n\n      closeEditLabel();\n      scope.onStateChangeEvent('Game.editLabel.open', openEditLabel, scope);\n      scope.onStateChangeEvent('Game.editLabel.close', closeEditLabel, scope);\n      input.addEventListener('keydown', closeOnEscape);\n      scope.edit_label.doRefresh = refreshEditLabel;\n      scope.edit_label.doClose = closeEditLabel;\n\n      function closeOnEscape(event) {\n        if(event.keyCode === 27) { // ESC\n          closeEditLabel();\n          event.preventDefault();\n        }\n      }\n      function closeEditLabel() {\n        // console.log('closeEditLabel');\n        scope.edit_label.selection = {};\n\n        container.style.display = 'none';\n        container.style.visibility = 'hidden';\n        container.style.left = 0+'px';\n        container.style.top = 0+'px';\n      }\n      function openEditLabel(_event_, [cmd, selection]) {\n        // console.log('openEditLabel');\n        scope.edit_label.cmd = cmd;\n        scope.edit_label.selection = selection;\n        scope.edit_label.new_label = '';\n        scope.$digest();\n\n        self.window.requestAnimationFrame(displayEditLabel);\n      }\n      function displayEditLabel() {\n        container.style.display = 'initial';\n        container.style.visibility = 'hidden';\n        setEditLabelWidth();\n\n        self.window.requestAnimationFrame(showEditLabel);\n      }\n      function showEditLabel() {\n        placeEditLabel();\n        container.style.visibility = 'visible';\n\n        self.window.requestAnimationFrame(() => {\n          input.focus();\n        });\n      }\n      function refreshEditLabel() {\n        setEditLabelWidth();\n\n        self.window.requestAnimationFrame(placeEditLabel);\n      }\n      function placeEditLabel() {\n        const detail_rect = input.getBoundingClientRect();\n        const screen_pos = gameMapService\n                .mapToScreenCoordinates(map, scope.edit_label.selection.state);\n\n        container.style.left = (screen_pos.x - detail_rect.width / 2) + 'px';\n        container.style.top = (screen_pos.y - detail_rect.height / 2) + 'px';\n      }\n      function setEditLabelWidth() {\n        input.style.width = R.length(scope.edit_label.new_label) + 'em';\n      }\n    }\n  }\n})();\n"]}