{"version":3,"sources":["editLabel.es6"],"names":[],"mappings":"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","file":"editLabel.js","sourcesContent":["angular.module('clickApp.controllers')\n  .controller('clickGameEditLabelCtrl', [\n    '$scope',\n    function($scope) {\n      console.log('init clickGameEditLabelCtrl');\n\n      $scope.edit = { label: '' };\n\n      $scope.doAddLabel = function doAddLabel() {\n        var new_label = s.trim($scope.edit.label);\n        if(R.length(new_label) === 0) return;\n\n        $scope.stateEvent('Game.command.execute',\n                          'onModels', [ 'addLabel',\n                                        [new_label],\n                                        [$scope.selection.state.stamp]\n                                      ])\n          .then(() => {\n            $scope.edit.label = '';\n            $scope.doClose();\n            $scope.$digest();\n          });\n      };\n    }\n  ]);\n\nangular.module('clickApp.directives')\n  .directive('clickGameEditLabel', [\n    '$window',\n    'gameMap',\n    function($window,\n             gameMapService) {\n      return {\n        restrict: 'A',\n        template: [ '<form ng-submit=\"doAddLabel()\">',\n                    '<input type=\"text\" ng-model=\"edit.label\" ng-change=\"doRefresh()\" />',\n                    '</form>'\n                  ].join(''),\n        scope: true,\n        controller: 'clickGameEditLabelCtrl',\n        link: function(scope, element) {\n          console.log('gameEditLabel');\n          let map = document.getElementById('map');\n          let input = element[0].querySelector('input');\n\n          closeEditLabel();\n\n          function closeEditLabel() {\n            // console.log('closeEditLabel');\n\n            scope.selection = {};\n\n            element[0].style.display = 'none';\n            element[0].style.visibility = 'hidden';\n            element[0].style.left = 0+'px';\n            element[0].style.top = 0+'px';\n          }\n          function openEditLabel(event, selection) {\n            // console.log('openEditLabel');\n\n            scope.selection = selection;\n            scope.edit = { label: '' };\n            scope.$digest();\n\n            $window.requestAnimationFrame(displayEditLabel);\n          }\n          function displayEditLabel() {\n            element[0].style.display = 'initial';\n            element[0].style.visibility = 'hidden';\n            setEditLabelWidth();\n\n            $window.requestAnimationFrame(showEditLabel);\n          }\n          function showEditLabel() {\n            placeEditLabel();\n            element[0].style.visibility = 'visible';\n\n            $window.requestAnimationFrame(() => {\n              input.focus();\n            });\n          }\n          function refreshEditLabel() {\n            setEditLabelWidth();\n\n            $window.requestAnimationFrame(placeEditLabel);\n          }\n          function placeEditLabel() {\n            var detail_rect = input.getBoundingClientRect();\n            var screen_pos = gameMapService\n                  .mapToScreenCoordinates(map, scope.selection.state);\n\n            element[0].style.left = (screen_pos.x - detail_rect.width / 2) + 'px';\n            element[0].style.top = (screen_pos.y - detail_rect.height / 2) + 'px';\n          }\n          function setEditLabelWidth() {\n            input.style.width = R.length(scope.edit.label) + 'em';\n          }\n\n          scope.onStateChangeEvent('Game.editLabel.open', openEditLabel, scope);\n          scope.onStateChangeEvent('Game.editLabel.close', closeEditLabel, scope);\n          input.addEventListener('keydown', (event) => {\n            console.log('toto',event);\n            if(event.keyCode === 27) { // ESC\n              closeEditLabel();\n            }\n          });\n\n          scope.doRefresh = refreshEditLabel;\n          scope.doClose = closeEditLabel;\n        }\n      };\n    }\n  ]);\n"]}