{"version":3,"sources":["model.es6"],"names":[],"mappings":"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","file":"model.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .directive('clickGameModel', gameModelDirectiveFactory)\n    .directive('clickGameModelsList', gameModelsListDirectiveFactory);\n\n  gameModelDirectiveFactory.$inject = [\n    'gameMap',\n    'gameFactions',\n    'gameModels',\n    'gameModelSelection',\n    'gameScenario',\n    'model',\n    'labelElement',\n    'clickGameModelArea',\n    'clickGameModelAura',\n    'clickGameModelBase',\n    'clickGameModelCharge',\n    'clickGameModelCounter',\n    'clickGameModelDamage',\n    'clickGameModelIcon',\n    'clickGameModelLoS',\n    'clickGameModelMelee',\n  ];\n  function gameModelDirectiveFactory(\n    gameMapService,\n    gameFactionsModel,\n    gameModelsModel,\n    gameModelSelectionModel,\n    gameScenarioModel,\n    modelModel,\n    labelElementModel,\n    clickGameModelAreaModel,\n    clickGameModelAuraModel,\n    clickGameModelBaseModel,\n    clickGameModelChargeModel,\n    clickGameModelCounterModel,\n    clickGameModelDamageModel,\n    clickGameModelIconModel,\n    clickGameModelLoSModel,\n    clickGameModelMeleeModel\n  ) {\n    const clickGameModeDirective = {\n      restrict: 'A',\n      link: link\n    };\n    function link(scope, parent) {\n      const state = scope.state;\n      gameFactionsModel\n        .getModelInfoP(scope.model.state.info, state.factions)\n        .catch((reason) => {\n          console.error('clickGameModel', reason);\n          return self.Promise.reject(reason);\n        })\n        .then((info) => {\n          console.log('gameModel', scope.model, info);\n\n          return buildModelElement(state, info, scope.model, parent[0], scope);\n        });\n    }\n    function buildModelElement(state, info, model, container, scope) {\n      const element = createModelElement(info, model, container);\n\n      scope.$on('$destroy', gameModelOnDestroy(element));\n      scope.onStateChangeEvent('Game.map.flipped',\n                               gameModelOnMapFlipped(info, scope, element),\n                               scope);\n      const updateModel = gameModelOnUpdate(state, info, scope, element);\n      scope.onStateChangeEvent(`Game.model.change.${model.state.stamp}`,\n                               updateModel, scope);\n      updateModel();\n\n      scope.onStateChangeEvent('Game.model.selection.local.updateSingle',\n                               onUpdateSingleModelSelection(state.factions, model, element),\n                               scope);\n\n      scope.onStateChangeEvent('Game.template.selection.local.updateSingle',\n                               onUpdateSingleTemplateSelection(state.factions, model, element),\n                               scope);\n\n      const onUpdateScenarioAura = withModel(scope, (model) => {\n        updateScenarioAura(state, info, model, scope, element);\n      });\n      scope.onStateChangeEvent('Game.scenario.refresh',\n                               onUpdateScenarioAura, scope);\n      scope.onStateChangeEvent('Game.scenario.change',\n                               onUpdateScenarioAura, scope);\n    }\n    function createModelElement(info, model, parent) {\n      const map = document.getElementById('map');\n      const under_models_container = document.getElementById('game-under-models');\n      const over_models_container = document.getElementById('game-over-models');\n      const svgNS = map.namespaceURI;\n\n      const aura = clickGameModelAuraModel.create(svgNS, parent);\n      const melee = clickGameModelMeleeModel.create(svgNS, parent);\n      const base = clickGameModelBaseModel.create(svgNS, info, model, parent);\n      const damage = clickGameModelDamageModel.create(svgNS, info, parent);\n      const los = clickGameModelLoSModel.create(svgNS, info, parent);\n      const label = labelElementModel.create(svgNS, over_models_container);\n      const counter = clickGameModelCounterModel.create(svgNS, over_models_container, parent);\n      const unit = labelElementModel.create(svgNS, parent);\n      const icon = clickGameModelIconModel.create(svgNS, parent);\n      const area = clickGameModelAreaModel.create(svgNS, parent);\n      const charge = clickGameModelChargeModel.create(svgNS,\n                                                      under_models_container,\n                                                      over_models_container,\n                                                      parent);\n\n      return { container: parent,\n               aura: aura,\n               base: base,\n               damage: damage,\n               los: los,\n               label: label,\n               counter: counter,\n               unit: unit,\n               icon: icon,\n               area: area,\n               melee: melee,\n               charge: charge\n             };\n    }\n    function gameModelOnDestroy(element) {\n      return () => {\n        console.log('gameModelOnDestroy');\n\n        const under_models_container = document.getElementById('game-under-models');\n        const over_models_container = document.getElementById('game-over-models');\n        over_models_container.removeChild(element.label.label);\n        clickGameModelCounterModel.cleanup(under_models_container,\n                                           over_models_container,\n                                           element.counter);\n        clickGameModelChargeModel.cleanup(under_models_container,\n                                          over_models_container,\n                                          element.charge);\n      };\n    }\n    function withModel(scope, fn) {\n      return () => {\n        R.threadP(scope.state.game.models)(\n          gameModelsModel.findStampP$(scope.model.state.stamp),\n          fn\n        );\n      };\n    }\n    function gameModelOnMapFlipped(info, scope, element) {\n      return withModel(scope, (model) => {\n        const map = document.getElementById('map');\n\n        const label_center = computeLabelCenter(info, model);\n        labelElementModel.updateOnFlipMap(map,\n                                          label_center.flip,\n                                          element.label);\n        labelElementModel.updateOnFlipMap(map,\n                                          model.state,\n                                          element.counter[0]);\n        if(modelModel.isCharging(model) ||\n           modelModel.isPlacing(model)) {\n          labelElementModel.updateOnFlipMap(map,\n                                            model.state.cha.s,\n                                            element.charge[2]);\n        }\n      });\n    }\n    function onUpdateSingleModelSelection(factions, model, element) {\n      return (event, sel_stamp, sel_model) => {\n        if(R.isNil(sel_model) ||\n           sel_stamp === model.state.stamp) {\n          element.container.classList.remove('overlap');\n          element.container.classList.remove('b2b');\n          return;\n        }\n        R.threadP(model)(\n          modelModel.distanceToP$(factions, sel_model),\n          (dist) => {\n            if(dist < -0.1) {\n              element.container.classList.add('overlap');\n              element.container.classList.remove('b2b');\n              return;\n            }\n            else if(dist < 0.1) {\n              element.container.classList.remove('overlap');\n              element.container.classList.add('b2b');\n              return;\n            }\n            else {\n              element.container.classList.remove('overlap');\n              element.container.classList.remove('b2b');\n            }\n          }\n        );\n      };\n    }\n    function onUpdateSingleTemplateSelection(factions, model, element) {\n      return (event, sel_stamp, sel_temp) => {\n        // console.log('onUpdateSingleAoTemplateSelection',\n        //             sel_stamp, model.state.stamp);\n        if(R.isNil(sel_temp) ||\n           'aoe' !== sel_temp.state.type) {\n          element.container.classList.remove('under-aoe');\n          return;\n        }\n        R.threadP(model)(\n          modelModel.distanceToAoEP$(factions, sel_temp),\n          (dist) => {\n            if(dist <= 0) {\n              element.container.classList.add('under-aoe');\n            }\n            else {\n              element.container.classList.remove('under-aoe');\n            }\n          }\n        );\n      };\n    }\n    function gameModelOnUpdate(state, info,\n                               scope, element) {\n      return withModel(scope, (model) => {\n        const map = document.getElementById('map');\n        const map_flipped = gameMapService.isFlipped(map);\n        const zoom_factor = gameMapService.zoomFactor(map);\n\n        const is_wreck = modelModel.isWreckDisplayed(model);\n        (is_wreck\n         ? modelModel.getWreckImageP(state.factions, model)\n         : modelModel.getImageP(state.factions, model)\n        ).then((img) => {\n          const label_text = modelModel.fullLabel(model);\n          const label_center = computeLabelCenter(info, model);\n\n          updateModelPosition(img, model, element);\n          updateModelSelection(state.game.model_selection,\n                               model, element);\n          updateScenarioAura(state, info, model, scope, element);\n          clickGameModelAuraModel.update(info, model, img, element.aura);\n          clickGameModelBaseModel.update(info, model, img, element.base);\n          clickGameModelDamageModel.update(info, model, img, element.damage);\n          labelElementModel.update(map_flipped,\n                                   zoom_factor,\n                                   label_center.flip,\n                                   label_center.text,\n                                   label_text,\n                                   element.label);\n          clickGameModelCounterModel.update(map_flipped, zoom_factor,\n                                            info, model, img, element.counter);\n          updateUnit(map_flipped, zoom_factor,\n                     img, info, model, element);\n          clickGameModelIconModel.update(info, model, img, element.icon);\n          clickGameModelAreaModel.update(state.factions, info, model, img, element.area);\n          clickGameModelMeleeModel.update(info, model, img, element.melee);\n          clickGameModelChargeModel.update(map_flipped, zoom_factor,\n                                           state, info, model, img, element.charge);\n        });\n      });\n    }\n    function updateModelPosition(img, model, element) {\n      element.container.setAttribute('transform', [\n        'translate(',\n        model.state.x-img.width/2,\n        ',',\n        model.state.y-img.height/2,\n        ') rotate(',\n        model.state.r,\n        ',',\n        img.width/2,\n        ',',\n        img.height/2,\n        ')'\n      ].join(''));\n    }\n    function updateModelSelection(selection, model, element) {\n      const container = element.container;\n      const stamp = model.state.stamp;\n      if(gameModelSelectionModel.in('local', stamp, selection)) {\n        container.classList.add('local-selection');\n      }\n      else {\n        container.classList.remove('local-selection');\n      }\n      if(gameModelSelectionModel.in('remote', stamp, selection)) {\n        container.classList.add('remote-selection');\n      }\n      else {\n        container.classList.remove('remote-selection');\n      }\n      if(gameModelSelectionModel.inSingle('local', stamp, selection)) {\n        container.classList.add('single-local');\n        container.classList.remove('single-remote');\n      }\n      else if(gameModelSelectionModel.inSingle('remote', stamp, selection)) {\n        container.classList.remove('single-local');\n        container.classList.add('single-remote');\n      }\n      else {\n        container.classList.remove('single-local');\n        container.classList.remove('single-remote');\n      }\n    }\n    function updateScenarioAura(state, info, model, scope, element) {\n      const circle = R.thread(model.state)(\n        R.pick(['x','y']),\n        R.assoc('radius', info.base_radius)\n      );\n\n      if(scope.app.stateIs('game.setup') &&\n         R.exists(state.game.scenario) &&\n         gameScenarioModel.isContesting(circle, state.game.scenario)) {\n        element.container.classList.add('contesting');\n      }\n      else {\n        element.container.classList.remove('contesting');\n      }\n      if(scope.app.stateIs('game.setup') &&\n         R.exists(state.game.scenario) &&\n         'wardude' === info.type &&\n         gameScenarioModel.isKillboxing(circle, state.game.scenario)) {\n        element.container.classList.add('killboxing');\n      }\n      else {\n        element.container.classList.remove('killboxing');\n      }\n    }\n    function updateUnit(map_flipped, zoom_factor, img, info, model, element) {\n      let unit = modelModel.unit(model);\n      unit = R.exists(unit) ? unit : '';\n\n      let unit_text = modelModel.isUnitDisplayed(model) ? unit+'' : '';\n      unit_text = R.length(unit_text) > 0 ? 'U'+unit_text : unit_text;\n\n      const unit_center = computeUnitCenter(img, info, model);\n      labelElementModel.update(map_flipped,\n                               zoom_factor,\n                               unit_center.flip,\n                               unit_center.text,\n                               unit_text,\n                               element.unit);\n    }\n    function computeLabelCenter(info, model) {\n      const label_text_center_y_down = model.state.y + info.base_radius + 6;\n      const label_text_center_y_up = model.state.y - info.base_radius - 2;\n      const orientation = ((model.state.r % 360) + 360) % 360;\n      const model_looking_down =  orientation > 90 && orientation < 270;\n      const label_text_center = { x: model.state.x,\n                                  y: ( model_looking_down\n                                       ? label_text_center_y_down\n                                       : label_text_center_y_up\n                                     )\n                                };\n      const label_flip_center = { x: label_text_center.x,\n                                  y: label_text_center.y - 2\n                                };\n      return { text: label_text_center,\n               flip: label_flip_center\n             };\n    }\n    function computeUnitCenter(img, info) {\n      const counter_flip_center = { x: img.width/2, y: img.height/2 };\n      const counter_text_center = { x: counter_flip_center.x - info.base_radius*0.7 - 5,\n                                    y: counter_flip_center.y - info.base_radius*0.7 - 5\n                                  };\n      return { text: counter_text_center,\n               flip: counter_flip_center\n             };\n    }\n    return clickGameModeDirective;\n  }\n\n  gameModelsListDirectiveFactory.$inject = [];\n  function gameModelsListDirectiveFactory() {\n    return {\n      restrict: 'A',\n      templateUrl: 'app/components/game/model/models_list.html',\n      scope: true,\n      link: link\n    };\n\n    function link(scope, element) {\n      scope.type = element[0].getAttribute('click-game-models-list');\n      scope.digestOnStateChangeEvent('Game.model.create', scope);\n      console.log('clickGameModelsList', scope.type);\n    }\n  }\n})();\n"]}