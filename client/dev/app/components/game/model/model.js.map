{"version":3,"sources":["model.es6"],"names":[],"mappings":"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","file":"model.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .directive('clickGameModel', gameModelDirectiveFactory)\n    .directive('clickGameModelsList', gameModelsListDirectiveFactory)\n    .directive('clickGameUnderModel', gameUnderModelDirectiveFactory)\n    .directive('clickGameUnderModelsList', gameUnderModelsListDirectiveFactory)\n    .directive('clickGameOverModel', gameOverModelDirectiveFactory)\n    .directive('clickGameOverModelsList', gameOverModelsListDirectiveFactory);\n\n  gameModelDirectiveFactory.$inject = [\n    'appState',\n    'gameMap',\n    'gameFactions',\n    'model',\n    'gameModels',\n    'gameModelSelection',\n  ];\n  function gameModelDirectiveFactory(\n    appStateService,\n    gameMapService,\n    gameFactionsModel,\n    modelModel,\n    gameModelsModel,\n    gameModelSelectionModel\n  ) {\n    const clickGameModelDirective = {\n      restrict: 'A',\n      link: link\n    };\n    return clickGameModelDirective;\n\n    function link(scope, _parent_) {\n      const state = scope.state;\n      const model = scope.model;\n      const info = R.thread(state.factions)(\n        gameFactionsModel.getModelInfo$(model.state.info),\n        R.defaultTo({ base_radius: 5.905 })\n      );\n      console.log('gameModel', scope.model, info);\n\n      scope.onStateChangeEvent('Game.view.flipMap', onUpdate, scope);\n      scope.onStateChangeEvent('Game.models.change', onUpdate, scope);\n      scope.onStateChangeEvent('Game.model_selection.change', onUpdate, scope);\n      scope.onStateChangeEvent(`Game.model.change.${model.state.stamp}`,\n                               _onUpdate, scope);\n      updateModel(scope);\n\n      let _model;\n      let _selection;\n      let _is_flipped;\n      function onUpdate() {\n        const map = document.getElementById('map');\n        const is_flipped = gameMapService.isFlipped(map);\n        const state = appStateService.current();\n        const selection = R.path(['game','model_selection'], state);\n        const model = scope.model;\n        if(_model === model &&\n           _selection === selection &&\n           _is_flipped === is_flipped) {\n          return;\n        }\n        _model = model;\n        _selection = selection;\n        _is_flipped = is_flipped;\n\n        _onUpdate();\n      }\n      function _onUpdate() {\n        updateModel(scope);\n        scope.$digest();\n      }\n    }\n    function updateModel(scope) {\n      const map = document.getElementById('map');\n      const is_flipped = gameMapService.isFlipped(map);\n      const model = scope.model;\n      const stamp = model.state.stamp;\n      const state = appStateService.current();\n\n      const selection = R.path(['game','model_selection'], state);\n      const local = gameModelSelectionModel\n              .in('local', stamp, selection);\n      const remote = gameModelSelectionModel\n              .in('remote', stamp, selection);\n      const single_local = gameModelSelectionModel\n              .inSingle('local', stamp, selection);\n      const single_remote = gameModelSelectionModel\n              .inSingle('remote', stamp, selection);\n      model.selection = {\n        local,\n        remote,\n        single_local,\n        single_remote\n      };\n\n      let charge_target;\n      if(single_local) {\n        const target_stamp = R.path(['state','cha','t'], model);\n        if(R.exists(target_stamp)) {\n          charge_target = gameModelsModel\n            .findStamp(target_stamp, state.game.models);\n          charge_target.info = gameFactionsModel\n            .getModelInfo(charge_target.state.info, state.factions);\n        }\n      }\n\n      model.render = modelModel\n        .render({is_flipped, charge_target},\n                state.factions, model.state);\n\n      appStateService.emit(`Game.model.change.${stamp}.render`);\n      console.warn('RENDER MODEL',\n                   model.state.stamp,\n                   model.render,\n                   scope.selection);\n    }\n  }\n\n  gameModelsListDirectiveFactory.$inject = [];\n  function gameModelsListDirectiveFactory() {\n    return {\n      restrict: 'A',\n      templateUrl: 'app/components/game/model/models_list.html',\n      scope: true,\n      link: link\n    };\n\n    function link(scope, element) {\n      scope.type = element[0].getAttribute('click-game-models-list');\n      scope.digestOnStateChangeEvent('Game.models.change', scope);\n      console.log('clickGameModelsList', scope.type);\n    }\n  }\n\n  gameUnderModelDirectiveFactory.$inject = [];\n  function gameUnderModelDirectiveFactory() {\n    const clickGameUnderModelDirective = {\n      restrict: 'A',\n      link: link\n    };\n    return clickGameUnderModelDirective;\n\n    function link(scope, _parent_) {\n      const stamp = scope.model.state.stamp;\n      console.log('gameUnderModel', stamp);\n\n      scope.digestOnStateChangeEvent('Game.view.flipMap', scope);\n      scope.digestOnStateChangeEvent(`Game.model.change.${stamp}.render`, scope);\n    }\n  }\n\n  gameUnderModelsListDirectiveFactory.$inject = [];\n  function gameUnderModelsListDirectiveFactory() {\n    return {\n      restrict: 'A',\n      templateUrl: 'app/components/game/model/under_models_list.html',\n      scope: true,\n      link: link\n    };\n\n    function link(scope) {\n      scope.digestOnStateChangeEvent('Game.models.change', scope);\n      console.log('clickGameModelsList', scope.type);\n    }\n  }\n\n  gameOverModelDirectiveFactory.$inject = [];\n  function gameOverModelDirectiveFactory() {\n    const clickGameOverModelDirective = {\n      restrict: 'A',\n      link: link\n    };\n    return clickGameOverModelDirective;\n\n    function link(scope, _parent_) {\n      const stamp = scope.model.state.stamp;\n      console.log('gameOverModel', stamp);\n\n      scope.digestOnStateChangeEvent('Game.view.flipMap', scope);\n      scope.digestOnStateChangeEvent(`Game.model.change.${stamp}.render`, scope);\n    }\n  }\n\n  gameOverModelsListDirectiveFactory.$inject = [];\n  function gameOverModelsListDirectiveFactory() {\n    return {\n      restrict: 'A',\n      templateUrl: 'app/components/game/model/over_models_list.html',\n      scope: true,\n      link: link\n    };\n\n    function link(scope) {\n      scope.digestOnStateChangeEvent('Game.models.change', scope);\n      console.log('clickGameModelsList', scope.type);\n    }\n  }\n})();\n"]}