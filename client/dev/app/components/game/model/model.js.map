{"version":3,"sources":["model.es6"],"names":[],"mappings":"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","file":"model.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .directive('clickGameModel', gameModelDirectiveFactory)\n    .directive('clickGameModelsList', gameModelsListDirectiveFactory)\n    .directive('clickGameUnderModelsList', gameUnderModelsListDirectiveFactory)\n    .directive('clickGameOverModelsList', gameOverModelsListDirectiveFactory);\n\n  gameModelDirectiveFactory.$inject = [\n    'appGame',\n    'gameMap',\n    'model',\n    'gameModels',\n    'gameModelSelection',\n  ];\n  function gameModelDirectiveFactory(\n    appGameService,\n    gameMapService,\n    modelModel,\n    gameModelsModel,\n    gameModelSelectionModel\n  ) {\n    const clickGameModelDirective = {\n      restrict: 'A',\n      link: link\n    };\n    return clickGameModelDirective;\n\n    function link(scope, _parent_) {\n      console.log('gameModel', scope.model);\n\n      const stamp = scope.model.state.stamp;\n      scope.listenSignal(refreshRender,\n                         appGameService.models.flip_map,\n                         scope);\n      scope.listenSignal(onModelSelectionChanges,\n                         appGameService.models.selection_changes,\n                         scope);\n      scope.listenSignal(onModelsChanges,\n                         appGameService.models.changes,\n                         scope);\n      mount();\n\n      function onModelsChanges([models, stamps]) {\n        if(!R.find(R.equals(stamp), stamps)) return;\n\n        refreshRender(models);\n      }\n      function onModelSelectionChanges([selection, stamps]) {\n        if(!R.find(R.equals(stamp), stamps)) return;\n\n        refreshSelection(selection);\n      }\n\n      function mount() {\n        const models = appGameService.models.models.sample();\n        refreshRender(models);\n\n        const selection = appGameService.models.selection.sample();\n        refreshSelection(selection);\n      }\n\n      function refreshRender(models) {\n        const model = gameModelsModel.findStamp(stamp, models);\n        if(R.isNil(model)) return;\n        scope.model = model;\n\n        const map = document.getElementById('map');\n        const is_flipped = gameMapService.isFlipped(map);\n\n        let charge_target;\n        const target_stamp = R.path(['state','cha','t'], model);\n        if(R.exists(target_stamp)) {\n          charge_target = gameModelsModel\n            .findStamp(target_stamp, models);\n        }\n        model.render = modelModel\n          .render({is_flipped, charge_target},\n                  model.info, model.state);\n        console.warn('RENDER MODEL',\n                     stamp, model.state, model.render);\n      }\n      function refreshSelection(selection) {\n        const local = gameModelSelectionModel\n                .in('local', stamp, selection);\n        const remote = gameModelSelectionModel\n                .in('remote', stamp, selection);\n        const single_local = gameModelSelectionModel\n                .inSingle('local', stamp, selection);\n        const single_remote = gameModelSelectionModel\n                .inSingle('remote', stamp, selection);\n        scope.model.selection = {\n          local,\n          remote,\n          single_local,\n          single_remote\n        };\n        console.warn('SELECTION MODEL',\n                     stamp, selection, scope.selection);\n      }\n    }\n  }\n\n  gameModelsListDirectiveFactory.$inject = [];\n  function gameModelsListDirectiveFactory() {\n    return {\n      restrict: 'A',\n      templateUrl: 'app/components/game/model/models_list.html',\n      scope: true,\n      link: link\n    };\n\n    function link(scope, element) {\n      scope.type = element[0].getAttribute('click-game-models-list');\n      console.log('clickGameModelsList', scope.type);\n    }\n  }\n\n  gameUnderModelsListDirectiveFactory.$inject = [];\n  function gameUnderModelsListDirectiveFactory() {\n    return {\n      restrict: 'A',\n      templateUrl: 'app/components/game/model/under_models_list.html',\n      scope: true,\n      link: link\n    };\n\n    function link(scope, element) {\n      scope.type = element[0].getAttribute('click-game-under-models-list');\n      console.log('clickGameUnderModelsList', scope.type);\n    }\n  }\n\n  gameOverModelsListDirectiveFactory.$inject = [];\n  function gameOverModelsListDirectiveFactory() {\n    return {\n      restrict: 'A',\n      templateUrl: 'app/components/game/model/over_models_list.html',\n      scope: true,\n      link: link\n    };\n\n    function link(scope, element) {\n      scope.type = element[0].getAttribute('click-game-over-models-list');\n      console.log('clickGameOverModelsList', scope.type);\n    }\n  }\n})();\n"]}