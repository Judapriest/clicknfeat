{"version":3,"sources":["damage.es6"],"names":[],"mappings":"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","file":"damage.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .factory('clickGameModelDamage', gameModelDamageModelFactory);\n\n  gameModelDamageModelFactory.$inject = [\n    'model',\n  ];\n  function gameModelDamageModelFactory(modelModel) {\n    return {\n      create: gameModelDamageCreate,\n      update: gameModelDamageUpdate\n    };\n\n    function gameModelDamageCreate(svgNS, info, parent) {\n      let damage_bar_red;\n      let damage_bar_green;\n      if(!(info.damage.type === 'warrior' &&\n           info.damage.n === 1)) {\n        damage_bar_red = document.createElementNS(svgNS, 'line');\n        damage_bar_red.classList.add('model-damage-bar');\n        damage_bar_red.setAttribute('x1', (info.img[0].width/2-info.base_radius)+'');\n        damage_bar_red.setAttribute('y1', (info.img[0].height/2+info.base_radius+2)+'');\n        damage_bar_red.setAttribute('x2', (info.img[0].width/2+info.base_radius)+'');\n        damage_bar_red.setAttribute('y2', (info.img[0].height/2+info.base_radius+2)+'');\n        damage_bar_red.style.stroke = '#F00';\n        parent.appendChild(damage_bar_red);\n\n        damage_bar_green = document.createElementNS(svgNS, 'line');\n        damage_bar_green.classList.add('model-damage-bar');\n        damage_bar_green.setAttribute('x1', (info.img[0].width/2-info.base_radius)+'');\n        damage_bar_green.setAttribute('y1', (info.img[0].height/2+info.base_radius+2)+'');\n        damage_bar_green.setAttribute('x2', (info.img[0].width/2+info.base_radius)+'');\n        damage_bar_green.setAttribute('y2', (info.img[0].height/2+info.base_radius+2)+'');\n        damage_bar_green.style.stroke = '#0F0';\n        parent.appendChild(damage_bar_green);\n      }\n\n      let field_bar_red;\n      let field_bar_green;\n      if(R.exists(info.damage.field)) {\n        field_bar_red = document.createElementNS(svgNS, 'line');\n        field_bar_red.classList.add('model-damage-bar');\n        field_bar_red.setAttribute('x1', (info.img[0].width/2-info.base_radius)+'');\n        field_bar_red.setAttribute('y1', (info.img[0].height/2+info.base_radius+2)+'');\n        field_bar_red.setAttribute('x2', (info.img[0].width/2+info.base_radius)+'');\n        field_bar_red.setAttribute('y2', (info.img[0].height/2+info.base_radius+2)+'');\n        field_bar_red.style.stroke = '#066';\n        parent.appendChild(field_bar_red);\n\n        field_bar_green = document.createElementNS(svgNS, 'line');\n        field_bar_green.classList.add('model-damage-bar');\n        field_bar_green.setAttribute('x1', (info.img[0].width/2-info.base_radius)+'');\n        field_bar_green.setAttribute('y1', (info.img[0].height/2+info.base_radius+2)+'');\n        field_bar_green.setAttribute('x2', (info.img[0].width/2+info.base_radius)+'');\n        field_bar_green.setAttribute('y2', (info.img[0].height/2+info.base_radius+2)+'');\n        field_bar_green.style.stroke = '#0FF';\n        parent.appendChild(field_bar_green);\n      }\n\n      return [ damage_bar_red, damage_bar_green,\n               field_bar_red, field_bar_green\n             ];\n    }\n    function gameModelDamageUpdate(info, model, img, element) {\n      const [ damage_bar_red, damage_bar_green,\n              field_bar_red, field_bar_green\n            ] = element;\n\n      if(R.isNil(damage_bar_red)) return;\n\n      if(info.damage.type === 'none' ||\n         modelModel.isWreckDisplayed(model)) {\n        damage_bar_red.style.visibility = 'hidden';\n        damage_bar_green.style.visibility = 'hidden';\n\n        if(R.isNil(field_bar_red)) return;\n\n        field_bar_red.style.visibility = 'hidden';\n        field_bar_green.style.visibility = 'hidden';\n        return;\n      }\n\n      const min_x = img.width / 2 + info.base_radius;\n      const max_x = img.width / 2 - info.base_radius;\n      const y = img.height / 2 + info.base_radius + 1;\n\n      const percent_damage = model.state.dmg.t / info.damage.total;\n      const damage_x = (max_x-min_x) * (1-percent_damage) + min_x;\n\n      damage_bar_red.setAttribute('x1', max_x + '');\n      damage_bar_red.setAttribute('y1', y + '');\n      damage_bar_red.setAttribute('x2', min_x + '');\n      damage_bar_red.setAttribute('y2', y + '');\n      damage_bar_red.style.visibility = 'visible';\n\n      damage_bar_green.setAttribute('x1', damage_x + '');\n      damage_bar_green.setAttribute('y1', y + '');\n      damage_bar_green.setAttribute('x2', min_x + '');\n      damage_bar_green.setAttribute('y2', y + '');\n      damage_bar_green.style.visibility = 'visible';\n\n      if(R.isNil(field_bar_red)) return;\n\n      const percent_field = model.state.dmg.f / info.damage.field;\n      const field_x = (max_x-min_x) * (1-percent_field) + min_x;\n\n      field_bar_red.setAttribute('x1', max_x + '');\n      field_bar_red.setAttribute('y1', (y+1) + '');\n      field_bar_red.setAttribute('x2', min_x + '');\n      field_bar_red.setAttribute('y2', (y+1) + '');\n      field_bar_red.style.visibility = 'visible';\n\n      field_bar_green.setAttribute('x1', field_x + '');\n      field_bar_green.setAttribute('y1', (y+1) + '');\n      field_bar_green.setAttribute('x2', min_x + '');\n      field_bar_green.setAttribute('y2', (y+1) + '');\n      field_bar_green.style.visibility = 'visible';\n    }\n  }\n})();\n"]}