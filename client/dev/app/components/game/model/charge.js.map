{"version":3,"sources":["charge.es6"],"names":[],"mappings":"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","file":"charge.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .factory('clickGameModelCharge', gameModelChargeModelFactory);\n\n  gameModelChargeModelFactory.$inject = [\n    'labelElement',\n    'model',\n    'point',\n    'gameFactions',\n    'gameModels',\n    'gameModelSelection',\n  ];\n  function gameModelChargeModelFactory(labelElementModel,\n                                       modelModel,\n                                       pointModel,\n                                       gameFactionsModel,\n                                       gameModelsModel,\n                                       gameModelSelectionModel) {\n    return {\n      create: gameModelChargeCreate,\n      cleanup: gameModelCharge,\n      update: gameModelChargeUpdate\n    };\n\n    function gameModelChargeCreate(svgNS,\n                                   under_models_container,\n                                   over_models_container) {\n      const charge_path = document.createElementNS(svgNS, 'rect');\n      charge_path.style.visibility = 'hidden';\n      charge_path.classList.add('model-charge-path');\n      under_models_container.appendChild(charge_path);\n\n      const charge_target = document.createElementNS(svgNS, 'circle');\n      charge_target.style.visibility = 'hidden';\n      charge_target.classList.add('model-charge-target');\n      over_models_container.appendChild(charge_target);\n\n      const charge_label = labelElementModel.create(svgNS, over_models_container);\n\n      return [ charge_path, charge_target, charge_label ];\n    }\n    function gameModelCharge(under_models_container,\n                             over_models_container,\n                             element) {\n      const [ charge_path, charge_target, charge_label ] = element;\n\n      over_models_container.removeChild(charge_label.label);\n      over_models_container.removeChild(charge_target);\n      under_models_container.removeChild(charge_path);\n    }\n    function gameModelChargeUpdate(map_flipped, zoom_factor,\n                                   state, info, model, _img_, element) {\n      const [ charge_path, charge_target, charge_label ] = element;\n\n      if(!modelModel.isCharging(model)  &&\n         !modelModel.isPlacing(model)) {\n        charge_path.style.visibility = 'hidden';\n        charge_target.style.visibility = 'hidden';\n        labelElementModel.update(map_flipped,\n                                 zoom_factor,\n                                 model.state,\n                                 model.state,\n                                 '',\n                                 charge_label);\n        return;\n      }\n      let max_dist;\n      if(modelModel.isCharging(model)) {\n        const charge_length = pointModel.distanceTo(model.state, model.state.cha.s);\n        const charge_dir = model.state.cha.s.r;\n        const charge_middle = pointModel.translateInDirection(400,\n                                                            charge_dir,\n                                                            model.state.cha.s);\n        charge_path.setAttribute('width', (info.base_radius*2)+'');\n        charge_path.setAttribute('height', '800');\n        charge_path.setAttribute('x', (charge_middle.x-info.base_radius)+'');\n        charge_path.setAttribute('y', (charge_middle.y-400)+'');\n        charge_path.setAttribute('transform', [\n          'rotate(',\n          charge_dir,\n          ',',\n          charge_middle.x,\n          ',',\n          charge_middle.y,\n          ')'\n        ].join(''));\n        charge_path.style.visibility = 'visible';\n\n        let label = (Math.round(charge_length*10)/100)+'\"';\n        max_dist = modelModel.chargeMaxLength(model);\n        if(R.exists(max_dist)) {\n          label += '/'+max_dist+'\"';\n        }\n        labelElementModel.update(map_flipped,\n                                 zoom_factor,\n                                 model.state.cha.s,\n                                 model.state.cha.s,\n                                 label,\n                                 charge_label);\n\n        if(gameModelSelectionModel\n           .in('local', model.state.stamp, state.game.model_selection) &&\n           R.exists(model.state.cha.t)) {\n          R.threadP(state.game.models)(\n            gameModelsModel.findStampP$(model.state.cha.t),\n            (target) => {\n              charge_target.setAttribute('cx', (target.state.x)+'');\n              charge_target.setAttribute('cy', (target.state.y)+'');\n\n              let melee_range = 0;\n              if(modelModel.isMeleeDisplayed('mm', model)) {\n                melee_range = 5;\n              }\n              if(modelModel.isMeleeDisplayed('mr', model)) {\n                melee_range = 20;\n              }\n              if(modelModel.isMeleeDisplayed('ms', model)) {\n                melee_range = 40;\n              }\n              const distance_to_target = pointModel.distanceTo(target.state, model.state);\n              return R.threadP(state.factions)(\n                gameFactionsModel.getModelInfoP$(target.state.info),\n                (target_info) => {\n                  charge_target.setAttribute('r', (target_info.base_radius)+'');\n\n                  if(distance_to_target <= melee_range + info.base_radius + target_info.base_radius) {\n                    charge_target.classList.add('reached');\n                  }\n                  else {\n                    charge_target.classList.remove('reached');\n                  }\n                  charge_target.style.visibility = 'visible';\n                }\n              );\n            }\n          );\n        }\n      }\n      if(modelModel.isPlacing(model)) {\n        const place_length = pointModel.distanceTo(model.state, model.state.pla.s);\n        const place_dir = model.state.pla.s.r;\n        const place_middle = pointModel.translateInDirection(400,\n                                                             place_dir,\n                                                             model.state.pla.s);\n        charge_path.setAttribute('width', (info.base_radius*2)+'');\n        charge_path.setAttribute('height', '800');\n        charge_path.setAttribute('x', (place_middle.x-info.base_radius)+'');\n        charge_path.setAttribute('y', (place_middle.y-400)+'');\n        charge_path.setAttribute('transform', [\n          'rotate(',\n          place_dir,\n          ',',\n          place_middle.x,\n          ',',\n          place_middle.y,\n          ')'\n        ].join(''));\n        charge_path.style.visibility = 'visible';\n\n        let place_label = (Math.round(place_length*10)/100)+'\"';\n        const within = modelModel.placeWithin(model);\n        max_dist = modelModel.placeMaxLength(model);\n        if(R.exists(max_dist)) {\n          place_label += '/'+(within ? 'w.' : '')+max_dist+'\"';\n        }\n        labelElementModel.update(map_flipped,\n                                 zoom_factor,\n                                 model.state.pla.s,\n                                 model.state.pla.s,\n                                 place_label,\n                                 charge_label);\n\n      }\n      charge_target.style.visibility = 'hidden';\n    }\n  }\n})();\n"]}