{"version":3,"sources":["modelDamage.es6"],"names":[],"mappings":"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","file":"modelDamage.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .controller('clickGameModelDamageCtrl', gameModelDamageCtrl)\n    .directive('clickGameModelDamage', gameModelDamageDirectiveFactory);\n\n  gameModelDamageCtrl.$inject = [\n    '$rootScope',\n    'appGame',\n    'gameModels',\n  ];\n  function gameModelDamageCtrl($rootScope,\n                               appGameService,\n                               gameModelsModel) {\n    const vm = this;\n    console.log('init clickModelDamageCtrl', vm.info, vm.state);\n\n    vm.range = range;\n    vm.warriorBoxClass = warriorBoxClass;\n    vm.fieldBoxClass = fieldBoxClass;\n    vm.gridBoxClass = gridBoxClass;\n    vm.doResetDamage = doResetDamage;\n    vm.doWarriorDamage = doWarriorDamage;\n    vm.doFieldDamage = doFieldDamage;\n    vm.doGridDamage = doGridDamage;\n    vm.doGridColDamage = doGridColDamage;\n\n    activate();\n\n    function activate() {\n      $rootScope.listenSignal(onModelsChanges,\n                              appGameService.models.changes,\n                              $rootScope);\n    }\n    function onModelsChanges([models, stamps]) {\n      if(R.isNil(vm.state) ||\n         !R.find(R.equals(vm.state.stamp), stamps)) return;\n      updateModel(models);\n    }\n    function updateModel(models) {\n      if(R.isNil(vm.state)) return;\n\n      R.thread(models)(\n        gameModelsModel.findStamp$(vm.state.stamp),\n        R.ifElse(\n          R.exists,\n          (model) => {\n            vm.state = model.state;\n          },\n          () => {\n            vm.state = {};\n          }\n        )\n      );\n    }\n    function range(n) {\n      return R.range(0, n);\n    }\n    function warriorBoxClass(i) {\n      if(R.isNil(vm.state) ||\n         R.isNil(vm.state.dmg)) return '';\n      return ( vm.state && vm.state.dmg.n > i\n               ? 'mark'\n               : ''\n             );\n    }\n    function fieldBoxClass(col, line) {\n      if(R.isNil(vm.state) ||\n         R.isNil(vm.state.dmg)) return '';\n      return ( vm.state &&\n               vm.state.dmg.f > line * vm.info.field/2 + col\n               ? 'mark'\n               : ''\n             );\n    }\n    function gridBoxClass(col, line) {\n      if(R.isNil(vm.state) ||\n         R.isNil(vm.state.dmg)) return '';\n      return ( !vm.info[col][line]\n               ? 'none'\n               : ( vm.state && vm.state.dmg[col][line] === 1\n                   ? 'mark'\n                   : ''\n                 )\n             );\n    }\n    function doResetDamage() {\n      if(R.isNil(vm.state)) return;\n\n      $rootScope.sendAction('Game.command.execute',\n                        'onModels', [\n                          'resetDamage',\n                          [],\n                          [vm.state.stamp]\n                        ]);\n    }\n    function doWarriorDamage(i) {\n      if(R.isNil(vm.state)) return;\n\n      $rootScope.sendAction('Game.command.execute',\n                            'onModels', [\n                              'setWarriorDamage',\n                              [i],\n                              [vm.state.stamp]\n                            ]);\n    }\n    function doFieldDamage(i) {\n      if(R.isNil(vm.state)) return;\n\n      $rootScope.sendAction('Game.command.execute',\n                            'onModels', [\n                              'setFieldDamage',\n                              [i],\n                              [vm.state.stamp]\n                            ]);\n    }\n    function doGridDamage(line, col) {\n      if(R.isNil(vm.state)) return;\n      if(R.isNil(vm.info[col][line])) return;\n\n      $rootScope.sendAction('Game.command.execute',\n                            'onModels', [\n                              'setGridDamage',\n                              [line, col],\n                              [vm.state.stamp]\n                            ]);\n    }\n    function doGridColDamage(col) {\n      if(R.isNil(vm.state)) return;\n\n      $rootScope.sendAction('Game.command.execute',\n                            'onModels', [\n                              'setGridColDamage',\n                              [col],\n                              [vm.state.stamp]\n                            ]);\n    }\n  }\n\n  gameModelDamageDirectiveFactory.$inject = [];\n  function gameModelDamageDirectiveFactory() {\n    return {\n      restrict: 'E',\n      scope: {},\n      controller: 'clickGameModelDamageCtrl',\n      controllerAs: 'damage',\n      bindToController: {\n        info: '=',\n        state: '='\n      },\n      templateUrl: 'app/components/game/model/damage/model_damage.html',\n      link: link\n    };\n    function link(scope) {\n      console.log('gameModelDamage', scope);\n    }\n  }\n})();\n"]}