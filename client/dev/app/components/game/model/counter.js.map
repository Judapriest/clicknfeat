{"version":3,"sources":["counter.es6"],"names":[],"mappings":"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","file":"counter.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .factory('clickGameModelCounter', gameModelCounterModelFactory);\n\n  gameModelCounterModelFactory.$inject = [\n    'labelElement',\n    'model',\n  ];\n  function gameModelCounterModelFactory(labelElementModel,\n                                        modelModel) {\n    return {\n      create: gameModelCounterCreate,\n      cleanup: gameModelCounterCleanup,\n      update: gameModelCounterUpdate\n    };\n\n    function gameModelCounterCreate(svgNS, over_models_container, parent) {\n      const counter = labelElementModel.create(svgNS, over_models_container);\n      counter.label.classList.add('counter');\n      counter.bckgnd.setAttribute('height', '9');\n\n      const souls_image = document.createElementNS(svgNS, 'image');\n      souls_image.classList.add('model-image');\n      souls_image.setAttribute('x', '0');\n      souls_image.setAttribute('y', '0');\n      souls_image.setAttribute('width', '20');\n      souls_image.setAttribute('height', '20');\n      souls_image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '/data/icons/Soul.png');\n      parent.appendChild(souls_image);\n\n      const souls_label = labelElementModel.create(svgNS, parent);\n\n      return [ counter, souls_image, souls_label ];\n    }\n    function gameModelCounterCleanup(_under_models_container_,\n                                     over_models_container,\n                                     element) {\n      const [ counter, _souls_image_, _souls_label_ ] = element;\n\n      over_models_container.removeChild(counter.label);\n    }\n    function gameModelCounterUpdate(map_flipped, zoom_factor,\n                                         info, model, img, element) {\n      const [ counter, souls_image, souls_label ] = element;\n      const counter_text = ( modelModel.isCounterDisplayed('c', model)\n                             ? model.state.c\n                             : ''\n                           );\n      const counter_center = computeCounterCenter(model);\n      labelElementModel.update(map_flipped,\n                               zoom_factor,\n                               counter_center.flip,\n                               counter_center.text,\n                               counter_text,\n                               counter);\n\n      const souls_text = ( modelModel.isCounterDisplayed('s', model)\n                           ? model.state.s + ''\n                           : ''\n                         );\n      const visibility = R.length(souls_text) > 0 ? 'visible' : 'hidden';\n      const souls_center = computeSoulsCenter(img, info, model);\n\n      souls_image.setAttribute('x', (souls_center.text.x-10)+'');\n      souls_image.setAttribute('y', (souls_center.text.y-10)+'');\n      souls_image.style.visibility = visibility;\n\n      labelElementModel.update(map_flipped,\n                               zoom_factor,\n                               souls_center.flip,\n                               souls_center.text,\n                               souls_text,\n                               souls_label);\n    }\n    function computeCounterCenter(model) {\n      const counter_flip_center = { x: model.state.x, y: model.state.y };\n      const counter_text_center = { x: counter_flip_center.x, y: counter_flip_center.y+4 };\n      return { text: counter_text_center,\n               flip: counter_flip_center\n             };\n    }\n    function computeSoulsCenter(img, info) {\n      const counter_flip_center = { x: img.width/2, y: img.height/2 };\n      const counter_text_center = { x: counter_flip_center.x + info.base_radius * 0.8 + 5,\n                                    y: counter_flip_center.y - info.base_radius - 5\n                                  };\n      return { text: counter_text_center,\n               flip: counter_flip_center\n             };\n    }\n  }\n})();\n"]}