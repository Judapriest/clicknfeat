{"version":3,"sources":["counter.es6"],"names":[],"mappings":"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","file":"counter.js","sourcesContent":["angular.module('clickApp.directives')\n  .factory('clickGameModelCounter', [\n    'labelElement',\n    'model',\n    function(labelElementService,\n             modelService) {\n      function computeCounterCenter(model) {\n        var counter_flip_center = { x: model.state.x, y: model.state.y };\n        var counter_text_center = { x: counter_flip_center.x, y: counter_flip_center.y+4 };\n        return { text: counter_text_center,\n                 flip: counter_flip_center\n               };\n      }\n      function computeSoulsCenter(img, info) {\n        var counter_flip_center = { x: img.width/2, y: img.height/2 };\n        var counter_text_center = { x: counter_flip_center.x + info.base_radius * 0.8 + 5,\n                                    y: counter_flip_center.y - info.base_radius - 5 };\n        return { text: counter_text_center,\n                 flip: counter_flip_center\n               };\n      }\n      return {\n        create: function clickGameModelCounterCreate(svgNS, over_models_container, parent) {\n          var counter = labelElementService.create(svgNS, over_models_container);\n          counter.label.classList.add('counter');\n          counter.bckgnd.setAttribute('height', '9');\n\n          var souls_image = document.createElementNS(svgNS, 'image');\n          souls_image.classList.add('model-image');\n          souls_image.setAttribute('x', '0');\n          souls_image.setAttribute('y', '0');\n          souls_image.setAttribute('width', '20');\n          souls_image.setAttribute('height', '20');\n          souls_image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '/data/icons/Soul.png');\n          parent.appendChild(souls_image);\n\n          var souls_label = labelElementService.create(svgNS, parent);\n\n          return [ counter, souls_image, souls_label ];\n        },\n        cleanup: function(under_models_container,\n                          over_models_container,\n                          element) {\n          let [ counter, souls_image, souls_label ] = element;\n\n          over_models_container.removeChild(counter.label);\n        },\n        update: function clickGameModelCounterUpdate(map_flipped, zoom_factor,\n                                                     info, model, img, element) {\n          let [ counter, souls_image, souls_label ] = element;\n          var counter_text = ( modelService.isCounterDisplayed('c', model) ?\n                               model.state.c : ''\n                             );\n          var counter_center = computeCounterCenter(model);\n          labelElementService.update(map_flipped,\n                                     zoom_factor,\n                                     counter_center.flip,\n                                     counter_center.text,\n                                     counter_text,\n                                     counter);\n\n          var souls_text = ( modelService.isCounterDisplayed('s', model)  ?\n                             model.state.s + '' : ''\n                           );\n          var visibility = R.length(souls_text) > 0 ? 'visible' : 'hidden';\n          var souls_center = computeSoulsCenter(img, info, model);\n\n          souls_image.setAttribute('x', (souls_center.text.x-10)+'');\n          souls_image.setAttribute('y', (souls_center.text.y-10)+'');\n          souls_image.style.visibility = visibility;\n\n          labelElementService.update(map_flipped,\n                                     zoom_factor,\n                                     souls_center.flip,\n                                     souls_center.text,\n                                     souls_text,\n                                     souls_label);\n        }\n      };\n    }\n  ]);\n"]}