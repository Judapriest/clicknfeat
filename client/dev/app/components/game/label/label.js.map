{"version":3,"sources":["label.es6"],"names":[],"mappings":"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","file":"label.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .factory('labelElement', labelElementModelFactory);\n\n  labelElementModelFactory.$inject = [\n    'gameMap',\n  ];\n  function labelElementModelFactory(gameMapService) {\n    const labelElementService = {\n      create: labelElementModelCreate,\n      updateOnFlipMap: labelElementModelUpdateOnFlipMap,\n      update: labelElementModelUpdate\n    };\n    return labelElementService;\n\n    function labelElementModelCreate(svgNS, parent) {\n      const gLabel = document.createElementNS(svgNS, 'g');\n      gLabel.classList.add('label');\n      parent.appendChild(gLabel);\n      const rectLabel = document.createElementNS(svgNS, 'rect');\n      rectLabel.setAttribute('height', '6');\n      gLabel.appendChild(rectLabel);\n      const textLabel = document.createElementNS(svgNS, 'text');\n      gLabel.appendChild(textLabel);\n\n      return { label: gLabel,\n               bckgnd: rectLabel,\n               text: textLabel\n             };\n    }\n    function labelElementModelUpdateOnFlipMap(map, center, label) {\n      const map_flipped = gameMapService.isFlipped(map);\n      label.label.setAttribute('transform',\n                               map_flipped ? 'rotate(180,'+\n                               center.x+','+\n                               center.y+')' : '');\n    }\n    function labelElementModelUpdate(map_flipped,\n                                     zoom_factor,\n                                     flip_center,\n                                     text_center,\n                                     text,\n                                     label) {\n      text = R.defaultTo('', text) + '';\n      const visibility = R.length(text) > 0 ? 'visible' : 'hidden';\n\n      updateLabel(map_flipped, flip_center, visibility, label.label);\n      if('visible' === visibility) {\n        updateText(text_center, text, label.text);\n\n        self.window.requestAnimationFrame(() => {\n          updateBackground(zoom_factor, text_center,\n                           label.text, label.bckgnd);\n        });\n      }\n    }\n    function updateLabel(map_flipped, flip_center, visibility, label) {\n      label.style.visibility = visibility;\n      label.setAttribute('transform',\n                         ( map_flipped ?\n                           'rotate(180,'+flip_center.x+','+flip_center.y+')' :\n                           ''\n                         ));\n    }\n    function updateText(center, content, text) {\n      text.innerHTML = content;\n      text.setAttribute('x', center.x+'');\n      text.setAttribute('y', center.y+'');\n    }\n    function updateBackground(zoom_factor, text_center,\n                              label, bckgnd) {\n      const label_rect = label.getBoundingClientRect();\n      const width = label_rect.width / zoom_factor - 2;\n      const height = parseFloat(bckgnd.getAttribute('height'));\n\n      bckgnd.setAttribute('x', (text_center.x - width / 2 - 1)+'');\n      bckgnd.setAttribute('y', (text_center.y - (height - 1))+'');\n      bckgnd.setAttribute('width', (width + 2)+'');\n    }\n  }\n})();\n"]}