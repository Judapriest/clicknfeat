{"version":3,"sources":["label.es6"],"names":[],"mappings":"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","file":"label.js","sourcesContent":["angular.module('clickApp.directives')\n  .factory('labelElement', [\n    '$window',\n    'gameMap',\n    function($window,\n             gameMapService) {\n      var labelElementService = {\n        create: function labelElementServiceCreate(svgNS, parent) {\n          var gLabel = document.createElementNS(svgNS, 'g');\n          gLabel.classList.add('label');\n          parent.appendChild(gLabel);\n          var rectLabel = document.createElementNS(svgNS, 'rect');\n          rectLabel.setAttribute('height', '6');\n          gLabel.appendChild(rectLabel);\n          var textLabel = document.createElementNS(svgNS, 'text');\n          gLabel.appendChild(textLabel);\n\n          return { label: gLabel,\n                   bckgnd: rectLabel,\n                   text: textLabel\n                 };\n        },\n        updateOnFlipMap: function labelElementUpdateOnFlipMap(map, center, label) {\n          var map_flipped = gameMapService.isFlipped(map);\n          label.label.setAttribute('transform',\n                                   map_flipped ? 'rotate(180,'+\n                                   center.x+','+\n                                   center.y+')' : '');\n        },\n        update: function labelElementUpdate(map_flipped,\n                                            zoom_factor,\n                                            flip_center,\n                                            text_center,\n                                            text,\n                                            label) {\n          text = R.defaultTo('', text) + '';\n          var visibility = R.length(text) > 0 ? 'visible' : 'hidden';\n\n          updateLabel(map_flipped, flip_center, visibility, label.label);\n          if('visible' === visibility) {\n            updateText(text_center, text, label.text);\n\n            $window.requestAnimationFrame(() => {\n              updateBackground(zoom_factor, text_center,\n                               label.text, label.bckgnd);\n            });\n          }\n        }\n      };\n      function updateLabel(map_flipped, flip_center, visibility, label) {\n        label.style.visibility = visibility;\n        label.setAttribute('transform',\n                           ( map_flipped ?\n                             'rotate(180,'+flip_center.x+','+flip_center.y+')' :\n                             ''\n                           ));\n      }\n      function updateText(center, content, text) {\n        text.innerHTML = content;\n        text.setAttribute('x', center.x+'');\n        text.setAttribute('y', center.y+'');\n      }\n      function updateBackground(zoom_factor, text_center,\n                                label, bckgnd) {\n        var label_rect = label.getBoundingClientRect();\n        var width = label_rect.width / zoom_factor - 2;\n        var height = parseFloat(bckgnd.getAttribute('height'));\n\n        bckgnd.setAttribute('x', (text_center.x - width / 2 - 1)+'');\n        bckgnd.setAttribute('y', (text_center.y - (height - 1))+'');\n        bckgnd.setAttribute('width', (width + 2)+'');\n      }\n      return labelElementService;\n    }\n  ]);\n"]}