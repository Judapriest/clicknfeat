{"version":3,"sources":["editDamage.es6"],"names":[],"mappings":"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","file":"editDamage.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .controller('clickGameEditDamageCtrl', gameEditDamageCtrl)\n    .directive('clickGameEditDamage', gameEditDamageDirectiveFactory);\n\n  gameEditDamageCtrl.$inject = [\n    '$scope',\n  ];\n  function gameEditDamageCtrl() {\n    console.log('init clickGameEditDamageCtrl');\n  }\n\n  gameEditDamageDirectiveFactory.$inject = [\n    'gameFactions',\n    'gameMap',\n  ];\n  function gameEditDamageDirectiveFactory(gameFactionsModel,\n                                          gameMapService) {\n    return {\n      restrict: 'A',\n      templateUrl: 'app/components/game/edit_damage/edit_damage.html',\n      scope: true,\n      controller: 'clickGameEditDamageCtrl',\n      controllerAs: 'edit_damage',\n      link: link\n    };\n\n    function link(scope, element) {\n      console.log('gameEditDamage');\n      const viewport = document.getElementById('viewport');\n      const map = document.getElementById('map');\n      const state = scope.state;\n      const container = element[0];\n\n      let opened = false;\n      closeEditDamage();\n      scope.onStateChangeEvent('Game.editDamage.toggle', toggleEditDamage, scope);\n      scope.onStateChangeEvent('Game.editDamage.open', openEditDamage, scope);\n      scope.onStateChangeEvent('Game.editDamage.close', closeEditDamage, scope);\n      scope.doClose = closeEditDamage;\n\n      function toggleEditDamage(event, selection) {\n        console.log('toggleEditDamage');\n        if(opened) {\n          closeEditDamage();\n        }\n        else {\n          openEditDamage(event, selection);\n        }\n      }\n      function closeEditDamage() {\n        // console.log('closeEditDamage');\n        opened = false;\n        scope.selection = {};\n\n        container.style.display = 'none';\n        container.style.visibility = 'hidden';\n        container.style.left = 0+'px';\n        container.style.top = 0+'px';\n      }\n      function openEditDamage(_event_, [selection]) {\n        // console.log('openEditDamage');\n        opened = true;\n        scope.selection = selection;\n        const info = gameFactionsModel\n                .getModelInfo(scope.selection.state.info, state.factions);\n        scope.info = info;\n        scope.$digest();\n\n        self.window.requestAnimationFrame(displayEditDamage);\n      }\n      function displayEditDamage() {\n        container.style.display = 'initial';\n        container.style.visibility = 'hidden';\n\n        self.window.requestAnimationFrame(showEditDamage);\n      }\n      function showEditDamage() {\n        placeEditDamage();\n        container.style.visibility = 'visible';\n      }\n      function placeEditDamage() {\n        const detail_rect = container.getBoundingClientRect();\n        const screen_pos = gameMapService\n                .mapToScreenCoordinates(map, scope.selection.state);\n        const viewport_rect = viewport.getBoundingClientRect();\n\n        const max_top = viewport_rect.height - detail_rect.height;\n        const max_left = viewport_rect.width - detail_rect.width;\n\n        const top = Math.max(0,\n                             Math.min(max_top,\n                                      screen_pos.y - detail_rect.height / 2\n                                     )\n                            );\n        const left = Math.max(0,\n                              Math.min(max_left,\n                                       screen_pos.x - detail_rect.width / 2\n                                      )\n                             );\n\n        container.style.top = top + 'px';\n        container.style.left = left + 'px';\n      }\n    }\n  }\n})();\n"]}