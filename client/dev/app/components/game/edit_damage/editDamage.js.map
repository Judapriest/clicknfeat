{"version":3,"sources":["editDamage.es6"],"names":[],"mappings":"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","file":"editDamage.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .controller('clickGameEditDamageCtrl', gameEditDamageCtrl)\n    .directive('clickGameEditDamage', gameEditDamageDirectiveFactory);\n\n  gameEditDamageCtrl.$inject = [\n    '$scope',\n  ];\n  function gameEditDamageCtrl() {\n    console.log('init clickGameEditDamageCtrl');\n  }\n\n  gameEditDamageDirectiveFactory.$inject = [\n    'appAction',\n    'appGame',\n    'gameMap',\n    'gameModelSelection',\n  ];\n  function gameEditDamageDirectiveFactory(appActionService,\n                                          appGameService,\n                                          gameMapService,\n                                          gameModelSelectionModel) {\n    return {\n      restrict: 'A',\n      templateUrl: 'app/components/game/edit_damage/edit_damage.html',\n      scope: true,\n      controller: 'clickGameEditDamageCtrl',\n      controllerAs: 'edit_damage',\n      link: link\n    };\n\n    function link(scope, element) {\n      console.log('gameEditDamage');\n      const viewport = document.getElementById('viewport');\n      const map = document.getElementById('map');\n      const container = element[0];\n\n      // let opened = false;\n      closeEditDamage();\n      scope.listenSignal((edit_damage) => {\n        if(R.isNil(edit_damage.selection)) {\n          closeEditDamage();\n        }\n        else {\n          openEditDamage(edit_damage);\n        }\n      }, appGameService.view.edit_damage_changes, scope);\n      scope.listenSignal(([sel]) => {\n        if(scope.selection.state &&\n           !gameModelSelectionModel.in('local', scope.selection.state.stamp, sel)) {\n          appActionService.defer('Game.view.editDamage.reset');\n        }\n      }, appGameService.models.selection_changes, scope);\n      function closeEditDamage() {\n        console.log('closeEditDamage');\n        // opened = false;\n        scope.selection = {};\n\n        container.style.display = 'none';\n        container.style.visibility = 'hidden';\n        container.style.left = 0+'px';\n        container.style.top = 0+'px';\n      }\n      function openEditDamage(edit_damage) {\n        console.log('openEditDamage');\n        // opened = true;\n        scope.selection = edit_damage.selection;\n        scope.info = scope.selection.info;\n\n        self.window.requestAnimationFrame(displayEditDamage);\n      }\n      function displayEditDamage() {\n        container.style.display = 'initial';\n        container.style.visibility = 'hidden';\n\n        self.window.requestAnimationFrame(showEditDamage);\n      }\n      function showEditDamage() {\n        placeEditDamage();\n        container.style.visibility = 'visible';\n      }\n      function placeEditDamage() {\n        const detail_rect = container.getBoundingClientRect();\n        const screen_pos = gameMapService\n                .mapToScreenCoordinates(map, scope.selection.state);\n        const viewport_rect = viewport.getBoundingClientRect();\n\n        const max_top = viewport_rect.height - detail_rect.height;\n        const max_left = viewport_rect.width - detail_rect.width;\n\n        const top = Math.max(0,\n                             Math.min(max_top,\n                                      screen_pos.y - detail_rect.height / 2\n                                     )\n                            );\n        const left = Math.max(0,\n                              Math.min(max_left,\n                                       screen_pos.x - detail_rect.width / 2\n                                      )\n                             );\n\n        container.style.top = top + 'px';\n        container.style.left = left + 'px';\n      }\n    }\n  }\n})();\n"]}