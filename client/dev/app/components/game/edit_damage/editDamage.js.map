{"version":3,"sources":["editDamage.es6"],"names":[],"mappings":";;AAAA,CAAC,YAAW;AACV,UAAQ,MAAR,CAAe,qBAAf,EACG,UADH,CACc,yBADd,EACyC,kBADzC,EAEG,SAFH,CAEa,qBAFb,EAEoC,8BAFpC,EADU;;AAKV,qBAAmB,OAAnB,GAA6B,CAC3B,QAD2B,CAA7B,CALU;AAQV,WAAS,kBAAT,GAA8B;AAC5B,YAAQ,GAAR,CAAY,8BAAZ,EAD4B;GAA9B;;AAIA,iCAA+B,OAA/B,GAAyC,CACvC,MADuC,EAEvC,cAFuC,EAGvC,SAHuC,CAAzC,CAZU;AAiBV,WAAS,8BAAT,CAAwC,WAAxC,EACwC,mBADxC,EAEwC,cAFxC,EAEwD;AACtD,WAAO;AACL,gBAAU,GAAV;AACA,mBAAa,kDAAb;AACA,aAAO,IAAP;AACA,kBAAY,yBAAZ;AACA,oBAAc,aAAd;AACA,YAAM,IAAN;KANF,CADsD;;AAUtD,aAAS,IAAT,CAAc,KAAd,EAAqB,OAArB,EAA8B;AAC5B,cAAQ,GAAR,CAAY,gBAAZ,EAD4B;AAE5B,UAAM,WAAW,SAAS,cAAT,CAAwB,UAAxB,CAAX,CAFsB;AAG5B,UAAM,MAAM,SAAS,cAAT,CAAwB,KAAxB,CAAN,CAHsB;AAI5B,UAAM,QAAQ,MAAM,KAAN,CAJc;AAK5B,UAAM,YAAY,QAAQ,CAAR,CAAZ,CALsB;;AAO5B,UAAI,SAAS,KAAT,CAPwB;AAQ5B,wBAR4B;AAS5B,YAAM,kBAAN,CAAyB,wBAAzB,EAAmD,gBAAnD,EAAqE,KAArE,EAT4B;AAU5B,YAAM,kBAAN,CAAyB,sBAAzB,EAAiD,cAAjD,EAAiE,KAAjE,EAV4B;AAW5B,YAAM,kBAAN,CAAyB,uBAAzB,EAAkD,eAAlD,EAAmE,KAAnE,EAX4B;AAY5B,YAAM,OAAN,GAAgB,eAAhB,CAZ4B;;AAc5B,eAAS,gBAAT,CAA0B,KAA1B,EAAiC,SAAjC,EAA4C;AAC1C,gBAAQ,GAAR,CAAY,kBAAZ,EAD0C;AAE1C,YAAG,MAAH,EAAW;AACT,4BADS;SAAX,MAGK;AACH,yBAAe,KAAf,EAAsB,SAAtB,EADG;SAHL;OAFF;AASA,eAAS,eAAT,GAA2B;;AAEzB,iBAAS,KAAT,CAFyB;AAGzB,cAAM,SAAN,GAAkB,EAAlB,CAHyB;;AAKzB,kBAAU,KAAV,CAAgB,OAAhB,GAA0B,MAA1B,CALyB;AAMzB,kBAAU,KAAV,CAAgB,UAAhB,GAA6B,QAA7B,CANyB;AAOzB,kBAAU,KAAV,CAAgB,IAAhB,GAAuB,IAAE,IAAF,CAPE;AAQzB,kBAAU,KAAV,CAAgB,GAAhB,GAAsB,IAAE,IAAF,CARG;OAA3B;AAUA,eAAS,cAAT,CAAwB,MAAxB,EAAgC,SAAhC,EAA2C;;AAEzC,iBAAS,IAAT,CAFyC;AAGzC,cAAM,SAAN,GAAkB,SAAlB,CAHyC;AAIzC,4BACG,aADH,CACiB,MAAM,SAAN,CAAgB,KAAhB,CAAsB,IAAtB,EAA4B,MAAM,QAAN,CAD7C,CAEG,IAFH,CAEQ,UAAC,IAAD,EAAU;AACd,gBAAM,IAAN,GAAa,IAAb,CADc;AAEd,gBAAM,OAAN,GAFc;SAAV,CAFR,CAJyC;;AAWzC,aAAK,MAAL,CAAY,qBAAZ,CAAkC,iBAAlC,EAXyC;OAA3C;AAaA,eAAS,iBAAT,GAA6B;AAC3B,kBAAU,KAAV,CAAgB,OAAhB,GAA0B,SAA1B,CAD2B;AAE3B,kBAAU,KAAV,CAAgB,UAAhB,GAA6B,QAA7B,CAF2B;;AAI3B,aAAK,MAAL,CAAY,qBAAZ,CAAkC,cAAlC,EAJ2B;OAA7B;AAMA,eAAS,cAAT,GAA0B;AACxB,0BADwB;AAExB,kBAAU,KAAV,CAAgB,UAAhB,GAA6B,SAA7B,CAFwB;OAA1B;AAIA,eAAS,eAAT,GAA2B;AACzB,YAAM,cAAc,UAAU,qBAAV,EAAd,CADmB;AAEzB,YAAM,aAAa,eAAe,sBAAf,CAAsC,GAAtC,EAA2C,MAAM,SAAN,CAAgB,KAAhB,CAAxD,CAFmB;AAGzB,YAAM,gBAAgB,SAAS,qBAAT,EAAhB,CAHmB;;AAKzB,YAAM,UAAU,cAAc,MAAd,GAAuB,YAAY,MAAZ,CALd;AAMzB,YAAM,WAAW,cAAc,KAAd,GAAsB,YAAY,KAAZ,CANd;;AAQzB,YAAM,MAAM,KAAK,GAAL,CAAS,CAAT,EAAY,KAAK,GAAL,CAAS,OAAT,EAAkB,WAAW,CAAX,GAAe,YAAY,MAAZ,GAAqB,CAArB,CAA7C,CAAN,CARmB;AASzB,YAAM,OAAO,KAAK,GAAL,CAAS,CAAT,EAAY,KAAK,GAAL,CAAS,QAAT,EAAmB,WAAW,CAAX,GAAe,YAAY,KAAZ,GAAoB,CAApB,CAA9C,CAAP,CATmB;;AAWzB,kBAAU,KAAV,CAAgB,GAAhB,GAAsB,MAAM,IAAN,CAXG;AAYzB,kBAAU,KAAV,CAAgB,IAAhB,GAAuB,OAAO,IAAP,CAZE;OAA3B;KAxDF;GAZF;CAjBD,CAAD","file":"editDamage.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .controller('clickGameEditDamageCtrl', gameEditDamageCtrl)\n    .directive('clickGameEditDamage', gameEditDamageDirectiveFactory);\n\n  gameEditDamageCtrl.$inject = [\n    '$scope',\n  ];\n  function gameEditDamageCtrl() {\n    console.log('init clickGameEditDamageCtrl');\n  }\n\n  gameEditDamageDirectiveFactory.$inject = [\n    'game',\n    'gameFactions',\n    'gameMap',\n  ];\n  function gameEditDamageDirectiveFactory(gameService,\n                                          gameFactionsService,\n                                          gameMapService) {\n    return {\n      restrict: 'A',\n      templateUrl: 'app/components/game/edit_damage/edit_damage.html',\n      scope: true,\n      controller: 'clickGameEditDamageCtrl',\n      controllerAs: 'edit_damage',\n      link: link\n    };\n\n    function link(scope, element) {\n      console.log('gameEditDamage');\n      const viewport = document.getElementById('viewport');\n      const map = document.getElementById('map');\n      const state = scope.state;\n      const container = element[0];\n\n      let opened = false;\n      closeEditDamage();\n      scope.onStateChangeEvent('Game.editDamage.toggle', toggleEditDamage, scope);\n      scope.onStateChangeEvent('Game.editDamage.open', openEditDamage, scope);\n      scope.onStateChangeEvent('Game.editDamage.close', closeEditDamage, scope);\n      scope.doClose = closeEditDamage;\n\n      function toggleEditDamage(event, selection) {\n        console.log('toggleEditDamage');\n        if(opened) {\n          closeEditDamage();\n        }\n        else {\n          openEditDamage(event, selection);\n        }\n      }\n      function closeEditDamage() {\n        // console.log('closeEditDamage');\n        opened = false;\n        scope.selection = {};\n\n        container.style.display = 'none';\n        container.style.visibility = 'hidden';\n        container.style.left = 0+'px';\n        container.style.top = 0+'px';\n      }\n      function openEditDamage($event, selection) {\n        // console.log('openEditDamage');\n        opened = true;\n        scope.selection = selection;\n        gameFactionsService\n          .getModelInfoP(scope.selection.state.info, state.factions)\n          .then((info) => {\n            scope.info = info;\n            scope.$digest();\n          });\n\n        self.window.requestAnimationFrame(displayEditDamage);\n      }\n      function displayEditDamage() {\n        container.style.display = 'initial';\n        container.style.visibility = 'hidden';\n\n        self.window.requestAnimationFrame(showEditDamage);\n      }\n      function showEditDamage() {\n        placeEditDamage();\n        container.style.visibility = 'visible';\n      }\n      function placeEditDamage() {\n        const detail_rect = container.getBoundingClientRect();\n        const screen_pos = gameMapService.mapToScreenCoordinates(map, scope.selection.state);\n        const viewport_rect = viewport.getBoundingClientRect();\n\n        const max_top = viewport_rect.height - detail_rect.height;\n        const max_left = viewport_rect.width - detail_rect.width;\n\n        const top = Math.max(0, Math.min(max_top, screen_pos.y - detail_rect.height / 2));\n        const left = Math.max(0, Math.min(max_left, screen_pos.x - detail_rect.width / 2));\n\n        container.style.top = top + 'px';\n        container.style.left = left + 'px';\n      }\n    }\n  }\n})();\n"]}