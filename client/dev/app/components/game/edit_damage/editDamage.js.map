{"version":3,"sources":["editDamage.es6"],"names":[],"mappings":"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","file":"editDamage.js","sourcesContent":["angular.module('clickApp.controllers')\n  .controller('clickGameEditDamageCtrl', [\n    '$scope',\n    function() {\n      console.log('init clickGameEditDamageCtrl');\n    }\n  ]);\n\nangular.module('clickApp.directives')\n  .directive('clickGameEditDamage', [\n    '$window',\n    'game',\n    'gameFactions',\n    'gameMap',\n    function($window,\n             gameService,\n             gameFactionsService,\n             gameMapService) {\n      return {\n        restrict: 'A',\n        template: [ '<click-game-model-damage info=\"info.damage\"',\n                    '  state=\"selection.state\"',\n                    '  on-error=\"gameEvent(\\'modeActionError\\', reason)\">',\n                    '</click-game-model-damage>',\n                  ].join(''),\n        scope: true,\n        controller: 'clickGameEditDamageCtrl',\n        link: function(scope, element) {\n          console.log('gameEditDamage');\n          let viewport = document.getElementById('viewport');\n          let map = document.getElementById('map');\n          let state = scope.state;\n\n          let opened = false;\n          function toggleEditDamage(event, selection) {\n            console.log('toggleEditDamage');\n            if(opened) {\n              closeEditDamage();\n            }\n            else {\n              openEditDamage(event, selection);\n            }\n          }\n\n          closeEditDamage();\n          function closeEditDamage() {\n            // console.log('closeEditDamage');\n\n            opened = false;\n            scope.selection = {};\n\n            element[0].style.display = 'none';\n            element[0].style.visibility = 'hidden';\n            element[0].style.left = 0+'px';\n            element[0].style.top = 0+'px';\n          }\n          function openEditDamage($event, selection) {\n            // console.log('openEditDamage');\n\n            opened = true;\n            scope.selection = selection;\n            gameFactionsService.getModelInfo(scope.selection.state.info,\n                                             state.factions)\n              .then((info) => {\n                scope.info = info;\n                scope.$digest();\n              });\n\n            $window.requestAnimationFrame(displayEditDamage);\n          }\n          function displayEditDamage() {\n            element[0].style.display = 'initial';\n            element[0].style.visibility = 'hidden';\n\n            $window.requestAnimationFrame(showEditDamage);\n          }\n          function showEditDamage() {\n            placeEditDamage();\n            element[0].style.visibility = 'visible';\n          }\n          function placeEditDamage() {\n            let detail_rect = element[0].getBoundingClientRect();\n            let screen_pos = gameMapService.mapToScreenCoordinates(map, scope.selection.state);\n            let viewport_rect = viewport.getBoundingClientRect();\n\n            let max_top = viewport_rect.height - detail_rect.height;\n            let max_left = viewport_rect.width - detail_rect.width;\n\n            let top = Math.max(0, Math.min(max_top, screen_pos.y - detail_rect.height / 2));\n            let left = Math.max(0, Math.min(max_left, screen_pos.x - detail_rect.width / 2));\n\n            element[0].style.top = top + 'px';\n            element[0].style.left = left + 'px';\n          }\n\n          scope.onStateChangeEvent('Game.editDamage.toggle', toggleEditDamage, scope);\n          scope.onStateChangeEvent('Game.editDamage.open', openEditDamage, scope);\n          scope.onStateChangeEvent('Game.editDamage.close', closeEditDamage, scope);\n          scope.doClose = closeEditDamage;\n        }\n      };\n    }\n  ]);\n"]}