{"version":3,"sources":["gameMap.es6"],"names":[],"mappings":"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","file":"gameMap.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .directive('clickGameMap', clickGameMapDirectiveFactory);\n\n  clickGameMapDirectiveFactory.$inject = [\n    'appAction',\n    'appGame',\n    // 'appState',\n    'gameMap',\n    'terrain',\n    'commonMode',\n  ];\n  function clickGameMapDirectiveFactory(appActionService,\n                                        appGameService,\n                                        // appStateService,\n                                        gameMapService,\n                                        terrainModel,\n                                        commonModeModel\n  ) {\n    const log = true // eslint-disable-line\n            ? R.bind(console.log, console)\n            : function() {};\n    return {\n      restrict: 'A',\n      link: link\n    };\n\n    function link(scope, element) {\n      const viewport = document.querySelector('#viewport');\n      const map = element[0];\n\n      const mouseEvents = buildMouseEvents();\n      const moveEvents = buildMoveEvents();\n      const flipMap = buildFlipMap();\n      const zoomEvents = buildZoomEvents();\n      const scrollEvents = buildScrollEvents();\n\n      map.addEventListener('mouseup', mouseEvents.click);\n      map.addEventListener('mousedown', mouseEvents.down);\n      map.addEventListener('mouseleave', mouseEvents.leave);\n      map.addEventListener('dragstart', (event) => {\n        event.preventDefault();\n      });\n      map.addEventListener('contextmenu', mouseEvents.rightClick);\n\n      scope.listenSignal(scrollEvents.left, appGameService.view.scroll_left, scope);\n      scope.listenSignal(scrollEvents.right, appGameService.view.scroll_right, scope);\n      scope.listenSignal(scrollEvents.up, appGameService.view.scroll_up, scope);\n      scope.listenSignal(scrollEvents.down, appGameService.view.scroll_down, scope);\n      scope.listenSignal(zoomEvents.in, appGameService.view.zoom_in, scope);\n      scope.listenSignal(zoomEvents.out, appGameService.view.zoom_out, scope);\n      scope.listenSignal(zoomEvents.reset, appGameService.view.zoom_reset, scope);\n      scope.listenSignal(flipMap, appGameService.view.flip_map, scope);\n      scope.listenSignal(moveEvents.enable, appGameService.view.move_map, scope);\n\n      self.window.requestAnimationFrame(zoomEvents.reset);\n\n      function buildMouseEvents() {\n        let drag = {\n          active: false,\n          start: null,\n          target: null,\n          now: null\n        };\n        return {\n          down: mouseDownMap,\n          leave: mouseLeaveMap,\n          click: clickMap,\n          rightClick: rightClickMap,\n          move: moveMap\n        };\n\n        function mouseDownMap(event) {\n          log('mouseDownMap', event, map.getBoundingClientRect());\n          blurInputs();\n          event.preventDefault();\n          if(event.which !== 1) return;\n\n          const game = appGameService.game.sample();\n          const start = gameMapService.eventToMapCoordinates(map, event);\n          const target = gameMapService.findEventTarget(game, event);\n          dragStart(start, target);\n          map.addEventListener('mousemove', dragMap);\n        }\n\n        function mouseLeaveMap(event) {\n          log('mouseLeaveMap', event);\n          event.preventDefault();\n\n          map.removeEventListener('mousemove', dragMap);\n          if(drag.active) dragEnd(event);\n        }\n\n        function clickMap(event) {\n          log('clickMap', event);\n          event.preventDefault();\n          if(event.which !== 1) return;\n\n          map.removeEventListener('mousemove', dragMap);\n\n          const game = appGameService.game.sample();\n          const now = gameMapService.eventToMapCoordinates(map, event);\n          if(drag.active) {\n            drag.now = now;\n            dragEnd(event);\n          }\n          else {\n            const target = gameMapService\n                    .findEventTarget(game, event);\n            emitClickEvent('click', event, now, target);\n          }\n        }\n\n        function rightClickMap(event) {\n          log('rightClickMap', event);\n          event.preventDefault();\n\n          const game = appGameService.game.sample();\n          const now = gameMapService.eventToMapCoordinates(map, event);\n          const target = gameMapService.findEventTarget(game, event);\n          emitClickEvent('rightClick', event, now, target);\n        }\n\n        function moveMap(event) {\n          log('moveMap', event);\n          event.preventDefault();\n\n          const now = gameMapService.eventToMapCoordinates(map, event);\n          appActionService.do('Modes.current.action',\n                              'moveMap', [now, event]);\n        }\n\n        function blurInputs() {\n          const inputs = [\n              ...document.querySelectorAll('input'),\n              ...document.querySelectorAll('select'),\n              ...document.querySelectorAll('textarea'),\n          ];\n          R.forEach((e) => { e.blur(); }, inputs);\n        }\n\n        function emitClickEvent(type, event, now, target) {\n          const event_name = R.thread(event)(\n            _eventModifiers,\n            R.append(type + target.type),\n            R.join('+')\n          );\n          event['click#'] = {\n            target: target.target,\n            x: now.x,\n            y: now.y\n          };\n          Mousetrap.trigger(event_name, undefined, event);\n        }\n\n        function dragStart(start, target) {\n          drag = {\n            active: false,\n            start: start,\n            target: target,\n            now: null\n          };\n        }\n        function dragMap(event) {\n          log('dragMap', event);\n          event.preventDefault();\n          if(event.which !== 1) return;\n\n          drag.now = gameMapService.eventToMapCoordinates(map, event);\n          if(!drag.active &&\n             currentDragIsBellowThreshold()) {\n            return;\n          }\n          const emit = drag.active ? 'drag' : 'dragStart';\n          drag.active = true;\n\n          if('Terrain' === drag.target.type &&\n             terrainModel.isLocked(drag.target.target)) {\n            drag.target = { type: 'Map',\n                            target: null\n                          };\n          }\n          appActionService.do('Modes.current.action',\n                              emit+drag.target.type,\n                              [ { target: drag.target.target,\n                                  start: drag.start,\n                                  now: drag.now\n                                },\n                                event\n                              ]);\n\n        }\n        function dragEnd(event) {\n          appActionService.do('Modes.current.action',\n                              'dragEnd'+drag.target.type,\n                              [ { target: drag.target.target,\n                                  start: drag.start,\n                                  now: drag.now\n                                },\n                                event\n                              ]);\n          drag = {\n            active: false,\n            start: null,\n            target: null,\n            now: null\n          };\n        }\n        function currentDragIsBellowThreshold() {\n          const epsilon = commonModeModel.settings().DragEpsilon;\n          return ( Math.abs(drag.now.x - drag.start.x) < epsilon &&\n                   Math.abs(drag.now.y - drag.start.y) < epsilon\n                 );\n        }\n      }\n\n      function buildMoveEvents() {\n        let move_enabled = false;\n        return {\n          enable: onEnableMove\n        };\n\n        function onEnableMove(enable) {\n          if(enable && !move_enabled) {\n            map.addEventListener('mousemove', mouseEvents.move);\n            move_enabled = true;\n          }\n          if(!enable && move_enabled) {\n            map.removeEventListener('mousemove', mouseEvents.move);\n            move_enabled = false;\n          }\n        }\n      }\n\n      function buildFlipMap() {\n        let deploiement_labels;\n        init();\n        return onFlipMap;\n\n        function init() {\n          map.classList.remove('flipped');\n        }\n\n        function onFlipMap(flipped) {\n          deploiement_labels = document.querySelector('#deploiement-labels');\n          if(R.isNil(deploiement_labels)) return;\n          if(flipped) {\n            map.classList.add('flipped');\n            deploiement_labels\n              .setAttribute('transform','rotate(180,240,240)');\n          }\n          else {\n            map.classList.remove('flipped');\n            deploiement_labels\n              .setAttribute('transform','');\n          }\n        }\n      }\n\n      function buildZoomEvents() {\n        return {\n          'in': zoomIn,\n          out: zoomOut,\n          reset: zoomReset\n        };\n\n        function zoomReset() {\n          const rect = viewport.getBoundingClientRect();\n          const hw = Math.min(rect.width, rect.height);\n          setMapDimensions(hw-15);\n        }\n        function zoomIn() {\n          const zoom_factor = commonModeModel.settings().ZoomFactor;\n          let [[cx,cy],[vw,vh]] = findViewportCenter();\n\n          const rect = map.getBoundingClientRect();\n          cx = (vw > rect.width) ? rect.width / zoom_factor : cx;\n          cy = (vh > rect.height) ? rect.height / zoom_factor : cy;\n\n          setMapDimensions(rect.width * zoom_factor);\n          setViewportCenter(cx * zoom_factor, cy * zoom_factor, vw, vh);\n        }\n        function zoomOut() {\n          const zoom_factor = commonModeModel.settings().ZoomFactor;\n          const [[cx,cy],[vw,vh]] = findViewportCenter();\n          const hw = Math.min(vw, vh);\n\n          const rect = map.getBoundingClientRect();\n\n          setMapDimensions(Math.max(hw-15, rect.width / zoom_factor));\n          setViewportCenter(cx / zoom_factor, cy / zoom_factor, vw, vh);\n        }\n      }\n\n      function buildScrollEvents() {\n        return {\n          left: scrollLeft,\n          right: scrollRight,\n          up: scrollUp,\n          down: scrollDown\n        };\n\n        function scrollLeft() {\n          const scroll_step = commonModeModel.settings().ScrollStep;\n          const left = viewport.scrollLeft;\n          self.window.requestAnimationFrame(() => {\n            viewport.scrollLeft = left - scroll_step;\n          });\n        }\n        function scrollRight() {\n          const scroll_step = commonModeModel.settings().ScrollStep;\n          const left = viewport.scrollLeft;\n          self.window.requestAnimationFrame(() => {\n            viewport.scrollLeft = left + scroll_step;\n          });\n        }\n        function scrollUp() {\n          const scroll_step = commonModeModel.settings().ScrollStep;\n          const top = viewport.scrollTop;\n          self.window.requestAnimationFrame(() => {\n            viewport.scrollTop = top - scroll_step;\n          });\n        }\n        function scrollDown() {\n          const scroll_step = commonModeModel.settings().ScrollStep;\n          const top = viewport.scrollTop;\n          self.window.requestAnimationFrame(() => {\n            viewport.scrollTop = top + scroll_step;\n          });\n        }\n      }\n\n      function setMapDimensions(dim) {\n        map.style.width = dim+'px';\n        map.style.height = dim+'px';\n      }\n      function findViewportCenter() {\n        const rect = viewport.getBoundingClientRect();\n        const vw = rect.width;\n        const vh = rect.height;\n\n        const cx = viewport.scrollLeft + vw/2;\n        const cy = viewport.scrollTop + vh/2;\n\n        return [[cx, cy], [vw, vh]];\n      }\n      function setViewportCenter(cx, cy, vw, vh) {\n        viewport.scrollLeft = cx - vw/2;\n        viewport.scrollTop = cy - vh/2;\n      }\n    }\n  }\n  function _eventModifiers(e) {\n    const modifiers = [];\n\n    if (e.shiftKey) {\n      modifiers.push('shift');\n    }\n\n    if (e.altKey) {\n      modifiers.push('alt');\n    }\n\n    if (e.ctrlKey) {\n      modifiers.push('ctrl');\n    }\n\n    if (e.metaKey) {\n      modifiers.push('meta');\n    }\n\n    return modifiers.sort();\n  }\n})();\n"]}