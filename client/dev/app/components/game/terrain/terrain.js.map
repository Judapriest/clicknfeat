{"version":3,"sources":["terrain.es6"],"names":[],"mappings":"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","file":"terrain.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .directive('clickGameTerrain', clickGameTerrainDirectiveFactory)\n    .directive('clickGameTerrainsList', clickGameTerrainsListDirectiveFactory);\n\n  clickGameTerrainDirectiveFactory.$inject = [\n    '$rootScope',\n    'terrain',\n    'gameTerrainSelection',\n  ];\n  function clickGameTerrainDirectiveFactory($rootScope,\n                                            terrainModel,\n                                            gameTerrainSelectionModel) {\n    return {\n      restrict: 'A',\n      link: link\n    };\n\n    function link(scope, parent) {\n      parent = parent[0];\n      console.log('gameTerrain', scope.terrain);\n      return buildTerrainElement(scope, parent);\n    }\n    function buildTerrainElement(scope, parent) {\n      const state = $rootScope.state;\n      const render = terrainModel.render(state.terrains, scope.terrain.state);\n      initTerrainElement(render, parent);\n      scope.pos = render;\n      updateTerrainSelection(state.game.terrain_selection,\n                             scope.terrain, scope);\n\n      const updateTerrain = gameTerrainOnUpdate(scope);\n      scope.onStateChangeEvent('Game.terrains.change',\n                               updateTerrain, scope);\n      scope.onStateChangeEvent(`Game.terrain.change.${scope.terrain.state.stamp}`,\n                               gameTerrainOnUpdate_(scope), scope);\n      scope.onStateChangeEvent('Game.terrain_selection.change',\n                               updateTerrain, scope);\n    }\n    function initTerrainElement(render, parent) {\n      const image = parent.querySelector('image');\n      image.setAttribute('data-stamp', render.stamp);\n      image.setAttribute('width', render.width+'');\n      image.setAttribute('height', render.height+'');\n      image.setAttributeNS('http://www.w3.org/1999/xlink',\n                           'href', render.img_link);\n\n      const edge = parent.querySelector('rect');\n      edge.setAttribute('width', render.width+'');\n      edge.setAttribute('height', render.height+'');\n    }\n    function gameTerrainOnUpdate(scope) {\n      const onUpdate_ = gameTerrainOnUpdate_(scope);\n      let _terrain = scope.terrain;\n      let _selection = R.path(['game', 'terrain_selection'], $rootScope.state);\n      return () => {\n        const current_selection = R.path(['game', 'terrain_selection'], $rootScope.state);\n        if( scope.terrain === _terrain &&\n            current_selection === _selection ) {\n          return;\n        }\n        _terrain = scope.terrain;\n        _selection = current_selection;\n        onUpdate_();\n      };\n    }\n    function gameTerrainOnUpdate_(scope) {\n      return () => {\n        console.warn('RENDER TERRAIN', scope.terrain.state.stamp);\n        const state = $rootScope.state;\n        const render = terrainModel.render(state.terrains, scope.terrain.state);\n        scope.pos = render;\n        updateTerrainSelection(state.game.terrain_selection,\n                               scope.terrain, scope);\n        scope.$digest();\n      };\n    }\n    function updateTerrainSelection(selection, terrain, scope) {\n      const stamp = terrain.state.stamp;\n      scope.selection = {\n        local: gameTerrainSelectionModel\n          .in('local', stamp, selection),\n        remote: gameTerrainSelectionModel\n          .in('remote', stamp, selection)\n      };\n    }\n  }\n\n  clickGameTerrainsListDirectiveFactory.$inject = [];\n  function clickGameTerrainsListDirectiveFactory() {\n    return {\n      restrict: 'A',\n      templateUrl: 'app/components/game/terrain/terrains_list.html',\n      scope: true,\n      link: link\n    };\n\n    function link(scope, _element_, attrs) {\n      scope.type = attrs.clickGameTerrainsList;\n      scope.digestOnStateChangeEvent('Game.terrains.change', scope);\n      console.log('clickGameTerrainsList', scope.type);\n    }\n  }\n})();\n"]}