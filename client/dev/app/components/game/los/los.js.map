{"version":3,"sources":["los.es6"],"names":[],"mappings":"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","file":"los.js","sourcesContent":["angular.module('clickApp.directives')\n  .directive('clickGameLos', [\n    'modes',\n    'gameLos',\n    'gameModels',\n    'gameFactions',\n    function(modesService,\n             gameLosService,\n             gameModelsService,\n             gameFactionsService) {\n      return {\n        restrict: 'A',\n        link: (scope, parent) => {\n          let map = document.getElementById('map');\n          let under_models_container = document.getElementById('game-under-models');\n          let svgNS = map.namespaceURI;\n\n          let state = scope.state;\n          let local_element = createLosElement(svgNS, under_models_container, parent[0]);\n          let remote_element = createLosElement(svgNS, under_models_container, parent[0]);\n\n          scope.onStateChangeEvent('Game.los.local.change', () => {\n            updateLine(state.game.los.local, local_element.line);\n          }, scope);\n          scope.onStateChangeEvent('Game.los.remote.change', () => {\n            updateLine(state.game.los.remote, remote_element.line);\n\n            let display = ( gameLosService.isDisplayed(state.game.los) ||\n                            'LoS' === modesService.currentModeName(state.modes)\n                          );\n            updateEnvelope(state.game.los, display, remote_element.envelope);\n            updateOriginTarget(state.factions, state.game.models,\n                               gameLosService.origin(state.game.los), display,\n                               remote_element.origin);\n            updateOriginTarget(state.factions, state.game.models,\n                               gameLosService.target(state.game.los), display,\n                               remote_element.target);\n          }, scope);\n        }\n      };\n      function createLosElement(svgNS, under_models_container, parent) {\n        let group = document.createElementNS(svgNS, 'g');\n        parent.appendChild(group);\n\n        let line = document.createElementNS(svgNS, 'line');\n        line.style['marker-start'] = 'url(#los-start)';\n        line.style['marker-end'] = 'url(#los-end)';\n        group.appendChild(line);\n\n        let origin = document.createElementNS(svgNS, 'circle');\n        origin.classList.add('los-origin');\n        origin.setAttribute('cx', '0');\n        origin.setAttribute('cy', '0');\n        origin.setAttribute('r', '0');\n        origin.style.visibility = 'hidden';\n        parent.appendChild(origin);\n\n        let target = document.createElementNS(svgNS, 'circle');\n        target.classList.add('los-target');\n        target.setAttribute('cx', '0');\n        target.setAttribute('cy', '0');\n        target.setAttribute('r', '0');\n        target.style.visibility = 'hidden';\n        parent.appendChild(target);\n\n        let envelope = document.createElementNS(svgNS, 'polygon');\n        envelope.classList.add('los-envelope');\n        envelope.setAttribute('points', '0,0 0,0 0,0');\n        envelope.style.visibility = 'hidden';\n        under_models_container.insertBefore(envelope, under_models_container.firstChild);\n\n        return { container: group,\n                 line: line,\n                 origin: origin,\n                 target: target,\n                 envelope: envelope\n               };\n      }\n      function updateLine(los, line) {\n        line.style['visibility'] = los.display ? 'visible' : 'hidden';\n        line.setAttribute('x1', los.start.x+'');\n        line.setAttribute('y1', los.start.y+'');\n        line.setAttribute('x2', los.end.x+'');\n        line.setAttribute('y2', los.end.y+'');\n      }\n      function updateEnvelope(los, display, envelope) {\n        let {\n          left:  { start: { x: x1 = 0, y: y1 = 0 } = {},\n                   end:   { x: x2 = 0, y: y2 = 0 } = {}\n                 } = {},\n          right: { start: { x: x4 = 0, y: y4 = 0 } = {},\n                   end:   { x: x3 = 0, y: y3 = 0 } = {}\n                 } = {}\n        } = R.pathOr({}, ['computed', 'envelope'], los);\n        let points = [\n          [ x1, y1 ].join(','),\n          [ x2, y2 ].join(','),\n          [ x3, y3 ].join(','),\n          [ x4, y4 ].join(','),\n        ].join(' ');\n        // console.log('gameLos envelope points', points);\n        envelope.setAttribute('points', points);\n        envelope.style['visibility'] = display ? 'visible' : 'hidden';\n      }\n      function updateOriginTarget(factions, models, stamp, display, element) {\n        R.pipeP(\n          (stamp) => {\n            if(R.exists(stamp)) {\n              return gameModelsService.findStamp(stamp, models);\n            }\n            return self.Promise.reject();\n          },\n          (model) => {\n            if( !display ||\n                R.isNil(model) ) {\n              element.style.visibility = 'hidden';\n              return self.Promise.reject();\n            }\n            return R.pipeP(\n              gameFactionsService.getModelInfo$(model.state.info),\n              (info) => {\n                element.setAttribute('cx', model.state.x+'');\n                element.setAttribute('cy', model.state.y+'');\n                element.setAttribute('r', info.base_radius+'');\n                element.style.visibility = 'visible';\n              }\n            )(factions);\n          }\n        )(stamp).catch(R.always(null));\n      }\n    }\n  ])\n  .directive('clickGameLosClip', [\n    function() {\n      return {\n        restrict: 'A',\n        link: (scope, element) => {\n          let state = scope.state;\n\n          scope.onStateChangeEvent('Game.loaded', () => {\n            updateEnvelope(state.game.los, element[0]);\n          }, scope);\n\n          scope.onStateChangeEvent('Game.los.remote.change', () => {\n            updateEnvelope(state.game.los, element[0]);\n          }, scope);\n        }\n      };\n      function updateEnvelope(los, envelope) {\n        let {\n          left:  { start: { x: x1 = 0, y: y1 = 0 } = {},\n                   end:   { x: x2 = 0, y: y2 = 0 } = {}\n                 } = {},\n          right: { start: { x: x4 = 0, y: y4 = 0 } = {},\n                   end:   { x: x3 = 0, y: y3 = 0 } = {}\n                 } = {}\n        } = R.pathOr({}, ['computed', 'envelope'], los);\n        let points = [\n          [ x1, y1 ].join(','),\n          [ x2, y2 ].join(','),\n          [ x3, y3 ].join(','),\n          [ x4, y4 ].join(','),\n        ].join(' ');\n        // console.log('gameLos clip points', points, los);\n        envelope.setAttribute('points', points);\n      }\n    }\n  ])\n  .directive('clickGameLosDarkness', [\n    'gameLos',\n    'modes',\n    function(gameLosService,\n             modesService) {\n      return {\n        restrict: 'A',\n        link: (scope, element) => {\n          let state = scope.state;\n          updatePolygon(scope, state, element[0]);\n\n          scope.onStateChangeEvent('Game.remote.los.change', () => {\n            updatePolygon(scope, state, state.game.los, element[0]);\n          }, scope);\n        }\n      };\n      function updatePolygon(scope, state, polygon) {\n        let {\n          left:  { start: { x: x1 = 0, y: y1 = 0 } = {},\n                   end:   { x: x2 = 0, y: y2 = 0 } = {}\n                 } = {},\n          right: { start: { x: x4 = 0, y: y4 = 0 } = {},\n                   end:   { x: x3 = 0, y: y3 = 0 } = {}\n                 } = {}\n        } = R.propOr({}, 'envelope', scope);\n        let points = [\n          [ x1, y1 ].join(','),\n          [ x2, y2 ].join(','),\n          [ x3, y3 ].join(','),\n          [ x4, y4 ].join(','),\n        ].join(' ');\n        // console.log('gameLosDarkness envelope points', points);\n        polygon.setAttribute('points', points);\n\n        let display = ( gameLosService.isDisplayed(state.game.los) ||\n                        'LoS' === modesService.currentModeName(state.modes)\n                      );\n        polygon.style['visibility'] = display ? 'visible' : 'hidden';\n      }\n    }\n  ])\n  .directive('clickGameLosRefresh', [\n    function() {\n      return {\n        restrict: 'A',\n        scope: true,\n        link: (scope) => {\n          // console.log('gameLosRefresh', scope);\n\n          scope.digestOnStateChangeEvent('Game.los.remote.change', scope);\n        }\n      };\n    }\n  ]);\n"]}