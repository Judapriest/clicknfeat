{"version":3,"sources":["gameLos.es6"],"names":[],"mappings":"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","file":"gameLos.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .directive('clickGameLos', gameLosDirectiveFactory)\n    .directive('clickGameLosClip', gameLosClipDirectiveFactory)\n    .directive('clickGameLosDarkness', gameLosDarknessDirectiveFactory)\n    .directive('clickGameLosRefresh', gameLosRefreshDirectiveFactory);\n\n  gameLosDirectiveFactory.$inject = [\n    'modes',\n    'gameLos',\n    'gameModels',\n    'gameFactions',\n  ];\n  function gameLosDirectiveFactory(modesModel,\n                                   gameLosModel,\n                                   gameModelsModel,\n                                   gameFactionsModel) {\n    return {\n      restrict: 'A',\n      link: link\n    };\n\n    function link(scope, element) {\n      const container = element[0];\n      const map = document.getElementById('map');\n      const under_models_container = document.getElementById('game-under-models');\n      const svgNS = map.namespaceURI;\n\n      const state = scope.state;\n      const local_element = createLosElement(svgNS, under_models_container, container);\n      const remote_element = createLosElement(svgNS, under_models_container, container);\n\n      scope.onStateChangeEvent('Game.los.local.change', updateLocalLos, scope);\n      scope.onStateChangeEvent('Game.los.remote.change', updateRemoteLos, scope);\n\n      function updateLocalLos() {\n        updateLine(state.game.los.local, local_element.line);\n      }\n      function updateRemoteLos() {\n        updateLine(state.game.los.remote, remote_element.line);\n\n        const display = ( gameLosModel.isDisplayed(state.game.los) ||\n                          'LoS' === modesModel.currentModeName(state.modes)\n                        );\n        updateEnvelope(state.game.los, display, remote_element.envelope);\n        updateOriginTarget(state.factions, state.game.models,\n                           gameLosModel.origin(state.game.los), display,\n                           remote_element.origin);\n        updateOriginTarget(state.factions, state.game.models,\n                           gameLosModel.target(state.game.los), display,\n                           remote_element.target);\n      }\n    }\n    function createLosElement(svgNS, under_models_container, parent) {\n      const group = document.createElementNS(svgNS, 'g');\n      parent.appendChild(group);\n\n      const line = document.createElementNS(svgNS, 'line');\n      line.style['marker-start'] = 'url(#los-start)';\n      line.style['marker-end'] = 'url(#los-end)';\n      group.appendChild(line);\n\n      const origin = document.createElementNS(svgNS, 'circle');\n      origin.classList.add('los-origin');\n      origin.setAttribute('cx', '0');\n      origin.setAttribute('cy', '0');\n      origin.setAttribute('r', '0');\n      origin.style.visibility = 'hidden';\n      parent.appendChild(origin);\n\n      const target = document.createElementNS(svgNS, 'circle');\n      target.classList.add('los-target');\n      target.setAttribute('cx', '0');\n      target.setAttribute('cy', '0');\n      target.setAttribute('r', '0');\n      target.style.visibility = 'hidden';\n      parent.appendChild(target);\n\n      const envelope = document.createElementNS(svgNS, 'polygon');\n      envelope.classList.add('los-envelope');\n      envelope.setAttribute('points', '0,0 0,0 0,0');\n      envelope.style.visibility = 'hidden';\n      under_models_container.insertBefore(envelope, under_models_container.firstChild);\n\n      return { container: group,\n               line: line,\n               origin: origin,\n               target: target,\n               envelope: envelope\n             };\n    }\n    function updateLine(los, line) {\n      line.style['visibility'] = los.display ? 'visible' : 'hidden';\n      line.setAttribute('x1', los.start.x+'');\n      line.setAttribute('y1', los.start.y+'');\n      line.setAttribute('x2', los.end.x+'');\n      line.setAttribute('y2', los.end.y+'');\n    }\n    function updateEnvelope(los, display, envelope) {\n      const {\n        left:  { start: { x: x1 = 0, y: y1 = 0 } = {},\n                 end:   { x: x2 = 0, y: y2 = 0 } = {}\n               } = {},\n        right: { start: { x: x4 = 0, y: y4 = 0 } = {},\n                 end:   { x: x3 = 0, y: y3 = 0 } = {}\n               } = {}\n      } = R.pathOr({}, ['computed', 'envelope'], los);\n      const points = [\n        [ x1, y1 ].join(','),\n        [ x2, y2 ].join(','),\n        [ x3, y3 ].join(','),\n        [ x4, y4 ].join(','),\n      ].join(' ');\n      // console.log('gameLos envelope points', points);\n      envelope.setAttribute('points', points);\n      envelope.style['visibility'] = display ? 'visible' : 'hidden';\n    }\n    function updateOriginTarget(factions, models, stamp, display, element) {\n      element.style.visibility = 'hidden';\n      R.threadP(stamp)(\n        (stamp) => {\n          if(R.exists(stamp)) {\n            return gameModelsModel.findStampP(stamp, models);\n          }\n          return R.rejectP();\n        },\n        (model) => {\n          if( !display ||\n              R.isNil(model) ) {\n            return null;\n          }\n          return R.threadP(factions)(\n            gameFactionsModel.getModelInfoP$(model.state.info),\n            (info) => {\n              element.setAttribute('cx', model.state.x+'');\n              element.setAttribute('cy', model.state.y+'');\n              element.setAttribute('r', info.base_radius+'');\n              element.style.visibility = 'visible';\n            }\n          );\n        }\n      ).catch(R.always(null));\n    }\n  }\n\n  gameLosClipDirectiveFactory.$inject = [];\n  function gameLosClipDirectiveFactory() {\n    return {\n      restrict: 'A',\n      link: link\n    };\n    function link(scope, element) {\n      const state = scope.state;\n\n      // scope.onStateChangeEvent('Game.loaded', () => {\n      //   updateEnvelope(state.game.los, element[0]);\n      // }, scope);\n\n      scope.onStateChangeEvent('Game.los.remote.change', () => {\n        updateEnvelope(state.game.los, element[0]);\n      }, scope);\n    }\n    function updateEnvelope(los, envelope) {\n      const {\n        left:  { start: { x: x1 = 0, y: y1 = 0 } = {},\n                 end:   { x: x2 = 0, y: y2 = 0 } = {}\n               } = {},\n        right: { start: { x: x4 = 0, y: y4 = 0 } = {},\n                 end:   { x: x3 = 0, y: y3 = 0 } = {}\n               } = {}\n      } = R.pathOr({}, ['computed', 'envelope'], los);\n      const points = [\n        [ x1, y1 ].join(','),\n        [ x2, y2 ].join(','),\n        [ x3, y3 ].join(','),\n        [ x4, y4 ].join(','),\n      ].join(' ');\n      // console.log('gameLos clip points', points, los);\n      envelope.setAttribute('points', points);\n    }\n  }\n  gameLosDarknessDirectiveFactory.$inject = [\n    'gameLos',\n    'modes',\n  ];\n  function gameLosDarknessDirectiveFactory(gameLosModel,\n                                           modesModel) {\n    return {\n      restrict: 'A',\n      link: link\n    };\n    function link(scope, element) {\n      const state = scope.state;\n      updatePolygon(scope, state, element[0]);\n\n      scope.onStateChangeEvent('Game.remote.los.change', () => {\n        updatePolygon(scope, state, state.game.los, element[0]);\n      }, scope);\n    }\n    function updatePolygon(scope, state, polygon) {\n      const {\n        left:  { start: { x: x1 = 0, y: y1 = 0 } = {},\n                 end:   { x: x2 = 0, y: y2 = 0 } = {}\n               } = {},\n        right: { start: { x: x4 = 0, y: y4 = 0 } = {},\n                 end:   { x: x3 = 0, y: y3 = 0 } = {}\n               } = {}\n      } = R.propOr({}, 'envelope', scope);\n      const points = [\n        [ x1, y1 ].join(','),\n        [ x2, y2 ].join(','),\n        [ x3, y3 ].join(','),\n        [ x4, y4 ].join(','),\n      ].join(' ');\n      // console.log('gameLosDarkness envelope points', points);\n      polygon.setAttribute('points', points);\n\n      const display = ( gameLosModel.isDisplayed(state.game.los) ||\n                        'LoS' === modesModel.currentModeName(state.modes)\n                      );\n      polygon.style['visibility'] = display ? 'visible' : 'hidden';\n    }\n  }\n\n  gameLosRefreshDirectiveFactory.$inject = [];\n  function gameLosRefreshDirectiveFactory() {\n    return {\n      restrict: 'A',\n      scope: true,\n      link: link\n    };\n    function link(scope) {\n      // console.log('gameLosRefresh', scope);\n      scope.digestOnStateChangeEvent('Game.los.remote.change', scope);\n    }\n  }\n})();\n"]}