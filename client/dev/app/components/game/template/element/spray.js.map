{"version":3,"sources":["spray.es6"],"names":[],"mappings":"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","file":"spray.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .factory('sprayTemplateElement', sprayTemplateElementModelFactory);\n\n  sprayTemplateElementModelFactory.$inject = [\n    'template',\n    'sprayTemplate',\n    'gameTemplateSelection',\n    'gameModels',\n    'gameFactions',\n    'gameMap',\n    'labelElement',\n  ];\n  const POINTS = {\n    6: '8.75,0 5.125,-59 10,-60 14.875,-59 11.25,0',\n    8: '8.75,0 3.5,-78.672 10,-80 16.5,-78.672 11.25,0',\n    10: '8.75,0 1.875,-98.34 10,-100 18.125,-98.34 11.25,0'\n  };\n  function sprayTemplateElementModelFactory(templateModel,\n                                            sprayTemplateModel,\n                                            gameTemplateSelectionModel,\n                                            gameModelsModel,\n                                            gameFactionsModel,\n                                            gameMapService,\n                                            labelElementModel) {\n    const sprayTemplateElementModel = {\n      create: sprayTemplateElementModelCreate,\n      cleanup: sprayTemplateElementModelCleanup,\n      update: sprayTemplateElementModelUpdate\n    };\n    return sprayTemplateElementModel;\n\n    function sprayTemplateElementModelCreate(svgNS, parent, spray) {\n      const over_models = document.getElementById('game-over-models');\n\n      const group = document.createElementNS(svgNS, 'g');\n      parent.appendChild(group);\n\n      const polygon = document.createElementNS(svgNS, 'polygon');\n      polygon.classList.add('template');\n      polygon.classList.add('spray');\n      polygon.setAttribute('data-stamp', spray.state.stamp);\n      group.appendChild(polygon);\n\n      const label = labelElementModel.create(svgNS, group);\n\n      const origin = document.createElementNS(svgNS, 'circle');\n      origin.classList.add('spray-origin');\n      origin.setAttribute('cx', '0');\n      origin.setAttribute('cy', '0');\n      origin.setAttribute('r', '0');\n      origin.style.visibility = 'hidden';\n      over_models.appendChild(origin);\n\n      return { container: group,\n               spray: polygon,\n               label: label,\n               origin: origin\n             };\n    }\n    function sprayTemplateElementModelCleanup(_parent_, spray) {\n      const over_models = document.getElementById('game-over-models');\n      over_models.removeChild(spray.origin);\n    }\n    function sprayTemplateElementModelUpdate(map, state, template, spray) {\n      const selection = state.game.template_selection;\n      const local = gameTemplateSelectionModel\n              .in('local', template.state.stamp, selection);\n      const remote = gameTemplateSelectionModel\n              .in('remote', template.state.stamp, selection);\n      const selected = (local || remote);\n      const stroke_color = ( selected ?\n                             ( local ? '#0F0' : '#FFF') :\n                             '#C60'\n                           );\n\n      const map_flipped = gameMapService.isFlipped(map);\n      const zoom_factor = gameMapService.zoomFactor(map);\n      const label_flip_center = template.state;\n      const label_text_center = { x: template.state.x,\n                                  y: template.state.y + 5\n                                };\n      const label_text = templateModel.fullLabel(template);\n\n      updateContainer(template, spray.container);\n      updateSpray(stroke_color, template, spray.spray);\n      labelElementModel.update(map_flipped,\n                               zoom_factor,\n                               label_flip_center,\n                               label_text_center,\n                               label_text,\n                               spray.label);\n\n      R.threadP(template)(\n        sprayTemplateModel.origin,\n        findOriginModel,\n        (origin_model) => updateOrigin(state.factions, local,\n                                       origin_model, spray.origin)\n      );\n\n      function findOriginModel(origin) {\n        if(R.isNil(origin)) return null;\n\n        return gameModelsModel\n          .findStampP(origin, state.game.models);\n      }\n    }\n    function updateContainer(template, container) {\n      container.setAttribute('transform', [\n        'rotate(',\n        template.state.r,\n        ',',\n        template.state.x,\n        ',',\n        template.state.y,\n        ')'\n      ].join(''));\n    }\n    function updateSpray(stroke_color, template, spray) {\n      spray.setAttribute('transform', [\n        'translate(',\n        template.state.x-10,\n        ',',\n        template.state.y,\n        ')'\n      ].join(''));\n      spray.setAttribute('points', POINTS[template.state.s+'']);\n      spray.style.stroke = stroke_color;\n    }\n    function updateOrigin(factions, local, model, origin) {\n      if(!local ||\n         R.isNil(model)) {\n        origin.style.visibility = 'hidden';\n        return;\n      }\n      R.threadP(factions)(\n        gameFactionsModel.getModelInfoP$(model.state.info),\n        (info) => {\n          origin.setAttribute('cx', model.state.x+'');\n          origin.setAttribute('cy', model.state.y+'');\n          origin.setAttribute('r', info.base_radius+'');\n          origin.style.visibility = 'visible';\n        }\n      );\n    }\n  }\n})();\n"]}