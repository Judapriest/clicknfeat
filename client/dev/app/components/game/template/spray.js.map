{"version":3,"sources":["spray.es6"],"names":[],"mappings":"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","file":"spray.js","sourcesContent":["angular.module('clickApp.directives')\n  .factory('sprayTemplateElement', [\n    'template',\n    'sprayTemplate',\n    'gameTemplateSelection',\n    'gameModels',\n    'gameFactions',\n    'gameMap',\n    'labelElement',\n    function(templateService,\n             sprayTemplateService,\n             gameTemplateSelectionService,\n             gameModelsService,\n             gameFactionsService,\n             gameMapService,\n             labelElementService) {\n      var POINTS = {\n        6: '8.75,0 5.125,-59 10,-60 14.875,-59 11.25,0',\n        8: '8.75,0 3.5,-78.672 10,-80 16.5,-78.672 11.25,0',\n        10: '8.75,0 1.875,-98.34 10,-100 18.125,-98.34 11.25,0'\n      };\n      var sprayTemplateElementService = {\n        create: function sprayTemplateElementServiceCreate(svgNS, parent, spray) {\n          var over_models = document.getElementById('game-over-models');\n\n          var group = document.createElementNS(svgNS, 'g');\n          parent.appendChild(group);\n\n          var polygon = document.createElementNS(svgNS, 'polygon');\n          polygon.classList.add('template');\n          polygon.classList.add('spray');\n          polygon.setAttribute('data-stamp', spray.state.stamp);\n          group.appendChild(polygon);\n\n          var label = labelElementService.create(svgNS, group);\n\n          var origin = document.createElementNS(svgNS, 'circle');\n          origin.classList.add('spray-origin');\n          origin.setAttribute('cx', '0');\n          origin.setAttribute('cy', '0');\n          origin.setAttribute('r', '0');\n          origin.style.visibility = 'hidden';\n          over_models.appendChild(origin);\n\n          return { container: group,\n                   spray: polygon,\n                   label: label,\n                   origin: origin\n                 };\n        },\n        update: function sprayTemplateElementUpdate(map, state, template, spray) {\n          var selection = state.game.template_selection;\n          var local = gameTemplateSelectionService\n                .in('local', template.state.stamp, selection);\n          var remote = gameTemplateSelectionService\n                .in('remote', template.state.stamp, selection);\n          var selected = (local || remote);\n          var stroke_color = ( selected ?\n                               ( local ? '#0F0' : '#FFF') :\n                               '#C60'\n                             );\n\n          var map_flipped = gameMapService.isFlipped(map);\n          var zoom_factor = gameMapService.zoomFactor(map);\n          var label_flip_center = template.state;\n          var label_text_center = { x: template.state.x,\n                                    y: template.state.y + 5\n                                  };\n          var label_text = templateService.fullLabel(template);\n\n          updateContainer(template, spray.container);\n          updateSpray(stroke_color, template, spray.spray);\n          labelElementService.update(map_flipped,\n                                     zoom_factor,\n                                     label_flip_center,\n                                     label_text_center,\n                                     label_text,\n                                     spray.label);\n\n          R.pipePromise(\n            sprayTemplateService.origin,\n            (origin) => {\n              if(R.isNil(origin)) return null;\n\n              return gameModelsService\n                .findStamp(origin, state.game.models);\n            },\n            (origin_model) => {\n              updateOrigin(state.factions, local, origin_model, spray.origin);\n            }\n          )(template);\n        }\n      };\n      function updateContainer(template, container) {\n        container.setAttribute('transform', [\n          'rotate(',\n          template.state.r,\n          ',',\n          template.state.x,\n          ',',\n          template.state.y,\n          ')'\n        ].join(''));\n      }\n      function updateSpray(stroke_color, template, spray) {\n        spray.setAttribute('transform', [\n          'translate(',\n          template.state.x-10,\n          ',',\n          template.state.y,\n          ')'\n        ].join(''));\n        spray.setAttribute('points', POINTS[template.state.s+'']);\n        spray.style.stroke = stroke_color;\n      }\n      function updateOrigin(factions, local, model, origin) {\n        if(!local ||\n           R.isNil(model)) {\n          origin.style.visibility = 'hidden';\n          return;\n        }\n        R.pipeP(\n          gameFactionsService.getModelInfo$(model.state.info),\n          (info) => {\n            origin.setAttribute('cx', model.state.x+'');\n            origin.setAttribute('cy', model.state.y+'');\n            origin.setAttribute('r', info.base_radius+'');\n            origin.style.visibility = 'visible';\n          }\n        )(factions);\n      }\n      return sprayTemplateElementService;\n    }\n  ]);\n"]}