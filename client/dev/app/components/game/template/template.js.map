{"version":3,"sources":["template.es6"],"names":[],"mappings":";;AAAA,CAAC,YAAW;AACV,UAAQ,MAAR,CAAe,qBAAf,EACG,SADH,CACa,mBADb,EACkC,4BADlC,EAEG,SAFH,CAEa,wBAFb,EAEuC,iCAFvC,EADU;;AAKV,+BAA6B,OAA7B,GAAuC,CACrC,cADqC,EAErC,oBAFqC,EAGrC,sBAHqC,EAIrC,qBAJqC,EAKrC,eALqC,CAAvC,CALU;AAYV,WAAS,4BAAT,CAAsC,iBAAtC,EACsC,uBADtC,EAEsC,yBAFtC,EAGsC,wBAHtC,EAIsC,kBAJtC,EAI0D;AACxD,QAAM,YAAY;AAChB,WAAK,uBAAL;AACA,aAAO,yBAAP;AACA,YAAM,wBAAN;KAHI,CADkD;AAMxD,QAAM,wBAAwB;AAC5B,gBAAU,GAAV;AACA,aAAO,IAAP;AACA,YAAM,IAAN;KAHI,CANkD;AAWxD,WAAO,qBAAP,CAXwD;;AAaxD,aAAS,IAAT,CAAc,KAAd,EAAqB,MAArB,EAA6B;AAC3B,UAAM,MAAM,SAAS,cAAT,CAAwB,KAAxB,CAAN,CADqB;AAE3B,UAAM,QAAQ,IAAI,YAAJ,CAFa;;AAI3B,UAAM,WAAW,MAAM,QAAN,CAJU;AAK3B,cAAQ,GAAR,CAAY,cAAZ,EAA4B,QAA5B,EAL2B;AAM3B,UAAG,EAAE,KAAF,CAAQ,QAAR,CAAH,EAAsB,OAAtB;;AAEA,UAAM,UAAU,UAAU,SAAS,KAAT,CAAe,IAAf,CAAV,CACP,MADO,CACA,KADA,EACO,OAAO,CAAP,CADP,EACkB,QADlB,CAAV,CARqB;AAU3B,YAAM,GAAN,CAAU,UAAV,EAAsB,YAAM;AAC1B,kBAAU,SAAS,KAAT,CAAe,IAAf,CAAV,CAA+B,OAA/B,CAAuC,MAAvC,EAA+C,OAA/C,EAD0B;OAAN,CAAtB,CAV2B;AAa3B,cAAQ,SAAR,GAAoB,OAAO,CAAP,CAApB,CAb2B;;AAe3B,YAAM,kBAAN,CAAyB,kBAAzB,EAA6C,YAAM;AACjD,0BACG,eADH,CACmB,GADnB,EACwB,SAAS,KAAT,EAAgB,QAAQ,KAAR,CADxC,CADiD;OAAN,EAG1C,KAHH,EAf2B;AAmB3B,uBAnB2B;AAoB3B,YAAM,kBAAN,2BAAiD,SAAS,KAAT,CAAe,KAAf,EACxB,cADzB,EACyC,KADzC,EApB2B;;AAuB3B,eAAS,cAAT,GAA0B;AACxB,UAAE,OAAF,GACE;iBAAM,mBACH,UADG,CACQ,SAAS,KAAT,CAAe,KAAf,EAAsB,MAAM,KAAN,CAAY,IAAZ,CAAiB,SAAjB;SADpC,EAEA,UAAC,QAAD;iBAAc,UAAU,SAAS,KAAT,CAAe,IAAf,CAAV,CACX,MADW,CACJ,GADI,EACC,MAAM,KAAN,EAAa,QADd,EACwB,OADxB;SAAd,CAHF,CADwB;OAA1B;KAvBF;GAjBF;;AAmDA,oCAAkC,OAAlC,GAA4C,EAA5C,CA/DU;AAgEV,WAAS,iCAAT,GAA6C;AAC3C,QAAM,6BAA6B;AACjC,gBAAU,GAAV;AACA,mBAAa,kDAAb;AACA,aAAO,IAAP;AACA,YAAM,IAAN;KAJI,CADqC;AAO3C,WAAO,0BAAP,CAP2C;;AAS3C,aAAS,IAAT,CAAc,KAAd,EAAqB,OAArB,EAA8B;AAC5B,YAAM,IAAN,GAAa,QAAQ,CAAR,EAAW,YAAX,CAAwB,2BAAxB,CAAb,CAD4B;AAE5B,YAAM,wBAAN,CAA+B,sBAA/B,EAAuD,KAAvD,EAF4B;AAG5B,cAAQ,GAAR,CAAY,wBAAZ,EAAsC,MAAM,IAAN,CAAtC,CAH4B;KAA9B;GATF;CAhED,CAAD","file":"template.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .directive('clickGameTemplate', gameTemplateDirectiveFactory)\n    .directive('clickGameTemplatesList', gameTemplatesListDirectiveFactory);\n\n  gameTemplateDirectiveFactory.$inject = [\n    'labelElement',\n    'aoeTemplateElement',\n    'sprayTemplateElement',\n    'wallTemplateElement',\n    'gameTemplates',\n  ];\n  function gameTemplateDirectiveFactory(labelElementModel,\n                                        aoeTemplateElementModel,\n                                        sprayTemplateElementModel,\n                                        wallTemplateElementModel,\n                                        gameTemplatesModel) {\n    const templates = {\n      aoe: aoeTemplateElementModel,\n      spray: sprayTemplateElementModel,\n      wall: wallTemplateElementModel\n    };\n    const gameTemplateDirective = {\n      restrict: 'A',\n      scope: true,\n      link: link\n    };\n    return gameTemplateDirective;\n\n    function link(scope, parent) {\n      const map = document.getElementById('map');\n      const svgNS = map.namespaceURI;\n\n      const template = scope.template;\n      console.log('gameTemplate', template);\n      if(R.isNil(template)) return;\n\n      const element = templates[template.state.type]\n              .create(svgNS, parent[0], template);\n      scope.$on('$destroy', () => {\n        templates[template.state.type].cleanup(parent, element);\n      });\n      element.container = parent[0];\n\n      scope.onStateChangeEvent('Game.map.flipped', () => {\n        labelElementModel\n          .updateOnFlipMap(map, template.state, element.label);\n      }, scope);\n      updateTemplate();\n      scope.onStateChangeEvent(`Game.template.change.${template.state.stamp}`,\n                               updateTemplate, scope);\n\n      function updateTemplate() {\n        R.threadP()(\n          () => gameTemplatesModel\n            .findStampP(template.state.stamp, scope.state.game.templates),\n          (template) => templates[template.state.type]\n            .update(map, scope.state, template, element)\n        );\n      }\n    }\n  }\n\n  gameTemplatesListDirectiveFactory.$inject = [];\n  function gameTemplatesListDirectiveFactory() {\n    const gameTemplatesListDirective = {\n      restrict: 'A',\n      templateUrl: 'app/components/game/template/templates_list.html',\n      scope: true,\n      link: link\n    };\n    return gameTemplatesListDirective;\n\n    function link(scope, element) {\n      scope.type = element[0].getAttribute('click-game-templates-list');\n      scope.digestOnStateChangeEvent('Game.template.create', scope);\n      console.log('clickGameTemplatesList', scope.type);\n    }\n  }\n})();\n"]}