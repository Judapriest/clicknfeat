{"version":3,"sources":["template.es6"],"names":[],"mappings":"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","file":"template.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .directive('clickGameTemplate', gameTemplateDirectiveFactory)\n    .directive('clickGameTemplatesList', gameTemplatesListDirectiveFactory);\n\n  gameTemplateDirectiveFactory.$inject = [\n    'appState',\n    'gameMap',\n    'template',\n    'gameTemplateSelection',\n    'gameModels',\n    'gameFactions',\n  ];\n  function gameTemplateDirectiveFactory(appStateService,\n                                        gameMapService,\n                                        templateModel,\n                                        gameTemplateSelectionModel,\n                                        gameModelsModel,\n                                        gameFactionsModel) {\n    const gameTemplateDirective = {\n      restrict: 'A',\n      scope: true,\n      link: link\n    };\n    return gameTemplateDirective;\n\n    function link(scope) {\n      console.log('gameTemplate', scope.template);\n\n      const template = scope.template;\n      scope.onStateChangeEvent('Game.view.flipMap', onUpdate, scope);\n      scope.onStateChangeEvent('Game.templates.change', onUpdate, scope);\n      scope.onStateChangeEvent('Game.template_selection.change', onUpdate, scope);\n      scope.onStateChangeEvent(`Game.template.change.${template.state.stamp}`,\n                               _onUpdate, scope);\n      updateTemplate(scope);\n\n      let _template;\n      let _selection;\n      let _is_flipped;\n      function onUpdate() {\n        const map = document.getElementById('map');\n        const is_flipped = gameMapService.isFlipped(map);\n        const state = appStateService.current();\n        const selection = R.path(['game','template_selection'], state);\n        const template = scope.template;\n        if(_template === template &&\n           _selection === selection &&\n           _is_flipped === is_flipped) {\n          return;\n        }\n        _template = template;\n        _selection = selection;\n        _is_flipped = is_flipped;\n\n        _onUpdate();\n      }\n      function _onUpdate() {\n        updateTemplate(scope);\n        scope.$digest();\n      }\n    }\n\n    function updateTemplate(scope) {\n      const map = document.getElementById('map');\n      const is_flipped = gameMapService.isFlipped(map);\n      const template = scope.template;\n      console.warn('RENDER TEMPLATE', template.state.stamp);\n      scope.render = templateModel.render(is_flipped, template.state);\n\n      const state = appStateService.current();\n      const selection = R.path(['game','template_selection'], state);\n      const stamp = template.state.stamp;\n      const local = gameTemplateSelectionModel\n              .in('local', stamp, selection);\n      const remote = gameTemplateSelectionModel\n              .in('remote', stamp, selection);\n      const selected = (local || remote);\n      scope.selection = {\n        local: local,\n        remote: remote,\n        selected: selected\n      };\n\n      if(local &&\n         R.exists(template.state.o)) {\n        R.thread(state.game.models)(\n          gameModelsModel.findStamp$(template.state.o),\n          R.unless(\n            R.isNil,\n            R.pipe(\n              (origin) => [\n                origin,\n                gameFactionsModel.getModelInfo(origin.state.info, state.factions)\n              ],\n              ([origin, info]) => {\n                scope.render.origin = {\n                  cx: origin.state.x,\n                  cy: origin.state.y,\n                  radius: info.base_radius\n                };\n              }\n            )\n          )\n        );\n      }\n}\n  }\n\n  gameTemplatesListDirectiveFactory.$inject = [];\n  function gameTemplatesListDirectiveFactory() {\n    const gameTemplatesListDirective = {\n      restrict: 'A',\n      templateUrl: 'app/components/game/template/templates_list.html',\n      scope: true,\n      link: link\n    };\n    return gameTemplatesListDirective;\n\n    function link(scope, element) {\n      scope.type = element[0].getAttribute('click-game-templates-list');\n      scope.digestOnStateChangeEvent('Game.templates.change', scope);\n      console.log('clickGameTemplatesList', scope.type);\n    }\n  }\n})();\n"]}