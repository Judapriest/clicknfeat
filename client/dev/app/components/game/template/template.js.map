{"version":3,"sources":["template.es6"],"names":[],"mappings":"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","file":"template.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .directive('clickGameTemplate', gameTemplateDirectiveFactory)\n    .directive('clickGameTemplatesList', gameTemplatesListDirectiveFactory);\n\n  gameTemplateDirectiveFactory.$inject = [\n    'appGame',\n    'gameMap',\n    'template',\n    'gameTemplates',\n    'gameTemplateSelection',\n    'gameModels',\n  ];\n  function gameTemplateDirectiveFactory(appGameService,\n                                        gameMapService,\n                                        templateModel,\n                                        gameTemplatesModel,\n                                        gameTemplateSelectionModel ,\n                                        gameModelsModel) {\n    const gameTemplateDirective = {\n      restrict: 'A',\n      scope: true,\n      link: link\n    };\n    return gameTemplateDirective;\n\n    function link(scope) {\n      console.log('gameTemplate', scope.template);\n\n      const stamp = scope.template.state.stamp;\n      scope.listenSignal(refreshRender,\n                         appGameService.templates.flip_map,\n                         scope);\n      scope.listenSignal(refreshSelection,\n                         appGameService.templates.selection_changes,\n                         scope);\n      scope.listenSignal(onTemplatesChanges,\n                         appGameService.templates.changes,\n                         scope);\n      mount();\n\n      function onTemplatesChanges([templates, stamps]) {\n        if(!R.find(R.equals(stamp), stamps)) return;\n\n        refreshRender(templates);\n      }\n\n      function mount() {\n        const templates = appGameService.templates.templates.sample();\n        refreshRender(templates);\n\n        const selection = appGameService.templates.selection.sample();\n        refreshSelection(selection);\n      }\n\n      function refreshRender(templates) {\n        const template = gameTemplatesModel.findStamp(stamp, templates);\n        if(R.isNil(template)) return;\n        scope.template = template;\n\n        const map = document.getElementById('map');\n        const is_flipped = gameMapService.isFlipped(map);\n        template.render = templateModel.render({is_flipped}, template);\n\n        if(R.exists(template.state.o)) {\n          const models = appGameService.models.models.sample();\n          R.thread(models)(\n            gameModelsModel.findStamp$(template.state.o),\n            R.unless(\n              R.isNil,\n              (origin) => {\n                template.render.origin = {\n                  cx: origin.state.x,\n                  cy: origin.state.y,\n                  radius: origin.info.base_radius\n                };\n              }\n            )\n          );\n        }\n        console.warn('RENDER TEMPLATE',\n                     stamp, template.state, is_flipped, template.render);\n      }\n      function refreshSelection(selection) {\n        const local = gameTemplateSelectionModel\n                .in('local', stamp, selection);\n        const remote = gameTemplateSelectionModel\n                .in('remote', stamp, selection);\n        const selected = (local || remote);\n        scope.selection = {\n          local: local,\n          remote: remote,\n          selected: selected\n        };\n        console.warn('SELECTION TEMPLATE',\n                     stamp, selection, scope.selection);\n      }\n    }\n  }\n\n  gameTemplatesListDirectiveFactory.$inject = [];\n  function gameTemplatesListDirectiveFactory() {\n    const gameTemplatesListDirective = {\n      restrict: 'A',\n      templateUrl: 'app/components/game/template/templates_list.html',\n      scope: true,\n      link: link\n    };\n    return gameTemplatesListDirective;\n\n    function link(scope, element) {\n      scope.type = element[0].getAttribute('click-game-templates-list');\n      console.log('clickGameTemplatesList', scope.type);\n    }\n  }\n})();\n"]}