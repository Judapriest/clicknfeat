{"version":3,"sources":["createTerrain.es6"],"names":[],"mappings":";;AAAA,CAAC,YAAW;AACV,UAAQ,MAAR,CAAe,qBAAf,EACG,SADH,CACa,wBADb,EACuC,sCADvC,EADU;;AAIV,yCAAuC,OAAvC,GAAiD,CAC/C,YAD+C,EAE/C,SAF+C,EAG/C,SAH+C,CAAjD,CAJU;AASV,WAAS,sCAAT,CAAgD,UAAhD,EACgD,YADhD,EAEgD,cAFhD,EAEgE;AAC9D,WAAO;AACL,gBAAU,GAAV;AACA,YAAM,IAAN;KAFF,CAD8D;;AAM9D,aAAS,IAAT,CAAc,KAAd,EAAqB,MAArB,EAA6B;AAC3B,eAAS,OAAO,CAAP,CAAT,CAD2B;AAE3B,cAAQ,GAAR,CAAY,oBAAZ,EAAkC,MAAM,KAAN,EAAa,MAAM,OAAN,CAA/C,CAF2B;;AAI3B,UAAM,QAAQ,WAAW,KAAX,CAJa;AAK3B,UAAM,SAAS,aACN,MADM,CACC,MAAM,QAAN,EAAgB,MAAM,OAAN,CAD1B,CALqB;AAO3B,yBAAmB,MAAnB,EAA2B,MAA3B,EAP2B;AAQ3B,yBAAmB,EAAE,IAAF,CAAO,CAAC,QAAD,EAAU,MAAV,CAAP,EAA0B,KAA1B,CAAnB,EACmB,MADnB,EAC2B,KAD3B,EAR2B;;AAW3B,iBAAW,kBAAX,CAA8B,oBAA9B,EAC8B,qBAAqB,KAArB,CAD9B,EAE8B,KAF9B,EAX2B;KAA7B;AAeA,aAAS,kBAAT,CAA4B,MAA5B,EAAoC,MAApC,EAA4C;AAC1C,UAAM,UAAU,OAAO,aAAP,CAAqB,MAArB,CAAV,CADoC;AAE1C,cAAQ,YAAR,CAAqB,OAArB,EAA8B,OAAO,KAAP,CAA9B,CAF0C;AAG1C,cAAQ,YAAR,CAAqB,QAArB,EAA+B,OAAO,MAAP,CAA/B,CAH0C;KAA5C;AAKA,aAAS,oBAAT,CAA8B,KAA9B,EAAqC;AACnC,aAAO,YAAM;AACX,YAAM,QAAQ,WAAW,KAAX,CADH;AAEX,YAAM,OAAO,EAAE,IAAF,CAAO,CAAC,QAAD,EAAU,MAAV,CAAP,EAA0B,KAA1B,CAAP,CAFK;AAGX,YAAG,EAAE,KAAF,CAAQ,IAAR,CAAH,EAAkB,OAAlB;;AAEA,YAAM,SAAS,aACN,MADM,CACC,MAAM,QAAN,EAAgB,MAAM,OAAN,CAD1B,CALK;AAOX,2BAAmB,IAAnB,EAAyB,MAAzB,EAAiC,KAAjC,EAPW;AAQX,cAAM,OAAN,GARW;OAAN,CAD4B;KAArC;AAYA,aAAS,kBAAT,CAA4B,IAA5B,EAAkC,MAAlC,EAA0C,KAA1C,EAAiD;AAC/C,UAAM,MAAM,SAAS,cAAT,CAAwB,KAAxB,CAAN,CADyC;AAE/C,UAAM,aAAa,eAAe,SAAf,CAAyB,GAAzB,CAAb,CAFyC;AAG/C,UAAM,QAAQ,aAAa,CAAC,CAAD,GAAK,CAAlB,CAHiC;AAI/C,YAAM,GAAN,GAAY;AACV,WAAG,KAAK,CAAL,GAAS,QAAQ,OAAO,CAAP;AACpB,WAAG,KAAK,CAAL,GAAS,QAAQ,OAAO,CAAP;OAFtB,CAJ+C;KAAjD;GAxCF;CATD,CAAD","file":"createTerrain.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .directive('clickGameCreateTerrain', clickGameCreateTerrainDirectiveFactory);\n\n  clickGameCreateTerrainDirectiveFactory.$inject = [\n    '$rootScope',\n    'terrain',\n    'gameMap',\n  ];\n  function clickGameCreateTerrainDirectiveFactory($rootScope,\n                                                  terrainModel,\n                                                  gameMapService) {\n    return {\n      restrict: 'A',\n      link: link\n    };\n\n    function link(scope, parent) {\n      parent = parent[0];\n      console.log('clickCreateTerrain', scope.index, scope.terrain);\n\n      const state = $rootScope.state;\n      const render = terrainModel\n              .render(state.terrains, scope.terrain);\n      initTerrainElement(render, parent);\n      setTerrainPosition(R.path(['create','base'], state),\n                         render, scope);\n\n      $rootScope.onStateChangeEvent('Create.base.change',\n                                    updateTerrainElement(scope),\n                                    scope);\n    }\n    function initTerrainElement(render, parent) {\n      const element = parent.querySelector('rect');\n      element.setAttribute('width', render.width);\n      element.setAttribute('height', render.height);\n    }\n    function updateTerrainElement(scope) {\n      return () => {\n        const state = $rootScope.state;\n        const base = R.path(['create','base'], state);\n        if(R.isNil(base)) return;\n\n        const render = terrainModel\n                .render(state.terrains, scope.terrain);\n        setTerrainPosition(base, render, scope);\n        scope.$digest();\n      };\n    }\n    function setTerrainPosition(base, render, scope) {\n      const map = document.getElementById('map');\n      const is_flipped = gameMapService.isFlipped(map);\n      const coeff = is_flipped ? -1 : 1;\n      scope.pos = {\n        x: base.x + coeff * render.x,\n        y: base.y + coeff * render.y\n      };\n    }\n  }\n})();\n"]}