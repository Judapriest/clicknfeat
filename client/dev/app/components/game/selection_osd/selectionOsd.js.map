{"version":3,"sources":["selectionOsd.es6"],"names":[],"mappings":"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","file":"selectionOsd.js","sourcesContent":["angular.module('clickApp.directives')\n  .controller('clickGameSelectionDetailCtrl', [\n    '$scope',\n    'game',\n    'gameFactions',\n    function($scope,\n             gameService,\n             gameFactionsService) {\n      console.log('init clickGameSelectionDetailCtrl');\n      let state = $scope.state;\n\n      $scope.edit = { label: '',\n                      max_deviation: 0\n                    };\n      var updateOnOpenType = {\n        template: () => {\n          $scope.edit.max_deviation = R.pathOr(0, ['state','m'], $scope.selection);\n        },\n        model: () => {\n          gameFactionsService\n            .getModelInfo($scope.selection.state.info, state.factions)\n            .then((info) => {\n              $scope.info = info;\n              $scope.$digest();\n            });\n        }\n      };\n      $scope.show = { info: false };\n      $scope.updateOnOpen = () => {\n        $scope.show.info = false;\n        updateOnOpenType[$scope.type]();\n      };\n      $scope.labelDisplay = (l) => {\n        return s.truncate(l, 12);\n      };\n\n      $scope.doSetMaxDeviation = () => {\n        var max = ($scope.edit.max_deviation > 0) ? $scope.edit.max_deviation : null;\n        $scope.stateEvent('Game.command.execute',\n                          'onTemplates', [ 'setMaxDeviation', [max],\n                                           [$scope.selection.state.stamp]\n                                         ]);\n      };\n      $scope.doAddLabel = () => {\n        var cmd = ($scope.type === 'template') ? 'onTemplates' : 'onModels';\n        var new_label = s.trim($scope.edit.label);\n        if(R.length(new_label) === 0) return;\n\n        $scope.stateEvent('Game.command.execute',\n                          cmd, [ 'addLabel', [new_label],\n                                 [$scope.selection.state.stamp]\n                               ])\n          .then(() => { $scope.$digest(); });\n        $scope.edit.label = '';\n      };\n      $scope.doRemoveLabel = (label) => {\n        var cmd = ($scope.type === 'template') ? 'onTemplates' : 'onModels';\n        $scope.stateEvent('Game.command.execute',\n                          cmd, [ 'removeLabel', [label],\n                                 [$scope.selection.state.stamp]\n                               ])\n          .then(() => { $scope.$digest(); });\n      };\n    }\n  ])\n  .directive('clickGameSelectionDetail', [\n    '$window',\n    'game',\n    'gameMap',\n    function($window,\n             gameService,\n             gameMapService) {\n      return {\n        restrict: 'A',\n        scope: true,\n        controller: 'clickGameSelectionDetailCtrl',\n        link: function(scope, element) {\n          console.log('gameSelectionDetail');\n          var viewport = document.getElementById('viewport');\n          var map = document.getElementById('map');\n\n          scope.type = 'model';\n          closeSelectionDetail();\n\n          function openSelectionDetail($event, type, selection) {\n            // console.log('openSelectionDetail');\n            scope.type = type;\n            scope.selection = selection;\n            scope.edit = { label: '',\n                           max_deviation: 0\n                         };\n            scope.updateOnOpen();\n            $window.requestAnimationFrame(displaySelectionDetail);\n          }\n          function closeSelectionDetail() {\n            // console.log('closeSelectionDetail');\n            scope.selection = {};\n            element[0].style.display = 'none';\n            element[0].style.visibility = 'hidden';\n            element[0].style.left = 0+'px';\n            element[0].style.top = 0+'px';\n          }\n          function displaySelectionDetail() {\n            scope.$digest();\n            element[0].style.display = 'initial';\n            element[0].style.visibility = 'hidden';\n            $window.requestAnimationFrame(showSelectionDetail);\n          }\n          function showSelectionDetail() {\n            placeSelectionDetail();\n            element[0].style.visibility = 'visible';\n          }\n          function placeSelectionDetail() {\n            var detail_rect = element[0].getBoundingClientRect();\n            var screen_pos = gameMapService.mapToScreenCoordinates(map, scope.selection.state);\n            var viewport_rect = viewport.getBoundingClientRect();\n            if(detailCanFitRight(viewport_rect, detail_rect, screen_pos)) {\n              element[0].style.left = alignRight(detail_rect, screen_pos);\n            }\n            else {\n              element[0].style.left = alignLeft(detail_rect, screen_pos);\n            }\n            if(detailCanFitBottom(viewport_rect, detail_rect, screen_pos)) {\n              element[0].style.top = alignBottom(detail_rect, screen_pos);\n            }\n            else {\n              element[0].style.top = alignTop(detail_rect, screen_pos);\n            }\n          }\n          function detailCanFitRight(viewport_rect, detail_rect, screen_pos) {\n            return screen_pos.x + detail_rect.width <= viewport_rect.right;\n          }\n          function alignRight(detail_rect, screen_pos) {\n            return screen_pos.x+'px';\n          }\n          function alignLeft(detail_rect, screen_pos) {\n            return Math.max(0, screen_pos.x-detail_rect.width)+'px';\n          }\n          function detailCanFitBottom(viewport_rect, detail_rect, screen_pos) {\n            return screen_pos.y + detail_rect.height <= viewport_rect.bottom;\n          }\n          function alignBottom(detail_rect, screen_pos) {\n            return screen_pos.y+'px';\n          }\n          function alignTop(detail_rect, screen_pos) {\n            return Math.max(0, screen_pos.y-detail_rect.height)+'px';\n          }\n\n          scope.onStateChangeEvent('Game.selectionDetail.open', openSelectionDetail, scope);\n          scope.onStateChangeEvent('Game.selectionDetail.close', closeSelectionDetail, scope);\n          scope.doClose = closeSelectionDetail;\n        }\n      };\n    }\n  ]);\n"]}