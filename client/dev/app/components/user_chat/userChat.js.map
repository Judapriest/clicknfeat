{"version":3,"sources":["userChat.es6"],"names":[],"mappings":";;AAAA,QAAQ,MAAR,CAAe,qBAAf,EACG,UADH,CACc,cADd,EAC8B,CAC1B,QAD0B,EAE1B,SAAS,YAAT,CAAsB,MAAtB,EAA8B;AAC5B,UAAQ,GAAR,CAAY,cAAZ,EAA4B,OAAO,IAAP,CAA5B,CAD4B;;AAG5B,MAAI,QAAQ,OAAO,KAAP,CAHgB;;AAK5B,SAAO,IAAP,GAAc;AACZ,SAAK,EAAL;AACA,QAAI,EAAJ;GAFF,CAL4B;AAS5B,WAAS,SAAT,CAAmB,EAAnB,EAAuB;AACrB,WAAO,IAAP,CAAY,EAAZ,GAAiB,EAAE,MAAF,CAAS,EAAE,MAAF,CAAS,MAAM,IAAN,CAAW,KAAX,CAAiB,KAAjB,CAAlB,EAA2C,EAA3C,CAAjB,CADqB;GAAvB;AAGA,SAAO,UAAP,GAAoB,UAAC,KAAD,EAAW;AAC7B,WAAO,EAAE,IAAF,CAAO,EAAE,MAAF,CAAS,KAAT,CAAP,EAAwB,OAAO,IAAP,CAAY,EAAZ,CAA/B,CAD6B;GAAX,CAZQ;AAe5B,SAAO,cAAP,GAAwB,UAAC,KAAD,EAAW;AACjC,QAAG,OAAO,UAAP,CAAkB,KAAlB,CAAH,EAA6B;AAC3B,gBAAU,EAAE,MAAF,CAAS,EAAE,MAAF,CAAS,KAAT,CAAT,EAA0B,OAAO,IAAP,CAAY,EAAZ,CAApC,EAD2B;KAA7B,MAGK;AACH,gBAAU,EAAE,MAAF,CAAS,KAAT,EAAgB,OAAO,IAAP,CAAY,EAAZ,CAA1B,EADG;KAHL;GADsB,CAfI;AAuB5B,SAAO,eAAP,GAAyB,YAAM;AAC7B,cAAU,EAAE,KAAF,CAAQ,OAAR,EAAiB,MAAM,IAAN,CAAW,UAAX,CAAsB,KAAtB,CAA3B,EAD6B;GAAN,CAvBG;AA0B5B,SAAO,WAAP,GAAqB,UAAC,IAAD,EAAU;AAC7B,cAAU,EAAE,IAAF,CACR,EAAE,IAAF,CAAO,IAAP,CADQ,EAER,EAAE,MAAF,CAAS,EAAE,IAAF,CAAO,MAAP,EAAe,IAAf,CAAT,CAFQ,EAGR,EAAE,IAAF,CAHQ,CAIR,IAJQ,CAAV,EAD6B;GAAV,CA1BO;;AAkC5B,WAAS,cAAT,GAA0B;AACxB,WAAO,EAAE,MAAF,CAAS,EAAE,KAAF,CAAQ,OAAO,IAAP,CAAY,GAAZ,CAAjB,IAAqC,CAArC,CADiB;GAA1B;AAGA,SAAO,cAAP,GAAwB,YAAM;AAC5B,WAAS,CAAC,EAAE,OAAF,CAAU,OAAO,IAAP,CAAY,EAAZ,CAAX,IACA,gBADA,CADmB;GAAN,CArCI;AA0C5B,SAAO,iBAAP,GAA2B,YAAM;AAC/B,QAAG,CAAC,OAAO,cAAP,EAAD,EAA0B,OAAO,IAAP,CAA7B;;AAEA,WAAO,EAAE,WAAF,CACL,YAAM;AACJ,aAAO,OAAO,UAAP,CAAkB,kBAAlB,EAAsC,OAAO,IAAP,CAA7C,CADI;KAAN,EAGA,YAAM;AACJ,aAAO,IAAP,CAAY,GAAZ,GAAkB,EAAlB,CADI;AAEJ,aAAO,OAAP,GAFI;KAAN,CAJK,CAQL,OAAO,IAAP,CARF,CAH+B;GAAN,CA1CC;AAuD5B,SAAO,sBAAP,GAAgC,YAAW;AACzC,cAAU,EAAE,KAAF,CAAQ,OAAR,EAAiB,MAAM,IAAN,CAAW,UAAX,CAAsB,KAAtB,CAA3B,EADyC;AAEzC,WAAO,iBAAP,GAFyC;GAAX,CAvDJ;CAA9B,CAHJ,EAgEG,SAhEH,CAgEa,qBAhEb,EAgEoC,CAChC,YAAW;AACT,SAAO;AACL,cAAU,GAAV;AACA,gBAAY,cAAZ;AACA,iBAAa,oCAAb;AACA,WAAO,IAAP;AACA,UAAM,gBAAM,EAAN;GALR,CADS;CAAX,CAjEJ","file":"userChat.js","sourcesContent":["angular.module('clickApp.directives')\n  .controller('userChatCtrl', [\n    '$scope',\n    function userChatCtrl($scope) {\n      console.log('userChatCtrl', $scope.user);\n\n      let state = $scope.state;\n\n      $scope.chat = {\n        msg: '',\n        to: []\n      };\n      function setChatTo(to) {\n        $scope.chat.to = R.reject(R.equals(state.user.state.stamp), to);\n      }\n      $scope.userIsInTo = (stamp) => {\n        return R.find(R.equals(stamp), $scope.chat.to);\n      };\n      $scope.doToggleUserTo = (stamp) => {\n        if($scope.userIsInTo(stamp)) {\n          setChatTo(R.reject(R.equals(stamp), $scope.chat.to));\n        }\n        else {\n          setChatTo(R.append(stamp, $scope.chat.to));\n        }\n      };\n      $scope.doSetAllUsersTo = () => {\n        setChatTo(R.pluck('stamp', state.user.connection.users));\n      };\n      $scope.doSetToChat = (chat) => {\n        setChatTo(R.pipe(\n          R.prop('to'),\n          R.append(R.prop('from', chat)),\n          R.uniq\n        )(chat));\n      };\n\n      function chatMsgIsValid() {\n        return R.length(s.strip($scope.chat.msg)) > 0;\n      }\n      $scope.canSendChatMsg = () => {\n        return ( !R.isEmpty($scope.chat.to) &&\n                 chatMsgIsValid()\n               );\n      };\n      $scope.doSendChatMessage = () => {\n        if(!$scope.canSendChatMsg()) return null;\n\n        return R.pipePromise(\n          () => {\n            return $scope.stateEvent('User.sendChatMsg', $scope.chat);\n          },\n          () => {\n            $scope.chat.msg = '';\n            $scope.$digest();\n          }\n        )($scope.user);\n      };\n      $scope.doSendChatMessageToAll = function() {\n        setChatTo(R.pluck('stamp', state.user.connection.users));\n        $scope.doSendChatMessage();\n      };\n    }\n  ])\n  .directive('clickUserConnection', [\n    function() {\n      return {\n        restrict: 'E',\n        controller: 'userChatCtrl',\n        templateUrl: 'partials/directives/user_chat.html',\n        scope: true,\n        link: () => { }\n      };\n    }\n  ]);\n"]}