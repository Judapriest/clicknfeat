{"version":3,"sources":["userChat.es6"],"names":[],"mappings":"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","file":"userChat.js","sourcesContent":["(function() {\n  angular.module('clickApp.directives')\n    .controller('userChatCtrl', userChatCtrl)\n    .directive('clickUserChat', userChatDirectiveFactory);\n\n  userChatDirectiveFactory.$inject = [];\n  function userChatDirectiveFactory() {\n    return {\n      restrict: 'E',\n      templateUrl: 'app/components/user_chat/user_chat.html',\n      scope: true,\n      controller: 'userChatCtrl',\n      controllerAs: 'user_chat',\n      link: () => { }\n    };\n  }\n\n  userChatCtrl.$inject = [\n    '$scope',\n    'appUser',\n  ];\n  function userChatCtrl($scope,\n                        appUserService) {\n    const vm = this;\n    console.log('userChatCtrl');\n\n    vm.userIsInRecipients = userIsInRecipients;\n    vm.doToggleRecipient = doToggleRecipient;\n    vm.doSetAllRecipients = doSetAllRecipients;\n    vm.doSetRecipientsFromChat = doSetRecipientsFromChat;\n\n    vm.canSendChatMsg = canSendChatMsg;\n    vm.doSendChatMsg = doSendChatMsg;\n    vm.doBroadcastChatMsg = doBroadcastChatMsg;\n\n    activate();\n\n    function activate() {\n      vm.chat = {\n        msg: '',\n        to: []\n      };\n      $scope.bindCell((user) => {\n        vm.user = R.clone(user);\n      }, appUserService.user, $scope);\n    }\n    function setChatRecipients(to) {\n      vm.chat.to = R.reject(R.equals(vm.user.state.stamp), to);\n    }\n    function userIsInRecipients(stamp) {\n      return R.find(R.equals(stamp), vm.chat.to);\n    }\n    function doToggleRecipient(stamp) {\n      if(vm.userIsInRecipients(stamp)) {\n        setChatRecipients(R.reject(R.equals(stamp), vm.chat.to));\n      }\n      else {\n        setChatRecipients(R.append(stamp, vm.chat.to));\n      }\n    }\n    function doSetAllRecipients() {\n      setChatRecipients(R.pluck('stamp', vm.user.connection.users));\n    }\n    function doSetRecipientsFromChat(chat) {\n      setChatRecipients(R.thread(chat)(\n        R.prop('to'),\n        R.append(R.prop('from', chat)),\n        R.uniq\n      ));\n    }\n\n    function chatMsgIsValid() {\n      return R.length(s.strip(vm.chat.msg)) > 0;\n    }\n    function canSendChatMsg() {\n      return ( !R.isEmpty(vm.chat.to) &&\n               chatMsgIsValid()\n             );\n    }\n    function doSendChatMsg() {\n      if(!vm.canSendChatMsg()) return;\n\n      $scope.sendAction('User.sendChat', R.clone(vm.chat));\n      vm.chat.msg = '';\n    }\n    function doBroadcastChatMsg() {\n      setChatRecipients(R.pluck('stamp', vm.user.connection.users));\n      vm.doSendChatMsg();\n    }\n  }\n})();\n"]}