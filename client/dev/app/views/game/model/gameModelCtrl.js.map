{"version":3,"sources":["gameModelCtrl.es6"],"names":[],"mappings":"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","file":"gameModelCtrl.js","sourcesContent":["(function() {\n  angular.module('clickApp.controllers')\n    .controller('gameModelCtrl', gameModelCtrl);\n\n  gameModelCtrl.$inject = [\n    '$scope',\n    'appData',\n  ];\n  function gameModelCtrl($scope,\n                         appDataService) {\n    const vm = this;\n    console.log('init gameModelCtrl');\n\n    vm.onFactionChange = onFactionChange;\n    vm.onSectionChange = onSectionChange;\n    vm.onEntryChange = onEntryChange;\n    vm.onTypeChange = onTypeChange;\n    vm.onModelChange = onModelChange;\n\n    vm.getEntries = getEntries;\n    vm.getModel = getModel;\n\n    vm.doCreateModel = doCreateModel;\n    vm.doImportList = doImportList;\n    vm.doImportModelsFile = doImportModelsFile;\n\n    activate();\n\n    function activate() {\n      vm.import_list = null;\n      $scope.bindCell((factions) => {\n        if(R.isNil(factions)) return;\n        vm.faction = R.head(R.keys(factions.current));\n        if(R.isNil(vm.faction)) return;\n        vm.onFactionChange();\n      }, appDataService.factions, $scope);\n    }\n\n    function onFactionChange() {\n      vm.section = R.head(R.keys($scope.state.factions.current[vm.faction].models));\n      vm.onSectionChange();\n    }\n    function onSectionChange() {\n      vm.entry = R.head(R.keys($scope.state.factions.current[vm.faction].models[vm.section]));\n      vm.onEntryChange();\n    }\n    function onEntryChange() {\n      const entries = vm.getEntries();\n      if(R.isNil(entries)) {\n        vm.model = $scope.entry;\n        vm.onModelChange();\n        return;\n      }\n      vm.type = R.head(R.keys(entries));\n      vm.onTypeChange();\n    }\n    function onTypeChange() {\n      const entries = vm.getEntries();\n      vm.model = R.thread(entries)(\n        R.defaultTo({}),\n        R.prop(vm.type),\n        R.defaultTo({}),\n        R.keys(),\n        R.head()\n      );\n      vm.onModelChange();\n    }\n    function onModelChange() {\n      vm.repeat = 1;\n    }\n    function getEntries() {\n      return R.path([ vm.faction,\n                      'models',\n                      vm.section,\n                      vm.entry,\n                      'entries'\n                    ], R.pathOr({}, ['state','factions','current'], $scope));\n    }\n    function getModel() {\n      const entries = vm.getEntries();\n      if(R.isNil(entries)) {\n        return R.path([ vm.faction,\n                        'models',\n                        vm.section,\n                        vm.entry\n                      ], R.pathOr({}, ['state','factions','current'], $scope));\n      }\n      else {\n        return R.path([ vm.type,\n                        vm.model\n                      ], entries);\n      }\n    }\n    function getModelPath() {\n      const entries = vm.getEntries();\n      if(R.isNil(entries)) {\n        return [ vm.faction,\n                 'models',\n                 vm.section,\n                 vm.entry\n               ];\n      }\n      else {\n        return [ vm.faction,\n                 'models',\n                 vm.section,\n                 vm.entry,\n                 'entries',\n                 vm.type,\n                 vm.model\n               ];\n      }\n    }\n    function doCreateModel() {\n      const model_path = getModelPath();\n      $scope.sendAction('Game.model.create',\n                        model_path, vm.repeat);\n    }\n    function doImportList() {\n      // TODO : find min unit number for user\n      $scope.sendAction('Game.model.importList', vm.import_list);\n    }\n    function doImportModelsFile(files) {\n      $scope.sendAction('Game.model.importFile', files[0]);\n    }\n  }\n})();\n"]}