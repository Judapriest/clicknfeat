{"version":3,"sources":["gameSetupCtrl.es6"],"names":[],"mappings":"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","file":"gameSetupCtrl.js","sourcesContent":["(function() {\n  angular.module('clickApp.controllers')\n    .controller('gameSetupCtrl', gameSetupCtrl);\n\n  gameSetupCtrl.$inject = [\n    '$scope',\n    'gameScenario',\n  ];\n  function gameSetupCtrl($scope,\n                         gameScenarioService) {\n    const vm = this;\n    console.log('init gameSetupCtrl');\n\n    vm.doSetBoard = doSetBoard;\n    vm.doSetRandomBoard = doSetRandomBoard;\n    vm.doSetScenario = doSetScenario;\n    vm.doSetRandomScenario = doSetRandomScenario;\n    // vm.doGenerateObjectives = doGenerateObjectives;\n    vm.doToggleLayer = doToggleLayer;\n    vm.onAmbianceChange = onAmbianceChange;\n    vm.onCategoryChange = onCategoryChange;\n    vm.onEntryChange = onEntryChange;\n    vm.getTerrain = getTerrain;\n    vm.doCreateTerrain = doCreateTerrain;\n    vm.doResetTerrain = doResetTerrain;\n    // vm.doImportBoardFile = doImportBoardFile;\n\n    activate();\n\n    function activate() {\n      $scope.state.data_ready.then(onDataReady);\n\n      $scope.onStateChangeEvent('Game.board.change', updateBoardName, $scope);\n      self.requestAnimationFrame(updateBoardName);\n\n      $scope.onStateChangeEvent('Game.scenario.change', updateScenario, $scope);\n      self.requestAnimationFrame(updateScenario);\n\n      $scope.onStateChangeEvent('Game.layers.change', updateLayers, $scope);\n      self.requestAnimationFrame(updateLayers);\n\n      // $scope.$on('$destroy', () => {\n      //   $scope.stateEvent('Game.scenario.refresh');\n      // });\n      // $scope.stateEvent('Game.scenario.refresh');\n    }\n\n    function onDataReady() {\n      vm.boards = $scope.state.boards;\n      vm.terrains = $scope.state.terrains;\n      vm.ambiance = R.head(R.keys(vm.terrains));\n      vm.onAmbianceChange();\n      vm.scenarios = $scope.state.scenarios;\n      $scope.$digest();\n    }\n\n    function updateBoardName() {\n      vm.board_name = R.path(['game','board','name'], $scope.state);\n      $scope.$digest();\n    }\n    function doSetBoard() {\n      $scope.stateEvent('Game.board.set', vm.board_name);\n    }\n    function doSetRandomBoard() {\n      $scope.stateEvent('Game.board.setRandom');\n    }\n\n    function updateScenario() {\n      vm.scenario_name = R.path(['state','game','scenario','name'], $scope);\n      vm.scenario_group = gameScenarioService\n        .groupForName(vm.scenario_name, vm.scenarios);\n      $scope.$digest();\n    }\n    function doSetScenario() {\n      if(R.isNil(vm.scenario_name)) return;\n\n      $scope.stateEvent('Game.scenario.set',\n                        vm.scenario_name, vm.scenario_group);\n    }\n    function doSetRandomScenario() {\n      $scope.stateEvent('Game.scenario.setRandom');\n    }\n    // function doGenerateObjectives() {\n    //   $scope.stateEvent('Game.scenario.generateObjectives');\n    // }\n\n    function updateLayers() {\n      vm.layers = R.path(['state','game','layers'], $scope);\n      $scope.$digest();\n    }\n    function doToggleLayer(l) {\n      $scope.stateEvent('Game.command.execute',\n                        'setLayers', ['toggle', l]);\n    }\n\n    function onAmbianceChange() {\n      vm.category = R.head(R.keys(vm.terrains[vm.ambiance]));\n      vm.onCategoryChange();\n    }\n    function onCategoryChange() {\n      vm.entry = R.head(R.keys(vm.terrains[vm.ambiance][vm.category]));\n      vm.onEntryChange();\n    }\n    function onEntryChange() {\n    }\n    function getTerrainPath() {\n      return [ vm.ambiance,\n               vm.category,\n               vm.entry\n             ];\n    }\n    function getTerrain() {\n      return R.path([\n        vm.ambiance,\n        vm.category,\n        vm.entry\n      ], vm.terrains);\n    }\n    function doCreateTerrain() {\n      const terrain_path = getTerrainPath();\n      $scope.stateEvent('Game.terrain.create', terrain_path);\n    }\n    function doResetTerrain() {\n      $scope.stateEvent('Game.terrain.reset');\n    }\n\n    // function doImportBoardFile(files) {\n    //   $scope.stateEvent('Game.board.importFile', files[0]);\n    // }\n  }\n})();\n"]}