{"version":3,"sources":["gameMap.es6"],"names":[],"mappings":"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","file":"gameMap.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('gameMap', gameMapServiceFactory);\n\n  gameMapServiceFactory.$inject = [\n    'gameModels',\n    'gameTemplates',\n    'gameTerrains',\n  ];\n  function gameMapServiceFactory(gameModelsModel,\n                                 gameTemplatesModel,\n                                 gameTerrainsModel) {\n    const gameMapService = {\n      isFlipped: mapIsFlipped,\n      zoomFactor: mapZoomFactor,\n      eventToMapCoordinates: gameMapEventToMapCoordinates,\n      mapToScreenCoordinates: gameMapMapToScreenCoordinates,\n      findEventTarget: gameMapFindEventTarget\n    };\n\n    R.curryService(gameMapService);\n    return gameMapService;\n\n    function mapIsFlipped(map) {\n      return map.classList.contains('flipped');\n    }\n    function mapZoomFactor(map) {\n      var map_rect = map.getBoundingClientRect();\n      return map_rect.width / 480;\n    }\n    function gameMapEventToMapCoordinates(map, event) {\n      var map_flipped = gameMapService.isFlipped(map);\n      var rect = map.getBoundingClientRect();\n      var map_x = (event.clientX - rect.left) * 480 / rect.width;\n      var map_y = (event.clientY - rect.top) * 480 / rect.height;\n      map_x = ( map_flipped ? 480 - map_x : map_x );\n      map_y = ( map_flipped ? 480 - map_y : map_y );\n      return { x: map_x, y: map_y };\n    }\n    function gameMapMapToScreenCoordinates(map, coord) {\n      var map_flipped = gameMapService.isFlipped(map);\n      var rect = map.getBoundingClientRect();\n      var x = (coord.x * rect.width / 480);\n      var y = (coord.y * rect.height / 480);\n      if(map_flipped) {\n        x = rect.width - x;\n        y = rect.height - y;\n      }\n      x = x + rect.left;\n      y = y + rect.top;\n      return { x: x, y: y };\n    }\n    function gameMapFindEventTarget(game, event) {\n      const not_found = {\n        type: 'Map',\n        target: null\n      };\n      if(eventTargetTypeIs('template')) {\n        return emitTypeEvent(gameTemplatesModel, 'template');\n      }\n      if(eventTargetTypeIs('model-base')) {\n        return emitTypeEvent(gameModelsModel, 'model');\n      }\n      if(eventTargetTypeIs('terrain-image')) {\n        return emitTypeEvent(gameTerrainsModel, 'terrain');\n      }\n      return R.resolveP(not_found);\n\n      function eventTargetTypeIs(type) {\n        return ( event.target.classList.contains(type) &&\n                 event.target.hasAttribute('data-stamp')\n               );\n      }\n      function emitTypeEvent(model, type) {\n        const stamp = event.target.getAttribute('data-stamp');\n        return R.thread(game)(\n          R.prop(`${type}s`),\n          model.findStamp$(stamp),\n          R.ifElse(\n            R.exists,\n            (element) => ({ type: s.capitalize(type),\n                            target: element\n                          }),\n            () => not_found\n          )\n        );\n      }\n    }\n  }\n})();\n"]}