{"version":3,"sources":["settings.es6"],"names":[],"mappings":"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","file":"settings.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('settings', [\n    'localStorage',\n    function settingsServiceFactory(localStorageService) {\n      var SETTINGS_STORAGE_KEY = 'clickApp.settings';\n      var DEFAULT_SETTINGS = {};\n      var UPDATERS = {};\n      var settingsService = {\n        register: function settingsRegister(type, name, settings, updater) {\n          DEFAULT_SETTINGS[type] = R.defaultTo({}, DEFAULT_SETTINGS[type]);\n          UPDATERS[type] = R.defaultTo({}, UPDATERS[type]);\n          console.log('Settings: register', type, name, settings);\n          // Object.freeze(settings);\n          \n          DEFAULT_SETTINGS[type][name] = settings;\n          UPDATERS[type][name] = updater;\n        },\n        load: function settingsLoad() {\n          return R.pipeP(\n            () => {\n              return localStorageService.load(SETTINGS_STORAGE_KEY)\n                .catch(function(/* error */) {\n                  console.log('settings: failed to load data');\n                });\n            },\n            R.defaultTo({}),\n            R.spyWarn('Settings load')\n          )();\n        },\n        init: function settingsInit() {\n          return R.pipeP(\n            settingsService.load,\n            settingsService.bind,\n            settingsService.update\n          )(null);\n        },\n        bind: function settingsBind(settings) {\n          settings = R.defaultTo({}, settings);\n          return R.pipe(\n            R.keys,\n            R.reduce(function(mem, type) {\n              var settings_type = R.propOr({}, type, settings);\n              mem[type] = R.pipe(\n                R.keys,\n                R.reduce(function(mem, name) {\n                  var base = Object.create(DEFAULT_SETTINGS[type][name]);\n                  R.extend(base, R.propOr({}, name, settings_type));\n                  mem[name] = base;\n                  return mem;\n                }, {})\n              )(DEFAULT_SETTINGS[type]);\n              return mem;\n            }, {}),\n            function(binded) {\n              return {\n                default: DEFAULT_SETTINGS,\n                current: binded\n              };\n            }\n          )(DEFAULT_SETTINGS);\n        },\n        update: function settingsUpdate(settings) {\n          R.pipe(\n            R.keys,\n            R.forEach(function(type) {\n              R.pipe(\n                R.keys,\n                R.filter(function(name) {\n                  return R.exists(UPDATERS[type][name]);\n                }),\n                R.forEach(function(name) {\n                  UPDATERS[type][name](settings.current[type][name]);\n                })\n              )(settings.current[type]);\n            })\n          )(settings.current);\n          return settings;\n        },\n        store: function settingsStore(settings) {\n          return R.pipePromise(\n            R.spyWarn('Settings store'),\n            localStorageService.save$(SETTINGS_STORAGE_KEY)\n          )(settings.current);\n        }\n      };\n      return settingsService;\n    }\n  ]);\n"]}