{"version":3,"sources":["tick.es6"],"names":[],"mappings":";;AAAA,CAAC,YAAW;AACV,UAAQ,MAAR,CAAe,mBAAf,EACG,OADH,CACW,SADX,EACsB,qBADtB,EADU;;AAIV,wBAAsB,OAAtB,GAAgC,CAC9B,QAD8B,CAAhC,CAJU;AAOV,WAAS,qBAAT,CAA+B,aAA/B,EAA8C;AAC5C,QAAM,cAAc;AAClB,WAAK,OAAL;AACA,qBAAe,iBAAf;AACA,uBAAiB,mBAAjB;AACA,0BAAoB,sBAApB;AACA,sBAAgB,kBAAhB;AACA,yBAAmB,qBAAnB;KANI,CADsC;AAS5C,MAAE,YAAF,CAAe,WAAf,EAT4C;;AAW5C,QAAI,gBAAJ,CAX4C;AAY5C,QAAI,0BAAJ,CAZ4C;AAa5C,QAAI,eAAJ,CAb4C;;AAe5C,YAf4C;;AAiB5C,WAAO,WAAP,CAjB4C;;AAmB5C,aAAS,KAAT,GAAiB;AACf,aAAO,cAAc,MAAd,EAAP,CADe;AAEb,uBAAiB,KAAjB,CAFa;AAGf,YAAM,CAAN,CAHe;KAAjB;;AAMA,aAAS,OAAT,GAAmB;AACjB,aAAO,GAAP,CADiB;KAAnB;;AAIA,aAAS,iBAAT,CAA2B,EAA3B,EAA+B;AAC7B,UAAM,kBAAkB,cAAlB,CADuB;AAE3B,uBAAiB,IAAjB,CAF2B;;AAI7B,UAAM,MAAM,IAAN,CAJuB;;AAM7B,UAAG,eAAH,EAAoB,OAAO,GAAP,CAApB;AACE,uBAAiB,KAAjB,CAP2B;;AAS7B,eAT6B;AAU7B,kBAV6B;;AAY7B,aAAO,GAAP,CAZ6B;KAA/B;;AAeA,aAAS,mBAAT,CAA6B,QAA7B,EAAuC;AACrC,aAAO,cACJ,WADI,CACQ,MADR,EACgB,QADhB,EAC0B,IAD1B,CAAP,CADqC;KAAvC;;AAKA,aAAS,sBAAT,CAAgC,QAAhC,EAA0C;AACxC,aAAO,cACJ,cADI,CACW,MADX,EACmB,QADnB,EAC6B,IAD7B,CAAP,CADwC;KAA1C;;AAKA,aAAS,kBAAT,CAA4B,QAA5B,EAAsC;AACpC,aAAO,cACJ,WADI,CACQ,SADR,EACmB,QADnB,EAC6B,IAD7B,CAAP,CADoC;KAAtC;;AAKA,aAAS,qBAAT,CAA+B,QAA/B,EAAyC;AACvC,aAAO,cACJ,cADI,CACW,SADX,EACsB,QADtB,EACgC,IADhC,CAAP,CADuC;KAAzC;;AAKA,aAAS,MAAT,GAAkB;AAChB,YADgB;AAEhB,oBAAc,IAAd,CAAmB,MAAnB,EAA2B,CAAC,GAAD,CAA3B,EAAkC,IAAlC,EAFgB;KAAlB;;AAKA,aAAS,SAAT,GAAqB;AACnB,oBAAc,IAAd,CAAmB,SAAnB,EAA8B,CAAC,GAAD,CAA9B,EAAqC,IAArC,EADmB;KAArB;GArEF;CAPD,CAAD","file":"tick.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('appTick', appTickServiceFactory);\n\n  appTickServiceFactory.$inject = [\n    'pubSub'\n  ];\n  function appTickServiceFactory(pubSubService) {\n    const tickService = {\n      now: tickNow,\n      inTransaction: tickInTransaction,\n      addTickListener: tickAddTickListener,\n      removeTickListener: tickRemoveTickListener,\n      addEndListener: tickAddEndListener,\n      removeEndListener: tickRemoveEndListener\n    };\n    R.curryService(tickService);\n\n    let tick;\n    let in_transaction;\n    let now;\n\n    mount();\n\n    return tickService;\n\n    function mount() {\n      tick = pubSubService.create();\n        in_transaction = false;\n      now = 0;\n    }\n\n    function tickNow() {\n      return now;\n    }\n\n    function tickInTransaction(fn) {\n      const _in_transaction = in_transaction;\n        in_transaction = true;\n\n      const ret = fn();\n\n      if(_in_transaction) return ret;\n        in_transaction = false;\n\n      doTick();\n      doEndTick();\n\n      return ret;\n    }\n\n    function tickAddTickListener(listener) {\n      tick = pubSubService\n        .addListener('tick', listener, tick);\n    }\n\n    function tickRemoveTickListener(listener) {\n      tick = pubSubService\n        .removeListener('tick', listener, tick);\n    }\n\n    function tickAddEndListener(listener) {\n      tick = pubSubService\n        .addListener('tickEnd', listener, tick);\n    }\n\n    function tickRemoveEndListener(listener) {\n      tick = pubSubService\n        .removeListener('tickEnd', listener, tick);\n    }\n\n    function doTick() {\n      now++;\n      pubSubService.emit('tick', [now], tick);\n    }\n\n    function doEndTick() {\n      pubSubService.emit('tickEnd', [now], tick);\n    }\n  }\n})();\n"]}