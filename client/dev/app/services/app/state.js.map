{"version":3,"sources":["state.es6"],"names":[],"mappings":";;;;;;AAAA,CAAC,YAAW;AACV,UAAQ,MAAR,CAAe,mBAAf,EACG,OADH,CACW,UADX,EACuB,sBADvB,EADU;;AAIV,yBAAuB,OAAvB,GAAiC,CAC/B,YAD+B,EAE/B,UAF+B,EAG/B,WAH+B,CAAjC,CAJU;AASV,WAAS,sBAAT,CAAgC,UAAhC,EACgC,eADhC,EAEgC,gBAFhC,EAEkD;AAChD,QAAM,gBAAgB,iBAAiB,MAAjB,CACb,QADa,CACJ,QADI,EACM;aAAM;KAAN,CADtB,CAD0C;AAGhD,QAAM,WAAW,WAAW,WAAX,CAAuB,MAAvB,EAAX,CAH0C;AAIhD,SAAK,MAAL,CAAY,QAAZ,GAAuB,QAAvB,CAJgD;;AAMhD,QAAM,QAAQ,SACL,MADK,CACE,aADF,EAEL,IAFK,CAEA,EAFA,CAAR,CAN0C;AAShD,QAAM,OAAO,MAAM,KAAN,EAAP,CAT0C;AAUhD,SAAK,MAAL,CAAY,KAAZ,GAAoB,KAApB,CAVgD;;AAYhD,QAAM,eAAe;AACnB,kBADmB;AAEnB,WAAK,QAAL;KAFI,CAZ0C;AAgBhD,MAAE,YAAF,CAAe,YAAf,EAhBgD;;AAkBhD,YAlBgD;;AAoBhD,WAAO,YAAP,CApBgD;;AAsBhD,aAAS,KAAT,GAAiB;AACf,uBAAiB,QAAjB,CAA0B,YAA1B,EAAwC,WAAxC,EADe;KAAjB;;AAIA,aAAS,QAAT,CAAkB,KAAlB,QAA4C;;;UAAlB,kBAAkB;;UAAP,sBAAO;;AAC1C,cAAQ,IAAR,kBAA4B,MAA5B,EAAsC,IAAtC,EAA4C,KAA5C,EAD0C;AAE1C,cAAQ,KAAR,GAF0C;;AAI1C,UAAI,MAAM,IAAN,CAJsC;;AAM1C,UAAM,UAAU,EAAE,IAAF,CAAO,MAAP,EAAe,iBAAiB,QAAjB,EAAf,CAAV,CANoC;AAO1C,UAAG,EAAE,KAAF,CAAQ,OAAR,CAAH,EAAqB;AACnB,wBAAgB,IAAhB,sBAAwC,YAAxC,EADmB;AAEnB,eAAO,GAAP,CAFmB;OAArB;AAIA,UAAI;AACF,cAAM,QAAQ,KAAR,CAAc,IAAd,GAAsB,iCAAU,MAAhC,CAAN,CADE;OAAJ,CAGA,OAAM,CAAN,EAAS;AACP,wBAAgB,IAAhB,cAAgC,0BAAhC,EAAyD,CAAzD,EADO;OAAT;AAGA,aAAS,cAAc,EAAE,IAAF,CAAO,GAAP,CAAd,IAA6B,EAAE,KAAF,CAAQ,GAAR,CAA7B,GACE,KADF,GAEE,GAFF,CAjBiC;KAA5C;;AAuBA,aAAS,WAAT,GAAuB;AACrB,UAAM,OAAO,EAAP,CADe;AAErB,cAAQ,IAAR,CAAa,YAAb,EAA2B,IAA3B,EAFqB;AAGrB,aAAO,IAAP,CAHqB;KAAvB;GAnDF;CATD,CAAD","file":"state.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('appState', appStateServiceFactory);\n\n  appStateServiceFactory.$inject=  [\n    'behaviours',\n    'appError',\n    'appAction'\n  ];\n  function appStateServiceFactory(behaviours,\n                                  appErrorService,\n                                  appActionService) {\n    const stateOnAction = appActionService.action\n            .snapshot(onAction, () => loop);\n    const stateSet = behaviours.signalModel.create();\n    self.window.stateSet = stateSet;\n\n    const state = stateSet\n            .orElse(stateOnAction)\n            .hold({});\n    const loop = state.delay();\n    self.window.state = state;\n\n    const stateService = {\n      state,\n      set: stateSet\n    };\n    R.curryService(stateService);\n\n    mount();\n\n    return stateService;\n\n    function mount() {\n      appActionService.register('State.Init', onStateInit);\n    }\n\n    function onAction(state, [action, ...args]) {\n      console.info(`===> Action ${action}`, args, state);\n      console.trace();\n\n      let ret = null;\n\n      const handler = R.prop(action, appActionService.handlers());\n      if(R.isNil(handler)) {\n        appErrorService.emit(`Unknown action \"${action}\"`);\n        return ret;\n      }\n      try {\n        ret = handler.apply(null, [ state, ...args ]);\n      }\n      catch(e) {\n        appErrorService.emit(`Action \"${action}\" handler error`, e);\n      }\n      return ( 'Promise' === R.type(ret) || R.isNil(ret)\n               ? state\n               : ret\n             );\n    }\n\n    function onStateInit() {\n      const init = {};\n      console.info('State.Init', init);\n      return init;\n    }\n  }\n})();\n"]}