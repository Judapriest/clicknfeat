{"version":3,"sources":["games.es6"],"names":[],"mappings":"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","file":"games.js","sourcesContent":["(function() {\n  angular.module('clickApp.services')\n    .factory('appGames', stateGamesModelFactory);\n\n  stateGamesModelFactory.$inject = [\n    'appError',\n    'behaviours',\n    'appAction',\n    'appState',\n    'fileImport',\n    'game',\n    'games',\n  ];\n  function stateGamesModelFactory(appErrorService,\n                                  behavioursModel,\n                                  appActionService,\n                                  appStateService,\n                                  fileImportService,\n                                  gameModel,\n                                  gamesModel) {\n    const LOCAL_GAMES_LENS = R.lensProp('local_games');\n\n    const local = appStateService.state\n            .map(R.viewOr([], LOCAL_GAMES_LENS));\n    const load = {\n      local: behavioursModel.signalModel.create(),\n      online: behavioursModel.signalModel.create()\n    };\n\n    const gamesService = {\n      local, load,\n      // create: stateGamesCreate,\n      localSet: actionGamesLocalSet,\n      localUpdate: actionGamesLocalUpdate,\n      localCreate: actionGamesLocalCreate,\n      localLoadFile: actionGamesLocalLoadFile,\n      localLoadNew: actionGamesLocalLoadNew,\n      localLoad: actionGamesLocalLoad,\n      localDelete: actionGamesLocalDelete,\n      onlineCreate: actionGamesOnlineCreate,\n      onlineLoad: actionGamesOnlineLoad,\n      onlineLoadFile: actionGamesOnlineLoadFile\n    };\n    R.curryService(gamesService);\n\n    mount();\n\n    return gamesService;\n\n    function mount() {\n      appActionService\n        .register('Games.local.set'       , actionGamesLocalSet)\n        .register('Games.local.update'    , actionGamesLocalUpdate)\n        .register('Games.local.create'    , actionGamesLocalCreate)\n        .register('Games.local.loadFile'  , actionGamesLocalLoadFile)\n        .register('Games.local.loadNew'   , actionGamesLocalLoadNew)\n        .register('Games.local.load'      , actionGamesLocalLoad)\n        .register('Games.local.delete'    , actionGamesLocalDelete)\n        .register('Games.online.create'   , actionGamesOnlineCreate)\n        .register('Games.online.load'     , actionGamesOnlineLoad)\n        .register('Games.online.loadFile' , actionGamesOnlineLoadFile);\n\n      gamesService.ready = gamesModel.loadLocalGamesP()\n        .then((games) => {\n          return appActionService.action\n            .send(['Games.local.set', games]);\n        });\n    }\n    function actionGamesLocalSet(state, games) {\n      return R.set(LOCAL_GAMES_LENS, games, state);\n    }\n    function actionGamesLocalUpdate(state, game) {\n      return R.over(\n        LOCAL_GAMES_LENS,\n        gamesModel.updateLocalGame$(game),\n        state\n      );\n    }\n    function actionGamesLocalCreate(state) {\n      return R.thread(state.user.state)(\n        gameModel.create,\n        (game) => actionGamesLocalLoadNew(state, game)\n      );\n    }\n    function actionGamesLocalLoadFile(_state_, file) {\n      return R.threadP(file)(\n        fileImportService.readP$('json'),\n        (data) => appActionService.action\n          .send(['Games.local.loadNew', data])\n      );\n    }\n    function actionGamesLocalLoadNew(state, game) {\n      return R.thread(state)(\n        R.over(LOCAL_GAMES_LENS, gamesModel.newLocalGame$(game)),\n        R.tap(R.pipe(\n          R.view(LOCAL_GAMES_LENS),\n          R.last,\n          R.prop('local_stamp'),\n          (id) => actionGamesLocalLoad(state, id)\n        ))\n      );\n    }\n    function actionGamesLocalLoad(_state_, index) {\n      load.local.send(index);\n    }\n    function actionGamesLocalDelete(state, id) {\n      return R.over(\n        LOCAL_GAMES_LENS,\n        gamesModel.removeLocalGame$(id),\n        state\n      );\n    }\n    function actionGamesOnlineCreate(state) {\n      return R.threadP(state)(\n        R.pathOr({}, ['user','state']),\n        gameModel.create,\n        loadNewOnlineGameP\n      ).catch(appErrorService.emit);\n    }\n    function actionGamesOnlineLoad(state, index) {\n      return R.thread(state)(\n        R.pathOr([], ['user','connection','games']),\n        R.nth(index),\n        R.defaultTo({}),\n        R.propOr('null', 'public_stamp'),\n        (id) => {\n          load.online.send(['public', id]);\n        }\n      );\n    }\n    function actionGamesOnlineLoadFile(_state_, file) {\n      return R.threadP(file)(\n        fileImportService.readP$('json'),\n        loadNewOnlineGameP\n      ).catch(appErrorService.emit);\n    }\n    function loadNewOnlineGameP(game) {\n      return R.threadP(game)(\n        gamesModel.newOnlineGameP,\n        R.prop('private_stamp'),\n        (id) => {\n          load.online.send(['private', id]);\n        }\n      );\n    }\n  }\n})();\n"]}