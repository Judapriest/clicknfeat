{"version":3,"sources":["../../es6/directives/gameTerrain.js"],"names":[],"mappings":"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","file":"gameTerrain.js","sourcesContent":["angular.module('clickApp.directives')\n  .directive('clickGameTerrain', [\n    'gameMap',\n    'gameTerrainInfo',\n    'gameTerrainSelection',\n    'terrain',\n    function(\n      gameMapService,\n      gameTerrainInfoService,\n      gameTerrainSelectionService\n    ) {\n      var clickGameTerrainDirective = {\n        restrict: 'A',\n        link: (scope, el/*, attrs*/) => {\n          R.pipeP(\n            () => {\n              return gameTerrainInfoService\n                .getInfo(scope.terrain.state.info, scope.terrains)\n                .catch((reason) => {\n                  console.error('clickGameTerrain', reason);\n                  return self.Promise.reject(reason);\n                });\n            },\n            (info) => {\n              console.log('gameTerrain', scope.terrain, info);\n\n              return buildTerrainElement(info, scope.terrain, el[0], scope);\n            }\n          )();\n        }\n      };\n      function buildTerrainElement(info, terrain, container, scope) {\n        var element = createTerrainElement(info, terrain, container);\n        \n        // scope.$on('$destroy', gameTerrainOnDestroy(element));\n        // scope.onGameEvent('mapFlipped',\n        //                   gameTerrainOnMapFlipped(info, terrain, element),\n        //                   scope);\n        var updateTerrain = gameTerrainOnUpdate(scope.terrains,\n                                                info,\n                                                terrain,\n                                                scope.game,\n                                                scope,\n                                                element);\n        scope.onGameEvent('changeTerrain-'+terrain.state.stamp,\n                          updateTerrain,\n                          scope);\n        updateTerrain();\n      }\n      function createTerrainElement(info, terrain, parent) {\n        var map = document.getElementById('map');\n        var svgNS = map.namespaceURI;\n        \n        // var title = document.createElementNS(svgNS, 'title');\n        // base.appendChild(title);\n        // title.innerHTML = info.name;\n          \n        var image = document.createElementNS(svgNS, 'image');\n        image.classList.add('terrain-image');\n        image.setAttribute('data-stamp', terrain.state.stamp);\n        image.setAttribute('x', '0');\n        image.setAttribute('y', '0');\n        image.setAttribute('width', info.img.width+'');\n        image.setAttribute('height', info.img.height+'');\n        image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', info.img.link);\n        parent.appendChild(image);\n          \n        var direction = document.createElementNS(svgNS, 'line');\n        direction.classList.add('terrain-los');\n        direction.setAttribute('x1', (info.img.width/2)+'');\n        direction.setAttribute('y1', (info.img.height/2)+'');\n        direction.setAttribute('x2', (info.img.width/2)+'');\n        direction.setAttribute('y2', '0');\n        parent.appendChild(direction);\n\n        var edge = document.createElementNS(svgNS, 'rect');\n        edge.classList.add('terrain-edge');\n        edge.setAttribute('x', '0');\n        edge.setAttribute('y', '0');\n        edge.setAttribute('width', (info.img.width)+'');\n        edge.setAttribute('height', (info.img.height)+'');\n        parent.appendChild(edge);\n\n        return { container: parent,\n                 image: image,\n                 direction: direction,\n                 edge: edge\n               };\n      }\n      // function gameTerrainOnDestroy(/*element*/) {\n      //   return function _gameTerrainOnDestroy() {\n      //     console.log('gameTerrainOnDestroy');\n      //   };\n      // }\n      // function gameTerrainOnMapFlipped(/*info, terrain, element*/) {\n      //   return function _gameTerrainOnMapFlipped() {\n      //   };\n      // }\n      function gameTerrainOnUpdate(terrains, info, terrain, game, scope, element) {\n        return () => {\n          updateTerrainPosition(info.img, terrain, element);\n          updateTerrainSelection(game.terrain_selection,\n                                 terrain, element);\n        };\n      }\n      function updateTerrainPosition(img, terrain, element) {\n        element.container.setAttribute('transform', [\n          'translate(',\n          terrain.state.x-img.width/2,\n          ',',\n          terrain.state.y-img.height/2,\n          ') rotate(',\n          terrain.state.r,\n          ',',\n          img.width/2,\n          ',',\n          img.height/2,\n          ')'\n        ].join(''));\n      }\n      function updateTerrainSelection(selection, terrain, element) {\n        var container = element.container;\n        var stamp = terrain.state.stamp;\n        if(gameTerrainSelectionService.in('local', stamp, selection)) {\n          container.classList.add('local-selection');\n        }\n        else {\n          container.classList.remove('local-selection');\n        }\n        if(gameTerrainSelectionService.in('remote', stamp, selection)) {\n          container.classList.add('remote-selection');\n        }\n        else {\n          container.classList.remove('remote-selection');\n        }\n      }\n      return clickGameTerrainDirective;\n    }\n  ])\n  .directive('clickGameTerrainsList', [\n    function() {\n      return {\n        restrict: 'A',\n        templateUrl: 'partials/game/terrains_list.html',\n        scope: true,\n        link: function(scope, element/*, attrs*/) {\n          scope.type = element[0].getAttribute('click-game-terrains-list');\n          console.log('clickGameTerrainsList', scope.type);\n        }\n      };\n    }\n  ]);\n"]}