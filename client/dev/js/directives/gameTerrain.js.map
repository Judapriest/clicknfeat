{"version":3,"sources":["../../es6/directives/gameTerrain.js"],"names":[],"mappings":"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","file":"gameTerrain.js","sourcesContent":["angular.module('clickApp.directives')\n  .directive('clickGameTerrain', [\n    'gameMap',\n    'gameTerrains',\n    'gameTerrainInfo',\n    'gameTerrainSelection',\n    function(gameMapService,\n             gameTerrainsService,\n             gameTerrainInfoService,\n             gameTerrainSelectionService) {\n      var clickGameTerrainDirective = {\n        restrict: 'A',\n        link: (scope, parent) => {\n          let state = scope.state;\n          R.pipeP(\n            () => {\n              return gameTerrainInfoService\n                .getInfo(scope.terrain.state.info, state.terrains)\n                .catch((reason) => {\n                  console.error('clickGameTerrain', reason);\n                  return self.Promise.reject(reason);\n                });\n            },\n            (info) => {\n              console.log('gameTerrain', scope.terrain, info);\n\n              return buildTerrainElement(state, info, scope.terrain,\n                                         parent[0], scope);\n            }\n          )();\n        }\n      };\n      function buildTerrainElement(state, info, terrain, parent, scope) {\n        var element = createTerrainElement(info, terrain, parent);\n\n        var updateTerrain = gameTerrainOnUpdate(state, info,\n                                                scope, element);\n        scope.onStateChangeEvent(`Game.terrain.change.${terrain.state.stamp}`,\n                                 updateTerrain, scope);\n        updateTerrain();\n      }\n      function createTerrainElement(info, terrain, parent) {\n        var map = document.getElementById('map');\n        var svgNS = map.namespaceURI;\n\n        var image = document.createElementNS(svgNS, 'image');\n        image.classList.add('terrain-image');\n        image.setAttribute('data-stamp', terrain.state.stamp);\n        image.setAttribute('x', '0');\n        image.setAttribute('y', '0');\n        image.setAttribute('width', info.img.width+'');\n        image.setAttribute('height', info.img.height+'');\n        image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', info.img.link);\n        parent.appendChild(image);\n\n        var direction = document.createElementNS(svgNS, 'line');\n        direction.classList.add('terrain-los');\n        direction.setAttribute('x1', (info.img.width/2)+'');\n        direction.setAttribute('y1', (info.img.height/2)+'');\n        direction.setAttribute('x2', (info.img.width/2)+'');\n        direction.setAttribute('y2', '0');\n        parent.appendChild(direction);\n\n        var edge = document.createElementNS(svgNS, 'rect');\n        edge.classList.add('terrain-edge');\n        edge.setAttribute('x', '0');\n        edge.setAttribute('y', '0');\n        edge.setAttribute('width', (info.img.width)+'');\n        edge.setAttribute('height', (info.img.height)+'');\n        parent.appendChild(edge);\n\n        return { container: parent,\n                 image: image,\n                 direction: direction,\n                 edge: edge\n               };\n      }\n      function gameTerrainOnUpdate(state, info, scope, element) {\n        return () => {\n          R.pipeP(\n            () => {\n              return gameTerrainsService\n                .findStamp(scope.terrain.state.stamp,\n                           scope.state.game.terrains);\n            },\n            (terrain) => {\n              updateTerrainPosition(info.img, terrain, element);\n              updateTerrainSelection(state.game.terrain_selection,\n                                     terrain, element);\n            }\n          )();\n        };\n      }\n      function updateTerrainPosition(img, terrain, element) {\n        element.container.setAttribute('transform', [\n          'translate(',\n          terrain.state.x-img.width/2,\n          ',',\n          terrain.state.y-img.height/2,\n          ') rotate(',\n          terrain.state.r,\n          ',',\n          img.width/2,\n          ',',\n          img.height/2,\n          ')'\n        ].join(''));\n      }\n      function updateTerrainSelection(selection, terrain, element) {\n        var container = element.container;\n        var stamp = terrain.state.stamp;\n        if(gameTerrainSelectionService.in('local', stamp, selection)) {\n          container.classList.add('local-selection');\n        }\n        else {\n          container.classList.remove('local-selection');\n        }\n        if(gameTerrainSelectionService.in('remote', stamp, selection)) {\n          container.classList.add('remote-selection');\n        }\n        else {\n          container.classList.remove('remote-selection');\n        }\n      }\n      return clickGameTerrainDirective;\n    }\n  ])\n  .directive('clickGameTerrainsList', [\n    function() {\n      return {\n        restrict: 'A',\n        templateUrl: 'partials/game/terrains_list.html',\n        scope: true,\n        link: function(scope, element) {\n          scope.type = element[0].getAttribute('click-game-terrains-list');\n          scope.digestOnStateChangeEvent('Game.terrain.create', scope);\n          console.log('clickGameTerrainsList', scope.type);\n        }\n      };\n    }\n  ]);\n"]}