{"version":3,"sources":["../../es6/directives/gameEditLabel.js"],"names":[],"mappings":"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","file":"gameEditLabel.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.controllers')\n  .controller('clickGameEditLabelCtrl', [\n    '$scope',\n    function($scope) {\n      console.log('init clickGameEditLabelCtrl');\n\n      $scope.edit = { label: '' };\n\n      $scope.doAddLabel = function doAddLabel() {\n        var new_label = s.trim($scope.edit.label);\n        if(R.length(new_label) === 0) return;\n        \n        $scope.doExecuteCommand('onModels', 'addLabel', new_label,\n                                [$scope.selection.state.stamp])\n          .then(() => {\n            $scope.edit.label = '';\n            $scope.doClose();\n            $scope.$digest();\n          });\n      };\n    }\n  ]);\n\nangular.module('clickApp.directives')\n  .directive('clickGameEditLabel', [\n    '$window',\n    'gameMap',\n    function($window,\n             gameMapService) {\n      return {\n        restrict: 'A',\n        template: [ '<form ng-submit=\"doAddLabel()\">',\n                    '<input type=\"text\" ng-model=\"edit.label\" ng-change=\"doRefresh()\" />',\n                    '</form>'\n                  ].join(''),\n        scope: true,\n        controller: 'clickGameEditLabelCtrl',\n        link: function(scope, element/*, attrs*/) {\n          console.log('gameEditLabel');\n          let map = document.getElementById('map');\n          let input = element[0].querySelector('input');\n          \n          closeEditLabel();\n\n          function closeEditLabel() {\n            console.log('closeEditLabel');\n\n            scope.selection = {};\n\n            $window.requestAnimationFrame(function _closeEditLabel() {\n              element[0].style.display = 'none';\n              element[0].style.visibility = 'hidden';\n              element[0].style.left = 0+'px';\n              element[0].style.top = 0+'px';\n            });\n          }\n          function openEditLabel(event, selection) {\n            console.log('openEditLabel');\n\n            scope.selection = selection;\n            scope.edit = { label: '' };\n            scope.$digest();\n            \n            $window.requestAnimationFrame(displayEditLabel);\n          }\n          function displayEditLabel() {\n            element[0].style.display = 'initial';\n            element[0].style.visibility = 'hidden';\n            setEditLabelWidth();\n\n            $window.requestAnimationFrame(showEditLabel);\n          }\n          function showEditLabel() {\n            placeEditLabel();\n            element[0].style.visibility = 'visible';\n\n            $window.requestAnimationFrame(() => {\n              input.focus();\n            });\n          }\n          function refreshEditLabel() {\n            setEditLabelWidth();\n\n            $window.requestAnimationFrame(placeEditLabel);\n          }\n          function placeEditLabel() {\n            var detail_rect = input.getBoundingClientRect();\n            var screen_pos = gameMapService\n                  .mapToScreenCoordinates(map, scope.selection.state);\n\n            element[0].style.left = (screen_pos.x - detail_rect.width / 2) + 'px';\n            element[0].style.top = (screen_pos.y - detail_rect.height / 2) + 'px';\n          }\n          function setEditLabelWidth() {\n            input.style.width = R.length(scope.edit.label) + 'em';\n          }\n\n          scope.onGameEvent('openEditLabel', openEditLabel, scope);\n          scope.onGameEvent('closeEditLabel', closeEditLabel, scope);\n          input.addEventListener('keydown', (event) => {\n            console.log('toto',event);\n            if(event.keyCode === 27) { // ESC\n              closeEditLabel();\n            }\n          });\n          \n          scope.doRefresh = refreshEditLabel;\n          scope.doClose = closeEditLabel;\n        }\n      };\n    }\n  ]);\n"]}