{"version":3,"sources":["../../es6/directives/gameMap.js"],"names":[],"mappings":"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","file":"gameMap.js","sourcesContent":["angular.module('clickApp.directives')\n  .directive('clickGameMap', [\n    '$window',\n    'gameMap',\n    'terrain',\n    'defaultMode',\n    function($window,\n             gameMapService,\n             terrainService,\n             defaultModeService) {\n      function _eventModifiers(e) {\n        let modifiers = [];\n\n        if (e.shiftKey) {\n          modifiers.push('shift');\n        }\n\n        if (e.altKey) {\n          modifiers.push('alt');\n        }\n\n        if (e.ctrlKey) {\n          modifiers.push('ctrl');\n        }\n\n        if (e.metaKey) {\n          modifiers.push('meta');\n        }\n\n        return modifiers.sort();\n      }\n      return {\n        restrict: 'A',\n        link: function(scope, element) {\n          let log = true ? R.bind(console.log, console) : function() {}; // eslint-disable-line\n\n          let viewport = document.querySelector('#viewport');\n          let map = element[0];\n          let state = scope.state;\n\n          let mouseEvents = (function() {\n            let drag = {\n              active: false,\n              start: null,\n              target: null,\n              now: null\n            };\n            function blurInputs() {\n              let inputs = [\n                ...document.querySelectorAll('input'),\n                ...document.querySelectorAll('select'),\n                ...document.querySelectorAll('textarea'),\n              ];\n              R.forEach((e) => { e.blur(); }, inputs);\n            }\n            function mouseDownMap(event) {\n              log('mouseDownMap', event, map.getBoundingClientRect());\n              blurInputs();\n              event.preventDefault();\n              if(event.which !== 1) return;\n\n              map.addEventListener('mousemove', dragMap);\n              let start = gameMapService.eventToMapCoordinates(map, event);\n              gameMapService.findEventTarget(state.game, event)\n                .then((target) => {\n                  drag = {\n                    active: false,\n                    start: start,\n                    target: target,\n                    now: null\n                  };\n                });\n            }\n            function dragMap(event) {\n              log('dragMap', event);\n              event.preventDefault();\n              if(event.which !== 1) return;\n\n              drag.now = gameMapService.eventToMapCoordinates(map, event);\n              if(!drag.active &&\n                 Math.abs(drag.now.x - drag.start.x) < defaultModeService.moves().DragEpsilon &&\n                 Math.abs(drag.now.y - drag.start.y) < defaultModeService.moves().DragEpsilon) {\n                return;\n              }\n              let emit = drag.active ? 'drag' : 'dragStart';\n              drag.active = true;\n\n              if('Terrain' === drag.target.type &&\n                 terrainService.isLocked(drag.target.target)) {\n                drag.target = { type: 'Map',\n                                target: null\n                              };\n              }\n              scope.stateEvent('Modes.current.action',\n                               emit+drag.target.type,\n                               [ { target: drag.target.target,\n                                   start: drag.start,\n                                   now: drag.now\n                                 },\n                                 event\n                               ]);\n            }\n            function mouseLeaveMap(event) {\n              log('mouseLeaveMap', event);\n              event.preventDefault();\n\n              map.removeEventListener('mousemove', dragMap);\n              if(drag.active) {\n                drag.active = false;\n                scope.stateEvent('Modes.current.action',\n                                 'dragEnd'+drag.target.type,\n                                 [ { target: drag.target.target,\n                                     start: drag.start,\n                                     now: drag.now\n                                   },\n                                   event\n                                 ]);\n              }\n            }\n            function clickMap(event) {\n              log('clickMap', event);\n              event.preventDefault();\n              if(event.which !== 1) return;\n\n              map.removeEventListener('mousemove', dragMap);\n\n              let now = gameMapService.eventToMapCoordinates(map, event);\n              if(drag.active) {\n                drag.active = false;\n                scope.stateEvent('Modes.current.action',\n                                 'dragEnd'+drag.target.type,\n                                 [ { target: drag.target.target,\n                                     start: drag.start,\n                                     now: now\n                                   },\n                                   event\n                                 ]);\n              }\n              else {\n                gameMapService.findEventTarget(state.game, event)\n                  .then((target) => {\n                    let event_name = R.pipe(\n                      R.append('click'+target.type),\n                      R.join('+')\n                    )(_eventModifiers(event));\n                    event['click#'] = {\n                      target: target.target,\n                      x: now.x,\n                      y: now.y\n                    };\n                    state.changeEvent('Game.selectionDetail.close');\n                    state.changeEvent('Game.editLabel.close');\n                    state.changeEvent('Game.editDamage.close');\n                    Mousetrap.trigger(event_name, undefined, event);\n                  });\n              }\n            }\n            function rightClickMap(event) {\n              log('rightClickMap', event);\n              event.preventDefault();\n\n              let now = gameMapService.eventToMapCoordinates(map, event);\n              gameMapService.findEventTarget(state.game, event)\n                .then((target) => {\n                  let event_name = R.pipe(\n                    R.append('rightClick'+target.type),\n                    R.join('+')\n                  )(_eventModifiers(event));\n                  event['click#'] = {\n                    target: target.target,\n                    x: now.x,\n                    y: now.y\n                  };\n                  state.changeEvent('Game.selectionDetail.close');\n                  state.changeEvent('Game.editLabel.close');\n                  state.changeEvent('Game.editDamage.close');\n                  Mousetrap.trigger(event_name, undefined, event);\n                });\n            }\n            function moveMap(event) {\n              log('moveMap', event);\n              event.preventDefault();\n\n              let now = gameMapService.eventToMapCoordinates(map, event);\n              scope.stateEvent('Modes.current.action',\n                               'moveMap', [now, event]);\n            }\n            return {\n              down: mouseDownMap,\n              drag: dragMap,\n              leave: mouseLeaveMap,\n              click: clickMap,\n              rightClick: rightClickMap,\n              move: moveMap\n            };\n          })();\n\n          let moveEvents = (function() {\n            let move_enabled = false;\n            function onEnableMove() {\n              if(move_enabled) return;\n              map.addEventListener('mousemove', mouseEvents.move);\n              move_enabled = true;\n            }\n            function onDisableMove() {\n              if(!move_enabled) return;\n              map.removeEventListener('mousemove', mouseEvents.move);\n              move_enabled = false;\n            }\n            return {\n              enable: onEnableMove,\n              disable: onDisableMove\n            };\n          })();\n\n          let flipMap = (function() {\n            let deploiement_labels;\n            state.ui_state = R.assoc('flip_map', false, R.propOr({}, 'ui_state', state));\n            map.classList.remove('flipped');\n            return function onFlipMap() {\n              deploiement_labels = document.querySelector('#deploiement-labels');\n              state.ui_state.flip_map = !map.classList.contains('flipped');\n              map.classList.toggle('flipped');\n              if(state.ui_state.flip_map) {\n                deploiement_labels\n                  .setAttribute('transform','rotate(180,240,240)');\n              }\n              else {\n                deploiement_labels\n                  .setAttribute('transform','');\n              }\n              state.changeEvent('Game.map.flipped');\n            };\n          })();\n\n          let zoomEvents = (function() {\n            function zoomReset() {\n              let rect = viewport.getBoundingClientRect();\n              let hw = Math.min(rect.width, rect.height);\n              setMapDimensions(hw-15);\n            }\n            function zoomIn() {\n              let [[cx,cy],[vw,vh]] = findViewportCenter();\n\n              let rect = map.getBoundingClientRect();\n              cx = (vw > rect.width) ? rect.width / 2 : cx;\n              cy = (vh > rect.height) ? rect.height / 2 : cy;\n\n              setMapDimensions(rect.width*2);\n              setViewportCenter(cx*2, cy*2, vw, vh);\n            }\n            function zoomOut() {\n              let [[cx,cy],[vw,vh]] = findViewportCenter();\n              let hw = Math.min(vw, vh);\n\n              let rect = map.getBoundingClientRect();\n\n              setMapDimensions(Math.max(hw-15, rect.width/2));\n              setViewportCenter(cx/2, cy/2, vw, vh);\n            }\n            return {\n              in: zoomIn,\n              out: zoomOut,\n              reset: zoomReset\n            };\n          })();\n\n          let scrollEvents = (function() {\n            let scroll_indent = 30;\n            function scrollLeft() {\n              let left = viewport.scrollLeft;\n              $window.requestAnimationFrame(() => {\n                viewport.scrollLeft = left - scroll_indent;\n              });\n            }\n            function scrollRight() {\n              let left = viewport.scrollLeft;\n              $window.requestAnimationFrame(() => {\n                viewport.scrollLeft = left + scroll_indent;\n              });\n            }\n            function scrollUp() {\n              let top = viewport.scrollTop;\n              $window.requestAnimationFrame(() => {\n                viewport.scrollTop = top - scroll_indent;\n              });\n            }\n            function scrollDown() {\n              let top = viewport.scrollTop;\n              $window.requestAnimationFrame(() => {\n                viewport.scrollTop = top + scroll_indent;\n              });\n            }\n            return {\n              left: scrollLeft,\n              right: scrollRight,\n              up: scrollUp,\n              down: scrollDown\n            };\n          })();\n\n          function setMapDimensions(dim) {\n            map.style.width = dim+'px';\n            map.style.height = dim+'px';\n          }\n\n          function findViewportCenter() {\n            let rect = viewport.getBoundingClientRect();\n            let vw = rect.width;\n            let vh = rect.height;\n\n            let cx = viewport.scrollLeft + vw/2;\n            let cy = viewport.scrollTop + vh/2;\n\n            return [[cx, cy], [vw, vh]];\n          }\n\n          function setViewportCenter(cx, cy, vw, vh) {\n            viewport.scrollLeft = cx - vw/2;\n            viewport.scrollTop = cy - vh/2;\n          }\n\n          map.addEventListener('mouseup', mouseEvents.click);\n          map.addEventListener('mousedown', mouseEvents.down);\n          map.addEventListener('mouseleave', mouseEvents.leave);\n          map.addEventListener('dragstart', (event) => {\n            event.preventDefault();\n          });\n          map.addEventListener('contextmenu', mouseEvents.rightClick);\n\n          scope.onStateChangeEvent('Game.view.flipMap', flipMap, scope);\n          scope.onStateChangeEvent('Game.moveMap.enable', moveEvents.enable, scope);\n          scope.onStateChangeEvent('Game.moveMap.disable', moveEvents.disable, scope);\n          scope.onStateChangeEvent('Game.view.zoomIn', zoomEvents.in, scope);\n          scope.onStateChangeEvent('Game.view.zoomOut', zoomEvents.out, scope);\n          scope.onStateChangeEvent('Game.view.zoomReset', zoomEvents.reset, scope);\n          scope.onStateChangeEvent('Game.view.scrollLeft', scrollEvents.left, scope);\n          scope.onStateChangeEvent('Game.view.scrollRight', scrollEvents.right, scope);\n          scope.onStateChangeEvent('Game.view.scrollUp', scrollEvents.up, scope);\n          scope.onStateChangeEvent('Game.view.scrollDown', scrollEvents.down, scope);\n\n          $window.requestAnimationFrame(zoomEvents.reset);\n        }\n      };\n    }\n  ]);\n"]}