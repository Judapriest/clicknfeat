{"version":3,"sources":["../../es6/directives/gameLabelElement.js"],"names":[],"mappings":"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","file":"gameLabelElement.js","sourcesContent":["angular.module('clickApp.directives')\n  .factory('labelElement', [\n    '$window',\n    'gameMap',\n    function($window,\n             gameMapService) {\n      var labelElementService = {\n        create: function labelElementServiceCreate(svgNS, parent) {\n          var gLabel = document.createElementNS(svgNS, 'g');\n          gLabel.classList.add('label');\n          parent.appendChild(gLabel);\n          var rectLabel = document.createElementNS(svgNS, 'rect');\n          rectLabel.setAttribute('height', '6');\n          gLabel.appendChild(rectLabel);\n          var textLabel = document.createElementNS(svgNS, 'text');\n          gLabel.appendChild(textLabel);\n\n          return { label: gLabel,\n                   bckgnd: rectLabel,\n                   text: textLabel\n                 };\n        },\n        updateOnFlipMap: function labelElementUpdateOnFlipMap(map, center, label) {\n          var map_flipped = gameMapService.isFlipped(map);\n          label.label.setAttribute('transform',\n                                   map_flipped ? 'rotate(180,'+\n                                   center.x+','+\n                                   center.y+')' : '');\n        },\n        update: function labelElementUpdate(map_flipped,\n                                            zoom_factor,\n                                            flip_center,\n                                            text_center,\n                                            text,\n                                            label) {\n          text = R.defaultTo('', text) + '';\n          var visibility = R.length(text) > 0 ? 'visible' : 'hidden';\n\n          updateLabel(map_flipped, flip_center, visibility, label.label);\n          if('visible' === visibility) {\n            updateText(text_center, text, label.text);\n\n            $window.requestAnimationFrame(() => {\n              updateBackground(zoom_factor, text_center,\n                               label.text, label.bckgnd);\n            });\n          }\n        }\n      };\n      function updateLabel(map_flipped, flip_center, visibility, label) {\n        label.style.visibility = visibility;\n        label.setAttribute('transform',\n                           ( map_flipped ?\n                             'rotate(180,'+flip_center.x+','+flip_center.y+')' :\n                             ''\n                           ));\n      }\n      function updateText(center, content, text) {\n        text.innerHTML = content;\n        text.setAttribute('x', center.x+'');\n        text.setAttribute('y', center.y+'');\n      }\n      function updateBackground(zoom_factor, text_center,\n                                label, bckgnd) {\n        var label_rect = label.getBoundingClientRect();\n        var width = label_rect.width / zoom_factor - 2;\n        var height = parseFloat(bckgnd.getAttribute('height'));\n\n        bckgnd.setAttribute('x', (text_center.x - width / 2 - 1)+'');\n        bckgnd.setAttribute('y', (text_center.y - (height - 1))+'');\n        bckgnd.setAttribute('width', (width + 2)+'');\n      }\n      return labelElementService;\n    }\n  ]);\n"]}