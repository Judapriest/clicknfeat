{"version":3,"sources":["../../../es6/directives/gameModel/counter.js"],"names":[],"mappings":"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","file":"counter.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.directives')\n  .factory('clickGameModelCounter', [\n    'labelElement',\n    'model',\n    function(labelElementService,\n             modelService) {\n      function computeCounterCenter(model) {\n        var counter_flip_center = { x: model.state.x, y: model.state.y };\n        var counter_text_center = { x: counter_flip_center.x, y: counter_flip_center.y+4 };\n        return { text: counter_text_center,\n                 flip: counter_flip_center,\n               };\n      }\n      function computeSoulsCenter(img, info/*, model*/) {\n        var counter_flip_center = { x: img.width/2, y: img.height/2 };\n        var counter_text_center = { x: counter_flip_center.x + info.base_radius * 0.8 + 5,\n                                    y: counter_flip_center.y - info.base_radius - 5 };\n        return { text: counter_text_center,\n                 flip: counter_flip_center,\n               };\n      }\n      return {\n        create: function clickGameModelCounterCreate(svgNS, over_models_container, parent) {\n          var counter = labelElementService.create(svgNS, over_models_container);\n          counter.label.classList.add('counter');\n          counter.bckgnd.setAttribute('height', '9');\n\n          var souls_image = document.createElementNS(svgNS, 'image');\n          souls_image.classList.add('model-image');\n          souls_image.setAttribute('x', '0');\n          souls_image.setAttribute('y', '0');\n          souls_image.setAttribute('width', '20');\n          souls_image.setAttribute('height', '20');\n          souls_image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '/data/icons/Soul.png');\n          parent.appendChild(souls_image);\n          \n          var souls_label = labelElementService.create(svgNS, parent);\n\n          return [ counter, souls_image, souls_label ];\n        },\n        cleanup: function(under_models_container,\n                          over_models_container,\n                          element) {\n          over_models_container.removeChild(element[0].label);\n        },\n        update: function clickGameModelCounterUpdate(map_flipped, zoom_factor,\n                                                     info, model, img, el) {\n          var counter = el[0];\n          var counter_text = modelService.isCounterDisplayed('c', model) ?\n              model.state.c : '';\n          var counter_center = computeCounterCenter(model);\n          labelElementService.update(map_flipped,\n                                     zoom_factor,\n                                     counter_center.flip,\n                                     counter_center.text,\n                                     modelService.isWreckDisplayed(model) ? '' : counter_text,\n                                     counter);\n\n          var souls_text = ( !modelService.isWreckDisplayed(model) &&\n                             modelService.isCounterDisplayed('s', model)  ?\n                             model.state.s+'' : ''\n                           );\n          var visibility = R.length(souls_text) > 0 ? 'visible' : 'hidden';\n          var souls_center = computeSoulsCenter(img, info, model);\n\n          var souls_image = el[1];\n          souls_image.setAttribute('x', (souls_center.text.x-10)+'');\n          souls_image.setAttribute('y', (souls_center.text.y-10)+'');\n          souls_image.style.visibility = visibility;\n\n          var souls_label = el[2];\n          labelElementService.update(map_flipped,\n                                     zoom_factor,\n                                     souls_center.flip,\n                                     souls_center.text,\n                                     souls_text,\n                                     souls_label);\n        },\n      };\n    }\n  ]);\n"]}