{"version":3,"sources":["../../../es6/directives/gameModel/charge.js"],"names":[],"mappings":"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","file":"charge.js","sourcesContent":["angular.module('clickApp.directives')\n  .factory('clickGameModelCharge', [\n    'labelElement',\n    'model',\n    'point',\n    'gameFactions',\n    'gameModels',\n    'gameModelSelection',\n    function(labelElementService,\n             modelService,\n             pointService,\n             gameFactionsService,\n             gameModelsService,\n             gameModelSelectionService) {\n      return {\n        create: function clickGameModelChargeCreate(svgNS,\n                                                    under_models_container,\n                                                    over_models_container) {\n          let charge_path = document.createElementNS(svgNS, 'rect');\n          charge_path.style.visibility = 'hidden';\n          charge_path.classList.add('model-charge-path');\n          under_models_container.appendChild(charge_path);\n\n          let charge_target = document.createElementNS(svgNS, 'circle');\n          charge_target.style.visibility = 'hidden';\n          charge_target.classList.add('model-charge-target');\n          over_models_container.appendChild(charge_target);\n\n          let charge_label = labelElementService.create(svgNS, over_models_container);\n\n          return [ charge_path, charge_target, charge_label ];\n        },\n        cleanup: function clickGameModelCharge(under_models_container,\n                                               over_models_container,\n                                               element) {\n          let [ charge_path, charge_target, charge_label ] = element;\n\n          over_models_container.removeChild(charge_label.label);\n          over_models_container.removeChild(charge_target);\n          under_models_container.removeChild(charge_path);\n        },\n        update: function clickGameModelChargeUpdate(map_flipped, zoom_factor,\n                                                    state, info, model, img, element) {\n          let [ charge_path, charge_target, charge_label ] = element;\n\n          if(!modelService.isCharging(model)  &&\n             !modelService.isPlacing(model)) {\n            charge_path.style.visibility = 'hidden';\n            charge_target.style.visibility = 'hidden';\n            labelElementService.update(map_flipped,\n                                       zoom_factor,\n                                       model.state,\n                                       model.state,\n                                       '',\n                                       charge_label);\n            return;\n          }\n          let max_dist;\n          if(modelService.isCharging(model)) {\n            let charge_length = pointService.distanceTo(model.state, model.state.cha.s);\n            let charge_dir = model.state.cha.s.r;\n            let charge_middle = pointService.translateInDirection(400,\n                                                                  charge_dir,\n                                                                  model.state.cha.s);\n            charge_path.setAttribute('width', (info.base_radius*2)+'');\n            charge_path.setAttribute('height', '800');\n            charge_path.setAttribute('x', (charge_middle.x-info.base_radius)+'');\n            charge_path.setAttribute('y', (charge_middle.y-400)+'');\n            charge_path.setAttribute('transform', [\n              'rotate(',\n              charge_dir,\n              ',',\n              charge_middle.x,\n              ',',\n              charge_middle.y,\n              ')'\n            ].join(''));\n            charge_path.style.visibility = 'visible';\n\n            let label = (Math.round(charge_length*10)/100)+'\"';\n            max_dist = modelService.chargeMaxLength(model);\n            if(R.exists(max_dist)) {\n              label += '/'+max_dist+'\"';\n            }\n            labelElementService.update(map_flipped,\n                                       zoom_factor,\n                                       model.state.cha.s,\n                                       model.state.cha.s,\n                                       label,\n                                       charge_label);\n\n            if(gameModelSelectionService\n               .in('local', model.state.stamp, state.game.model_selection) &&\n               R.exists(model.state.cha.t)) {\n              R.pipeP(\n                gameModelsService.findStamp$(model.state.cha.t),\n                (target) => {\n                  charge_target.setAttribute('cx', (target.state.x)+'');\n                  charge_target.setAttribute('cy', (target.state.y)+'');\n\n                  let melee_range = 0;\n                  if(modelService.isMeleeDisplayed('mm', model)) {\n                    melee_range = 5;\n                  }\n                  if(modelService.isMeleeDisplayed('mr', model)) {\n                    melee_range = 20;\n                  }\n                  if(modelService.isMeleeDisplayed('ms', model)) {\n                    melee_range = 40;\n                  }\n                  let distance_to_target = pointService.distanceTo(target.state, model.state);\n                  return R.pipeP(\n                    gameFactionsService.getModelInfo$(target.state.info),\n                    (target_info) => {\n                      charge_target.setAttribute('r', (target_info.base_radius)+'');\n\n                      if(distance_to_target <= melee_range + info.base_radius + target_info.base_radius) {\n                        charge_target.classList.add('reached');\n                      }\n                      else {\n                        charge_target.classList.remove('reached');\n                      }\n                      charge_target.style.visibility = 'visible';\n                    }\n                  )(state.factions);\n                }\n              )(state.game.models);\n            }\n          }\n          if(modelService.isPlacing(model)) {\n            let place_length = pointService.distanceTo(model.state, model.state.pla.s);\n            let place_dir = model.state.pla.s.r;\n            let place_middle = pointService.translateInDirection(400,\n                                                                 place_dir,\n                                                                 model.state.pla.s);\n            charge_path.setAttribute('width', (info.base_radius*2)+'');\n            charge_path.setAttribute('height', '800');\n            charge_path.setAttribute('x', (place_middle.x-info.base_radius)+'');\n            charge_path.setAttribute('y', (place_middle.y-400)+'');\n            charge_path.setAttribute('transform', [\n              'rotate(',\n              place_dir,\n              ',',\n              place_middle.x,\n              ',',\n              place_middle.y,\n              ')'\n            ].join(''));\n            charge_path.style.visibility = 'visible';\n\n            let place_label = (Math.round(place_length*10)/100)+'\"';\n            let within = modelService.placeWithin(model);\n            max_dist = modelService.placeMaxLength(model);\n            if(R.exists(max_dist)) {\n              place_label += '/'+(within ? 'w.' : '')+max_dist+'\"';\n            }\n            labelElementService.update(map_flipped,\n                                       zoom_factor,\n                                       model.state.pla.s,\n                                       model.state.pla.s,\n                                       place_label,\n                                       charge_label);\n\n          }\n          charge_target.style.visibility = 'hidden';\n        }\n      };\n    }\n  ]);\n"]}