{"version":3,"sources":["../../es6/directives/gameCreateModel.js"],"names":[],"mappings":";;AAAA,OAAO,CAAC,MAAM,CAAC,qBAAqB,CAAC,CAClC,SAAS,CAAC,sBAAsB,EAAE,CACjC,cAAc,EACd,SAAS,EACT,UAAS,mBAAmB,EACnB,cAAc,EAAE;AACvB,SAAO;AACL,YAAQ,EAAE,GAAG;AACb,QAAI,EAAE,cAAS,KAAK,EAAE,MAAM,EAAE;AAC5B,UAAI,GAAG,GAAG,QAAQ,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;AACzC,UAAI,KAAK,GAAG,GAAG,CAAC,YAAY,CAAC;;AAE7B,aAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;AAC7C,UAAI,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;AACxB,UAAI,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;;AAE1D,OAAC,CAAC,KAAK,CACL,mBAAmB,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI,CAAC,EAC7C,UAAC,IAAI,EAAK;AACR,YAAI,OAAO,GAAG,kBAAkB,CAAC,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;AACnE,YAAI,UAAU,GAAG,cAAc,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;AAC/C,wBAAgB,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,UAAU,EAAE,KAAK,EAAE,OAAO,CAAC,CAAC;;AAEtE,aAAK,CAAC,kBAAkB,CAAC,oBAAoB,EAAE,YAAM;AACnD,cAAG,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,QAAQ,EAAC,OAAO,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,OAAO;;AAEtD,oBAAU,GAAG,cAAc,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;AAC3C,0BAAgB,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,UAAU,EAAE,KAAK,EAAE,OAAO,CAAC,CAAC;SACvE,EAAE,KAAK,CAAC,CAAC;OACX,CACF,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;KACnB;GACF,CAAC;AACF,WAAS,kBAAkB,CAAC,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,MAAM,EAAE;AACzD,QAAI,OAAO,GAAG,QAAQ,CAAC,eAAe,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;AACxD,WAAO,CAAC,SAAS,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;AACtC,WAAO,CAAC,YAAY,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;AAClC,WAAO,CAAC,YAAY,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;AAClC,WAAO,CAAC,YAAY,CAAC,GAAG,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;AAC5C,UAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;AAC5B,WAAO,OAAO,CAAC;GAChB;AACD,WAAS,gBAAgB,CAAC,IAAI,EAAE,UAAU,EAAE,KAAK,EAAE,OAAO,EAAE;AAC1D,QAAI,KAAK,GAAG,UAAU,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;AAChC,WAAO,CAAC,YAAY,CAAC,IAAI,EAAE,AAAC,IAAI,CAAC,CAAC,GAAG,KAAK,GAAG,KAAK,CAAC,CAAC,GAAE,EAAE,CAAC,CAAC;AAC1D,WAAO,CAAC,YAAY,CAAC,IAAI,EAAE,AAAC,IAAI,CAAC,CAAC,GAAG,KAAK,GAAG,KAAK,CAAC,CAAC,GAAE,EAAE,CAAC,CAAC;GAC3D;CACF,CACF,CAAC,CAAC","file":"gameCreateModel.js","sourcesContent":["angular.module('clickApp.directives')\n  .directive('clickGameCreateModel', [\n    'gameFactions',\n    'gameMap',\n    function(gameFactionsService,\n             gameMapService) {\n      return {\n        restrict: 'A',\n        link: function(scope, parent) {\n          var map = document.getElementById('map');\n          var svgNS = map.namespaceURI;\n\n          console.log('clickCreateModel', scope.index);\n          let state = scope.state;\n          let model = R.nth(scope.index, state.create.model.models);\n\n          R.pipeP(\n            gameFactionsService.getModelInfo$(model.info),\n            (info) => {\n              let element = createModelElement(info, document, svgNS, parent[0]);\n              let is_flipped = gameMapService.isFlipped(map);\n              setModelPosition(state.create.model.base, is_flipped, model, element);\n\n              scope.onStateChangeEvent('Game.create.update', () => {\n                if(R.isNil(R.path(['create','model'], state))) return;\n\n                is_flipped = gameMapService.isFlipped(map);\n                setModelPosition(state.create.model.base, is_flipped, model, element);\n              }, scope);\n            }\n          )(state.factions);\n        }\n      };\n      function createModelElement(info, document, svgNS, parent) {\n        var element = document.createElementNS(svgNS, 'circle');\n        element.classList.add('create-model');\n        element.setAttribute('cx', '240');\n        element.setAttribute('cy', '240');\n        element.setAttribute('r', info.base_radius);\n        parent.appendChild(element);\n        return element;\n      }\n      function setModelPosition(base, is_flipped, model, element) {\n        var coeff = is_flipped ? -1 : 1;\n        element.setAttribute('cx', (base.x + coeff * model.x)+'');\n        element.setAttribute('cy', (base.y + coeff * model.y)+'');\n      }\n    }\n  ]);\n"]}