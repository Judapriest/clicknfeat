{"version":3,"sources":["../../../es6/directives/gameTemplate/wall.js"],"names":[],"mappings":"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","file":"wall.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.directives')\n  .factory('wallTemplateElement', [\n    '$window',\n    'template',\n    'gameTemplateSelection',\n    'gameMap',\n    'labelElement',\n    function($window,\n             templateService,\n             gameTemplateSelectionService,\n             gameMapService,\n             labelElementService) {\n      var wallTemplateElementService = {\n        create: function wallTemplateElementServiceCreate(svgNS, parent, template) {\n          var group = document.createElementNS(svgNS, 'g');\n          parent.appendChild(group);\n\n          var rect = document.createElementNS(svgNS, 'rect');\n          rect.classList.add('template');\n          rect.classList.add('wall');\n          rect.setAttribute('width', '40');\n          rect.setAttribute('height', '7.5');\n          rect.setAttribute('data-stamp', template.state.stamp);\n          group.appendChild(rect);\n\n          var label = labelElementService.create(svgNS, group);\n\n          return { container: group,\n                   wall: rect,\n                   label: label,\n                 };\n        },\n        update: function wallTemplateElementUpdate(map, scope, template, wall) {\n          var selection = scope.game.template_selection;\n          var local =\n              gameTemplateSelectionService.in('local', template.state.stamp,\n                                              selection);\n          var remote =\n              gameTemplateSelectionService.in('remote', template.state.stamp,\n                                              selection);\n          var selected = (local || remote);\n\n          var map_flipped = gameMapService.isFlipped(map);\n          var zoom_factor = gameMapService.zoomFactor(map);\n          var label_flip_center = template.state;\n          var label_text_center = { x: template.state.x,\n                                    y: template.state.y+2\n                                  };\n          var label_text = templateService.fullLabel(template);\n          $window.requestAnimationFrame(function _wallTemplateElementUpdate() {\n            updateWall(template, wall.wall);\n            updateContainer(selected, local, remote, template, wall.container);\n            labelElementService.update(map_flipped,\n                                       zoom_factor,\n                                       label_flip_center,\n                                       label_text_center,\n                                       label_text,\n                                       wall.label);\n            $window.requestAnimationFrame(function _aoeTemplateElementUpdate2() {\n              if(gameTemplateSelectionService.inSingle('local', template.state.stamp,\n                                                       scope.game.template_selection)) {\n                scope.gameEvent('changeSingleAoESelection', null);\n              }\n            });\n          });\n        },\n      };\n      function updateWall(template, wall) {\n        wall.setAttribute('x', (template.state.x-20)+'');\n        wall.setAttribute('y', (template.state.y-3.75)+'');\n      }\n      function updateContainer(selected, local, remote, template, container) {\n        if(selected) container.classList.add('selection');\n        else container.classList.remove('selection');\n        if(local) container.classList.add('local');\n        else container.classList.remove('local');\n        if(remote) container.classList.add('remote');\n        else container.classList.remove('remote');\n            \n        container.setAttribute('transform', ('rotate('+\n                                             template.state.r+','+\n                                             template.state.x+','+\n                                             template.state.y+\n                                             ')'\n                                            ));\n      }\n      return wallTemplateElementService;\n    }\n  ]);\n"]}