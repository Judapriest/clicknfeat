{"version":3,"sources":["../../../es6/directives/gameTemplate/aoe.js"],"names":[],"mappings":"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","file":"aoe.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.directives')\n  .factory('aoeTemplateElement', [\n    '$window',\n    'template',\n    'gameTemplateSelection',\n    'gameMap',\n    'labelElement',\n    function($window,\n             templateService,\n             gameTemplateSelectionService,\n             gameMapService,\n             labelElementService) {\n      var aoeTemplateElementService = {\n        create: function aoeTemplateElementServiceCreate(svgNS, parent, aoe) {\n          var circle = document.createElementNS(svgNS, 'circle');\n          circle.classList.add('template');\n          circle.classList.add('aoe');\n          circle.setAttribute('data-stamp', aoe.state.stamp);\n          parent.appendChild(circle);\n\n          var line = document.createElementNS(svgNS, 'line');\n          line.classList.add('template-aoe-direction');\n          line.style['marker-end'] = 'url(#aoe-direction-end)';\n          parent.appendChild(line);\n\n          var label = labelElementService.create(svgNS, parent);\n          \n          return { aoe: circle,\n                   dir: line,\n                   label: label,\n                 };\n        },\n        update: function aoeTemplateElementUpdate(map, scope, template, aoe) {\n          var selection = scope.game.template_selection;\n          var local =\n              gameTemplateSelectionService.in('local', template.state.stamp,\n                                              selection);\n          var remote =\n              gameTemplateSelectionService.in('remote', template.state.stamp,\n                                              selection);\n          var selected = (local || remote);\n\n          var map_flipped = gameMapService.isFlipped(map);\n          var zoom_factor = gameMapService.zoomFactor(map);\n          var label_flip_center = template.state;\n          var label_text_center = { x: template.state.x,\n                                    y: template.state.y + template.state.s + 5\n                                  };\n          var label_text = templateService.fullLabel(template);\n          $window.requestAnimationFrame(function _aoeTemplateElementUpdate() {\n            if(selected) aoe.container.classList.add('selection');\n            else aoe.container.classList.remove('selection');\n            if(local) aoe.container.classList.add('local');\n            else aoe.container.classList.remove('local');\n            if(remote) aoe.container.classList.add('remote');\n            else aoe.container.classList.remove('remote');\n            \n            updateAoe(template, aoe.aoe);\n            updateDir(template, aoe.dir);\n            labelElementService.update(map_flipped,\n                                       zoom_factor,\n                                       label_flip_center,\n                                       label_text_center,\n                                       label_text,\n                                       aoe.label);\n          });\n        },\n      };\n      function updateAoe(template, aoe) {\n        aoe.setAttribute('cx', template.state.x+'');\n        aoe.setAttribute('cy', template.state.y+'');\n        aoe.setAttribute('r', template.state.s+'');\n      }\n      function updateDir(template, dir) {\n        dir.setAttribute('x1', template.state.x+'');\n        dir.setAttribute('y1', template.state.y+'');\n        dir.setAttribute('x2', template.state.x+'');\n        dir.setAttribute('y2', (template.state.y-template.state.s)+'');\n        dir.setAttribute('transform', ('rotate('+\n                                       template.state.r+','+\n                                       template.state.x+','+\n                                       template.state.y+\n                                       ')'\n                                      ));\n      }\n      return aoeTemplateElementService;\n    }\n  ]);\n"]}