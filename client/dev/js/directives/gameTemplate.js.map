{"version":3,"sources":["../../es6/directives/gameTemplate.js"],"names":[],"mappings":";;AAAA,OAAO,CAAC,MAAM,CAAC,qBAAqB,CAAC,CAClC,SAAS,CAAC,mBAAmB,EAAE,CAC9B,cAAc,EACd,oBAAoB,EACpB,sBAAsB,EACtB,qBAAqB,EACrB,eAAe,EACf,UAAS,mBAAmB,EACnB,yBAAyB,EACzB,2BAA2B,EAC3B,0BAA0B,EAC1B,oBAAoB,EAAE;AAC7B,MAAI,SAAS,GAAG;AACd,OAAG,EAAE,yBAAyB;AAC9B,SAAK,EAAE,2BAA2B;AAClC,QAAI,EAAE,0BAA0B;GACjC,CAAC;AACF,SAAO;AACL,YAAQ,EAAE,GAAG;AACb,QAAI,EAAE,cAAS,KAAK,EAAE,MAAM,EAAE;AAC5B,UAAI,GAAG,GAAG,QAAQ,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;AACzC,UAAI,KAAK,GAAG,GAAG,CAAC,YAAY,CAAC;;AAE7B,UAAI,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC;AAC9B,aAAO,CAAC,GAAG,CAAC,cAAc,EAAE,QAAQ,CAAC,CAAC;AACtC,UAAG,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,EAAE,OAAO;;AAE7B,UAAI,OAAO,GAAG,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;AAChF,aAAO,CAAC,SAAS,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;;AAE9B,WAAK,CAAC,kBAAkB,CAAC,kBAAkB,EAAE,YAAM;AACjD,2BAAmB,CAChB,eAAe,CAAC,GAAG,EAAE,QAAQ,CAAC,KAAK,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC;OACxD,EAAE,KAAK,CAAC,CAAC;AACV,eAAS,cAAc,GAAG;AACxB,SAAC,CAAC,WAAW,CACX,YAAM;AACJ,iBAAO,oBAAoB,CACxB,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;SAChE,EACD,UAAC,QAAQ,EAAK;AACZ,mBAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,KAAK,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAC;SAC5E,CACF,EAAE,CAAC;OACL;AACD,oBAAc,EAAE,CAAC;AACjB,WAAK,CAAC,kBAAkB,2BAAyB,QAAQ,CAAC,KAAK,CAAC,KAAK,EAC5C,cAAc,EAAE,KAAK,CAAC,CAAC;KACjD;GACF,CAAC;CACH,CACF,CAAC,CACD,SAAS,CAAC,wBAAwB,EAAE,CACnC,YAAW;AACT,SAAO;AACL,YAAQ,EAAE,GAAG;AACb,eAAW,EAAE,mCAAmC;AAChD,SAAK,EAAE,IAAI;AACX,QAAI,EAAE,cAAS,KAAK,EAAE,OAAO,EAAE;AAC7B,WAAK,CAAC,IAAI,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,2BAA2B,CAAC,CAAC;AAClE,WAAK,CAAC,wBAAwB,CAAC,sBAAsB,EAAE,KAAK,CAAC,CAAC;AAC9D,aAAO,CAAC,GAAG,CAAC,wBAAwB,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;KACnD;GACF,CAAC;CACH,CACF,CAAC,CAAC","file":"gameTemplate.js","sourcesContent":["angular.module('clickApp.directives')\n  .directive('clickGameTemplate', [\n    'labelElement',\n    'aoeTemplateElement',\n    'sprayTemplateElement',\n    'wallTemplateElement',\n    'gameTemplates',\n    function(labelElementService,\n             aoeTemplateElementService,\n             sprayTemplateElementService,\n             wallTemplateElementService,\n             gameTemplatesService) {\n      var templates = {\n        aoe: aoeTemplateElementService,\n        spray: sprayTemplateElementService,\n        wall: wallTemplateElementService\n      };\n      return {\n        restrict: 'A',\n        link: function(scope, parent) {\n          var map = document.getElementById('map');\n          var svgNS = map.namespaceURI;\n\n          var template = scope.template;\n          console.log('gameTemplate', template);\n          if(R.isNil(template)) return;\n\n          var element = templates[template.state.type].create(svgNS, parent[0], template);\n          element.container = parent[0];\n\n          scope.onStateChangeEvent('Game.map.flipped', () => {\n            labelElementService\n              .updateOnFlipMap(map, template.state, element.label);\n          }, scope);\n          function updateTemplate() {\n            R.pipePromise(\n              () => {\n                return gameTemplatesService\n                  .findStamp(template.state.stamp, scope.state.game.templates);\n              },\n              (template) => {\n                templates[template.state.type].update(map, scope.state, template, element);\n              }\n            )();\n          }\n          updateTemplate();\n          scope.onStateChangeEvent(`Game.template.change.${template.state.stamp}`,\n                                   updateTemplate, scope);\n        }\n      };\n    }\n  ])\n  .directive('clickGameTemplatesList', [\n    function() {\n      return {\n        restrict: 'A',\n        templateUrl: 'partials/game/templates_list.html',\n        scope: true,\n        link: function(scope, element) {\n          scope.type = element[0].getAttribute('click-game-templates-list');\n          scope.digestOnStateChangeEvent('Game.template.create', scope);\n          console.log('clickGameTemplatesList', scope.type);\n        }\n      };\n    }\n  ]);\n"]}