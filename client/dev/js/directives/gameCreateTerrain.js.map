{"version":3,"sources":["../../es6/directives/gameCreateTerrain.js"],"names":[],"mappings":"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","file":"gameCreateTerrain.js","sourcesContent":["angular.module('clickApp.directives')\n  .directive('clickGameCreateTerrain', [\n    'gameTerrainInfo',\n    'gameMap',\n    function(gameTerrainInfoService,\n             gameMapService) {\n      return {\n        restrict: 'A',\n        link: function(scope, parent) {\n          var map = document.getElementById('map');\n          var svgNS = map.namespaceURI;\n\n          console.log('clickCreateTerrain', scope.index);\n          let state = scope.state;\n          let terrain = R.nth(scope.index, state.create.terrain.terrains);\n\n          R.pipeP(\n            gameTerrainInfoService.getInfo$(terrain.info),\n            (info) => {\n              var element = createTerrainElement(info, document, svgNS, parent[0]);\n              var is_flipped = gameMapService.isFlipped(map);\n              setTerrainPosition(info, state.create.terrain.base, is_flipped, terrain, element);\n\n              scope.onStateChangeEvent('Game.create.update', () => {\n                if(R.isNil(R.path(['create','terrain'], state))) return;\n\n                is_flipped = gameMapService.isFlipped(map);\n                setTerrainPosition(info, state.create.terrain.base, is_flipped, terrain, element);\n              }, scope);\n            }\n          )(state.terrains);\n        }\n      };\n      function createTerrainElement(info, document, svgNS, parent) {\n        var element = document.createElementNS(svgNS, 'rect');\n        element.classList.add('create-terrain');\n        element.setAttribute('x', '240');\n        element.setAttribute('y', '240');\n        element.setAttribute('width', info.img.width);\n        element.setAttribute('height', info.img.height);\n        parent.appendChild(element);\n        return element;\n      }\n      function setTerrainPosition(info, base, is_flipped, terrain, element) {\n        var coeff = is_flipped ? -1 : 1;\n        element.setAttribute('x', (base.x + coeff * terrain.x - info.img.width / 2)+'');\n        element.setAttribute('y', (base.y + coeff * terrain.y - info.img.height / 2)+'');\n      }\n    }\n  ]);\n"]}