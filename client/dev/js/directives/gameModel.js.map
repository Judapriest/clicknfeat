{"version":3,"sources":["../../es6/directives/gameModel.js"],"names":[],"mappings":"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","file":"gameModel.js","sourcesContent":["angular.module('clickApp.directives')\n  .directive('clickGameModel', [\n    'gameMap',\n    'gameFactions',\n    'gameModels',\n    'gameModelSelection',\n    'gameScenario',\n    'model',\n    'labelElement',\n    'clickGameModelArea',\n    'clickGameModelAura',\n    'clickGameModelBase',\n    'clickGameModelCharge',\n    'clickGameModelCounter',\n    'clickGameModelDamage',\n    'clickGameModelIcon',\n    'clickGameModelLoS',\n    'clickGameModelMelee',\n    function(\n      gameMapService,\n      gameFactionsService,\n      gameModelsService,\n      gameModelSelectionService,\n      gameScenarioService,\n      modelService,\n      labelElementService,\n      clickGameModelAreaService,\n      clickGameModelAuraService,\n      clickGameModelBaseService,\n      clickGameModelChargeService,\n      clickGameModelCounterService,\n      clickGameModelDamageService,\n      clickGameModelIconService,\n      clickGameModelLoSService,\n      clickGameModelMeleeService\n    ) {\n      let clickGameModeDirective = {\n        restrict: 'A',\n        link: function(scope, parent) {\n          let state = scope.state;\n          gameFactionsService\n            .getModelInfo(scope.model.state.info, state.factions)\n            .catch((reason) => {\n              console.error('clickGameModel', reason);\n              return self.Promise.reject(reason);\n            })\n            .then((info) => {\n              console.log('gameModel', scope.model, info);\n\n              return buildModelElement(state, info, scope.model, parent[0], scope);\n            });\n        }\n      };\n      function buildModelElement(state, info, model, container, scope) {\n        let element = createModelElement(info, model, container);\n\n        scope.$on('$destroy', gameModelOnDestroy(element));\n        scope.onStateChangeEvent('Game.map.flipped',\n                                 gameModelOnMapFlipped(info, scope, element),\n                                 scope);\n        let updateModel = gameModelOnUpdate(state, info, scope, element);\n        scope.onStateChangeEvent(`Game.model.change.${model.state.stamp}`,\n                                 updateModel, scope);\n        updateModel();\n\n        scope.onStateChangeEvent('Game.model.selection.local.updateSingle',\n                                 onUpdateSingleModelSelection(state.factions, model, element),\n                                 scope);\n\n        scope.onStateChangeEvent('Game.template.selection.local.updateSingle',\n                                 onUpdateSingleTemplateSelection(state.factions, model, element),\n                                 scope);\n\n        let onUpdateScenarioAura = withModel(scope, (model) => {\n          updateScenarioAura(state, info, model, scope, element);\n        });\n        scope.onStateChangeEvent('Game.scenario.refresh',\n                                 onUpdateScenarioAura, scope);\n        scope.onStateChangeEvent('Game.scenario.change',\n                                 onUpdateScenarioAura, scope);\n      }\n      function createModelElement(info, model, parent) {\n        let map = document.getElementById('map');\n        let under_models_container = document.getElementById('game-under-models');\n        let over_models_container = document.getElementById('game-over-models');\n        let svgNS = map.namespaceURI;\n\n        let aura = clickGameModelAuraService.create(svgNS, parent);\n        let melee = clickGameModelMeleeService.create(svgNS, parent);\n        let base = clickGameModelBaseService.create(svgNS, info, model, parent);\n        let damage = clickGameModelDamageService.create(svgNS, info, parent);\n        let los = clickGameModelLoSService.create(svgNS, info, parent);\n        let label = labelElementService.create(svgNS, over_models_container);\n        let counter = clickGameModelCounterService.create(svgNS, over_models_container, parent);\n        let unit = labelElementService.create(svgNS, parent);\n        let icon = clickGameModelIconService.create(svgNS, parent);\n        let area = clickGameModelAreaService.create(svgNS, parent);\n        let charge = clickGameModelChargeService.create(svgNS,\n                                                        under_models_container,\n                                                        over_models_container,\n                                                        parent);\n\n        return { container: parent,\n                 aura: aura,\n                 base: base,\n                 damage: damage,\n                 los: los,\n                 label: label,\n                 counter: counter,\n                 unit: unit,\n                 icon: icon,\n                 area: area,\n                 melee: melee,\n                 charge: charge\n               };\n      }\n      function gameModelOnDestroy(element) {\n        return () => {\n          console.log('gameModelOnDestroy');\n\n          let under_models_container = document.getElementById('game-under-models');\n          let over_models_container = document.getElementById('game-over-models');\n          over_models_container.removeChild(element.label.label);\n          clickGameModelCounterService.cleanup(under_models_container,\n                                               over_models_container,\n                                               element.counter);\n          clickGameModelChargeService.cleanup(under_models_container,\n                                              over_models_container,\n                                              element.charge);\n        };\n      }\n      function withModel(scope, fn) {\n        return () => {\n          R.pipeP(\n            () => {\n              return gameModelsService\n                .findStamp(scope.model.state.stamp, scope.state.game.models);\n            },\n            fn\n          )();\n        };\n      }\n      function gameModelOnMapFlipped(info, scope, element) {\n        return withModel(scope, (model) => {\n          let map = document.getElementById('map');\n\n          let label_center = computeLabelCenter(info, model);\n          labelElementService.updateOnFlipMap(map,\n                                              label_center.flip,\n                                              element.label);\n          labelElementService.updateOnFlipMap(map,\n                                              model.state,\n                                              element.counter[0]);\n          if(modelService.isCharging(model) ||\n             modelService.isPlacing(model)) {\n            labelElementService.updateOnFlipMap(map,\n                                                model.state.cha.s,\n                                                element.charge[2]);\n          }\n        });\n      }\n      function onUpdateSingleModelSelection(factions, model, element) {\n        return (event, sel_stamp, sel_model) => {\n          // console.log('onUpdateSingleModelSelection',\n          //             sel_stamp, model.state.stamp);\n          if(R.isNil(sel_model) ||\n             sel_stamp === model.state.stamp) {\n            element.container.classList.remove('overlap');\n            element.container.classList.remove('b2b');\n            return;\n          }\n          R.pipeP(\n            modelService.distanceTo$(factions, sel_model),\n            (dist) => {\n              if(dist < -0.1) {\n                element.container.classList.add('overlap');\n                element.container.classList.remove('b2b');\n                return;\n              }\n              else if(dist < 0.1) {\n                element.container.classList.remove('overlap');\n                element.container.classList.add('b2b');\n                return;\n              }\n              else {\n                element.container.classList.remove('overlap');\n                element.container.classList.remove('b2b');\n              }\n            }\n          )(model);\n        };\n      }\n      function onUpdateSingleTemplateSelection(factions, model, element) {\n        return (event, sel_stamp, sel_temp) => {\n          // console.log('onUpdateSingleAoTemplateSelection',\n          //             sel_stamp, model.state.stamp);\n          if(R.isNil(sel_temp)) {\n            element.container.classList.remove('under-aoe');\n            return;\n          }\n          R.pipeP(\n            modelService.distanceToAoE$(factions, sel_temp),\n            (dist) => {\n              if(dist <= 0) {\n                element.container.classList.add('under-aoe');\n              }\n              else {\n                element.container.classList.remove('under-aoe');\n              }\n            }\n          )(model);\n        };\n      }\n      function gameModelOnUpdate(state, info,\n                                 scope, element) {\n        return withModel(scope, (model) => {\n          let map = document.getElementById('map');\n          let map_flipped = gameMapService.isFlipped(map);\n          let zoom_factor = gameMapService.zoomFactor(map);\n\n          let is_wreck = modelService.isWreckDisplayed(model);\n          (is_wreck ?\n           modelService.getWreckImage(state.factions, model) :\n           modelService.getImage(state.factions, model))\n            .then((img) => {\n              let label_text = modelService.fullLabel(model);\n              let label_center = computeLabelCenter(info, model);\n\n              updateModelPosition(img, model, element);\n              updateModelSelection(state.game.model_selection,\n                                   model, element);\n              updateScenarioAura(state, info, model, scope, element);\n              clickGameModelAuraService.update(info, model, img, element.aura);\n              clickGameModelBaseService.update(info, model, img, element.base);\n              clickGameModelDamageService.update(info, model, img, element.damage);\n              labelElementService.update(map_flipped,\n                                         zoom_factor,\n                                         label_center.flip,\n                                         label_center.text,\n                                         label_text,\n                                         element.label);\n              clickGameModelCounterService.update(map_flipped, zoom_factor,\n                                                  info, model, img, element.counter);\n              updateUnit(map_flipped, zoom_factor,\n                         img, info, model, element);\n              clickGameModelIconService.update(info, model, img, element.icon);\n              clickGameModelAreaService.update(state.factions, info, model, img, element.area);\n              clickGameModelMeleeService.update(info, model, img, element.melee);\n              clickGameModelChargeService.update(map_flipped, zoom_factor,\n                                                 state, info, model, img, element.charge);\n            });\n        });\n      }\n      function updateModelPosition(img, model, element) {\n        element.container.setAttribute('transform', [\n          'translate(',\n          model.state.x-img.width/2,\n          ',',\n          model.state.y-img.height/2,\n          ') rotate(',\n          model.state.r,\n          ',',\n          img.width/2,\n          ',',\n          img.height/2,\n          ')'\n        ].join(''));\n      }\n      function updateModelSelection(selection, model, element) {\n        let container = element.container;\n        let stamp = model.state.stamp;\n        if(gameModelSelectionService.in('local', stamp, selection)) {\n          container.classList.add('local-selection');\n        }\n        else {\n          container.classList.remove('local-selection');\n        }\n        if(gameModelSelectionService.in('remote', stamp, selection)) {\n          container.classList.add('remote-selection');\n        }\n        else {\n          container.classList.remove('remote-selection');\n        }\n        if(gameModelSelectionService.inSingle('local', stamp, selection)) {\n          container.classList.add('single-local');\n          container.classList.remove('single-remote');\n        }\n        else if(gameModelSelectionService.inSingle('remote', stamp, selection)) {\n          container.classList.remove('single-local');\n          container.classList.add('single-remote');\n        }\n        else {\n          container.classList.remove('single-local');\n          container.classList.remove('single-remote');\n        }\n      }\n      function updateScenarioAura(state, info, model, scope, element) {\n        let circle = R.pipe(\n          R.pick(['x','y']),\n          R.assoc('radius', info.base_radius)\n        )(model.state);\n\n        if(scope.stateIs('game.setup') &&\n           R.exists(state.game.scenario) &&\n           gameScenarioService.isContesting(circle, state.game.scenario)) {\n          element.container.classList.add('contesting');\n        }\n        else {\n          element.container.classList.remove('contesting');\n        }\n        if(scope.stateIs('game.setup') &&\n           R.exists(state.game.scenario) &&\n           'wardude' === info.type &&\n           gameScenarioService.isKillboxing(circle, state.game.scenario)) {\n          element.container.classList.add('killboxing');\n        }\n        else {\n          element.container.classList.remove('killboxing');\n        }\n      }\n      function updateUnit(map_flipped, zoom_factor, img, info, model, element) {\n        let unit = modelService.unit(model);\n        unit = R.exists(unit) ? unit : '';\n\n        let unit_text = modelService.isUnitDisplayed(model) ? unit+'' : '';\n        unit_text = R.length(unit_text) > 0 ? 'U'+unit_text : unit_text;\n\n        let unit_center = computeUnitCenter(img, info, model);\n        labelElementService.update(map_flipped,\n                                   zoom_factor,\n                                   unit_center.flip,\n                                   unit_center.text,\n                                   unit_text,\n                                   element.unit);\n      }\n      function computeLabelCenter(info, model) {\n        let label_text_center_y_down = model.state.y + info.base_radius + 6;\n        let label_text_center_y_up = model.state.y - info.base_radius - 2;\n        let orientation = ((model.state.r % 360) + 360) % 360;\n        let model_looking_down =  orientation > 90 && orientation < 270;\n        let label_text_center = { x: model.state.x,\n                                  y: model_looking_down ?\n                                  label_text_center_y_down : label_text_center_y_up\n                                };\n        let label_flip_center = { x: label_text_center.x,\n                                  y: label_text_center.y - 2\n                                };\n        return { text: label_text_center,\n                 flip: label_flip_center\n               };\n      }\n      function computeUnitCenter(img, info) {\n        let counter_flip_center = { x: img.width/2, y: img.height/2 };\n        let counter_text_center = { x: counter_flip_center.x - info.base_radius*0.7 - 5,\n                                    y: counter_flip_center.y - info.base_radius*0.7 - 5 };\n        return { text: counter_text_center,\n                 flip: counter_flip_center\n               };\n      }\n      return clickGameModeDirective;\n    }\n  ])\n  .directive('clickGameModelsList', [\n    function() {\n      return {\n        restrict: 'A',\n        templateUrl: 'partials/game/models_list.html',\n        scope: true,\n        link: function(scope, element) {\n          scope.type = element[0].getAttribute('click-game-models-list');\n          scope.digestOnStateChangeEvent('Game.model.create', scope);\n          console.log('clickGameModelsList', scope.type);\n        }\n      };\n    }\n  ]);\n"]}