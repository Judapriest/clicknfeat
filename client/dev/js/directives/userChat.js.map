{"version":3,"sources":["../../es6/directives/userChat.js"],"names":[],"mappings":"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","file":"userChat.js","sourcesContent":["angular.module('clickApp.directives')\n  .controller('userChatCtrl', [\n    '$scope',\n    function userChatCtrl($scope) {\n      console.log('userChatCtrl', $scope.user);\n\n      let state = $scope.state;\n\n      $scope.chat = {\n        msg: '',\n        to: []\n      };\n      function setChatTo(to) {\n        $scope.chat.to = R.reject(R.equals(state.user.state.stamp), to);\n      }\n      $scope.userIsInTo = (stamp) => {\n        return R.find(R.equals(stamp), $scope.chat.to);\n      };\n      $scope.doToggleUserTo = (stamp) => {\n        if($scope.userIsInTo(stamp)) {\n          setChatTo(R.reject(R.equals(stamp), $scope.chat.to));\n        }\n        else {\n          setChatTo(R.append(stamp, $scope.chat.to));\n        }\n      };\n      $scope.doSetAllUsersTo = () => {\n        setChatTo(R.pluck('stamp', state.user.connection.users));\n      };\n      $scope.doSetToChat = (chat) => {\n        setChatTo(R.pipe(\n          R.prop('to'),\n          R.append(R.prop('from', chat)),\n          R.uniq\n        )(chat));\n      };\n\n      function chatMsgIsValid() {\n        return R.length(s.strip($scope.chat.msg)) > 0;\n      }\n      $scope.canSendChatMsg = () => {\n        return ( !R.isEmpty($scope.chat.to) &&\n                 chatMsgIsValid()\n               );\n      };\n      $scope.doSendChatMessage = () => {\n        if(!$scope.canSendChatMsg()) return null;\n\n        return R.pipePromise(\n          () => {\n            return $scope.stateEvent('User.sendChatMsg', $scope.chat);\n          },\n          () => {\n            $scope.chat.msg = '';\n            $scope.$digest();\n          }\n        )($scope.user);\n      };\n      $scope.doSendChatMessageToAll = function() {\n        setChatTo(R.pluck('stamp', state.user.connection.users));\n        $scope.doSendChatMessage();\n      };\n    }\n  ])\n  .directive('clickUserConnection', [\n    function() {\n      return {\n        restrict: 'E',\n        controller: 'userChatCtrl',\n        templateUrl: 'partials/directives/user_chat.html',\n        scope: true,\n        link: () => { }\n      };\n    }\n  ]);\n"]}