{"version":3,"sources":["../../es6/directives/gameEditDamage.js"],"names":[],"mappings":"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","file":"gameEditDamage.js","sourcesContent":["angular.module('clickApp.controllers')\n  .controller('clickGameEditDamageCtrl', [\n    '$scope',\n    function() {\n      console.log('init clickGameEditDamageCtrl');\n    }\n  ]);\n\nangular.module('clickApp.directives')\n  .directive('clickGameEditDamage', [\n    '$window',\n    'game',\n    'gameFactions',\n    'gameMap',\n    function($window,\n             gameService,\n             gameFactionsService,\n             gameMapService) {\n      return {\n        restrict: 'A',\n        template: [ '<click-game-model-damage info=\"info.damage\"',\n                    '  state=\"selection.state\"',\n                    '  on-error=\"gameEvent(\\'modeActionError\\', reason)\">',\n                    '</click-game-model-damage>',\n                  ].join(''),\n        scope: true,\n        controller: 'clickGameEditDamageCtrl',\n        link: function(scope, element) {\n          console.log('gameEditDamage');\n          let viewport = document.getElementById('viewport');\n          let map = document.getElementById('map');\n          let state = scope.state;\n\n          let opened = false;\n          function toggleEditDamage(event, selection) {\n            console.log('toggleEditDamage');\n            if(opened) {\n              closeEditDamage();\n            }\n            else {\n              openEditDamage(event, selection);\n            }\n          }\n\n          closeEditDamage();\n          function closeEditDamage() {\n            // console.log('closeEditDamage');\n\n            opened = false;\n            scope.selection = {};\n\n            element[0].style.display = 'none';\n            element[0].style.visibility = 'hidden';\n            element[0].style.left = 0+'px';\n            element[0].style.top = 0+'px';\n          }\n          function openEditDamage($event, selection) {\n            // console.log('openEditDamage');\n\n            opened = true;\n            scope.selection = selection;\n            gameFactionsService.getModelInfo(scope.selection.state.info,\n                                             state.factions)\n              .then((info) => {\n                scope.info = info;\n                scope.$digest();\n              });\n\n            $window.requestAnimationFrame(displayEditDamage);\n          }\n          function displayEditDamage() {\n            element[0].style.display = 'initial';\n            element[0].style.visibility = 'hidden';\n\n            $window.requestAnimationFrame(showEditDamage);\n          }\n          function showEditDamage() {\n            placeEditDamage();\n            element[0].style.visibility = 'visible';\n          }\n          function placeEditDamage() {\n            let detail_rect = element[0].getBoundingClientRect();\n            let screen_pos = gameMapService.mapToScreenCoordinates(map, scope.selection.state);\n            let viewport_rect = viewport.getBoundingClientRect();\n\n            let max_top = viewport_rect.height - detail_rect.height;\n            let max_left = viewport_rect.width - detail_rect.width;\n\n            let top = Math.max(0, Math.min(max_top, screen_pos.y - detail_rect.height / 2));\n            let left = Math.max(0, Math.min(max_left, screen_pos.x - detail_rect.width / 2));\n\n            element[0].style.top = top + 'px';\n            element[0].style.left = left + 'px';\n          }\n\n          scope.onStateChangeEvent('Game.editDamage.toggle', toggleEditDamage, scope);\n          scope.onStateChangeEvent('Game.editDamage.open', openEditDamage, scope);\n          scope.onStateChangeEvent('Game.editDamage.close', closeEditDamage, scope);\n          scope.doClose = closeEditDamage;\n        }\n      };\n    }\n  ]);\n"]}