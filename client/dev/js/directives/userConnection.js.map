{"version":3,"sources":["../../es6/directives/userConnection.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,OAAO,CAAC,MAAM,CAAC,qBAAqB,CAAC,CAClC,UAAU,CAAC,oBAAoB,EAAE,CAChC,QAAQ,EACR,QAAQ,EACR,gBAAgB,EAChB,SAAS,kBAAkB,CAAC,MAAM,EACN,aAAa,EACb,qBAAqB,EAAE;AACjD,SAAO,CAAC,GAAG,CAAC,oBAAoB,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;;AAE/C,QAAM,CAAC,IAAI,GAAG;AACZ,OAAG,EAAE,EAAE;AACP,MAAE,EAAE,EAAE;GACP,CAAC;AACF,QAAM,CAAC,UAAU,GAAG,UAAS,KAAK,EAAE;AAClC,WAAO,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;GAChD,CAAC;AACF,QAAM,CAAC,cAAc,GAAG,UAAS,KAAK,EAAE;AACtC,QAAG,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,EAAE;AAC3B,YAAM,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;KAC5D,MACI;AACH,YAAM,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;KAClD;AACD,UAAM,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EACjC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;GAC3C,CAAC;AACF,QAAM,CAAC,eAAe,GAAG,qBAAoB;AAC3C,UAAM,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,IAAI,CACrB,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,EAChB,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAC5C,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;GACjC,CAAC;AACF,QAAM,CAAC,WAAW,GAAG,UAAS,IAAI,EAAE;AAClC,UAAM,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,IAAI,CACrB,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,EACZ,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,EAC9B,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAC3C,CAAC,CAAC,IAAI,CACP,CAAC,IAAI,CAAC,CAAC;GACT,CAAC;;AAEF,QAAM,CAAC,cAAc,GAAG,YAAW;AACjC,WAAS,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,IAC1B,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CACtC;GACV,CAAC;AACF,QAAM,CAAC,iBAAiB,GAAG,YAAW;AACpC,QAAG,CAAC,MAAM,CAAC,cAAc,EAAE,EAAE,OAAO;;AAEpC,WAAO,qBAAqB,CACzB,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE,MAAM,CAAC,IAAI,CAAC,GAAG,EAC/B,MAAM,CAAC,IAAI,CAAC,CACrB,IAAI,CAAC,YAAW;AACf,YAAM,CAAC,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC;AACrB,YAAM,CAAC,OAAO,EAAE,CAAC;KAClB,CAAC,CAAC;GACN,CAAC;AACF,QAAM,CAAC,sBAAsB,GAAG,YAAW;AACzC,QAAG,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO;;AAEnD,QAAI,EAAE,GAAG,CAAC,CAAC,IAAI,CACb,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,EAChB,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAC5C,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;;AAEhC,WAAO,qBAAqB,CACzB,QAAQ,CAAC,EAAE,EAAE,MAAM,CAAC,IAAI,CAAC,GAAG,EACnB,MAAM,CAAC,IAAI,CAAC,CACrB,IAAI,CAAC,YAAW;AACf,YAAM,CAAC,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC;AACrB,YAAM,CAAC,OAAO,EAAE,CAAC;KAClB,CAAC,CAAC;GACN,CAAC;CACH,CACF,CAAC,CACD,SAAS,CAAC,qBAAqB,EAAE,CAChC,YAAW;AACT,SAAO;AACL,YAAQ,EAAE,GAAG;AACb,cAAU,EAAE,oBAAoB;AAChC,eAAW,EAAE,0CAA0C;AACvD,SAAK,EAAE,IAAI;AACX,QAAI,EAAE,qCAAoC,EACzC;GACF,CAAC;CACH,CACF,CAAC,CAAC","file":"userConnection.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.directives')\n  .controller('userConnectionCtrl', [\n    '$scope',\n    'pubSub',\n    'userConnection',\n    function userConnectionCtrl($scope,\n                                pubSubService,\n                                userConnectionService) {\n      console.log('userConnectionCtrl', $scope.user);\n\n      $scope.chat = {\n        msg: '',\n        to: [],\n      };\n      $scope.userIsInTo = function(stamp) {\n        return R.find(R.equals(stamp), $scope.chat.to);\n      };\n      $scope.doToggleUserTo = function(stamp) {\n        if($scope.userIsInTo(stamp)) {\n          $scope.chat.to = R.reject(R.equals(stamp), $scope.chat.to);\n        }\n        else {\n          $scope.chat.to = R.append(stamp, $scope.chat.to);\n        }\n        $scope.chat.to = R.reject(R.equals($scope.user.state.stamp),\n                                  $scope.chat.to);\n      };\n      $scope.doSetAllUsersTo = function(/*stamp*/) {\n        $scope.chat.to = R.pipe(\n          R.pluck('stamp'),\n          R.reject(R.equals($scope.user.state.stamp))\n        )($scope.user.connection.users);\n      };\n      $scope.doSetToChat = function(chat) {\n        $scope.chat.to = R.pipe(\n          R.prop('to'),\n          R.append(R.prop('from', chat)),\n          R.reject(R.equals($scope.user.state.stamp)),\n          R.uniq\n        )(chat);\n      };\n      \n      $scope.canSendChatMsg = function() {\n        return ( !R.isEmpty($scope.chat.to) &&\n                 R.length(s.strip($scope.chat.msg)) > 0\n               );\n      };\n      $scope.doSendChatMessage = function() {\n        if(!$scope.canSendChatMsg()) return;\n        \n        return userConnectionService\n          .sendChat($scope.chat.to, $scope.chat.msg,\n                    $scope.user)\n          .then(function() {\n            $scope.chat.msg = '';\n            $scope.$digest();\n          });\n      };\n      $scope.doSendChatMessageToAll = function() {\n        if(R.length(s.strip($scope.chat.msg)) <= 0) return;\n\n        var to = R.pipe(\n          R.pluck('stamp'),\n          R.reject(R.equals($scope.user.state.stamp))\n        )($scope.user.connection.users);\n        \n        return userConnectionService\n          .sendChat(to, $scope.chat.msg,\n                    $scope.user)\n          .then(function() {\n            $scope.chat.msg = '';\n            $scope.$digest();\n          });\n      };\n    }\n  ])\n  .directive('clickUserConnection', [\n    function() {\n      return {\n        restrict: 'E',\n        controller: 'userConnectionCtrl',\n        templateUrl: 'partials/directives/user_connection.html',\n        scope: true,\n        link: function(/*scope, element, attrs*/) {\n        }\n      };\n    }\n  ]);\n"]}