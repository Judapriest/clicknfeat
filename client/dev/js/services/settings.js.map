{"version":3,"sources":["../../es6/services/settings.js"],"names":[],"mappings":"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","file":"settings.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('settings', [\n    'localStorage',\n    function settingsServiceFactory(localStorageService) {\n      var SETTINGS_STORAGE_KEY = 'clickApp.settings';\n      var DEFAULT_SETTINGS = {};\n      var UPDATERS = {};\n      var settingsService = {\n        register: function settingsRegister(type, name, settings, updater) {\n          DEFAULT_SETTINGS[type] = R.defaultTo({}, DEFAULT_SETTINGS[type]);\n          UPDATERS[type] = R.defaultTo({}, UPDATERS[type]);\n          console.log('Settings: register', type, name, settings);\n          // Object.freeze(settings);\n          \n          DEFAULT_SETTINGS[type][name] = settings;\n          UPDATERS[type][name] = updater;\n        },\n        load: function settingsLoad() {\n          return R.pipeP(\n            () => {\n              return localStorageService.load(SETTINGS_STORAGE_KEY)\n                .catch(function(/* error */) {\n                  console.log('settings: failed to load data');\n                });\n            },\n            R.defaultTo({}),\n            R.spyWarn('Settings load')\n          )();\n        },\n        init: function settingsInit() {\n          return R.pipeP(\n            settingsService.load,\n            settingsService.bind,\n            settingsService.update\n          )(null);\n        },\n        bind: function settingsBind(settings) {\n          settings = R.defaultTo({}, settings);\n          return R.pipe(\n            R.keys,\n            R.reduce(function(mem, type) {\n              var settings_type = R.propOr({}, type, settings);\n              mem[type] = R.pipe(\n                R.keys,\n                R.reduce(function(mem, name) {\n                  var base = Object.create(DEFAULT_SETTINGS[type][name]);\n                  R.extend(base, R.propOr({}, name, settings_type));\n                  mem[name] = base;\n                  return mem;\n                }, {})\n              )(DEFAULT_SETTINGS[type]);\n              return mem;\n            }, {}),\n            function(binded) {\n              return {\n                default: DEFAULT_SETTINGS,\n                current: binded\n              };\n            }\n          )(DEFAULT_SETTINGS);\n        },\n        update: function settingsUpdate(settings) {\n          R.pipe(\n            R.keys,\n            R.forEach(function(type) {\n              R.pipe(\n                R.keys,\n                R.filter(function(name) {\n                  return R.exists(UPDATERS[type][name]);\n                }),\n                R.forEach(function(name) {\n                  UPDATERS[type][name](settings.current[type][name]);\n                })\n              )(settings.current[type]);\n            })\n          )(settings.current);\n          return settings;\n        },\n        store: function settingsStore(settings) {\n          return R.pipePromise(\n            R.spyWarn('Settings store'),\n            localStorageService.save$(SETTINGS_STORAGE_KEY)\n          )(settings.current);\n        }\n      };\n      return settingsService;\n    }\n  ]);\n"]}