{"version":3,"sources":["../../../es6/services/command/deleteTemplates.js"],"names":[],"mappings":"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","file":"deleteTemplates.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('deleteTemplatesCommand', [\n    'commands',\n    'template',\n    'gameTemplates',\n    'gameTemplateSelection',\n    function deleteTemplatesCommandServiceFactory(commandsService,\n                                                  templateService,\n                                                  gameTemplatesService,\n                                                  gameTemplateSelectionService) {\n      var deleteTemplatesCommandService = {\n        execute: function deleteTemplatesExecute(stamps, state, game) {\n          return R.pipeP(\n            gameTemplatesService.findAnyStamps$(stamps),\n            R.reject(R.isNil),\n            R.map(templateService.saveState),\n            (states) => {\n              var ctxt = {\n                templates: states,\n                desc: ''\n              };\n\n              return R.pipe(\n                gameTemplatesService.removeStamps$(stamps),\n                (game_templates) => {\n                  game = R.assoc('templates', game_templates, game);\n                  \n                  return gameTemplateSelectionService\n                    .removeFrom('local', stamps, state, game.template_selection);\n                },\n                gameTemplateSelectionService\n                  .removeFrom$('remote', stamps, state),\n                (selection) => {\n                  game = R.assoc('template_selection', selection, game);\n\n                  state.changeEvent('Game.template.create');\n\n                  return [ctxt, game];\n                }\n              )(game.templates);\n            }\n          )(game.templates);\n        },\n        replay: function deleteTemplatesReplay(ctxt, state, game) {\n          return R.pipe(\n            R.pluck('stamp'),\n            (stamps) => {\n              return R.pipe(\n                gameTemplatesService.removeStamps$(stamps),\n                (game_templates) => {\n                  game = R.assoc('templates', game_templates, game);\n                  \n                  return gameTemplateSelectionService\n                    .removeFrom('local', stamps, state, game.template_selection);\n                },\n                gameTemplateSelectionService\n                  .removeFrom$('remote', stamps, state),\n                (selection) => {\n                  game = R.assoc('template_selection', selection, game);\n                  \n                  state.changeEvent('Game.template.create');\n\n                  return game;\n                }\n              )(game.templates);\n            }\n          )(ctxt.templates);\n        },\n        undo: function deleteTemplatesUndo(ctxt, state, game) {\n          return R.pipePromise(\n            R.map(templateService.create),\n            R.promiseAll,\n            R.reject(R.isNil),\n            (templates) => {\n              if(R.isEmpty(templates)) {\n                return self.Promise.reject('No valid template definition');\n              }\n\n              return R.pipe(\n                gameTemplatesService.add$(templates),\n                (game_templates) => {\n                  game = R.assoc('templates', game_templates, game);\n          \n                  return gameTemplateSelectionService\n                    .set('remote', R.map(R.path(['state','stamp']), templates),\n                         state, game.template_selection);\n                },\n                (selection) => {\n                  game = R.assoc('template_selection', selection, game);\n\n                  state.changeEvent('Game.template.create');\n\n                  return game;\n                }\n              )(game.templates);\n            }\n          )(ctxt.templates);\n        }\n      };\n      commandsService.registerCommand('deleteTemplates', deleteTemplatesCommandService);\n      return deleteTemplatesCommandService;\n    }\n  ]);\n"]}