{"version":3,"sources":["../../../es6/services/command/onTemplates.js"],"names":[],"mappings":"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","file":"onTemplates.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('onTemplatesCommand', [\n    'commands',\n    'template',\n    'gameTemplates',\n    'gameTemplateSelection',\n    function onTemplatesCommandServiceFactory(commandsService,\n                                              templateService,\n                                              gameTemplatesService,\n                                              gameTemplateSelectionService) {\n      var onTemplatesCommandService = {\n        execute: function onTemplatesExecute(method, ...args /*, stamps, scope, game */) {\n          var game = R.last(args);\n          var scope = R.nth(-2, args);\n          var stamps = R.nth(-3, args);\n          var ctxt = {\n            before: [],\n            after: [],\n            desc: method,\n          };\n\n          args = R.pipe(\n            R.slice(0, -2),\n            R.append(game.templates),\n            R.prepend(method)\n          )(args);\n\n          return R.pipeP(\n            () => {\n              return gameTemplatesService.onStamps('saveState', stamps, game.templates);\n            },\n            (before) => {\n              ctxt.before = before;\n\n              return gameTemplatesService.onStamps.apply(null, args);\n            },\n            () => {\n              return gameTemplatesService.onStamps('saveState', stamps, game.templates);\n            },\n            (after) => {\n              ctxt.after = after;\n\n              R.forEach((stamp) => {\n                scope.gameEvent('changeTemplate-'+stamp);\n              }, stamps);\n              \n              return ctxt;\n            }\n          )();\n        },\n        replay: function onTemplatesRedo(ctxt, scope, game) {\n          return R.pipe(\n            R.map(R.prop('stamp')),\n            (stamps) => {\n              return R.pipeP(\n                gameTemplatesService.findAnyStamps$(stamps),\n                R.addIndex(R.forEach)((template, index) => {\n                  if(R.isNil(template)) return;\n                  \n                  templateService.setState(ctxt.after[index], template);\n                  scope.gameEvent('changeTemplate-'+templateService.eventName(template));\n                }),\n                () => {\n                  game.template_selection =\n                    gameTemplateSelectionService.set('remote', stamps,\n                                                     scope, game.template_selection);\n                }\n              )(game.templates);\n            }\n          )(ctxt.after);\n        },\n        undo: function onTemplatesUndo(ctxt, scope, game) {\n          return R.pipe(\n            R.map(R.prop('stamp')),\n            (stamps) => {\n              return R.pipeP(\n                gameTemplatesService.findAnyStamps$(stamps),\n                R.addIndex(R.forEach)((template, index) => {\n                  templateService.setState(ctxt.before[index],template);\n                  scope.gameEvent('changeTemplate-'+templateService.eventName(template));\n                }),\n                () => {\n                  game.template_selection =\n                    gameTemplateSelectionService.set('remote', stamps,\n                                                     scope, game.template_selection);\n                }\n              )(game.templates);\n            }\n          )(ctxt.before);\n        }\n      };\n      commandsService.registerCommand('onTemplates', onTemplatesCommandService);\n      return onTemplatesCommandService;\n    }\n  ]);\n"]}