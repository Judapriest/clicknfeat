{"version":3,"sources":["../../../es6/services/command/onTemplates.js"],"names":[],"mappings":"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","file":"onTemplates.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('onTemplatesCommand', [\n    'commands',\n    'template',\n    'gameTemplates',\n    'gameTemplateSelection',\n    function onTemplatesCommandServiceFactory(commandsService,\n                                              templateService,\n                                              gameTemplatesService,\n                                              gameTemplateSelectionService) {\n      var onTemplatesCommandService = {\n        execute: function onTemplatesExecute(method, args, stamps, state, game) {\n          var ctxt = {\n            before: [],\n            after: [],\n            desc: method\n          };\n\n          return R.pipePromise(\n            gameTemplatesService.fromStamps$('saveState', [], stamps),\n            (before) => {\n              ctxt.before = before;\n\n              return gameTemplatesService\n                .onStamps(method, args, stamps, game.templates);\n            },\n            (templates) => {\n              game = R.assoc('templates', templates, game);\n              \n              return gameTemplatesService\n                .fromStamps('saveState', [], stamps, game.templates);\n            },\n            (after) => {\n              ctxt.after = after;\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.template.change.${stamp}`);\n              }, stamps);\n              \n              return [ctxt, game];\n            }\n          )(game.templates);\n        },\n        replay: function onTemplatesRedo(ctxt, state, game) {\n          let stamps = R.pluck('stamp', ctxt.after);\n          return R.pipePromise(\n            gameTemplatesService.setStateStamps$(ctxt.after, stamps),\n            (templates) => {\n              game = R.assoc('templates', templates, game);\n              \n              return gameTemplateSelectionService\n                .set('remote', stamps, state, game.template_selection);\n            },\n            (selection) => {\n              game = R.assoc('template_selection', selection, game);\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.template.change.${stamp}`);\n              }, stamps);\n              \n              return game;\n            }\n          )(game.templates);\n        },\n        undo: function onTemplatesUndo(ctxt, state, game) {\n          let stamps = R.pluck('stamp', ctxt.before);\n          return R.pipePromise(\n            gameTemplatesService.setStateStamps$(ctxt.before, stamps),\n            (templates) => {\n              game = R.assoc('templates', templates, game);\n              \n              return gameTemplateSelectionService\n                .set('remote', stamps, state, game.template_selection);\n            },\n            (selection) => {\n              game = R.assoc('template_selection', selection, game);\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.template.change.${stamp}`);\n              }, stamps);\n              \n              return game;\n            }\n          )(game.templates);\n        }\n      };\n      commandsService.registerCommand('onTemplates', onTemplatesCommandService);\n      return onTemplatesCommandService;\n    }\n  ]);\n"]}