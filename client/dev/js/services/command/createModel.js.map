{"version":3,"sources":["../../../es6/services/command/createModel.js"],"names":[],"mappings":";;AAAA,OAAO,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAChC,OAAO,CAAC,oBAAoB,EAAE,CAC7B,UAAU,EACV,OAAO,EACP,OAAO,EACP,YAAY,EACZ,oBAAoB,EACpB,SAAS,gCAAgC,CAAC,eAAe,EACf,YAAY,EACZ,YAAY,EACZ,iBAAiB,EACjB,yBAAyB,EAAE;AACnE,MAAI,yBAAyB,GAAG;AAC9B,WAAO,EAAE,SAAS,kBAAkB,CAAC,MAAM,EAAE,UAAU,EAAE,KAAK,EAAE,IAAI,EAAE;AACpE,UAAI,IAAI,GAAG,YAAY,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC;AACnD,aAAO,CAAC,CAAC,WAAW,CAClB,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,EAChB,CAAC,CAAC,GAAG,CAAC,UAAC,KAAK,EAAK;AACf,eAAO,CAAC,CAAC,IAAI,CACX,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EACjB,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,EACjB,UAAC,KAAK,EAAK;AACT,iBAAO,YAAY,CAChB,MAAM,CAAC,KAAK,CAAC,QAAQ,EAAE,KAAK,CAAC,CAC7B,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;SAC1B,CACF,CAAC,KAAK,CAAC,CAAC;OACV,CAAC,EACF,CAAC,CAAC,UAAU,EACZ,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,EACjB,UAAC,MAAM,EAAK;AACV,YAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;AACpB,iBAAO,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,2BAA2B,CAAC,CAAC;SACzD;;AAED,YAAI,IAAI,GAAG;AACT,gBAAM,EAAE,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,SAAS,EAAE,MAAM,CAAC;AAC7C,cAAI,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC;SACrC,CAAC;AACF,eAAO,CAAC,CAAC,IAAI,CACX,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,EAC9B,UAAC,WAAW,EAAK;AACf,cAAI,GAAG,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC;;AAE5C,iBAAO,yBAAyB,CAAC,GAAG,CAAC,OAAO,EACP,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,EAAC,OAAO,CAAC,CAAC,EAAE,MAAM,CAAC,EACxC,KAAK,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;SACnE,EACD,UAAC,SAAS,EAAK;AACb,cAAI,GAAG,CAAC,CAAC,KAAK,CAAC,iBAAiB,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;;AAEnD,eAAK,CAAC,WAAW,CAAC,mBAAmB,CAAC,CAAC;;AAEvC,iBAAO,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;SACrB,CACF,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;OAChB,CACF,CAAC,MAAM,CAAC,CAAC;KACX;AACD,UAAM,EAAE,SAAS,iBAAiB,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE;AACpD,aAAO,CAAC,CAAC,WAAW,CAClB,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,EAChB,CAAC,CAAC,GAAG,CAAC,UAAC,KAAK,EAAK;AACf,eAAO,YAAY,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ,EAAE,KAAK,CAAC,CAC9C,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;OAC1B,CAAC,EACF,CAAC,CAAC,UAAU,EACZ,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,EACjB,UAAC,MAAM,EAAK;AACV,YAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;AACpB,iBAAO,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,2BAA2B,CAAC,CAAC;SACzD;;AAED,eAAO,CAAC,CAAC,IAAI,CACX,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,EAC9B,UAAC,WAAW,EAAK;AACf,cAAI,GAAG,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC;;AAE5C,iBAAO,yBAAyB,CAAC,GAAG,CAAC,QAAQ,EACR,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,EAAC,OAAO,CAAC,CAAC,EAAE,MAAM,CAAC,EACxC,KAAK,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;SACnE,EACD,UAAC,SAAS,EAAK;AACb,cAAI,GAAG,CAAC,CAAC,KAAK,CAAC,iBAAiB,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;;AAEnD,eAAK,CAAC,WAAW,CAAC,mBAAmB,CAAC,CAAC;;AAEvC,iBAAO,IAAI,CAAC;SACb,CACF,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;OAChB,CACF,CAAC,IAAI,CAAC,CAAC;KACT;AACD,QAAI,EAAE,SAAS,eAAe,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE;AAChD,UAAI,MAAM,GAAG,CAAC,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;AAC3C,UAAI,GAAG,CAAC,CAAC,IAAI,CACX,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,EACpB,iBAAiB,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,EAC/C,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,iBAAiB,CAAC,EAC7B,yBAAyB,CAAC,WAAW,CAAC,OAAO,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC,EACrE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,iBAAiB,CAAC,EAC7B,yBAAyB,CAAC,WAAW,CAAC,QAAQ,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC,CACvE,CAAC,IAAI,CAAC,CAAC;AACR,OAAC,CAAC,OAAO,CAAC,UAAC,KAAK,EAAK;AAAE,aAAK,CAAC,WAAW,wBAAsB,KAAK,CAAG,CAAC;OAAE,EAAE,MAAM,CAAC,CAAC;AACnF,WAAK,CAAC,WAAW,CAAC,mBAAmB,CAAC,CAAC;AACvC,aAAO,IAAI,CAAC;KACb;GACF,CAAC;AACF,iBAAe,CAAC,eAAe,CAAC,aAAa,EAAE,yBAAyB,CAAC,CAAC;AAC1E,SAAO,yBAAyB,CAAC;CAClC,CACF,CAAC,CAAC","file":"createModel.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('createModelCommand', [\n    'commands',\n    'point',\n    'model',\n    'gameModels',\n    'gameModelSelection',\n    function createModelCommandServiceFactory(commandsService,\n                                              pointService,\n                                              modelService,\n                                              gameModelsService,\n                                              gameModelSelectionService) {\n      var createModelCommandService = {\n        execute: function createModelExecute(create, is_flipped, state, game) {\n          var add$ = pointService.addToWithFlip$(is_flipped);\n          return R.pipePromise(\n            R.prop('models'),\n            R.map((model) => {\n              return R.pipe(\n                add$(create.base),\n                R.omit(['stamp']),\n                (model) => {\n                  return modelService\n                    .create(state.factions, model)\n                    .catch(R.always(null));\n                }\n              )(model);\n            }),\n            R.promiseAll,\n            R.reject(R.isNil),\n            (models) => {\n              if(R.isEmpty(models)) {\n                return self.Promise.reject('No valid model definition');\n              }\n            \n              var ctxt = {\n                models: R.map(modelService.saveState, models),\n                desc: models[0].state.info.join('.')\n              };\n              return R.pipe(\n                gameModelsService.add$(models),\n                (game_models) => {\n                  game = R.assoc('models', game_models, game);\n              \n                  return gameModelSelectionService.set('local',\n                                                       R.map(R.path(['state','stamp']), models),\n                                                       state, game.model_selection);\n                },\n                (selection) => {\n                  game = R.assoc('model_selection', selection, game);\n\n                  state.changeEvent('Game.model.create');\n                  \n                  return [ctxt, game];\n                }\n              )(game.models);\n            }\n          )(create);\n        },\n        replay: function createModelReplay(ctxt, state, game) {\n          return R.pipePromise(\n            R.prop('models'),\n            R.map((model) => {\n              return modelService.create(state.factions, model)\n                .catch(R.always(null));\n            }),\n            R.promiseAll,\n            R.reject(R.isNil),\n            (models) => {\n              if(R.isEmpty(models)) {\n                return self.Promise.reject('No valid model definition');\n              }\n              \n              return R.pipe(\n                gameModelsService.add$(models),\n                (game_models) => {\n                  game = R.assoc('models', game_models, game);\n                  \n                  return gameModelSelectionService.set('remote',\n                                                       R.map(R.path(['state','stamp']), models),\n                                                       state, game.model_selection);\n                },\n                (selection) => {\n                  game = R.assoc('model_selection', selection, game);\n                  \n                  state.changeEvent('Game.model.create');\n\n                  return game;\n                }\n              )(game.models);\n            }\n          )(ctxt);\n        },\n        undo: function createModelUndo(ctxt, state, game) {\n          var stamps = R.pluck('stamp', ctxt.models);\n          game = R.pipe(\n            R.over(R.lensProp('models'),\n                   gameModelsService.removeStamps$(stamps)),\n            R.over(R.lensProp('model_selection'),\n                   gameModelSelectionService.removeFrom$('local', stamps, state)),\n            R.over(R.lensProp('model_selection'),\n                   gameModelSelectionService.removeFrom$('remote', stamps, state))\n          )(game);\n          R.forEach((stamp) => { state.changeEvent(`Game.model.delete.${stamp}`); }, stamps);\n          state.changeEvent('Game.model.create');\n          return game;\n        }\n      };\n      commandsService.registerCommand('createModel', createModelCommandService);\n      return createModelCommandService;\n    }\n  ]);\n"]}