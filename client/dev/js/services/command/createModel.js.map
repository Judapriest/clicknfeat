{"version":3,"sources":["../../../es6/services/command/createModel.js"],"names":[],"mappings":"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","file":"createModel.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('createModelCommand', [\n    'commands',\n    'point',\n    'model',\n    'gameModels',\n    'gameModelSelection',\n    function createModelCommandServiceFactory(commandsService,\n                                              pointService,\n                                              modelService,\n                                              gameModelsService,\n                                              gameModelSelectionService) {\n      var createModelCommandService = {\n        execute: function createModelExecute(create, is_flipped, scope, game) {\n          var add$ = pointService.addToWithFlip$(is_flipped);\n          return R.pipePromise(\n            R.prop('models'),\n            R.map((model) => {\n              return R.pipe(\n                add$(create.base),\n                R.omit(['stamp']),\n                (model) => {\n                  return modelService.create(scope.factions, model)\n                    .catch(R.always(null));\n                }\n              )(model);\n            }),\n            R.promiseAll,\n            R.reject(R.isNil),\n            (models) => {\n              if(R.isEmpty(models)) {\n                return self.Promise.reject('No valid model definition');\n              }\n            \n              var ctxt = {\n                models: R.map(modelService.saveState, models),\n                desc: models[0].state.info.join('.'),\n              };\n              return R.pipe(\n                gameModelsService.add$(models),\n                (game_models) => {\n                  game.models = game_models;\n              \n                  return gameModelSelectionService.set('local',\n                                                       R.map(R.path(['state','stamp']), models),\n                                                       scope, game.model_selection);\n                },\n                (selection) => {\n                  game.model_selection = selection;\n\n                  scope.gameEvent('createModel');\n                  return ctxt;\n                }\n              )(game.models);\n            }\n          )(create);\n        },\n        replay: function createModelReplay(ctxt, scope, game) {\n          return R.pipePromise(\n            R.prop('models'),\n            R.map((model) => {\n              return modelService.create(scope.factions, model)\n                .catch(R.always(null));\n            }),\n            R.promiseAll,\n            R.reject(R.isNil),\n            (models) => {\n              if(R.isEmpty(models)) {\n                return self.Promise.reject('No valid model definition');\n              }\n              \n              return R.pipe(\n                gameModelsService.add$(models),\n                (game_models) => {\n                  game.models = game_models;\n                  \n                  return gameModelSelectionService.set('remote',\n                                                       R.map(R.path(['state','stamp']), models),\n                                                       scope, game.model_selection);\n                },\n                (selection) => {\n                  game.model_selection = selection;\n                  \n                  scope.gameEvent('createModel');\n                }\n              )(game.models);\n            }\n          )(ctxt);\n        },\n        undo: function createModelUndo(ctxt, scope, game) {\n          var stamps = R.map(R.prop('stamp'), ctxt.models);\n          game.models = gameModelsService.removeStamps(stamps, game.models);\n          game.model_selection =\n            gameModelSelectionService.removeFrom('local', stamps,\n                                                 scope, game.model_selection);\n          game.model_selection =\n            gameModelSelectionService.removeFrom('remote', stamps,\n                                                 scope, game.model_selection);\n          R.forEach((stamp) => { scope.gameEvent('deleteModel-'+stamp); }, stamps);\n          scope.gameEvent('createModel');\n        }\n      };\n      commandsService.registerCommand('createModel', createModelCommandService);\n      return createModelCommandService;\n    }\n  ]);\n"]}