{"version":3,"sources":["../../../es6/services/command/onTerrains.js"],"names":[],"mappings":"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","file":"onTerrains.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('onTerrainsCommand', [\n    'commands',\n    'terrain',\n    'gameTerrains',\n    'gameTerrainSelection',\n    function onTerrainsCommandServiceFactory(commandsService,\n                                             terrainService,\n                                             gameTerrainsService,\n                                             gameTerrainSelectionService) {\n      var onTerrainsCommandService = {\n        execute: function onTerrainsExecute(method, ...args /*, stamps, scope, game */) {\n          if('Function' !== R.type(terrainService[method])) {\n            return self.Promise.reject('Unknown method '+method+' on terrain');\n          }\n          \n          var game = R.last(args);\n          var scope = R.nth(-2, args);\n          var stamps = R.nth(-3, args);\n          var ctxt = {\n            before: [],\n            after: [],\n            desc: method\n          };\n\n          args = R.pipe(\n            R.slice(0, -2),\n            R.prepend(method),\n            R.append(game.terrains)\n          )(args);\n\n          return R.pipeP(\n            () => {\n              return gameTerrainsService.onStamps$('saveState', stamps, game.terrains);\n            },\n            (before) => {\n              ctxt.before = before;\n              \n              return gameTerrainsService.onStamps.apply(null, args);\n            },\n            () => {\n              return gameTerrainsService.onStamps('saveState', stamps, game.terrains);\n            },\n            (after) => {\n              ctxt.after = after;\n\n              R.forEach((stamp) => {\n                scope.gameEvent('changeTerrain-'+stamp);\n              }, stamps);\n              \n              return ctxt;\n            }\n          )();\n        },\n        replay: function onTerrainsRedo(ctxt, scope, game) {\n          var stamps = R.pluck('stamp', ctxt.after);\n          return R.pipeP(\n            gameTerrainsService.findAnyStamps$(stamps),\n            R.addIndex(R.forEach)((terrain, index) => {\n              if(R.isNil(terrain)) return;\n\n              terrainService.setState(ctxt.after[index], terrain);\n              scope.gameEvent('changeTerrain-'+terrainService.eventName(terrain));\n            }),\n            () => {\n              game.terrain_selection = gameTerrainSelectionService\n                .set('remote', stamps,\n                     scope, game.terrain_selection);\n            }\n          )(game.terrains);\n        },\n        undo: function onTerrainsUndo(ctxt, scope, game) {\n          var stamps = R.pluck('stamp', ctxt.before);\n          return R.pipeP(\n            gameTerrainsService.findAnyStamps$(stamps),\n            R.addIndex(R.forEach)((terrain, index) => {\n              if(R.isNil(terrain)) return;\n\n              terrainService.setState(ctxt.before[index], terrain);\n              scope.gameEvent('changeTerrain-'+terrainService.eventName(terrain));\n            }),\n            () => {\n              game.terrain_selection = gameTerrainSelectionService\n                .set('remote', stamps,\n                     scope, game.terrain_selection);\n            }\n          )(game.terrains);\n        }\n      };\n      commandsService.registerCommand('onTerrains', onTerrainsCommandService);\n      return onTerrainsCommandService;\n    }\n  ]);\n"]}