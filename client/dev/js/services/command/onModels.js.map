{"version":3,"sources":["../../../es6/services/command/onModels.js"],"names":[],"mappings":"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","file":"onModels.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('onModelsCommand', [\n    'commands',\n    'model',\n    'gameModels',\n    'gameModelSelection',\n    function onModelsCommandServiceFactory(commandsService,\n                                           modelService,\n                                           gameModelsService,\n                                           gameModelSelectionService) {\n      var onModelsCommandService = {\n        execute: function onModelsExecute(method, args, stamps, state, game) {\n          if('Function' !== R.type(modelService[method])) {\n            return self.Promise\n              .reject(`Unknown method ${method} on model`);\n          }\n          \n          var ctxt = {\n            before: [],\n            after: [],\n            desc: method\n          };\n\n          return R.pipeP(\n            gameModelsService.fromStamps$('saveState', [], stamps),\n            (before) => {\n              ctxt.before = before;\n              \n              return gameModelsService\n                .onStamps(method, args, stamps, game.models);\n            },\n            (models) => {\n              game = R.assoc('models', models, game);\n              \n              return gameModelsService\n                .fromStamps('saveState', [], stamps, game.models);\n            },\n            (after) => {\n              ctxt.after = after;\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.model.change.${stamp}`);\n              }, stamps);\n              \n              return [ctxt, game];\n            }\n          )(game.models);\n        },\n        replay: function onModelsRedo(ctxt, state, game) {\n          var stamps = R.pluck('stamp', ctxt.after);\n          return R.pipeP(\n            gameModelsService.setStateStamps$(ctxt.after, stamps),\n            (models) => {\n              game = R.assoc('models', models, game);\n\n              return gameModelSelectionService\n                .set('remote', stamps, state, game.model_selection);\n            },\n            (selection) => {\n              game = R.assoc('model_selection', selection, game);\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.model.change.${stamp}`);\n              }, stamps);\n              \n              return game;\n            }\n          )(game.models);\n        },\n        undo: function onModelsUndo(ctxt, state, game) {\n          var stamps = R.pluck('stamp', ctxt.before);\n          return R.pipeP(\n            gameModelsService.setStateStamps$(ctxt.before, stamps),\n            (models) => {\n              game = R.assoc('models', models, game);\n\n              return gameModelSelectionService\n                .set('remote', stamps, state, game.model_selection);\n            },\n            (selection) => {\n              game = R.assoc('model_selection', selection, game);\n\n              R.forEach((stamp) => {\n                state.changeEvent(`Game.model.change.${stamp}`);\n              }, stamps);\n              \n              return game;\n            }\n          )(game.models);\n        }\n      };\n      commandsService.registerCommand('onModels', onModelsCommandService);\n      return onModelsCommandService;\n    }\n  ]);\n"]}