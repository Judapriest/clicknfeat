{"version":3,"sources":["../../../es6/services/command/deleteModel.js"],"names":[],"mappings":"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","file":"deleteModel.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('deleteModelCommand', [\n    'commands',\n    'model',\n    'gameModels',\n    'gameModelSelection',\n    function deleteModelCommandServiceFactory(commandsService,\n                                              modelService,\n                                              gameModelsService,\n                                              gameModelSelectionService) {\n      var deleteModelCommandService = {\n        execute: function deleteModelExecute(stamps, state, game) {\n          return R.pipeP(\n            (stamps) => {\n              return gameModelsService.findAnyStamps(stamps, game.models);\n            },\n            R.reject(R.isNil),\n            R.map(modelService.saveState),\n            (states) => {\n              var ctxt = {\n                models: states,\n                desc: ''\n              };\n              return R.pipe(\n                gameModelsService.removeStamps$(stamps),\n                (game_models) => {\n                  game = R.assoc('models', game_models, game);\n\n                  return gameModelSelectionService\n                    .removeFrom('local', stamps, state, game.model_selection);\n                },\n                gameModelSelectionService.removeFrom$('remote', stamps, state),\n                (selection) => {\n                  game = R.assoc('model_selection', selection, game);\n                  \n                  R.forEach((stamp) => {\n                    state.changeEvent(`Game.model.delete.${stamp}`);\n                  }, stamps);\n                  state.changeEvent('Game.model.create');\n\n                  return [ctxt, game];\n                }\n              )(game.models);\n            }\n          )(stamps);\n        },\n        replay: function deleteModelReplay(ctxt, state, game) {\n          return R.pipe(\n            R.pluck('stamp'),\n            (stamps) => {\n              return R.pipe(\n                () => {\n                  return gameModelsService.removeStamps(stamps, game.models);\n                },\n                (game_models) => {\n                  game = R.assoc('models', game_models, game);\n\n                  return gameModelSelectionService\n                    .removeFrom('local', stamps, state, game.model_selection);\n                },\n                gameModelSelectionService.removeFrom$('remote', stamps, state),\n                (selection) => {\n                  game = R.assoc('model_selection', selection, game);\n                  \n                  R.forEach((stamp) => {\n                    state.changeEvent(`Game.model.delete.${stamp}`);\n                  }, stamps);\n                  state.changeEvent('Game.model.create');\n\n                  return game;\n                }\n              )();\n            }\n          )(ctxt.models);\n        },\n        undo: function deleteModelUndo(ctxt, state, game) {\n          return R.pipePromise(\n            R.map((model) => {\n              return modelService.create(state.factions, model)\n                .catch(R.always(null));\n            }),\n            R.promiseAll,\n            R.reject(R.isNil),\n            (models) => {\n              if(R.isEmpty(models)) {\n                return self.Promise.reject('No valid model definition');\n              }\n              \n              return R.pipe(\n                gameModelsService.add$(models),\n                (game_models) => {\n                  game = R.assoc('models', game_models, game);\n\n                  var stamps = R.map(R.path(['state','stamp']), models);\n                  return gameModelSelectionService\n                    .set('remote', stamps, state, game.model_selection);\n                },\n                (selection) => {\n                  game = R.assoc('model_selection', selection, game);\n                  \n                  state.changeEvent('Game.model.create');\n\n                  return game;\n                }\n              )(game.models);\n            }\n          )(ctxt.models);\n        }\n      };\n      commandsService.registerCommand('deleteModel', deleteModelCommandService);\n      return deleteModelCommandService;\n    }\n  ]);\n"]}