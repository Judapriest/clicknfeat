{"version":3,"sources":["../../../es6/services/command/setLos.js"],"names":[],"mappings":";;;;AAAA,OAAO,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAChC,OAAO,CAAC,eAAe,EAAE,CACxB,UAAU,EACV,SAAS,EACT,SAAS,2BAA2B,CAAC,eAAe,EACf,cAAc,EAAE;AACnD,MAAI,oBAAoB,GAAG;AACzB,WAAO,EAAE,SAAS,aAAa,CAAC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE;AACzD,UAAG,UAAU,KAAK,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC,EAAE;AAChD,eAAO,IAAI,CAAC,OAAO,CAAC,MAAM,yBAAuB,MAAM,CAAG,CAAC;OAC5D;;AAED,UAAI,IAAI,GAAG;AACT,cAAM,EAAE,EAAE;AACV,aAAK,EAAE,EAAE;AACT,YAAI,EAAE,MAAM;OACb,CAAC;;AAEF,aAAO,CAAC,CAAC,WAAW,CAClB,cAAc,CAAC,eAAe,EAC9B,UAAC,MAAM,EAAK;AACV,YAAI,CAAC,MAAM,GAAG,MAAM,CAAC;;AAErB,eAAO,cAAc,CAAC,MAAM,CAAC,CAC1B,KAAK,CAAC,IAAI,+BAAM,IAAI,IAAE,KAAK,EAAE,IAAI,EAAE,IAAI,CAAC,GAAG,GAAE,CAAC;OAClD,EACD,UAAC,GAAG,EAAK;AACP,YAAI,GAAG,CAAC,CAAC,KAAK,CAAC,KAAK,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;;AAEjC,eAAO,cAAc,CAAC,eAAe,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;OACjD,EACD,UAAC,KAAK,EAAK;AACT,YAAI,CAAC,KAAK,GAAG,KAAK,CAAC;;AAEnB,aAAK,CAAC,WAAW,CAAC,wBAAwB,CAAC,CAAC;;AAE5C,eAAO,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;OACrB,CACF,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACb;AACD,UAAM,EAAE,SAAS,UAAU,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE;AAC7C,aAAO,CAAC,CAAC,KAAK,CACZ,cAAc,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,EAAE,IAAI,CAAC,EACpD,UAAC,GAAG,EAAK;AACP,aAAK,CAAC,WAAW,CAAC,wBAAwB,CAAC,CAAC;;AAE5C,eAAO,CAAC,CAAC,KAAK,CAAC,KAAK,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;OAClC,CACF,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACb;AACD,QAAI,EAAE,SAAS,UAAU,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE;AAC3C,aAAO,CAAC,CAAC,KAAK,CACZ,cAAc,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,EACrD,UAAC,GAAG,EAAK;AACP,aAAK,CAAC,WAAW,CAAC,wBAAwB,CAAC,CAAC;;AAE5C,eAAO,CAAC,CAAC,KAAK,CAAC,KAAK,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;OAClC,CACF,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACb;GACF,CAAC;AACF,iBAAe,CAAC,eAAe,CAAC,QAAQ,EAAE,oBAAoB,CAAC,CAAC;AAChE,SAAO,oBAAoB,CAAC;CAC7B,CACF,CAAC,CAAC","file":"setLos.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('setLosCommand', [\n    'commands',\n    'gameLos',\n    function setLosCommandServiceFactory(commandsService,\n                                         gameLosService) {\n      var setLosCommandService = {\n        execute: function setLosExecute(method, args, state, game) {\n          if('Function' !== R.type(gameLosService[method])) {\n            return self.Promise.reject(`Los unknown method ${method}`);\n          }\n\n          var ctxt = {\n            before: [],\n            after: [],\n            desc: method\n          };\n          \n          return R.pipePromise(\n            gameLosService.saveRemoteState,\n            (before) => {\n              ctxt.before = before;\n              \n              return gameLosService[method]\n                .apply(null, [...args, state, game, game.los]);\n            },\n            (los) => {\n              game = R.assoc('los', los, game);\n              \n              return gameLosService.saveRemoteState(game.los);\n            },\n            (after) => {\n              ctxt.after = after;\n\n              state.changeEvent('Game.los.remote.change');\n              \n              return [ctxt, game];\n            }\n          )(game.los);\n        },\n        replay: function setLosRedo(ctxt, state, game) {\n          return R.pipeP(\n            gameLosService.resetRemote$(ctxt.after, state, game),\n            (los) => {\n              state.changeEvent('Game.los.remote.change');\n\n              return R.assoc('los', los, game);\n            }\n          )(game.los);\n        },\n        undo: function setLosUndo(ctxt, state, game) {\n          return R.pipeP(\n            gameLosService.resetRemote$(ctxt.before, state, game),\n            (los) => {\n              state.changeEvent('Game.los.remote.change');\n\n              return R.assoc('los', los, game);\n            }\n          )(game.los);\n        }\n      };\n      commandsService.registerCommand('setLos', setLosCommandService);\n      return setLosCommandService;\n    }\n  ]);\n"]}