{"version":3,"sources":["../../../es6/services/command/createTerrain.js"],"names":[],"mappings":"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","file":"createTerrain.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('createTerrainCommand', [\n    'commands',\n    'point',\n    'terrain',\n    'gameTerrains',\n    'gameTerrainSelection',\n    function createTerrainCommandServiceFactory(commandsService,\n                                                pointService,\n                                                terrainService,\n                                                gameTerrainsService,\n                                                gameTerrainSelectionService) {\n      var createTerrainCommandService = {\n        execute: function createTerrainExecute(create, is_flipped, state, game) {\n          var add$ = pointService.addToWithFlip$(is_flipped);\n          return R.pipePromise(\n            R.prop('terrains'),\n            R.map((terrain) => {\n              return R.pipe(\n                add$(create.base),\n                R.omit(['stamp']),\n                R.spyError('terrain', create, is_flipped),\n                (terrain) => {\n                  return self.Promise\n                    .resolve(terrainService.create(terrain))\n                    .catch(R.always(null));\n                }\n              )(terrain);\n            }),\n            R.promiseAll,\n            R.reject(R.isNil),\n            R.rejectIf(R.isEmpty, 'No valid terrain definition'),\n            R.spyError('terrains'),\n            (terrains) => {\n              var ctxt = {\n                terrains: R.map(terrainService.saveState, terrains),\n                desc: terrains[0].state.info.join('.')\n              };\n              return R.pipe(\n                gameTerrainsService.add$(terrains),\n                (game_terrains) => {\n                  game = R.assoc('terrains', game_terrains, game);\n              \n                  return gameTerrainSelectionService\n                    .set('local', R.map(R.path(['state','stamp']), terrains),\n                         state, game.terrain_selection);\n                },\n                (selection) => {\n                  game = R.assoc('terrain_selection', selection, game);\n\n                  state.changeEvent('Game.terrain.create');\n                  \n                  return [ctxt, game];\n                }\n              )(game.terrains);\n            }\n          )(create);\n        },\n        replay: function createTerrainReplay(ctxt, state, game) {\n          return R.pipePromise(\n            R.prop('terrains'),\n            R.map((terrain) => {\n              return self.Promise\n                .resolve(terrainService.create(terrain))\n                .catch(R.always(null));\n            }),\n            R.promiseAll,\n            R.reject(R.isNil),\n            R.rejectIf(R.isEmpty, 'No valid terrain definition'),\n            (terrains) => {\n              return R.pipe(\n                gameTerrainsService.add$(terrains),\n                (game_terrains) => {\n                  game = R.assoc('terrains', game_terrains, game);\n                  \n                  return gameTerrainSelectionService\n                    .set('remote', R.map(R.path(['state','stamp']), terrains),\n                         state, game.terrain_selection);\n                },\n                (selection) => {\n                  game = R.assoc('terrain_selection', selection, game);\n                  \n                  state.changeEvent('Game.terrain.create');\n\n                  return game;\n                }\n              )(game.terrains);\n            }\n          )(ctxt);\n        },\n        undo: function createTerrainUndo(ctxt, state, game) {\n          var stamps = R.pluck('stamp', ctxt.terrains);\n          game = R.pipe(\n            R.over(R.lensProp('terrains'),\n                   gameTerrainsService.removeStamps$(stamps)),\n            R.over(R.lensProp('terrain_selection'),\n                    gameTerrainSelectionService.removeFrom$('local', stamps, state)),\n            R.over(R.lensProp('terrain_selection'),\n                   gameTerrainSelectionService.removeFrom$('remote', stamps, state))\n          )(game);\n          state.changeEvent('Game.terrain.create');\n          return game;\n        }\n      };\n      commandsService.registerCommand('createTerrain', createTerrainCommandService);\n      return createTerrainCommandService;\n    }\n  ]);\n"]}