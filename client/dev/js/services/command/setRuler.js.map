{"version":3,"sources":["../../../es6/services/command/setRuler.js"],"names":[],"mappings":";;;;AAAA,OAAO,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAChC,OAAO,CAAC,iBAAiB,EAAE,CAC1B,UAAU,EACV,WAAW,EACX,SAAS,6BAA6B,CAAC,eAAe,EACf,gBAAgB,EAAE;AACvD,MAAI,sBAAsB,GAAG;AAC3B,WAAO,EAAE,SAAS,eAAe,CAAC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE;AAC3D,UAAG,UAAU,KAAK,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,EAAE;AAClD,eAAO,IAAI,CAAC,OAAO,CAAC,MAAM,2BAAyB,MAAM,CAAG,CAAC;OAC9D;;AAED,UAAI,IAAI,GAAG;AACT,cAAM,EAAE,EAAE;AACV,aAAK,EAAE,EAAE;AACT,YAAI,EAAE,MAAM;OACb,CAAC;;AAEF,aAAO,CAAC,CAAC,WAAW,CAClB,gBAAgB,CAAC,eAAe,EAChC,UAAC,MAAM,EAAK;AACV,YAAI,CAAC,MAAM,GAAG,MAAM,CAAC;;AAErB,eAAO,gBAAgB,CAAC,MAAM,CAAC,CAC5B,KAAK,CAAC,IAAI,+BAAM,IAAI,IAAE,KAAK,EAAE,IAAI,CAAC,KAAK,GAAE,CAAC;OAC9C,EACD,UAAC,KAAK,EAAK;AACT,YAAI,GAAG,CAAC,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;;AAErC,eAAO,gBAAgB,CAAC,eAAe,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;OACrD,EACD,UAAC,KAAK,EAAK;AACT,YAAI,CAAC,KAAK,GAAG,KAAK,CAAC;;AAEnB,aAAK,CAAC,WAAW,CAAC,0BAA0B,CAAC,CAAC;;AAE9C,eAAO,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;OACrB,CACF,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;KACf;AACD,UAAM,EAAE,SAAS,YAAY,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE;AAC/C,UAAI,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,EACnB,gBAAgB,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,CAAC,EAChD,IAAI,CAAC,CAAC;AACpB,WAAK,CAAC,WAAW,CAAC,0BAA0B,CAAC,CAAC;AAC9C,aAAO,IAAI,CAAC;KACb;AACD,QAAI,EAAE,SAAS,YAAY,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE;AAC7C,UAAI,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,EACnB,gBAAgB,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,EACjD,IAAI,CAAC,CAAC;AACpB,WAAK,CAAC,WAAW,CAAC,0BAA0B,CAAC,CAAC;AAC9C,aAAO,IAAI,CAAC;KACb;GACF,CAAC;AACF,iBAAe,CAAC,eAAe,CAAC,UAAU,EAAE,sBAAsB,CAAC,CAAC;AACpE,SAAO,sBAAsB,CAAC;CAC/B,CACF,CAAC,CAAC","file":"setRuler.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('setRulerCommand', [\n    'commands',\n    'gameRuler',\n    function setRulerCommandServiceFactory(commandsService,\n                                           gameRulerService) {\n      var setRulerCommandService = {\n        execute: function setRulerExecute(method, args, state, game) {\n          if('Function' !== R.type(gameRulerService[method])) {\n            return self.Promise.reject(`Ruler unknown method ${method}`);\n          }\n\n          var ctxt = {\n            before: [],\n            after: [],\n            desc: method\n          };\n\n          return R.pipePromise(\n            gameRulerService.saveRemoteState,\n            (before) => {\n              ctxt.before = before;\n              \n              return gameRulerService[method]\n                .apply(null, [...args, state, game.ruler]);\n            },\n            (ruler) => {\n              game = R.assoc('ruler', ruler, game);\n              \n              return gameRulerService.saveRemoteState(game.ruler);\n            },\n            (after) => {\n              ctxt.after = after;\n\n              state.changeEvent('Game.ruler.remote.change');\n              \n              return [ctxt, game];\n            }\n          )(game.ruler);\n        },\n        replay: function setRulerRedo(ctxt, state, game) {\n          game = R.over(R.lensProp('ruler'),\n                        gameRulerService.resetRemote$(ctxt.after, state),\n                        game);\n          state.changeEvent('Game.ruler.remote.change');\n          return game;\n        },\n        undo: function setRulerUndo(ctxt, state, game) {\n          game = R.over(R.lensProp('ruler'),\n                        gameRulerService.resetRemote$(ctxt.before, state),\n                        game);\n          state.changeEvent('Game.ruler.remote.change');\n          return game;\n        }\n      };\n      commandsService.registerCommand('setRuler', setRulerCommandService);\n      return setRulerCommandService;\n    }\n  ]);\n"]}