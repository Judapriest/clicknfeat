{"version":3,"sources":["../../../es6/services/state/games.js"],"names":[],"mappings":"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","file":"games.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('stateGames', [\n    'game',\n    'games',\n    'fileImport',\n    function stateGamesServiceFactory(gameService,\n                                      gamesService,\n                                      fileImportService) {\n      var stateGamesService = {\n        init: function stateGamesInit(state) {\n          state.local_games = {};\n          state.games_ready = R.pipeP(\n            gamesService.loadLocalGames,\n            setLocalGames$(state)\n          )();\n\n          state.onEvent('Games.local.create',\n                        stateGamesService.onGamesLocalCreate$(state));\n          state.onEvent('Games.local.load',\n                        stateGamesService.onGamesLocalLoad$(state));\n          state.onEvent('Games.local.loadFile',\n                        stateGamesService.onGamesLocalLoadFile$(state));\n          state.onEvent('Games.local.delete',\n                        stateGamesService.onGamesLocalDelete$(state));\n\n          return state;\n        },\n        save: function stateGamesSave(state) {\n          return R.pipePromise(\n            (games) => {\n              let current_game_local_id = parseInt(R.path(['game','local_id'], state));\n              if(R.isNil(current_game_local_id) ||\n                 isNaN(current_game_local_id)) return games;\n              return R.pipe(\n                gamesService.updateLocalGame$(current_game_local_id, state.game),\n                (games) => {\n                  state.local_games = games;\n                  return games;\n                }\n              )(games);\n            },\n            gamesService.storeLocalGames\n          )(state.local_games);\n        },\n        onGamesLocalCreate: function stateOnGamesLocalCreate(state, event) {\n          event = event;\n          return R.pipePromise(\n            () => {\n              return gameService.create(state.user.state);\n            },\n            stateGamesService.loadNewLocalGame$(state)\n          )();\n        },\n        onGamesLocalLoad: function stateOnGamesLocalLoad(state, event, index) {\n          state.changeEvent('Games.local.load', index);\n        },\n        onGamesLocalLoadFile: function stateOnGamesLocalLoadFile(state, event, file) {\n          return R.pipePromise(\n            fileImportService.read$('json'),\n            stateGamesService.loadNewLocalGame$(state)\n          )(file);\n        },\n        onGamesLocalDelete: function stateOnGamesLocalDelete(state, event, index) {\n          return R.pipePromise(\n            gamesService.removeLocalGame$(index),\n            setLocalGames$(state)\n          )(state.local_games);\n        },\n        loadNewLocalGame: function stateLoadNewLocalGame(state, game) {\n          return R.pipe(\n            gamesService.newLocalGame$(game),\n            setLocalGames$(state),\n            () => {\n              state.changeEvent('Games.local.load',\n                                R.length(state.local_games) - 1);\n            }\n          )(state.local_games);\n        }\n      };\n      var setLocalGames$ = R.curry((state, games) => {\n        state.local_games = games;\n        console.log('stateSetLocalGames', state.local_games);\n        state.changeEvent('Games.local.change');\n      });\n      R.curryService(stateGamesService);\n      return stateGamesService;\n    }\n  ]);\n"]}