{"version":3,"sources":["../../../es6/services/state/exports.js"],"names":[],"mappings":";;;;AAAA,OAAO,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAChC,OAAO,CAAC,cAAc,EAAE,CACvB,YAAY,EACZ,SAAS,0BAA0B,CAAC,iBAAiB,EAAE;AACrD,MAAI,cAAc,GAAG,CAAC,CAAC,KAAK,CAAC,UAAC,IAAI,EAAE,OAAO,EAAK;AAC9C,WAAO,CAAC,CAAC,IAAI,CACX,CAAC,CAAC,IAAI,8BAAK,IAAI,IAAC,KAAK,GAAE,EACvB,iBAAiB,CAAC,OAAO,EACzB,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,EACjB,CAAC,CAAC,SAAS,8BAAK,IAAI,IAAC,KAAK,IAAG,IAAI,CAAC,CACnC,CAAC,OAAO,CAAC,CAAC;GACZ,CAAC,CAAC;AACH,MAAI,mBAAmB,GAAG;AACxB,QAAI,EAAE,SAAS,gBAAgB,CAAC,KAAK,EAAE;AACrC,WAAK,CAAC,OAAO,GAAG,EAAE,CAAC;AACnB,aAAO,KAAK,CAAC;KACd;AACD,YAAQ,EAAE,SAAS,oBAAoB,CAAC,IAAI,EAAE,GAAG,EAAE;AACjD,UAAG,IAAI,CAAC,GAAG,CAAC,EAAE,OAAO,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;AAC3C,aAAO,GAAG,CAAC;KACZ;AACD,UAAM,EAAE,SAAS,sBAAsB,CAAC,IAAI,EAAE,SAAS,EAAE,KAAK,EAAE;AAC9D,aAAO,CAAC,CAAC,WAAW,CAClB,SAAS,EACT,mBAAmB,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,EACtC,iBAAiB,CAAC,SAAS,CAAC,MAAM,CAAC,CACpC,CAAC,KAAK,CAAC,CACL,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,EACd,CAAC,CAAC,OAAO,CAAC,cAAc,EAAE,IAAI,CAAC,CAC/B,CACV,CACN,IAAI,CAAC,UAAC,GAAG,EAAK;AACb,aAAK,CAAC,OAAO,GAAG,CAAC,CAAC,IAAI,CACpB,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,EACf,cAAc,CAAC,CAAC,IAAI,CAAC,CAAC,EACtB,CAAC,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,EAAE;AAClB,cAAI,kBAAgB,IAAI,UAAO;AAC/B,aAAG,EAAE,GAAG;SACT,CAAC,CACH,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AACjB,eAAO,CAAC,IAAI,CAAC,SAAS,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;AACvC,aAAK,CAAC,WAAW,cAAY,IAAI,CAAG,CAAC;OACtC,CAAC,CAAC;KACN;GACF,CAAC;AACF,GAAC,CAAC,YAAY,CAAC,mBAAmB,CAAC,CAAC;AACpC,SAAO,mBAAmB,CAAC;CAC5B,CACF,CAAC,CAAC","file":"exports.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('stateExports', [\n    'fileExport',\n    function stateExportsServiceFactory(fileExportService) {\n      let cleanupExport$ = R.curry((path, exports) => {\n        return R.pipe(\n          R.path([...path,'url']),\n          fileExportService.cleanup,\n          R.always(exports),\n          R.assocPath([...path,'url'], null)\n        )(exports);\n      });\n      let stateExportsService = {\n        init: function stateExportsInit(state) {\n          state.exports = {};\n          return state;\n        },\n        rejectIf: function stateExportsRejectIf(test, obj) {\n          if(test(obj)) return self.Promise.reject();\n          return obj;\n        },\n        export: function stateExportsExportData(name, buildData, state) {\n          return R.pipePromise(\n            buildData,\n            stateExportsService.rejectIf$(R.isNil),\n            fileExportService.generate$('json')\n          )(state)\n            .catch(R.compose(R.always(null),\n                             R.spyWarn('Export error', name)\n                            )\n                  )\n            .then((url) => {\n              state.exports = R.pipe(\n                R.defaultTo({}),\n                cleanupExport$([name]),\n                R.assocPath([name], {\n                  name: `clicknfeat_${name}.json`,\n                  url: url\n                })\n              )(state.exports);\n              console.warn('Exports', state.exports);\n              state.changeEvent(`Exports.${name}`);\n            });\n        }\n      };\n      R.curryService(stateExportsService);\n      return stateExportsService;\n    }\n  ]);\n"]}