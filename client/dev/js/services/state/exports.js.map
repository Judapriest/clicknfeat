{"version":3,"sources":["../../../es6/services/state/exports.js"],"names":[],"mappings":";;;;AAAA,OAAO,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAChC,OAAO,CAAC,cAAc,EAAE,CACvB,YAAY,EACZ,SAAS,0BAA0B,CAAC,iBAAiB,EAAE;AACrD,MAAI,cAAc,GAAG,CAAC,CAAC,KAAK,CAAC,UAAC,IAAI,EAAE,OAAO,EAAK;AAC9C,WAAO,CAAC,CAAC,IAAI,CACX,CAAC,CAAC,IAAI,8BAAK,IAAI,IAAC,KAAK,GAAE,EACvB,iBAAiB,CAAC,OAAO,EACzB,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,EACjB,CAAC,CAAC,SAAS,8BAAK,IAAI,IAAC,KAAK,IAAG,IAAI,CAAC,CACnC,CAAC,OAAO,CAAC,CAAC;GACZ,CAAC,CAAC;AACH,MAAI,mBAAmB,GAAG;AACxB,QAAI,EAAE,SAAS,gBAAgB,CAAC,KAAK,EAAE;AACrC,WAAK,CAAC,OAAO,GAAG,EAAE,CAAC;AACnB,aAAO,KAAK,CAAC;KACd;AACD,YAAQ,EAAE,SAAS,oBAAoB,CAAC,IAAI,EAAE,GAAG,EAAE;AACjD,UAAG,IAAI,CAAC,GAAG,CAAC,EAAE,OAAO,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;AAC3C,aAAO,GAAG,CAAC;KACZ;AACD,UAAM,EAAE,SAAS,sBAAsB,CAAC,IAAI,EAAE,SAAS,EAAE,KAAK,EAAE;AAC9D,aAAO,CAAC,CAAC,WAAW,CAClB,SAAS,EACT,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,SAAS,QAAK,IAAI,CAAG,EAAE,KAAK,CAAC,CAAC,EAC/C,WAAW,CAAC,EACvB,UAAC,IAAI,EAAK;AACR,aAAK,CAAC,OAAO,GAAG,CAAC,CAAC,KAAK,OAAK,IAAI,EAAI,IAAI,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;AACzD,eAAO,IAAI,CAAC;OACb,EACD,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,KAAK,EAAE,KAAK,CAAC,EAC1B,iBAAiB,CAAC,SAAS,CAAC,MAAM,CAAC,CACpC,CAAC,KAAK,CAAC,CACL,KAAK,CAAC,UAAC,KAAK,EAAK;AAChB,gBAAO,KAAK;AACZ,eAAK,KAAK;AAAE,mBAAO,IAAI,CAAC;AAAA,AACxB,eAAK,WAAW;AAAE,mBAAO,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;AAAA,AAC/C;AAAS;AACP,qBAAO,CAAC,IAAI,CAAC,gBAAgB,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;AAC5C,qBAAO,IAAI,CAAC;aACb;AAAA,SACA;OACF,CAAC,CACD,IAAI,CAAC,UAAC,GAAG,EAAK;AACb,aAAK,CAAC,OAAO,GAAG,CAAC,CAAC,IAAI,CACpB,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,EACf,cAAc,CAAC,CAAC,IAAI,CAAC,CAAC,EACtB,CAAC,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,EAAE;AAClB,cAAI,kBAAgB,IAAI,UAAO;AAC/B,aAAG,EAAE,GAAG;SACT,CAAC,CACH,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AACjB,eAAO,CAAC,IAAI,CAAC,SAAS,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;AACvC,aAAK,CAAC,WAAW,cAAY,IAAI,CAAG,CAAC;OACtC,CAAC,CACD,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;KAC1B;GACF,CAAC;AACF,GAAC,CAAC,YAAY,CAAC,mBAAmB,CAAC,CAAC;AACpC,SAAO,mBAAmB,CAAC;CAC5B,CACF,CAAC,CAAC","file":"exports.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('stateExports', [\n    'fileExport',\n    function stateExportsServiceFactory(fileExportService) {\n      let cleanupExport$ = R.curry((path, exports) => {\n        return R.pipe(\n          R.path([...path,'url']),\n          fileExportService.cleanup,\n          R.always(exports),\n          R.assocPath([...path,'url'], null)\n        )(exports);\n      });\n      let stateExportsService = {\n        init: function stateExportsInit(state) {\n          state.exports = {};\n          return state;\n        },\n        rejectIf: function stateExportsRejectIf(test, obj) {\n          if(test(obj)) return self.Promise.reject();\n          return obj;\n        },\n        export: function stateExportsExportData(name, buildData, state) {\n          return R.pipePromise(\n            buildData,\n            R.rejectIf(R.equals(R.path(['exports',`_${name}`], state)),\n                       'unchanged'),\n            (data) => {\n              state.exports = R.assoc(`_${name}`, data, state.exports);\n              return data;\n            },\n            R.rejectIf(R.isNil, 'nil'),\n            fileExportService.generate$('json')\n          )(state)\n            .catch((error) => {\n              switch(error) {\n              case 'nil': return null;\n              case 'unchanged': return self.Promise.reject();\n              default: {\n                console.warn('Exports: error', name, error);\n                return null;\n              }\n              }\n            })\n            .then((url) => {\n              state.exports = R.pipe(\n                R.defaultTo({}),\n                cleanupExport$([name]),\n                R.assocPath([name], {\n                  name: `clicknfeat_${name}.json`,\n                  url: url\n                })\n              )(state.exports);\n              console.warn('Exports', state.exports);\n              state.changeEvent(`Exports.${name}`);\n            })\n            .catch(R.always(null));\n        }\n      };\n      R.curryService(stateExportsService);\n      return stateExportsService;\n    }\n  ]);\n"]}