{"version":3,"sources":["../../../es6/services/state/user.js"],"names":[],"mappings":"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","file":"user.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('stateUser', [\n    'user',\n    'userConnection',\n    'prompt',\n    function stateUserServiceFactory(userService,\n                                     userConnectionService,\n                                     promptService) {\n      var stateUserService = {\n        init: function stateUserInit(state) {\n          state.user = {};\n          state.user_ready = R.pipeP(\n            userService.init,\n            setUser$(state)\n          )(state);\n\n          state.onEvent('User.set',\n                        stateUserService.onUserSet$(state));\n          state.onEvent('User.toggleOnline',\n                        stateUserService.onUserToggleOnline$(state));\n          state.onEvent('User.sendChatMsg',\n                        stateUserService.onUserSendChatMsg$(state));\n          state.onEvent('User.connection.close',\n                        stateUserService.onUserConnectionClose$(state));\n          state.onEvent('User.setOnlineUsers',\n                        stateUserService.onUserSetOnlineUsers$(state));\n          state.onEvent('User.setOnlineGames',\n                        stateUserService.onUserSetOnlineGames$(state));\n          state.onEvent('User.newChatMsg',\n                        stateUserService.onUserNewChatMsg$(state));\n\n          return state;\n        },\n        save: function stateUserSave(state) {\n          return saveCurrentUser(state);\n        },\n        onUserSet: function stateOnUserSet(state, event, user_state) {\n          return R.pipePromise(\n            R.assoc('state', user_state),\n            userService.checkOnline$(state),\n            setUser$(state)\n          )(state.user);\n        },\n        onUserToggleOnline: function stateOnUserToggleOnline(state, event) {\n          event = event;\n          return R.pipePromise(\n            userService.toggleOnline$(state),\n            setUser$(state)\n          )(state.user);\n        },\n        onUserSendChatMsg: function stateOnUserSendChatMsg(state, event, chat) {\n          return userConnectionService\n            .sendChat$(chat, state.user);\n        },\n        onUserConnectionClose: function stateOnUserConnectionClose(state, event) {\n          event = event;\n          return R.pipePromise(\n            userService.online,\n            (online) => {\n              if(!online) {\n                return self.Promise\n                  .reject('User not online when connection close');\n              }\n\n              return promptService\n                .prompt('alert','Server connection lost.')\n                .catch(R.always(null));\n            },\n            R.always(state.user),\n            userService.toggleOnline$(state),\n            setUser$(state)\n          )(state.user);\n        },\n        onUserSetOnlineUsers: function stateOnUserSetOnlineUsers(state, event, users) {\n          return R.pipePromise(\n            R.assocPath(['connection','users'], users),\n            setUser$(state)\n          )(state.user);\n        },\n        onUserSetOnlineGames: function stateOnUserSetOnlineGames(state, event, games) {\n          return R.pipePromise(\n            R.assocPath(['connection','games'], games),\n            setUser$(state)\n          )(state.user);\n        },\n        onUserNewChatMsg: function stateOnUserNewChatMsg(state, event, msg) {\n          state.changeEvent('User.chat', msg);\n          return R.pipePromise(\n            R.assocPath(['connection','chat'], R.pipe(\n              R.pathOr([], ['connection','chat']),\n              R.append(msg)\n            )(state.user)),\n            setUser$(state)\n          )(state.user);\n        }\n      };\n      var setUser$ = R.curry((state, user) => {\n        state.user = user;\n        console.log('stateSetUser', state.user);\n        state.changeEvent('User.change');\n      });\n      function saveCurrentUser(state) {\n        if(state._user === state.user) return null;\n        state._user = state.user;\n        return userService.save(state.user);\n      }\n      R.curryService(stateUserService);\n      return stateUserService;\n    }\n  ]);\n"]}