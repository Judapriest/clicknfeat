{"version":3,"sources":["../../../es6/services/state/game.js"],"names":[],"mappings":"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","file":"game.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('stateGame', [\n    '$window',\n    'games',\n    'game',\n    'gameBoard',\n    'gameConnection',\n    'gameFactions',\n    'gameModels',\n    'gameModelSelection',\n    'gameScenario',\n    'gameTerrains',\n    'fileImport',\n    'stateExports',\n    'allCommands',\n    'allTemplates',\n    function stateGamesServiceFactory($window,\n                                      gamesService,\n                                      gameService,\n                                      gameBoardService,\n                                      gameConnectionService,\n                                      gameFactionsService,\n                                      gameModelsService,\n                                      gameModelSelectionService,\n                                      gameScenarioService,\n                                      gameTerrainsService,\n                                      fileImportService,\n                                      stateExportsService) {\n      let stateGameService = {\n        init: function stateGamesInit(state) {\n          state.game = null;\n\n          state.onEvent('Game.load',\n                        stateGameService.onGameLoad$(state));\n          state.onEvent('Game.connection.close',\n                        stateGameService.onGameConnectionClose$(state));\n          state.onEvent('Game.command.execute',\n                        stateGameService.onGameCommandExecute$(state));\n          state.onEvent('Game.command.undo',\n                        stateGameService.onGameCommandUndo$(state));\n          state.onEvent('Game.command.replay',\n                        stateGameService.onGameCommandReplay$(state));\n          state.onEvent('Game.command.replayBatch',\n                        stateGameService.onGameCommandReplayBatch$(state));\n          state.onEvent('Game.command.undoLast',\n                        stateGameService.onGameCommandUndoLast$(state));\n          state.onEvent('Game.command.replayNext',\n                        stateGameService.onGameCommandReplayNext$(state));\n          state.onEvent('Game.setCmds',\n                        stateGameService.onGameSetCmds$(state));\n          state.onEvent('Game.setPlayers',\n                        stateGameService.onGameSetPlayers$(state));\n          state.onEvent('Game.newChatMsg',\n                        stateGameService.onGameNewChatMsg$(state));\n          state.onEvent('Game.update',\n                        stateGameService.onGameUpdate$(state));\n          state.onEvent('Game.invitePlayer',\n                        stateGameService.onGameInvitePlayer$(state));\n          state.onEvent('Game.model.create',\n                        stateGameService.onGameModelCreate$(state));\n          state.onEvent('Game.model.copy',\n                        stateGameService.onGameModelCopy$(state));\n          state.onEvent('Game.model.importList',\n                        stateGameService.onGameModelImportList$(state));\n          state.onEvent('Game.model.importFile',\n                        stateGameService.onGameModelImportFile$(state));\n          state.onEvent('Game.template.create',\n                        stateGameService.onGameTemplateCreate$(state));\n          state.onEvent('Game.terrain.create',\n                        stateGameService.onGameTerrainCreate$(state));\n          state.onEvent('Game.terrain.reset',\n                        stateGameService.onGameTerrainReset$(state));\n          state.onEvent('Game.board.set',\n                        stateGameService.onGameBoardSet$(state));\n          state.onEvent('Game.board.setRandom',\n                        stateGameService.onGameBoardSetRandom$(state));\n          state.onEvent('Game.board.importFile',\n                        stateGameService.onGameBoardImportFile$(state));\n          state.onEvent('Game.scenario.set',\n                        stateGameService.onGameScenarioSet$(state));\n          state.onEvent('Game.scenario.setRandom',\n                        stateGameService.onGameScenarioSetRandom$(state));\n          state.onEvent('Game.scenario.generateObjectives',\n                        stateGameService.onGameScenarioGenerateObjectives$(state));\n\n          return state;\n        },\n        save: function stateGameSave(state) {\n          return R.pipeP(\n            () => { return exportCurrentGame(state); },\n            () => { return exportCurrentModelSelection(state); },\n            () => { return exportCurrentBoard(state); }\n          )();\n        },\n        onGameLoad: function stateGameOnLoad(state, event, is_online, is_private, id) {\n          return R.pipePromise(\n            R.always(state.data_ready),\n            R.always(state.user_ready),\n            R.always(state.games_ready),\n            ()=> {\n              if(is_online) {\n                return gamesService\n                  .loadOnlineGame(is_private, id);\n              }\n              else {\n                return gamesService\n                  .loadLocalGame(id, state.local_games);\n              }\n            },\n            (game) => {\n              state.changeEventUnbuffered('Game.loading');\n              return game;\n            },\n            setGame$(state),\n            (game) => {\n              return R.pipeP(\n                () => { return state.event('Modes.reset'); },\n                R.always(game)\n              )();\n            },\n            gameService.load$(state),\n            (game) => {\n              state.changeEvent('Game.loaded');\n              return game;\n            },\n            (game) => {\n              if(!is_online) return game;\n              return gameConnectionService\n                .open$(R.path(['user','state','name'], state), state, game);\n            },\n            (game) => {\n              if(is_online) return game;\n\n              return R.assoc('local_id', id, game);\n            },\n            setGame$(state),\n            () => {\n              state.changeEvent('Game.load.success');\n            }\n          )().catch((error) => {\n            state.changeEvent('Game.load.error', error);\n          });\n        },\n        onGameConnectionClose: function stateGameOnConnectionClose(state, event) {\n          event = event;\n          return R.pipe(\n            gameConnectionService.cleanup,\n            setGame$(state)\n          )(state.game);\n        },\n        onGameCommandExecute: function stateGameOnCommandExecute(state, event, cmd, args) {\n          return R.pipeP(\n            gameService.executeCommand$(cmd, args, state),\n            setGame$(state)\n          )(state.game).catch(gameActionError$(state));\n        },\n        onGameCommandUndo: function stateGameOnCommandUndo(state, event, cmd) {\n          return R.pipeP(\n            gameService.undoCommand$(cmd, state),\n            setGame$(state)\n          )(state.game);\n        },\n        onGameCommandUndoLast: function stateGameOnCommandUndoLast(state, event) {\n          event = event;\n          return R.pipeP(\n            gameService.undoLastCommand$(state),\n            setGame$(state)\n          )(state.game).catch(gameActionError$(state));\n        },\n        onGameCommandReplay: function stateGameOnCommandReplay(state, event, cmd) {\n          return R.pipeP(\n            gameService.replayCommand$(cmd, state),\n            setGame$(state)\n          )(state.game);\n        },\n        onGameCommandReplayBatch: function stateGameOnCommandReplayBatch(state, event, cmds) {\n          return R.pipeP(\n            gameService.replayCommandsBatch$(cmds, state),\n            setGame$(state)\n          )(state.game);\n        },\n        onGameCommandReplayNext: function stateGameOnCommandReplayNext(state, event) {\n          event = event;\n          return R.pipeP(\n            gameService.replayNextCommand$(state),\n            setGame$(state)\n          )(state.game).catch(gameActionError$(state));\n        },\n        onGameSetCmds: function stateGameOnSetCmds(state, event, set) {\n          return R.pipe(\n            R.assoc(set.where, set.cmds),\n            setGame$(state)\n          )(state.game);\n        },\n        onGameSetPlayers: function stateGameOnSetPlayers(state, event, players) {\n          return R.pipe(\n            R.assoc('players', players),\n            setGame$(state)\n          )(state.game);\n        },\n        onGameNewChatMsg: function stateGameOnNewChatMsg(state, event, msg) {\n          return R.pipe(\n            R.over(R.lensProp('chat'),\n                   R.compose(R.append(msg.chat), R.defaultTo([]))),\n            setGame$(state),\n            () => { state.changeEvent('Game.chat'); }\n          )(state.game);\n        },\n        onGameUpdate: function stateGameOnUpdate(state, event, lens, update) {\n          return R.pipe(\n            R.over(lens, update),\n            setGame$(state)\n          )(state.game);\n        },\n        onGameInvitePlayer: function stateGameOnInvitePlayer(state, event, to) {\n          var msg = [\n            s.capitalize(R.pathOr('Unknown', ['user','state','name'], state)),\n            'has invited you to join a game'\n          ].join(' ');\n          var link = $window.location.hash;\n          console.log('Invite player', to, msg, link);\n\n          return state.event('User.sendChatMsg',\n                             { to: to, msg: msg, link: link });\n        },\n        onGameModelCreate: function stateGameOnModelCreate(state, event, model_path, repeat = 1) {\n          state.create = R.assoc('model', {\n            base: { x: 240, y: 240, r: 0 },\n            models: R.times((i) => {\n              return {\n                info: model_path,\n                x: 20*i, y: 0, r: 0\n              };\n            }, repeat)\n          }, R.defaultTo({}, state.create));\n          return state.event('Modes.switchTo', 'CreateModel');\n        },\n        onGameModelCopy: function stateGameOnModelCopy(state, event, create) {\n          state.create = R.assoc('model', create, state.create);\n          return state.event('Modes.switchTo', 'CreateModel');\n        },\n        onGameModelImportList: function stateGameOnModelImportList(state, event, list) {\n          let user = R.pathOr('Unknown', ['user','state','name'], state);\n          state.create = R.assoc(\n            'model',\n            gameFactionsService\n              .buildModelsList(list, user, state.factions.references),\n            state.create\n          );\n          console.info('doImportList', list, state.create.model);\n          return state.event('Modes.switchTo', 'CreateModel');\n        },\n        onGameModelImportFile: function stateGameOnModelImportFile(state, event, file) {\n          return R.pipeP(\n            fileImportService.read$('json'),\n            (create) => {\n              state.create = R.assoc('model', create, state.create);\n              return state.event('Modes.switchTo', 'CreateModel');\n            }\n          )(file).catch(gameActionError$(state));\n        },\n        onGameTemplateCreate: function stateGameOnModelCreate(state, event, type) {\n          state.create = R.assoc('template', {\n            base: { x: 240, y: 240, r: 0 },\n            templates: [ { type: type, x: 0, y: 0, r: 0 } ]\n          }, R.defaultTo({}, state.create));\n          return state.event('Modes.switchTo', 'CreateTemplate');\n        },\n        onGameTerrainCreate: function stateGameOnTerrainCreate(state, event, path) {\n          state.create = R.assoc('terrain', {\n            base: { x: 240, y: 240, r: 0 },\n            terrains: [ {\n              info: path,\n              x: 0, y: 0, r: 0\n            } ]\n          }, R.defaultTo({}, state.create));\n          return state.event('Modes.switchTo', 'CreateTerrain');\n        },\n        onGameTerrainReset: function stateGameOnTerrainReset(state, event) {\n          event = event;\n          return R.pipePromise(\n            () => {\n              return gameTerrainsService.all(state.game.terrains);\n            },\n            R.pluck('state'),\n            R.pluck('stamp'),\n            (stamps) => {\n              return state.event('Game.command.execute',\n                                 'deleteTerrain', [stamps]);\n          }\n          )().catch(gameActionError$(state));\n        },\n        onGameBoardSet: function stateGameOnBoardSet(state, event, name) {\n          let board = gameBoardService.forName(name, state.boards);\n          return state.event('Game.command.execute',\n                             'setBoard', [board]);\n        },\n        onGameBoardSetRandom: function stateGameOnBoardSetRandom(state, event) {\n          event = event;\n          let board, name = gameBoardService.name(state.game.board);\n          while(name === gameBoardService.name(state.game.board)) {\n            board = state.boards[R.randomRange(0, state.boards.length-1)];\n            name = gameBoardService.name(board);\n          }\n          return state.event('Game.command.execute',\n                             'setBoard', [board]);\n        },\n        onGameBoardImportFile: function stateGameOnBoardImportFile(state, event, file) {\n          return R.pipeP(\n            fileImportService.read$('json'),\n            (board_info) => {\n              return R.pipePromise(\n                () => {\n                  if(!board_info.board) return self.Promise.reject();\n\n                  return state.event('Game.command.execute',\n                                     'setBoard', [board_info.board]);\n                },\n                () => {\n                  if(R.isEmpty(R.pathOr([], ['terrain','terrains'], board_info))) {\n                    return self.Promise.reject();\n                  }\n\n                  return state.event('Game.terrain.reset');\n                },\n                () => {\n                  return state.event('Game.command.execute',\n                                     'createTerrain', [board_info.terrain, false]);\n                }\n              )();\n            }\n          )(file).catch(R.always(null));\n        },\n        onGameScenarioSet: function stateGameOnScenarioSet(state, event, name, group) {\n          let scenario = gameScenarioService.forName(name, group);\n          return state.event('Game.command.execute',\n                             'setScenario', [scenario]);\n        },\n        onGameScenarioSetRandom: function stateGameOnScenarioSetRandom(state, event) {\n          event = event;\n          var group = gameScenarioService.group('SR15', state.scenarios);\n          var scenario, name = gameScenarioService.name(state.game.scenario);\n          while(name === gameScenarioService.name(state.game.scenario)) {\n            scenario = group[1][R.randomRange(0, group[1].length-1)];\n            name = gameScenarioService.name(scenario);\n          }\n          return state.event('Game.command.execute',\n                             'setScenario', [scenario]);\n        },\n        onGameScenarioGenerateObjectives: function stateGameOnScenarioGenerateObjectives(state, event) {\n          event = event;\n          return R.pipePromise(\n            () => {\n              return gameModelsService.all(state.game.models);\n            },\n            R.filter(R.pipe(\n              R.path(['state','info']),\n              R.head,\n              R.equals('scenario')\n            )),\n            R.map(R.path(['state','stamp'])),\n            (stamps) => {\n              return state.event('Game.command.execute',\n                                 'deleteModel', [stamps]);\n            },\n            () => {\n              return gameScenarioService\n                .createObjectives(state.game.scenario);\n            },\n            (objectives) => {\n              var is_flipped = R.path(['ui_state','flip_map'], state);\n              return state.event('Game.command.execute',\n                                 'createModel', [objectives, is_flipped]);\n            }\n          )();\n        }\n      };\n      var setGame$ = R.curry((state, game) => {\n        state.game = game;\n        console.log('stateGame', state.game);\n        state.changeEvent('Game.change');\n        return game;\n      });\n      var gameActionError$ = R.curry((state, error) => {\n        state.changeEvent('Game.action.error', error);\n        return null;\n        // return self.Promise.reject(error);\n      });\n      var exportCurrentGame = stateExportsService\n            .export$('game', R.prop('game'));\n      function exportCurrentModelSelection(state) {\n        return stateExportsService\n          .export('models', R.pipePromise(\n            R.path(['game','model_selection']),\n            stateExportsService.rejectIf$(R.isNil),\n            gameModelSelectionService.get$('local'),\n            stateExportsService.rejectIf$(R.isEmpty),\n            (stamps) => {\n              return gameModelsService\n                .copyStamps(stamps, R.path(['game', 'models'], state));\n            },\n            stateExportsService.rejectIf$(R.isEmpty)\n          ), state);\n      }\n      var exportCurrentBoard = stateExportsService\n            .export$('board', R.pipePromise(\n              R.prop('game'),\n              stateExportsService.rejectIf$(R.isNil),\n              (game) => {\n                return {\n                  board: game.board,\n                  terrain: {\n                    base: { x: 0, y: 0, r: 0 },\n                    terrains: R.pipe(\n                      gameTerrainsService.all,\n                      R.pluck('state'),\n                      R.map(R.pick(['x','y','r','info','lk']))\n                    )(game.terrains)\n                  }\n                };\n              }\n            ));\n      R.curryService(stateGameService);\n      return stateGameService;\n    }\n  ]);\n"]}