{"version":3,"sources":["../../../es6/services/game/templates.js"],"names":[],"mappings":"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","file":"templates.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('gameTemplates', [\n    'template',\n    function gameTemplatesServiceFactory(templateService) {\n      var gameTemplatesService = {\n        create: function() {\n          return {\n            active: [],\n            locked: []\n          };\n        },\n        all: function templatesAll(templates) {\n          return R.concat(templates.active, templates.locked);\n        },\n        findStampIn: function templatesFindStampIn(stamp, where, templates) {\n          return new self.Promise((resolve, reject) => {\n            var find = R.pipe(\n              R.prop(where),\n              R.find(R.pathEq(['state','stamp'], stamp))\n            )(templates);\n            return (R.exists(find) ?\n                    resolve(find) :\n                    reject('stamp '+stamp+' not found in '+where)\n                   );\n          });\n        },\n        findStamp: function templatesFindStamp(stamp, templates) {\n          return gameTemplatesService.findStampIn(stamp, 'active', templates)\n            .catch(() => {\n              return gameTemplatesService.findStampIn(stamp, 'locked', templates);\n            });\n        },\n        findAnyStamps: function templatesFindAnyStamps(stamps, templates) {\n          return R.pipePromise(\n            R.map((stamp) => {\n              return gameTemplatesService.findStamp(stamp, templates)\n                .catch(R.always(null));\n            }),\n            R.promiseAll,\n            (stamps) => {\n              if(R.isEmpty(R.reject(R.isNil, stamps))) {\n                console.log('DeleteTemplate : no templates found');\n                return self.Promise.reject('No template found');\n              }\n              return stamps;\n            }\n          )(stamps);\n        },\n        onStamps: function templatesOnStamps(...args) {\n          var templates = R.last(args);\n          var stamps = R.nth(-2, args);\n\n          args = R.slice(0, -2, args);\n          return R.pipeP(\n            gameTemplatesService.findAnyStamps$(stamps),\n            R.reject(R.isNil),\n            R.map((template) => {\n              return templateService.call.apply(null, R.append(template, args));\n            }),\n            R.promiseAll\n          )(templates);\n        },\n        add: function templatesAdd(temps, templates) {\n          return R.pipe(\n            gameTemplatesService.removeStamps$(R.map(R.path(['state','stamp']), temps)),\n            (templates) => {\n              return R.assoc('active', R.concat(templates.active, temps), templates);\n            }\n          )(templates);\n        },\n        removeStamps: function templatesRemoveStamps(stamps, templates) {\n          function inStamps(template) {\n            return R.find(R.equals(R.path(['state', 'stamp'], template)), stamps);\n          }\n          return R.pipe(\n            R.assoc('active', R.reject(inStamps, templates.active)),\n            R.assoc('locked', R.reject(inStamps, templates.locked))\n          )(templates);\n        },\n        isActive: function templatesIsLocked(stamp, templates) {\n          return R.find(R.pathEq(['state','stamp'], stamp), templates.active);\n        },\n        isLocked: function templatesIsLocked(stamp, templates) {\n          return R.find(R.pathEq(['state','stamp'], stamp), templates.locked);\n        },\n        lockStamps: function templatesLockStamps(lock, stamps, templates) {\n          return R.pipeP(\n            gameTemplatesService.findAnyStamps$(stamps),\n            R.reject(R.isNil),\n            R.forEach(templateService.setLock$(lock)),\n            () => {\n              var [locked, active] = R.pipe(\n                gameTemplatesService.all,\n                R.partition(templateService.isLocked)\n              )(templates);\n              return {\n                active: active,\n                locked: locked\n              };\n            }\n          )(templates);\n        },\n        modeForStamp: function templateSelectionModeForStamp(stamp, templates) {\n          return R.pipeP(\n            gameTemplatesService.findStamp$(stamp),\n            R.path(['state','type']),\n            R.defaultTo('aoe'),\n            (type) => {\n              return type+'Template';\n            }\n          )(templates);\n        },\n      };\n      R.curryService(gameTemplatesService);\n      return gameTemplatesService;\n    }\n  ]);\n"]}