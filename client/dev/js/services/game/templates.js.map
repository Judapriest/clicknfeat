{"version":3,"sources":["../../../es6/services/game/templates.js"],"names":[],"mappings":"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","file":"templates.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('gameTemplates', [\n    'template',\n    function gameTemplatesServiceFactory(templateService) {\n      var gameTemplatesService = {\n        create: function() {\n          return {\n            active: [],\n            locked: []\n          };\n        },\n        all: function templatesAll(templates) {\n          return R.concat(templates.active, templates.locked);\n        },\n        findStampIn: function templatesFindStampIn(stamp, where, templates) {\n          return new self.Promise((resolve, reject) => {\n            var find = R.pipe(\n              R.prop(where),\n              R.find(R.pathEq(['state','stamp'], stamp))\n            )(templates);\n            return (R.exists(find) ?\n                    resolve(find) :\n                    reject(`stamp ${stamp} not found in ${where}`)\n                   );\n          });\n        },\n        findStamp: function templatesFindStamp(stamp, templates) {\n          return gameTemplatesService\n            .findStampIn(stamp, 'active', templates)\n            .catch(() => {\n              return gameTemplatesService\n                .findStampIn(stamp, 'locked', templates);\n            });\n        },\n        findAnyStamps: function templatesFindAnyStamps(stamps, templates) {\n          return R.pipePromise(\n            R.map((stamp) => {\n              return gameTemplatesService\n                .findStamp(stamp, templates)\n                .catch(R.always(null));\n            }),\n            R.promiseAll,\n            (stamps) => {\n              if(R.isEmpty(R.reject(R.isNil, stamps))) {\n                return self.Promise.reject('No template found');\n              }\n              return stamps;\n            }\n          )(stamps);\n        },\n        fromStamps: function templatesFromStamps(method, args, stamps, templates) {\n          return fromStamps$(R.compose(R.always, R.always(null)),\n                             method, args, stamps, templates);\n        },\n        onStamps: function templatesOnStamps(method, args, stamps, templates) {\n          return R.pipeP(\n            fromStamps$(R.always, method, args, stamps),\n            updateTemplates$(templates)\n          )(templates);\n        },\n        setStateStamps: function templatesSetStateStamps(states, stamps, templates) {\n          return R.pipeP(\n            gameTemplatesService.findAnyStamps$(stamps),\n            R.addIndex(R.map)((template, index) => {\n              return ( R.isNil(template) ?\n                       null :\n                       templateService.setState(states[index], template)\n                     );\n            }),\n            R.reject(R.isNil),\n            updateTemplates$(templates)\n          )(templates);\n        },\n        add: function templatesAdd(temps, templates) {\n          return R.pipe(\n            gameTemplatesService.removeStamps$(R.map(R.path(['state','stamp']), temps)),\n            (templates) => {\n              return R.assoc('active', R.concat(templates.active, temps), templates);\n            }\n          )(templates);\n        },\n        removeStamps: function templatesRemoveStamps(stamps, templates) {\n          function inStamps(template) {\n            return R.find(R.equals(R.path(['state', 'stamp'], template)), stamps);\n          }\n          return R.pipe(\n            R.assoc('active', R.reject(inStamps, templates.active)),\n            R.assoc('locked', R.reject(inStamps, templates.locked))\n          )(templates);\n        },\n        isActive: function templatesIsLocked(stamp, templates) {\n          return R.find(R.pathEq(['state','stamp'], stamp), templates.active);\n        },\n        isLocked: function templatesIsLocked(stamp, templates) {\n          return R.find(R.pathEq(['state','stamp'], stamp), templates.locked);\n        },\n        lockStamps: function templatesLockStamps(lock, stamps, templates) {\n          return R.pipePromise(\n            gameTemplatesService.findAnyStamps$(stamps),\n            R.reject(R.isNil),\n            R.map(templateService.setLock$(lock)),\n            updateTemplates$(templates)\n          )(templates);\n        },\n        modeForStamp: function templateSelectionModeForStamp(stamp, templates) {\n          return R.pipeP(\n            gameTemplatesService.findStamp$(stamp),\n            R.path(['state','type']),\n            R.defaultTo('aoe'),\n            (type) => {\n              return type+'Template';\n            }\n          )(templates);\n        }\n      };\n      var fromStamps$ = R.curry((onError, method, args, stamps, templates) => {\n        return R.pipeP(\n          gameTemplatesService.findAnyStamps$(stamps),\n          R.reject(R.isNil),\n          R.map((template) => {\n            return self.Promise\n              .resolve(templateService.call(method, args, template))\n              .catch(onError(template));\n          }),\n          R.promiseAll\n        )(templates);\n      });\n      var updateTemplates$ = R.curry((templates, news) => {\n        return R.pipe(\n          gameTemplatesService.all,\n          R.concat(news),\n          R.uniqBy(R.path(['state','stamp'])),\n          R.partition(templateService.isLocked),\n          ([locked, active]) => {\n            return {\n              active: active,\n              locked: locked\n            };\n          }\n        )(templates);\n      });\n      R.curryService(gameTemplatesService);\n      return gameTemplatesService;\n    }\n  ]);\n"]}