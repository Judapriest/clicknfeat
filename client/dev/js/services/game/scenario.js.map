{"version":3,"sources":["../../../es6/services/game/scenario.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,OAAO,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAChC,OAAO,CAAC,cAAc,EAAE,CACvB,MAAM,EACN,OAAO,EACP,MAAM,EACN,QAAQ,EACR,SAAS,0BAA0B,CAAC,WAAW,EACX,YAAY,EACZ,WAAW,EACX,aAAa,EAAE;AACjD,MAAI,mBAAmB,GAAG;AACxB,QAAI,EAAE,SAAS,gBAAgB,GAAG;AAChC,aAAO,WAAW,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAC3C,KAAK,CAAC,UAAS,MAAM,EAAE;AACtB,eAAO,CAAC,GAAG,CAAC,8BAA8B,EAAE,MAAM,CAAC,CAAC;AACpD,eAAO,EAAE,CAAC;OACX,CAAC,CAAC;KACN;AACD,QAAI,EAAE,SAAS,gBAAgB,CAAC,QAAQ,EAAE;AACxC,aAAO,CAAC,CAAC,IAAI,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;KACjC;AACD,SAAK,EAAE,SAAS,iBAAiB,CAAC,UAAU,EAAE,MAAM,EAAE;AACpD,aAAO,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,MAAM,CAAC,CAAC;KAChE;AACD,WAAO,EAAE,SAAS,mBAAmB,CAAC,IAAI,EAAE,KAAK,EAAE;AACjD,aAAO,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,EAAE,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;KACjD;AACD,gBAAY,EAAE,SAAS,wBAAwB,CAAC,IAAI,EAAE,MAAM,EAAE;AAC5D,UAAG,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,OAAO,SAAS,CAAC;AACnC,aAAO,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,MAAM,CAAC,CAAC;KAC1E;AACD,oBAAgB,EAAE,SAAS,4BAA4B,CAAC,QAAQ,EAAE;AAChE,aAAO,IAAI,IAAI,CAAC,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;AAC3C,YAAI,UAAU,GAAG,CAAC,CAAC,MAAM,CACvB,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,YAAY,EAAE,QAAQ,CAAC,EACpC,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,OAAO,EAAE,QAAQ,CAAC,CAChC,CAAC;AACF,YAAG,CAAC,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE,MAAM,CAAC,eAAe,CAAC,CAAC;;AAElD,YAAI,IAAI,GAAG,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;AAC/C,eAAO,CAAC;AACN,cAAI,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,EAAC,GAAG,EAAC,GAAG,CAAC,EAAE,IAAI,CAAC;AACjC,gBAAM,EAAE,CAAC,CAAC,GAAG,CAAC,UAAC,SAAS,EAAK;AAC3B,mBAAO,CAAC,CAAC,IAAI,CACX,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC,EACf,CAAC,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,UAAU,EAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC,CAAC,EAC3E,YAAY,CAAC,eAAe,CAAC,IAAI,CAAC,CACnC,CAAC,SAAS,CAAC,CAAC;WACd,EAAE,UAAU,CAAC;SACf,CAAC,CAAC;OACJ,CAAC,CAAC;KACJ;AACD,gBAAY,EAAE,SAAS,wBAAwB,CAAC,MAAM,EAAE,QAAQ,EAAE;AAChE,aAAO,CAAC,CAAC,MAAM,CAAE,CAAC,CAAC,IAAI,CAAC,UAAC,CAAC,EAAK;AAAE,eAAO,UAAU,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;OAAK,EAC3C,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC,IACxC,CAAC,CAAC,IAAI,CAAC,UAAC,CAAC,EAAK;AAAE,eAAO,aAAa,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;OAAE,EAC3C,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC,IACtC,CAAC,CAAC,IAAI,CAAC,UAAC,CAAC,EAAK;AAAE,eAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;OAAG,EAC3C,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,OAAO,EAAE,QAAQ,CAAC,CAAC,CACxC,CAAC;KAClB;AACD,gBAAY,EAAE,SAAS,wBAAwB,CAAC,MAAM,EAAE,QAAQ,EAAE;AAChE,aAAS,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,IAC1B,WAAW,CAAC,MAAM,EAAE,QAAQ,CAAC,OAAO,CAAC,CACrC;KACV;GACF,CAAC;AACF,WAAS,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE;AAC7B,QAAI,IAAI,GAAG;AACT,WAAK,EAAE,MAAM;AACb,SAAG,EAAE,CAAC;KACP,CAAC;AACF,QAAI,MAAM,GAAG,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AACtC,WAAO,MAAM,IAAK,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,AAAC,CAAC;GACxC;AACD,WAAS,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE;AAC/B,QAAI,IAAI,GAAG;AACT,WAAK,EAAE,MAAM;AACb,SAAG,EAAE,CAAC;KACP,CAAC;AACF,QAAI,MAAM,GAAG,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AACtC,WAAO,MAAM,IAAK,MAAM,CAAC,MAAM,GAAG,EAAE,GAAG,KAAK,AAAC,CAAC;GAC/C;AACD,WAAS,aAAa,CAAC,MAAM,EAAE,CAAC,EAAE;AAChC,QAAI,GAAG,GAAG;AACR,SAAG,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,GAAC,CAAC;AAClB,SAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,GAAC,CAAC,EAAE;AAC5B,UAAI,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,GAAC,CAAC;AAClB,SAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,GAAC,CAAC,EAAE;KAC9B,CAAC;AACF,WAAO,aAAa,CAAC,OAAO,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;GAC3C;AACD,WAAS,WAAW,CAAC,MAAM,EAAE,EAAE,EAAE;AAC/B,QAAI,GAAG,GAAG;AACR,SAAG,EAAE,EAAE,CAAC,EAAE,EAAE;AACL,SAAC,EAAE,EAAE,EAAE;AACd,UAAI,EAAE,EAAE,CAAC,EAAE,GAAG,GAAG,EAAE;AACX,SAAC,EAAE,GAAG,GAAG,EAAE,EAAE;KACtB,CAAC;AACF,WAAO,CAAC,aAAa,CAAC,OAAO,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;GAC5C;;AAED,SAAO,mBAAmB,CAAC;CAC5B,CACF,CAAC,CAAC","file":"scenario.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('gameScenario', [\n    'http',\n    'point',\n    'line',\n    'circle',\n    function gameScenarioServiceFactory(httpService,\n                                        pointService,\n                                        lineService,\n                                        circleService) {\n      var gameScenarioService = {\n        init: function gameScenarioInit() {\n          return httpService.get('/data/scenarios.json')\n            .catch(function(reason) {\n              console.log('error getting scenarios.json', reason);\n              return [];\n            });\n        },\n        name: function gameScenarioName(scenario) {\n          return R.prop('name', scenario);\n        },\n        group: function gameScenarioGroup(group_name, groups) {\n          return R.find(R.compose(R.equals(group_name), R.head), groups);\n        },\n        forName: function gameScenarioForName(name, group) {\n          return R.find(R.propEq('name', name), group[1]);\n        },\n        groupForName: function gameScenarioGroupForName(name, groups) {\n          if(R.isNil(name)) return undefined;\n          return R.find(R.compose(R.find(R.propEq('name', name)), R.last), groups);\n        },\n        createObjectives: function gameScenarioCreateObjectives(scenario) {\n          return new self.Promise((resolve, reject) => {\n            let objectives = R.concat(\n              R.propOr([], 'objectives', scenario),\n              R.propOr([], 'flags', scenario)\n            );\n            if(R.isEmpty(objectives)) reject('No objectives');\n\n            let base = R.assoc('r', 0, R.head(objectives));\n            resolve({\n              base: R.pick(['x','y','r'], base),\n              models: R.map((objective) => {\n                return R.pipe(\n                  R.assoc('r', 0),\n                  R.assoc('info', R.concat(['scenario','models'], R.prop('info', objective))),\n                  pointService.differenceFrom$(base)\n                )(objective);\n              }, objectives)\n            });\n          });\n        },\n        isContesting: function gameScenarioIsContesting(circle, scenario) {\n          return R.exists( R.find((c) => { return isInCircle(circle, c);    },\n                                  R.propOr([], 'circle', scenario)) ||\n                           R.find((r) => { return isInRectangle(circle, r); },\n                                  R.propOr([], 'rect', scenario)) ||\n                           R.find((f) => { return isWithinFlag(circle, f);  },\n                                  R.propOr([], 'flags', scenario))\n                         );\n        },\n        isKillboxing: function gameScenarioIsKillboxing(circle, scenario) {\n          return ( R.exists(scenario.killbox) &&\n                   isInKillbox(circle, scenario.killbox)\n                 );\n        },\n      };\n      function isInCircle(circle, c) {\n        let line = {\n          start: circle,\n          end: c\n        };\n        let length = lineService.length(line);\n        return length <= (circle.radius + c.r);\n      }\n      function isWithinFlag(circle, f) {\n        let line = {\n          start: circle,\n          end: f\n        };\n        let length = lineService.length(line);\n        return length <= (circle.radius + 40 + 7.874);\n      }\n      function isInRectangle(circle, r) {\n        let box = {\n          low: { x: r.x - r.width/2,\n                 y: r.y - r.height/2 },\n          high: { x: r.x + r.width/2,\n                  y: r.y + r.height/2 }\n        };\n        return circleService.isInBox(box, circle);\n      }\n      function isInKillbox(circle, kb) {\n        let box = {\n          low: { x: kb,\n                 y: kb },\n          high: { x: 480 - kb,\n                  y: 480 - kb }\n        };\n        return !circleService.isInBox(box, circle);\n      }\n\n      return gameScenarioService;\n    }\n  ]);\n"]}