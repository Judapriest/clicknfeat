{"version":3,"sources":["../../../es6/services/game/models.js"],"names":[],"mappings":"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","file":"models.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('gameModels', [\n    'point',\n    'model',\n    function gameModelsServiceFactory(pointService,\n                                      modelService) {\n      var gameModelsService = {\n        create: function() {\n          return {\n            active: [],\n            locked: []\n          };\n        },\n        all: function modelsAll(models) {\n          return R.concat(models.active, models.locked);\n        },\n        findStamp: function modelsFindStamp(stamp, models) {\n          return new self.Promise(function(resolve, reject) {\n            var model = R.pipe(\n              gameModelsService.all,\n              R.find(R.pathEq(['state','stamp'], stamp))\n            )(models);\n            if(R.isNil(model)) reject(`Model ${stamp} not found`);\n            else resolve(model);\n          });\n        },\n        findAnyStamps: function modelsFindAnyStamps(stamps, models) {\n          return R.pipePromise(\n            R.map((stamp) => {\n              return gameModelsService.findStamp(stamp, models)\n                .catch(R.always(null));\n            }),\n            R.promiseAll,\n            (models) => {\n              if(R.isEmpty(R.reject(R.isNil, models))) {\n                return self.Promise.reject('No model found');\n              }\n              return models;\n            }\n          )(stamps);\n        },\n        findStampsBetweenPoints: function modelsFindStampBetweenPoints(top_left, bottom_right, models) {\n          return new self.Promise(function(resolve, reject) {\n            models = gameModelsService.all(models);\n            var stamps = R.pipe(\n              R.filter(modelService.isBetweenPoints$(top_left, bottom_right)),\n              R.map(R.path(['state','stamp']))\n            )(models);\n            if(R.isEmpty(stamps)) reject('No model found between points');\n            else resolve(stamps);\n          });\n        },\n        fromStamps: function modelsFromStamps(method, args, stamps, models) {\n          return fromStamps$(R.compose(R.always, R.always(null)),\n                             method, args, stamps, models);\n        },\n        onStamps: function modelsOnStamps(method, args, stamps, models) {\n          return R.pipeP(\n            fromStamps$(R.always, method, args, stamps),\n            updateModels$(models)\n          )(models);\n        },\n        setStateStamps: function modelsSetStateStamps(states, stamps, models) {\n          return R.pipeP(\n            gameModelsService.findAnyStamps$(stamps),\n            R.addIndex(R.map)((model, index) => {\n              return ( R.isNil(model) ?\n                       null :\n                       modelService.setState(states[index], model)\n                     );\n            }),\n            R.reject(R.isNil),\n            updateModels$(models)\n          )(models);\n        },\n        lockStamps: function modelsLockStamps(lock, stamps, models) {\n          return R.pipeP(\n            gameModelsService.findAnyStamps$(stamps),\n            R.reject(R.isNil),\n            R.map(modelService.setLock$(lock)),\n            updateModels$(models)\n          )(models);\n        },\n        add: function modelsAdd(mods, models) {\n          return R.pipe(\n            gameModelsService.removeStamps$(R.map(R.path(['state','stamp']), mods)),\n            (models) => {\n              return R.assoc('active', R.concat(models.active, mods), models);\n            }\n          )(models);\n        },\n        removeStamps: function modelsRemoveStamps(stamps, models) {\n          function inStamps(model) {\n            return R.find(R.equals(R.path(['state', 'stamp'], model)), stamps);\n          }\n          return R.pipe(\n            R.assoc('active', R.reject(inStamps, models.active)),\n            R.assoc('locked', R.reject(inStamps, models.locked))\n          )(models);\n        },\n        modeForStamp: function modelsModeForStamp(stamp, models) {\n          return R.pipeP(\n            () => {\n              return gameModelsService.findStamp(stamp, models);\n            },\n            modelService.modeFor$\n          )();\n        },\n        copyStamps: function modelsCopyStamps(stamps, models) {\n          return R.pipeP(\n            gameModelsService.findAnyStamps$(stamps),\n            R.reject(R.isNil),\n            (selection) => {\n              var base = R.pick(['x','y','r'], selection[0].state);\n\n              return {\n                base: base,\n                models: R.map(R.compose(pointService.differenceFrom$(base),\n                                        modelService.saveState),\n                              selection)\n              };\n            }\n          )(models);\n        }\n      };\n      var fromStamps$ = R.curry((onError, method, args, stamps, models) => {\n        if('Function' !== R.type(modelService[method])) {\n          return self.Promise.reject(`Unknown method ${method} on models`);\n        }\n          \n        return R.pipeP(\n          gameModelsService.findAnyStamps$(stamps),\n          R.reject(R.isNil),\n          R.map((model) => {\n            return self.Promise\n              .resolve(modelService[method].apply(null, [...args, model]))\n              .catch(onError(model));\n          }),\n          R.promiseAll\n        )(models);\n      });\n      var updateModels$ = R.curry((models, news) => {\n        return R.pipe(\n          gameModelsService.all,\n          R.concat(news),\n          R.uniqBy(R.path(['state','stamp'])),\n          R.partition(modelService.isLocked),\n          ([locked, active]) => {\n            return {\n              active: active,\n              locked: locked\n            };\n          }\n        )(models);\n      });\n      R.curryService(gameModelsService);\n      return gameModelsService;\n    }\n  ]);\n"]}