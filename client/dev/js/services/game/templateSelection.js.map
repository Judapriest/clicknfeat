{"version":3,"sources":["../../../es6/services/game/templateSelection.js"],"names":[],"mappings":"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","file":"templateSelection.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('gameTemplateSelection', [\n    'modes',\n    'gameTemplates',\n    function gameTemplateSelectionServiceFactory(modesService,\n                                                 gameTemplatesService) {\n      function checkSelection(where, state) {\n        if('local' === where) {\n          state.event('Modes.switchTo', 'Default');\n          state.changeEvent('Game.template.selection.local.change');\n        }\n      }\n      var gameTemplateSelectionService = {\n        create: function templateSelectionCreate() {\n          return {\n            local: [],\n            remote: []\n          };\n        },\n        'in': function templateSelectionIn(where, stamp, selection) {\n          var stamps = R.prop(where, selection);\n          return R.find(R.equals(stamp), stamps);\n        },\n        get: function templateSelectionGet(where, selection) {\n          return R.propOr([], where, selection);\n        },\n        checkMode: function templateSelectionCheckMode(state, selection) {\n          return R.pipePromise(\n            gameTemplateSelectionService.get$('local'),\n            R.head,\n            (stamp) => {\n              if(R.isNil(stamp)) {\n                return self.Promise.reject('No template selection');\n              }\n\n              return R.pipeP(\n                gameTemplatesService.modeForStamp$(stamp),\n                (mode) => {\n                  return state.event('Modes.switchTo', mode);\n                }\n              )(state.game.templates);\n            }\n          )(selection);\n        },\n        set: function templateSelectionSet(where, stamps, state, selection) {\n          var previous = gameTemplateSelectionService.get(where, selection);\n          var ret = R.assoc(where, stamps, selection);\n\n          checkSelection(where, state);\n          \n          R.forEach((stamp) => {\n            state.changeEvent(`Game.template.change.${stamp}`);\n          }, stamps);\n          R.forEach((stamp) => {\n            state.changeEvent(`Game.template.change.${stamp}`);\n          }, previous);\n\n          return ret;\n        },\n        removeFrom: function templateSelectionRemoveFrom(where, stamps, state, selection) {\n          var previous = R.prop(where, selection);\n          var new_selection = R.difference(previous, stamps);\n          var ret = R.assoc(where, new_selection, selection);\n          \n          checkSelection(where, state);\n\n          R.forEach((stamp) => {\n            state.changeEvent(`Game.template.change.${stamp}`);\n          }, R.uniq(R.concat(previous, stamps)));\n\n          return ret;\n        },\n        clear: function templateSelectionClear(where, state, selection) {\n          var previous = R.prop(where, selection);\n          return gameTemplateSelectionService\n            .removeFrom(where, previous, state, selection);\n        }\n      };\n      R.curryService(gameTemplateSelectionService);\n      return gameTemplateSelectionService;\n    }\n  ]);\n"]}