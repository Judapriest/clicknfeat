{"version":3,"sources":["../../../es6/services/game/modelSelection.js"],"names":[],"mappings":"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","file":"modelSelection.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('gameModelSelection', [\n    'modes',\n    'gameModels',\n    function gameModelSelectionServiceFactory(modesService,\n                                              gameModelsService) {\n      var gameModelSelectionService = {\n        create: function modelSelectionCreate() {\n          return {\n            local: [],\n            remote: [],\n          };\n        },\n        'in': function modelSelectionIn(where, stamp, selection) {\n          var stamps = R.prop(where, selection);\n          return R.find(R.equals(stamp), stamps);\n        },\n        inSingle: function modelSelectionInSingle(where, stamp, selection) {\n          var stamps = R.prop(where, selection);\n          return ( R.length(stamps) === 1 &&\n                   stamps[0] === stamp );\n        },\n        get: function modelSelectionGet(where, selection) {\n          return R.pipe(\n            R.defaultTo({}),\n            R.propOr([], where)\n          )(selection);\n        },\n        modeFor: function(models, selection) {\n          var local = gameModelSelectionService.get('local', selection);\n          if(R.isEmpty(local)) {\n            return self.Promise.reject('No model selection');\n          }\n          if(R.length(local) === 1) {\n            return gameModelsService.modeForStamp(local[0], models);\n          }\n          return 'Models';\n        },\n        checkMode: function modelSelectionCheckMode(scope, selection) {\n          return self.Promise.resolve(gameModelSelectionService\n                                      .modeFor(scope.game.models, selection))\n            .then(function(mode) {\n              return scope.doSwitchToMode(mode);\n            });\n        },\n        set: function modelSelectionSet(where, stamps, scope, selection) {\n          var previous = gameModelSelectionService.get(where, selection);\n          var ret = R.assoc(where, stamps, selection);\n\n          if('local' === where) {\n            scope.doSwitchToMode('Default');\n            checkSingleSelection(scope, ret);\n          }\n          \n          R.forEach(function(stamp) {\n            scope.gameEvent('changeModel-'+stamp);\n          }, stamps);\n          R.forEach(function(stamp) {\n            scope.gameEvent('changeModel-'+stamp);\n          }, previous);\n\n          return ret;\n        },\n        addTo: function modelSelectionSet(where, stamps, scope, selection) {\n          var previous = gameModelSelectionService.get(where, selection);\n          var new_selection = R.uniq(R.concat(previous, stamps));\n          var ret = R.assoc(where, new_selection, selection);\n\n          if('local' === where) {\n            scope.doSwitchToMode('Default');\n            checkSingleSelection(scope, ret);\n          }\n          \n          R.forEach(function(stamp) {\n            scope.gameEvent('changeModel-'+stamp);\n          }, new_selection);\n\n          return ret;\n        },\n        removeFrom: function modelSelectionRemoveFrom(where, stamps, scope, selection) {\n          var previous = R.prop(where, selection);\n          var new_selection = R.difference(previous, stamps);\n          var ret = R.assoc(where, new_selection, selection);\n          \n          if('local' === where) {\n            scope.doSwitchToMode('Default');\n            checkSingleSelection(scope, ret);\n          }\n\n          R.forEach(function(stamp) {\n            scope.gameEvent('changeModel-'+stamp);\n          }, R.uniq(R.concat(previous, stamps)));\n\n          return ret;\n        },\n        clear: function modelSelectionClear(where, stamps, scope, selection) {\n          var previous = R.prop(where, selection);\n          return gameModelSelectionService.removeFrom(where, previous, scope, selection);\n        },\n      };\n      function checkSingleSelection(scope, selection) {\n        if(1 !== R.length(R.prop('local', selection))) {\n          scope.gameEvent('disableSingleModelSelection');\n        }\n      }\n      R.curryService(gameModelSelectionService);\n      return gameModelSelectionService;\n    }\n  ]);\n"]}