{"version":3,"sources":["../../../es6/services/game/ruler.js"],"names":[],"mappings":"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","file":"ruler.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('gameRuler', [\n    'point',\n    'model',\n    'gameModels',\n    function gameRulerServiceFactory(pointService,\n                                     modelService,\n                                     gameModelsService) {\n      var gameRulerService = {\n        create: function gameRulerCreate() {\n          return {\n            local: {\n              display: false,\n              start: { x: 0, y: 0 },\n              end: { x: 0, y: 0 },\n              length: null\n            },\n            remote: {\n              display: false,\n              start: { x: 0, y: 0 },\n              end: { x: 0, y: 0 },\n              length: null\n            }\n          };\n        },\n        isDisplayed: function gameRulerIsDisplayed(ruler) {\n          return R.path(['remote','display'], ruler);\n        },\n        maxLength: function gameRulerMaxLength(ruler) {\n          return R.pathOr(0, ['remote','max'], ruler);\n        },\n        setMaxLength: function gameRulerSetMaxLength(length, state, ruler) {\n          ruler = R.pipe(\n            R.assocPath(['local', 'max'], length),\n            R.assocPath(['remote', 'max'], length)\n          )(ruler);\n          return setupRemoteRuler(state, ruler);\n        },\n        origin: function gameRulerOrigin(ruler) {\n          return R.path(['remote', 'origin'], ruler);\n        },\n        clearOrigin: function gameRulerClearOrigin(state, ruler) {\n          return setOriginTarget(null,\n                                 ruler.remote.target,\n                                 ruler.remote.max,\n                                 state, ruler);\n        },\n        setOrigin: function gameRulerSetOrigin(origin_model, state, ruler) {\n          var origin = origin_model.state.stamp;\n          var target = gameRulerService.target(ruler);\n          target = (target === origin) ? null : target;\n          var max_length = modelService.rulerMaxLength(origin_model);\n          return setOriginTarget(origin, target, max_length, state, ruler);\n        },\n        setOriginResetTarget: function gameRulerSetOrigin(origin_model, state, ruler) {\n          var origin = origin_model.state.stamp;\n          var max_length = modelService.rulerMaxLength(origin_model);\n          return setOriginTarget(origin, null, max_length, state, ruler);\n        },\n        target: function gameRulerTarget(ruler) {\n          return R.path(['remote', 'target'], ruler);\n        },\n        targetReached: function gameRulerTargetReached(ruler) {\n          return R.path(['remote', 'reached'], ruler);\n        },\n        clearTarget: function gameRulerClearTarget(state, ruler) {\n          return setOriginTarget(ruler.remote.origin,\n                                 null,\n                                 null,\n                                 state, ruler);\n        },\n        setTarget: function gameRulerSetTarget(target_model, state, ruler) {\n          var origin = gameRulerService.origin(ruler);\n          var target = target_model.state.stamp;\n          origin = (origin === target) ? null : origin;\n          return setOriginTarget(origin, target, null, state, ruler);\n        },\n        updateOriginTarget: function gameRulerUpdateOriginTarget(state, ruler) {\n          return setupRemoteRuler(state, ruler);\n        },\n        toggleDisplay: function gameRulerToggleDisplay(state, ruler) {\n          var path = ['remote','display'];\n          ruler = R.assocPath(path, !R.path(path, ruler), ruler);\n          state.changeEvent('Game.ruler.remote.change');\n          return ruler;\n        },\n        setLocal: function gameRulerSetLocal(start, end, state, ruler) {\n          return R.pipe(\n            R.prop('local'),\n            R.assoc('start', R.clone(start)),\n            enforceEndToMaxLength(end),\n            R.assoc('length', null),\n            R.assoc('display', true),\n            (local) => {\n              state.changeEvent('Game.ruler.local.change');\n\n              return R.assoc('local', local, ruler);\n            }\n          )(ruler);\n        },\n        setRemote: function gameRulerSetRemote(start, end, state, ruler) {\n          ruler = R.assocPath(['local','display'], false, ruler);          \n          state.changeEvent('Game.ruler.local.change');\n\n          let remote = R.pipe(\n            R.assoc('origin', null),\n            R.assoc('target', null),\n            R.assoc('start', R.clone(start)),\n            R.assoc('end', R.clone(end)),\n            R.assoc('display', true)\n          )(ruler.remote);\n          ruler = R.assoc('remote', remote, ruler);\n          \n          return setupRemoteRuler(state, ruler);\n        },\n        saveRemoteState: function gameRulerSaveRemoteState(ruler) {\n          return R.clone(R.prop('remote', ruler));\n        },\n        resetRemote: function gameRulerResetRemote(remote, state, ruler) {\n          var ret = R.assoc('remote', R.clone(remote), ruler);\n          state.changeEvent('Game.ruler.remote.change');\n          return ret;\n        },\n        targetAoEPosition: function gameRulerTargetAoEPosition(models, ruler) {\n          var dir = pointService.directionTo(ruler.remote.end, ruler.remote.start);\n          var max = ruler.remote.length / 2;\n          var end = ruler.remote.end;\n          var target = gameRulerService.target(ruler);\n          return R.pipePromise(\n            (end) => {\n              if( R.exists(target) &&\n                  gameRulerService.targetReached(ruler) ) {\n                return R.pipeP(\n                  gameModelsService.findStamp$(target),\n                  R.prop('state')\n                )(models);\n              }\n              return end;\n            },\n            R.pick(['x', 'y']),\n            R.assoc('r', dir),\n            R.assoc('m', max)\n          )(end);\n        }\n      };\n      var enforceEndToMaxLength = R.curry(function _enforceEndToMaxLength(end, ruler) {\n        var length = pointService.distanceTo(end, ruler.start);\n        var dir = pointService.directionTo(end, ruler.start);\n        var max = 10 * R.defaultTo(length/10, ruler.max);\n        length = Math.min(length, max);\n        end = pointService.translateInDirection(length, dir, ruler.start);\n        return R.assoc('end', end, ruler);\n      });\n      function setOriginTarget(origin, target, max_length, state, ruler) {\n        var display = R.exists(origin) && R.exists(target);\n        ruler = R.assoc('remote', R.pipe(\n          R.assoc('origin', origin),\n          R.assoc('target', target),\n          R.assoc('display', display),\n          (remote) => {\n            if(R.exists(max_length)) {\n              return R.assoc('max', max_length, remote);\n            }\n            return remote;\n          }\n        )(ruler.remote), ruler);\n        return setupRemoteRuler(state, ruler);\n      }\n      function setupRemoteRuler(state, ruler) {\n        return R.pipeP(\n          () => {\n            var origin = R.path(['remote','origin'], ruler);\n            if(R.exists(origin)) {\n              return gameModelsService.findStamp(origin, state.game.models)\n                .catch(R.always(null));\n            }\n            return self.Promise.resolve(null);\n          },\n          (origin_model) => {\n            return R.pipeP(\n              () => {\n                var target = R.path(['remote','target'], ruler);\n                if(R.exists(target)) {\n                  return gameModelsService.findStamp(target, state.game.models)\n                    .catch(R.always(null));\n                }\n                return self.Promise.resolve(null);\n              },\n              (target_model) => {\n                if(R.exists(origin_model) &&\n                   R.exists(target_model)) {\n                  return modelService.shortestLineTo(state.factions,\n                                                     target_model,\n                                                     origin_model);\n                }\n                if(R.exists(origin_model)) {\n                  return {\n                    start: R.pick(['x','y'], origin_model.state),\n                    end: R.pick(['x','y'], origin_model.state)\n                  };\n                }\n                if(R.exists(target_model)) {\n                  return {\n                    start: R.pick(['x','y'], target_model.state),\n                    end: R.pick(['x','y'], target_model.state)\n                  };\n                }\n                return R.pick(['start', 'end'], R.prop('remote', ruler));\n              },\n              ({ start, end }) => {\n                var models_dist = pointService.distanceTo(end, start);\n                ruler = R.over(R.lensProp('remote'), R.pipe(\n                  R.assoc('start', start),\n                  enforceEndToMaxLength(end),\n                  (remote) => {\n                    var ruler_length = pointService.distanceTo(remote.end, remote.start);\n                    return R.pipe(\n                      R.assoc('reached', ruler_length >= models_dist - 0.1),\n                      R.assoc('length', Math.round(ruler_length * 10) / 100)\n                    )(remote);\n                  }\n                ), ruler);\n\n                state.changeEvent('Game.ruler.remote.change');\n\n                return ruler;\n              }\n            )();\n          }\n        )();\n      }\n      R.curryService(gameRulerService);\n      return gameRulerService;\n    }\n  ]);\n"]}