{"version":3,"sources":["../../es6/services/model.js"],"names":[],"mappings":"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","file":"model.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('model', [\n    'settings',\n    'point',\n    'gameFactions',\n    'modelArea',\n    'modelAura',\n    'modelCharge',\n    'modelCounter',\n    'modelDamage',\n    'modelEffect',\n    'modelGeom',\n    'modelImage',\n    'modelIncorporeal',\n    'modelLabel',\n    'modelLeader',\n    'modelMelee',\n    'modelMove',\n    'modelPlace',\n    'modelRuler',\n    'modelUnit',\n    'modelWreck',\n    function modelServiceFactory(settingsService,\n                                 pointService,\n                                 gameFactionsService,\n                                 modelAreaService,  \n                                 modelAuraService,  \n                                 modelChargeService,  \n                                 modelCounterService,  \n                                 modelDamageService, \n                                 modelEffectService,  \n                                 modelGeomService,  \n                                 modelImageService,\n                                 modelIncorporealService,\n                                 modelLabelService,\n                                 modelLeaderService,\n                                 modelMeleeService,\n                                 modelMoveService,\n                                 modelPlaceService,\n                                 modelRulerService,\n                                 modelUnitService,\n                                 modelWreckService) {\n      let DEFAULT_MOVES = {\n        Move: 10,\n        MoveSmall: 5,\n        Rotate: 15,\n        RotateSmall: 5,\n        Shift: 10,\n        ShiftSmall: 1,\n        RotateCharge: 10,\n        RotateChargeSmall: 2\n      };\n      let MOVES = R.clone(DEFAULT_MOVES);\n      settingsService.register('Moves',\n                               'Model',\n                               DEFAULT_MOVES,\n                               (moves) => {\n                                 R.extend(MOVES, moves);\n                               });\n      var modelService = {\n        create: function modelCreate(factions, temp) {\n          return R.pipeP(\n            gameFactionsService.getModelInfo$(temp.info),\n            (info) => {\n              let model = {\n                state: {\n                  x: 0, y: 0, r: 0,\n                  img: 0,\n                  dsp: ['i'],\n                  eff: [],\n                  l: [],\n                  c: 0, s: 0,\n                  u: null,\n                  aur: null,\n                  are: null,\n                  rml: null,\n                  cml: null,\n                  pml: [null,false],\n                  cha: null,\n                  pla: null,\n                  dmg: initDamage(info.damage),\n                  stamp: R.guid()\n                }\n              };\n              if(info.type === 'wardude' ||\n                 info.type === 'beast' ||\n                 info.type === 'jack') {\n                model.state.dsp = R.append('c', model.state.dsp);\n              }\n              if(info.immovable) {\n                model.state.dsp = R.append('lk', model.state.dsp);\n              }\n              model.state = R.deepExtend(model.state, temp);\n              return modelService.checkState(factions, null, model);\n            }\n          )(factions);\n        },\n        stamp: function modelStamp(model) {\n          return R.path(['state','stamp'], model);\n        },\n        eventName: function modelEventName(model) {\n          return R.path(['state','stamp'], model);\n        },\n        user: function modelUser(model) {\n          return R.path(['state', 'user'], model);\n        },\n        userIs: function modelUser(user, model) {\n          return R.pathEq(['state', 'user'], user, model);\n        },\n        state: function modelState(model) {\n          return R.prop('state', model);\n        },\n        saveState: function modelSaveState(model) {\n          return R.clone(R.prop('state', model));\n        },\n        setState: function modelSetState(state, model) {\n          return R.assoc('state', R.clone(state), model);\n        },\n        state_checkers: [],\n        state_updaters: [],\n        checkState: function modelCheckState(factions, target, model) {\n          return R.pipeP(\n            gameFactionsService.getModelInfo$(model.state.info),\n            (info) => {\n              var radius = info.base_radius;\n              return R.pipe(\n                R.assoc('x', Math.max(0+radius, Math.min(480-radius, model.state.x))),\n                R.assoc('y', Math.max(0+radius, Math.min(480-radius, model.state.y))),\n                (state) => {\n                  return R.reduce((state, checker) => {\n                    return checker(info, target, state);\n                  }, state, modelService.state_checkers);\n                },\n                (state) => {\n                  return R.reduce(function(state, updater) {\n                    return updater(state);\n                  }, state, modelService.state_updaters);\n                }\n              )(model.state);\n            },\n            (state) => {\n              return R.assoc('state', state, model);\n            }\n          )(factions);\n        },\n        isLocked: function modelIsLocked(model) {\n          return R.pipe(\n            R.pathOr([], ['state', 'dsp']),\n            R.find(R.equals('lk')),\n            R.exists\n          )(model);\n        },\n        setLock: function modelSetLock(set, model) {\n          if(set) {\n            return R.over(R.lensPath(['state','dsp']),\n                          R.compose(R.uniq, R.append('lk')),\n                          model);\n          }\n          else {\n            return R.over(R.lensPath(['state','dsp']),\n                          R.reject(R.equals('lk')),\n                          model);\n          }\n        },\n        modeFor: function modelModeFor(model) {\n          if(modelService.isCharging(model)) {\n            return 'ModelCharge';\n          }\n          if(modelService.isPlacing(model)) {\n            return 'ModelPlace';\n          }\n          return 'Model';\n        },\n        descriptionFromInfo: function modelDescriptionFromInfo(info, model) {\n          return R.pipe(\n            R.props(['unit_name', 'name']),\n            R.prepend(modelService.user(model)),\n            R.reject(R.isNil),\n            R.join('/')\n          )(info);\n        }\n      };\n      function initDamage(info) {\n        if(info.type === 'warrior') {\n          return { n: 0, t: 0 };\n        }\n        return R.pipe(\n          R.keys,\n          R.reject(R.equals('type')),\n          R.reject(R.equals('field')),\n          R.reject(R.equals('total')),\n          R.reject(R.equals('depth')),\n          R.reduce(function(mem, key) {\n            return R.assoc(key, R.map(R.always(0), info[key]), mem);\n          }, {}),\n          R.assoc('f', 0),\n          R.assoc('t', 0)\n        )(info);\n      }\n      R.extend(\n        modelService,\n        modelAreaService(modelService),\n        modelAuraService(modelService),\n        modelChargeService(MOVES, modelService),\n        modelCounterService(modelService),\n        modelDamageService(modelService),\n        modelEffectService(modelService),\n        modelGeomService(modelService),\n        modelImageService(modelService),\n        modelIncorporealService(modelService),\n        modelLabelService(modelService),\n        modelLeaderService(modelService),\n        modelPlaceService(MOVES, modelService),\n        modelMeleeService(modelService),\n        modelMoveService(MOVES, modelService),\n        modelRulerService(modelService),\n        modelUnitService(modelService),\n        modelWreckService(modelService)\n      );\n      R.curryService(modelService);\n      return modelService;\n    }\n  ]);\n"]}