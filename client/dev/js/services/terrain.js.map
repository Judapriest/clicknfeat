{"version":3,"sources":["../../es6/services/terrain.js"],"names":[],"mappings":"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","file":"terrain.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('terrain', [\n    'settings',\n    'point',\n    function terrainServiceFactory(settingsService,\n                                   pointService) {\n      var DEFAULT_MOVES = {\n        Move: 10,\n        MoveSmall: 1,\n        Rotate: 15,\n        RotateSmall: 5,\n        Shift: 10,\n        ShiftSmall: 1,\n      };\n      var MOVES = R.clone(DEFAULT_MOVES);\n      settingsService.register('Moves',\n                               'Terrain',\n                               DEFAULT_MOVES,\n                               function(moves) {\n                                 R.extend(MOVES, moves);\n                               });\n      var terrainService = {\n        create: function terrainCreate(temp) {\n          var terrain = {\n            state: {\n              x: 0, y: 0, r: 0,\n              lk: false,\n              stamp: R.guid()\n            }\n          };\n          terrain.state = R.deepExtend(terrain.state, temp);\n          return terrainService.checkState(terrain);\n        },\n        stamp: function terrainStamp(terrain) {\n          return R.path(['state','stamp'], terrain);\n        },\n        eventName: function terrainEventName(terrain) {\n          return R.path(['state','stamp'], terrain);\n        },\n        state: function terrainState(terrain) {\n          return R.prop('state', terrain);\n        },\n        saveState: function terrainSaveState(terrain) {\n          return R.clone(R.prop('state', terrain));\n        },\n        setState: function terrainSetState(state, terrain) {\n          terrain.state = R.clone(state);\n        },\n        checkState: function terrainCheckState(terrain) {\n          terrain.state = R.pipe(\n            R.assoc('x', Math.max(0, Math.min(480, terrain.state.x))),\n            R.assoc('y', Math.max(0, Math.min(480, terrain.state.y)))\n          )(terrain.state);\n          return terrain;\n        },\n        isLocked: function terrainIsLocked(terrain) {\n          return R.path(['state', 'lk'], terrain);\n        },\n        setLock: function terrainSetLock(set, terrain) {\n          terrain.state = R.assoc('lk', set, terrain.state);\n          return terrain;\n        },\n        setPosition: function terrainSet(pos, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          \n          terrain.state = R.pipe(\n            R.assoc('x', pos.x),\n            R.assoc('y', pos.y)\n          )(terrain.state);\n          return terrainService.checkState(terrain);\n        },\n        shiftPosition: function terrainSet(shift, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n\n          terrain.state = R.pipe(\n            R.assoc('x', terrain.state.x + shift.x),\n            R.assoc('y', terrain.state.y + shift.y)\n          )(terrain.state);\n          return terrainService.checkState(terrain);\n        },\n        setOrientation: function terrainSet(orientation, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n\n          terrain.state = R.assoc('r', orientation, terrain.state);\n          return terrainService.checkState(terrain);\n        },\n        moveFront: function terrainMoveFront(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n\n          var dist = MOVES[small ? 'MoveSmall' : 'Move'];\n          terrain.state = pointService.moveFront(dist, terrain.state);\n          return terrainService.checkState(terrain);\n        },\n        moveBack: function terrainMoveBack(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n\n          var dist = MOVES[small ? 'MoveSmall' : 'Move'];\n          terrain.state = pointService.moveBack(dist, terrain.state);\n          return terrainService.checkState(terrain);\n        },\n        rotateLeft: function terrainRotateLeft(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n\n          var angle = MOVES[small ? 'RotateSmall' : 'Rotate'];\n          terrain.state = pointService.rotateLeft(angle, terrain.state);\n          return terrainService.checkState(terrain);\n        },\n        rotateRight: function terrainRotateRight(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n\n          var angle = MOVES[small ? 'RotateSmall' : 'Rotate'];\n          terrain.state = pointService.rotateRight(angle, terrain.state);\n          return terrainService.checkState(terrain);\n        },\n        shiftLeft: function terrainShiftLeft(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n\n          var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n          terrain.state = pointService.shiftLeft(dist, terrain.state);\n          return terrainService.checkState(terrain);\n        },\n        shiftRight: function terrainShiftRight(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n\n          var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n          terrain.state = pointService.shiftRight(dist, terrain.state);\n          return terrainService.checkState(terrain);\n        },\n        shiftUp: function terrainShiftUp(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n\n          var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n          terrain.state = pointService.shiftUp(dist, terrain.state);\n          return terrainService.checkState(terrain);\n        },\n        shiftDown: function terrainShiftDown(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n\n          var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n          terrain.state = pointService.shiftDown(dist, terrain.state);\n          return terrainService.checkState(terrain);\n        },\n      };\n      R.curryService(terrainService);\n      return terrainService;\n    }\n  ]);\n"]}