{"version":3,"sources":["../../es6/services/terrain.js"],"names":[],"mappings":"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","file":"terrain.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('terrain', [\n    'settings',\n    'point',\n    function terrainServiceFactory(settingsService,\n                                   pointService) {\n      let DEFAULT_MOVES = {\n        Move: 10,\n        MoveSmall: 1,\n        Rotate: 15,\n        RotateSmall: 5,\n        Shift: 10,\n        ShiftSmall: 1\n      };\n      let MOVES = R.clone(DEFAULT_MOVES);\n      settingsService.register('Moves',\n                               'Terrain',\n                               DEFAULT_MOVES,\n                               (moves) => {\n                                 R.extend(MOVES, moves);\n                               });\n      var terrainService = {\n        create: function terrainCreate(temp) {\n          var terrain = {\n            state: {\n              x: 0, y: 0, r: 0,\n              lk: false,\n              stamp: R.guid()\n            }\n          };\n          terrain.state = R.deepExtend(terrain.state, temp);\n          return terrainService.checkState(terrain);\n        },\n        stamp: function terrainStamp(terrain) {\n          return R.path(['state','stamp'], terrain);\n        },\n        eventName: function terrainEventName(terrain) {\n          return R.path(['state','stamp'], terrain);\n        },\n        state: function terrainState(terrain) {\n          return R.prop('state', terrain);\n        },\n        saveState: function terrainSaveState(terrain) {\n          return R.clone(R.prop('state', terrain));\n        },\n        setState: function terrainSetState(state, terrain) {\n          return R.assoc('state', R.clone(state), terrain);\n        },\n        checkState: function terrainCheckState(terrain) {\n          return R.pipe(\n            R.over(R.lensPath(['state','x']),\n                   R.compose(R.max(0), R.min(480))),\n            R.over(R.lensPath(['state','y']),\n                   R.compose(R.max(0), R.min(480)))\n          )(terrain);\n        },\n        isLocked: function terrainIsLocked(terrain) {\n          return R.path(['state', 'lk'], terrain);\n        },\n        setLock: function terrainSetLock(set, terrain) {\n          return R.assocPath(['state','lk'], set, terrain);\n        },\n        setPosition: function terrainSet(pos, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }          \n          return R.pipe(\n            R.assocPath(['state','x'], pos.x),\n            R.assocPath(['state','y'], pos.y),\n            terrainService.checkState\n          )(terrain);\n        },\n        shiftPosition: function terrainSet(shift, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          return R.pipe(\n            R.assocPath(['state','x'], terrain.state.x + shift.x),\n            R.assocPath(['state','y'], terrain.state.y + shift.y),\n            terrainService.checkState\n          )(terrain);\n        },\n        setOrientation: function terrainSet(orientation, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          return R.pipe(\n            R.assocPath(['state','r'], orientation, terrain),\n            terrainService.checkState\n          )(terrain);\n        },\n        moveFront: function terrainMoveFront(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var dist = MOVES[small ? 'MoveSmall' : 'Move'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.moveFront$(dist)),\n            terrainService.checkState\n          )(terrain);\n        },\n        moveBack: function terrainMoveBack(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var dist = MOVES[small ? 'MoveSmall' : 'Move'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.moveBack$(dist)),\n            terrainService.checkState\n          )(terrain);\n        },\n        rotateLeft: function terrainRotateLeft(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var angle = MOVES[small ? 'RotateSmall' : 'Rotate'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.rotateLeft$(angle)),\n            terrainService.checkState\n          )(terrain);\n        },\n        rotateRight: function terrainRotateRight(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var angle = MOVES[small ? 'RotateSmall' : 'Rotate'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.rotateRight$(angle)),\n            terrainService.checkState\n          )(terrain);\n        },\n        shiftLeft: function terrainShiftLeft(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.shiftLeft$(dist)),\n            terrainService.checkState\n          )(terrain);\n        },\n        shiftRight: function terrainShiftRight(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.shiftRight$(dist)),\n            terrainService.checkState\n          )(terrain);\n        },\n        shiftUp: function terrainShiftUp(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.shiftUp$(dist)),\n            terrainService.checkState\n          )(terrain);\n        },\n        shiftDown: function terrainShiftDown(small, terrain) {\n          if(terrainService.isLocked(terrain)) {\n            return self.Promise.reject('Terrain is locked');\n          }\n          var dist = MOVES[small ? 'ShiftSmall' : 'Shift'];\n          return R.pipe(\n            R.over(R.lensProp('state'),\n                   pointService.shiftDown$(dist)),\n            terrainService.checkState\n          )(terrain);\n        }\n      };\n      R.curryService(terrainService);\n      return terrainService;\n    }\n  ]);\n"]}