{"version":3,"sources":["../../../es6/services/modes/aoeTemplate.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,OAAO,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAChC,OAAO,CAAC,iBAAiB,EAAE,CAC1B,OAAO,EACP,UAAU,EACV,cAAc,EACd,MAAM,EACN,eAAe,EACf,uBAAuB,EACvB,WAAW,EACX,QAAQ,EACR,SAAS,6BAA6B,CAAC,YAAY,EACZ,eAAe,EACf,mBAAmB,EACnB,WAAW,EACX,oBAAoB,EACpB,4BAA4B,EAC5B,gBAAgB,EAChB,aAAa,EAAE;AACpD,MAAI,gBAAgB,GAAG,MAAM,CAAC,MAAM,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;AAClE,kBAAgB,CAAC,QAAQ,GAAG,SAAS,QAAQ,CAAC,KAAK,EAAE;AACnD,QAAI,MAAM,GAAG,4BAA4B,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACtF,WAAO,WAAW,CAAC,cAAc,CAAC,aAAa,EAAE,SAAS,EAAE,CAAC,EAC3B,MAAM,EAAE,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;GAC9D,CAAC;AACF,kBAAgB,CAAC,QAAQ,GAAG,SAAS,QAAQ,CAAC,KAAK,EAAE;AACnD,QAAI,MAAM,GAAG,4BAA4B,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACtF,WAAO,WAAW,CAAC,cAAc,CAAC,aAAa,EAAE,SAAS,EAAE,CAAC,EAC3B,MAAM,EAAE,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;GAC9D,CAAC;AACF,kBAAgB,CAAC,QAAQ,GAAG,SAAS,QAAQ,CAAC,KAAK,EAAE;AACnD,QAAI,MAAM,GAAG,4BAA4B,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACtF,WAAO,WAAW,CAAC,cAAc,CAAC,aAAa,EAAE,SAAS,EAAE,CAAC,EAC3B,MAAM,EAAE,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;GAC9D,CAAC;AACF,kBAAgB,CAAC,cAAc,GAAG,SAAS,iBAAiB,CAAC,KAAK,EAAE,KAAK,EAAE;AACzE,QAAI,MAAM,GAAG,4BAA4B,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACtF,WAAO,WAAW,CAAC,cAAc,CAAC,aAAa,EACb,WAAW,EAAE,KAAK,CAAC,QAAQ,EAAE,IAAI,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC,MAAM,EACzD,MAAM,EAAE,KAAK,EAAG,KAAK,CAAC,IAAI,CAAC,CAAC;GAC/D,CAAC;AACF,kBAAgB,CAAC,eAAe,GAAG,SAAS,oBAAoB,CAAC,KAAK,EAAE;AACtE,QAAI,MAAM,GAAG,4BAA4B,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACtF,WAAO,CAAC,CAAC,KAAK,CACZ,YAAW;AACT,aAAO,oBAAoB,CAAC,SAAS,CAAC,cAAc,EAAE,MAAM,EAAE,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;KACrF,EACD,UAAS,KAAK,EAAE;AACd,UAAI,GAAG,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;AACnB,aAAO,aAAa,CAAC,MAAM,CAAC,QAAQ,EAAE,yBAAyB,EAAE,GAAG,CAAC,CAClE,KAAK,CAAC,UAAS,KAAK,EAAE;AACrB,eAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AACnB,eAAO,IAAI,CAAC;OACb,CAAC,CAAC;KACN,EACD,UAAS,KAAK,EAAE;AACd,WAAK,GAAG,AAAC,KAAK,KAAK,CAAC,GAAI,IAAI,GAAG,KAAK,CAAC;AACrC,aAAO,oBAAoB,CACxB,QAAQ,CAAC,iBAAiB,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;KACrE,CACF,EAAE,CAAC;GACL,CAAC;AACF,kBAAgB,CAAC,OAAO,GAAG,SAAS,UAAU,CAAC,KAAK,EAAE;AACpD,QAAI,MAAM,GAAG,4BAA4B,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACtF,WAAO,CAAC,CAAC,KAAK,CACZ,YAAW;AACT,aAAO,WAAW,CAAC,eAAe,CAAC,eAAe,EAAE,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;KACxE,EACD,UAAS,SAAS,EAAE;AAClB,aAAO,WAAW,CAAC,cAAc,CAAC,aAAa,EAAE,SAAS,EACxB,SAAS,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC,EACxB,MAAM,EAAE,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;KAC9D,CACF,EAAE,CAAC;GACL,CAAC;AACF,kBAAgB,CAAC,gBAAgB,GAAG,SAAS,mBAAmB,CAAC,KAAK,EAAE;AACtE,QAAG,CAAC,gBAAgB,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,OAAO;;AAE3D,QAAI,MAAM,GAAG,4BAA4B,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACtF,WAAO,CAAC,CAAC,KAAK,CACZ,YAAW;AACT,aAAO,gBAAgB,CAAC,iBAAiB,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EACjB,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;KAC7D,EACD,UAAS,QAAQ,EAAE;AACjB,aAAO,WAAW,CAAC,cAAc,CAAC,aAAa,EACb,YAAY,EAAE,QAAQ,EACtB,MAAM,EAAE,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;KAC9D,CACF,EAAE,CAAC;GACL,CAAC;;AAEF,MAAI,yBAAyB,GAAG;AAC9B,kBAAc,EAAE,kBAAkB;AAClC,YAAQ,EAAE,GAAG;AACb,YAAQ,EAAE,GAAG;AACb,YAAQ,EAAE,GAAG;AACb,WAAO,EAAE,GAAG;AACZ,mBAAe,EAAE,SAAS;AAC1B,oBAAgB,EAAE,SAAS;GAC5B,CAAC;AACF,MAAI,iBAAiB,GAAG,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,mBAAmB,CAAC,QAAQ,CAAC,EAC3C,yBAAyB,CAAC,CAAC;AAC5D,MAAI,gBAAgB,GAAG,CAAC,CAAC,MAAM,CAAC,CAC9B,CAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,CAAE,EAC5B,CAAE,MAAM,EAAE,UAAU,EAAE,MAAM,CAAE,EAC9B,CAAE,MAAM,EAAE,UAAU,EAAE,MAAM,CAAE,EAC9B,CAAE,MAAM,EAAE,UAAU,EAAE,MAAM,CAAE,EAC9B,CAAE,SAAS,EAAE,SAAS,CAAE,EACxB,CAAE,cAAc,EAAE,kBAAkB,CAAE,CACvC,EAAE,mBAAmB,CAAC,OAAO,CAAC,CAAC;;AAEhC,MAAI,aAAa,GAAG;AAClB,WAAO,EAAE,SAAS,eAAe,YAAY,EAC5C;AACD,WAAO,EAAE,SAAS,eAAe,YAAY,EAC5C;AACD,QAAI,EAAE,KAAK,GAAC,mBAAmB,CAAC,IAAI;AACpC,WAAO,EAAE,gBAAgB;AACzB,WAAO,EAAE,gBAAgB;AACzB,YAAQ,EAAE,iBAAiB;GAC5B,CAAC;AACF,cAAY,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;AACzC,iBAAe,CAAC,QAAQ,CAAC,UAAU,EACV,aAAa,CAAC,IAAI,EAClB,yBAAyB,EACzB,UAAS,EAAE,EAAE;AACX,KAAC,CAAC,MAAM,CAAC,aAAa,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;GACtC,CAAC,CAAC;AAC5B,SAAO,aAAa,CAAC;CACtB,CACF,CAAC,CAAC","file":"aoeTemplate.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('aoeTemplateMode', [\n    'modes',\n    'settings',\n    'templateMode',\n    'game',\n    'gameTemplates',\n    'gameTemplateSelection',\n    'gameRuler',\n    'prompt',\n    function aoeTemplateModeServiceFactory(modesService,\n                                           settingsService,\n                                           templateModeService,\n                                           gameService,\n                                           gameTemplatesService,\n                                           gameTemplateSelectionService,\n                                           gameRulerService,\n                                           promptService) {\n      var template_actions = Object.create(templateModeService.actions);\n      template_actions.aoeSize3 = function aoeSize3(scope) {\n        var stamps = gameTemplateSelectionService.get('local', scope.game.template_selection);\n        return gameService.executeCommand('onTemplates', 'setSize', 3,\n                                          stamps, scope, scope.game);\n      };\n      template_actions.aoeSize4 = function aoeSize4(scope) {\n        var stamps = gameTemplateSelectionService.get('local', scope.game.template_selection);\n        return gameService.executeCommand('onTemplates', 'setSize', 4,\n                                          stamps, scope, scope.game);\n      };\n      template_actions.aoeSize5 = function aoeSize5(scope) {\n        var stamps = gameTemplateSelectionService.get('local', scope.game.template_selection);\n        return gameService.executeCommand('onTemplates', 'setSize', 5,\n                                          stamps, scope, scope.game);\n      };\n      template_actions.setTargetModel = function aoeSetTargetModel(scope, event) {\n        var stamps = gameTemplateSelectionService.get('local', scope.game.template_selection);\n        return gameService.executeCommand('onTemplates',\n                                          'setTarget', scope.factions, null, event['click#'].target,\n                                          stamps, scope,  scope.game);\n      };\n      template_actions.setMaxDeviation = function rulerSetMaxDeviation(scope) {\n        var stamps = gameTemplateSelectionService.get('local', scope.game.template_selection);\n        return R.pipeP(\n          function() {\n            return gameTemplatesService.onStamps$('maxDeviation', stamps, scope.game.templates);\n          },\n          function(maxes) {\n            var max = maxes[0];\n            return promptService.prompt('prompt', 'Set AoE max deviation :', max)\n              .catch(function(error) {\n                console.log(error);\n                return null;\n              });\n          },\n          function(value) {\n            value = (value === 0) ? null : value;\n            return gameTemplatesService\n              .onStamps('setMaxDeviation', value, stamps, scope.game.templates);\n          }\n        )();\n      };\n      template_actions.deviate = function aoeDeviate(scope) {\n        var stamps = gameTemplateSelectionService.get('local', scope.game.template_selection);\n        return R.pipeP(\n          function() {\n            return gameService.executeCommand$('rollDeviation', scope, scope.game);\n          },\n          function(deviation) {\n            return gameService.executeCommand('onTemplates', 'deviate',\n                                              deviation.r, deviation.d,\n                                              stamps, scope, scope.game);\n          }\n        )();\n      };\n      template_actions.setToRulerTarget = function aoeSetToRulerTarget(scope) {\n        if(!gameRulerService.isDisplayed(scope.game.ruler)) return;\n        \n        var stamps = gameTemplateSelectionService.get('local', scope.game.template_selection);\n        return R.pipeP(\n          function() {\n            return gameRulerService.targetAoEPosition(scope.game.models,\n                                                      scope.game.ruler);\n          },\n          function(position) {\n            return gameService.executeCommand('onTemplates',\n                                              'setToRuler', position,\n                                              stamps, scope, scope.game);\n          }\n        )();\n      };\n\n      var template_default_bindings = {\n        setTargetModel: 'shift+clickModel',\n        aoeSize3: '3',\n        aoeSize4: '4',\n        aoeSize5: '5',\n        deviate: 'd',\n        setMaxDeviation: 'shift+d',\n        setToRulerTarget: 'shift+r',\n      };\n      var template_bindings = R.extend(Object.create(templateModeService.bindings),\n                                       template_default_bindings);\n      var template_buttons = R.concat([\n        [ 'Size', 'toggle', 'size' ],\n        [ 'Aoe3', 'aoeSize3', 'size' ],\n        [ 'Aoe4', 'aoeSize4', 'size' ],\n        [ 'Aoe5', 'aoeSize5', 'size' ],\n        [ 'Deviate', 'deviate' ],\n        [ 'Set to Ruler', 'setToRulerTarget' ],\n      ], templateModeService.buttons);\n\n      var template_mode = {\n        onEnter: function templateOnEnter(/*scope*/) {\n        },\n        onLeave: function templateOnLeave(/*scope*/) {\n        },\n        name: 'aoe'+templateModeService.name,\n        actions: template_actions,\n        buttons: template_buttons,\n        bindings: template_bindings,\n      };\n      modesService.registerMode(template_mode);\n      settingsService.register('Bindings',\n                               template_mode.name,\n                               template_default_bindings,\n                               function(bs) {\n                                 R.extend(template_mode.bindings, bs);\n                               });\n      return template_mode;\n    }\n  ]);\n"]}