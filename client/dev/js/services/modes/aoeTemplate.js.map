{"version":3,"sources":["../../../es6/services/modes/aoeTemplate.js"],"names":[],"mappings":";;AAAA,OAAO,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAChC,OAAO,CAAC,iBAAiB,EAAE,CAC1B,OAAO,EACP,UAAU,EACV,cAAc,EACd,MAAM,EACN,eAAe,EACf,uBAAuB,EACvB,WAAW,EACX,QAAQ,EACR,SAAS,6BAA6B,CAAC,YAAY,EACZ,eAAe,EACf,mBAAmB,EACnB,WAAW,EACX,oBAAoB,EACpB,4BAA4B,EAC5B,gBAAgB,EAChB,aAAa,EAAE;AACpD,MAAI,gBAAgB,GAAG,MAAM,CAAC,MAAM,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;AAClE,kBAAgB,CAAC,QAAQ,GAAG,UAAC,KAAK,EAAK;AACrC,QAAI,MAAM,GAAG,4BAA4B,CAClC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACnD,WAAO,KAAK,CAAC,KAAK,CAAC,sBAAsB,EACtB,aAAa,EAAE,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC;GAC7D,CAAC;AACF,kBAAgB,CAAC,QAAQ,GAAG,UAAC,KAAK,EAAK;AACrC,QAAI,MAAM,GAAG,4BAA4B,CAClC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACnD,WAAO,KAAK,CAAC,KAAK,CAAC,sBAAsB,EACtB,aAAa,EAAE,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC;GAC7D,CAAC;AACF,kBAAgB,CAAC,QAAQ,GAAG,UAAC,KAAK,EAAK;AACrC,QAAI,MAAM,GAAG,4BAA4B,CAClC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACnD,WAAO,KAAK,CAAC,KAAK,CAAC,sBAAsB,EACtB,aAAa,EAAE,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC;GAC7D,CAAC;AACF,kBAAgB,CAAC,cAAc,GAAG,UAAC,KAAK,EAAE,KAAK,EAAK;AAClD,QAAI,MAAM,GAAG,4BAA4B,CAClC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACnD,WAAO,KAAK,CAAC,KAAK,CAAC,sBAAsB,EACtB,aAAa,EACb,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,QAAQ,EAAE,IAAI,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,EAC3D,MAAM,CACN,CAAC,CAAC;GACvB,CAAC;AACF,kBAAgB,CAAC,eAAe,GAAG,UAAC,KAAK,EAAK;AAC5C,QAAI,MAAM,GAAG,4BAA4B,CAClC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACnD,WAAO,CAAC,CAAC,KAAK,CACZ,oBAAoB,CAAC,WAAW,CAAC,cAAc,EAAE,EAAE,EAAE,MAAM,CAAC,EAC5D,UAAC,KAAK,EAAK;AACT,UAAI,GAAG,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;AACnB,aAAO,aAAa,CACjB,MAAM,CAAC,QAAQ,EAAE,yBAAyB,EAAE,GAAG,CAAC,CAChD,KAAK,CAAC,UAAC,KAAK,EAAK;AAChB,eAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AACnB,eAAO,IAAI,CAAC;OACb,CAAC,CAAC;KACN,EACD,UAAC,KAAK,EAAK;AACT,WAAK,GAAG,AAAC,KAAK,KAAK,CAAC,GAAI,IAAI,GAAG,KAAK,CAAC;AACrC,aAAO,KAAK,CAAC,KAAK,CAAC,aAAa,EAAE,CAAC,CAAC,QAAQ,CAAC,WAAW,CAAC,EACtC,oBAAoB,CAAC,SAAS,CAAC,iBAAiB,EAAE,CAAC,KAAK,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC;KACxF,CACF,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;GACzB,CAAC;AACF,kBAAgB,CAAC,OAAO,GAAG,UAAC,KAAK,EAAK;AACpC,QAAI,MAAM,GAAG,4BAA4B,CAClC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACnD,WAAO,CAAC,CAAC,WAAW,CAClB,YAAW;AACT,aAAO,KAAK,CAAC,KAAK,CAAC,sBAAsB,EACtB,eAAe,EAAE,EAAE,CAAC,CAAC;KACzC,EACD,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,EACf,CAAC,CAAC,IAAI,CAAC,CAAC,MAAM,EAAC,MAAM,CAAC,CAAC,EACvB,CAAC,CAAC,IAAI,EACN,UAAS,SAAS,EAAE;AAClB,aAAO,KAAK,CAAC,KAAK,CAAC,sBAAsB,EACtB,aAAa,EAAE,CAAE,SAAS,EAAE,CAAC,SAAS,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC,EACrC,MAAM,CACP,CAAC,CAAC;KACtC,CACF,EAAE,CAAC;GACL,CAAC;AACF,kBAAgB,CAAC,gBAAgB,GAAG,UAAC,KAAK,EAAK;AAC7C,QAAG,CAAC,gBAAgB,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,OAAO,IAAI,CAAC;;AAEhE,QAAI,MAAM,GAAG,4BAA4B,CAClC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACnD,WAAO,CAAC,CAAC,KAAK,CACZ,gBAAgB,CAAC,kBAAkB,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,EACtD,UAAC,QAAQ,EAAK;AACZ,aAAO,KAAK,CAAC,KAAK,CAAC,sBAAsB,EACtB,aAAa,EAAE,CAAE,YAAY,EAAE,CAAC,QAAQ,CAAC,EACxB,MAAM,CACP,CAAC,CAAC;KACtC,CACF,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;GACrB,CAAC;;AAEF,MAAI,yBAAyB,GAAG;AAC9B,kBAAc,EAAE,kBAAkB;AAClC,YAAQ,EAAE,GAAG;AACb,YAAQ,EAAE,GAAG;AACb,YAAQ,EAAE,GAAG;AACb,WAAO,EAAE,GAAG;AACZ,mBAAe,EAAE,SAAS;AAC1B,oBAAgB,EAAE,SAAS;GAC5B,CAAC;AACF,MAAI,iBAAiB,GAAG,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,mBAAmB,CAAC,QAAQ,CAAC,EAC3C,yBAAyB,CAAC,CAAC;AAC5D,MAAI,gBAAgB,GAAG,CAAC,CAAC,MAAM,CAAC,CAC9B,CAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,CAAE,EAC5B,CAAE,MAAM,EAAE,UAAU,EAAE,MAAM,CAAE,EAC9B,CAAE,MAAM,EAAE,UAAU,EAAE,MAAM,CAAE,EAC9B,CAAE,MAAM,EAAE,UAAU,EAAE,MAAM,CAAE,EAC9B,CAAE,SAAS,EAAE,SAAS,CAAE,EACxB,CAAE,cAAc,EAAE,kBAAkB,CAAE,CACvC,EAAE,mBAAmB,CAAC,OAAO,CAAC,CAAC;;AAEhC,MAAI,aAAa,GAAG;AAClB,WAAO,EAAE,4BAAe,EAAE;AAC1B,WAAO,EAAE,4BAAe,EAAE;AAC1B,QAAI,EAAE,KAAK,GAAC,mBAAmB,CAAC,IAAI;AACpC,WAAO,EAAE,gBAAgB;AACzB,WAAO,EAAE,gBAAgB;AACzB,YAAQ,EAAE,iBAAiB;GAC5B,CAAC;AACF,cAAY,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;AACzC,iBAAe,CAAC,QAAQ,CAAC,UAAU,EACV,aAAa,CAAC,IAAI,EAClB,yBAAyB,EACzB,UAAC,EAAE,EAAK;AACN,KAAC,CAAC,MAAM,CAAC,aAAa,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;GACtC,CAAC,CAAC;AAC5B,SAAO,aAAa,CAAC;CACtB,CACF,CAAC,CAAC","file":"aoeTemplate.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('aoeTemplateMode', [\n    'modes',\n    'settings',\n    'templateMode',\n    'game',\n    'gameTemplates',\n    'gameTemplateSelection',\n    'gameRuler',\n    'prompt',\n    function aoeTemplateModeServiceFactory(modesService,\n                                           settingsService,\n                                           templateModeService,\n                                           gameService,\n                                           gameTemplatesService,\n                                           gameTemplateSelectionService,\n                                           gameRulerService,\n                                           promptService) {\n      var template_actions = Object.create(templateModeService.actions);\n      template_actions.aoeSize3 = (state) => {\n        var stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return state.event('Game.command.execute',\n                           'onTemplates', ['setSize', [3], stamps]);\n      };\n      template_actions.aoeSize4 = (state) => {\n        var stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return state.event('Game.command.execute',\n                           'onTemplates', ['setSize', [4], stamps]);\n      };\n      template_actions.aoeSize5 = (state) => {\n        var stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return state.event('Game.command.execute',\n                           'onTemplates', ['setSize', [5], stamps]);\n      };\n      template_actions.setTargetModel = (state, event) => {\n        var stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return state.event('Game.command.execute',\n                           'onTemplates',\n                           ['setTarget', [state.factions, null, event['click#'].target],\n                            stamps\n                           ]);\n      };\n      template_actions.setMaxDeviation = (state) => {\n        var stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return R.pipeP(\n          gameTemplatesService.fromStamps$('maxDeviation', [], stamps),\n          (maxes) => {\n            var max = maxes[0];\n            return promptService\n              .prompt('prompt', 'Set AoE max deviation :', max)\n              .catch((error) => {\n                console.log(error);\n                return null;\n              });\n          },\n          (value) => {\n            value = (value === 0) ? null : value;\n            return state.event('Game.update', R.lensProp('templates'),\n                               gameTemplatesService.onStamps$('setMaxDeviation', [value], stamps));\n          }\n        )(state.game.templates);\n      };\n      template_actions.deviate = (state) => {\n        var stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return R.pipePromise(\n          function() {\n            return state.event('Game.command.execute',\n                               'rollDeviation', []);\n          },\n          R.always(state),\n          R.path(['game','dice']),\n          R.last,\n          function(deviation) {\n            return state.event('Game.command.execute',\n                               'onTemplates', [ 'deviate', [deviation.r, deviation.d],\n                                                stamps\n                                              ]);\n          }\n        )();\n      };\n      template_actions.setToRulerTarget = (state) => {\n        if(!gameRulerService.isDisplayed(state.game.ruler)) return null;\n        \n        var stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return R.pipeP(\n          gameRulerService.targetAoEPosition$(state.game.models),\n          (position) => {\n            return state.event('Game.command.execute',\n                               'onTemplates', [ 'setToRuler', [position],\n                                                stamps\n                                              ]);\n          }\n        )(state.game.ruler);\n      };\n\n      var template_default_bindings = {\n        setTargetModel: 'shift+clickModel',\n        aoeSize3: '3',\n        aoeSize4: '4',\n        aoeSize5: '5',\n        deviate: 'd',\n        setMaxDeviation: 'shift+d',\n        setToRulerTarget: 'shift+r'\n      };\n      var template_bindings = R.extend(Object.create(templateModeService.bindings),\n                                       template_default_bindings);\n      var template_buttons = R.concat([\n        [ 'Size', 'toggle', 'size' ],\n        [ 'Aoe3', 'aoeSize3', 'size' ],\n        [ 'Aoe4', 'aoeSize4', 'size' ],\n        [ 'Aoe5', 'aoeSize5', 'size' ],\n        [ 'Deviate', 'deviate' ],\n        [ 'Set to Ruler', 'setToRulerTarget' ],\n      ], templateModeService.buttons);\n\n      var template_mode = {\n        onEnter: (/*state*/) => {},\n        onLeave: (/*state*/) => {},\n        name: 'aoe'+templateModeService.name,\n        actions: template_actions,\n        buttons: template_buttons,\n        bindings: template_bindings\n      };\n      modesService.registerMode(template_mode);\n      settingsService.register('Bindings',\n                               template_mode.name,\n                               template_default_bindings,\n                               (bs) => {\n                                 R.extend(template_mode.bindings, bs);\n                               });\n      return template_mode;\n    }\n  ]);\n"]}