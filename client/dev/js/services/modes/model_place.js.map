{"version":3,"sources":["../../../es6/services/modes/model_place.js"],"names":[],"mappings":"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","file":"model_place.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('modelPlaceMode', [\n    'modes',\n    'settings',\n    'modelsMode',\n    'modelBaseMode',\n    'game',\n    'gameModels',\n    'gameModelSelection',\n    function modelPlaceModeServiceFactory(modesService,\n                                          settingsService,\n                                          modelsModeService,\n                                          modelBaseModeService,\n                                          gameService,\n                                          gameModelsService,\n                                          gameModelSelectionService) {\n      var model_actions = Object.create(modelBaseModeService.actions);\n      model_actions.endPlace = function modelEndPlace(scope) {\n        var stamps = gameModelSelectionService.get('local', scope.game.model_selection);\n        return R.pipeP(\n          function() {\n            return gameService.executeCommand('onModels', 'endPlace',\n                                              stamps, scope, scope.game);\n          },\n          function() {\n            return scope.doSwitchToMode('Model');\n          }\n        )();\n      };\n      model_actions.setTargetModel = function modelSetTargetModel(scope, event) {\n        var stamps = gameModelSelectionService.get('local', scope.game.model_selection);\n        return R.pipeP(\n          gameModelsService.findStamp$(stamps[0]),\n          function(model) {\n            if(model.state.stamp === event['click#'].target.state.stamp) return;\n            \n            return gameService.executeCommand('onModels', 'setPlaceTarget',\n                                              scope.factions, event['click#'].target,\n                                              stamps, scope, scope.game);\n          }\n        )(scope.game.models);\n      };\n      model_actions.setOriginModel = function modelSetOriginModel(scope, event) {\n        var stamps = gameModelSelectionService.get('local', scope.game.model_selection);\n        return R.pipeP(\n          gameModelsService.findStamp$(stamps[0]),\n          function(model) {\n            if(model.state.stamp === event['click#'].target.state.stamp) return;\n            \n            return gameService.executeCommand('onModels', 'setPlaceOrigin',\n                                              scope.factions, event['click#'].target,\n                                              stamps, scope, scope.game);\n          }\n        )(scope.game.models);\n      };\n      var moves = [\n        ['moveFront', 'up', 'moveFront'],\n        ['moveBack', 'down', 'moveBack'],\n        ['rotateLeft', 'left', 'rotateLeft'],\n        ['rotateRight', 'right', 'rotateRight'],\n        ['shiftUp', 'ctrl+up', 'shiftDown'],\n        ['shiftDown', 'ctrl+down', 'shiftUp'],\n        ['shiftLeft', 'ctrl+left', 'shiftRight'],\n        ['shiftRight', 'ctrl+right', 'shiftLeft'],\n      ];\n      R.forEach(function(move) {\n        model_actions[move[0]] = buildPlaceMove(move[0], move[2], false,\n                                                move[0]);\n        model_actions[move[0]+'Small'] = buildPlaceMove(move[0], move[2], true,\n                                                        move[0]+'Small');\n      }, moves);\n      function buildPlaceMove(move, flip_move, small) {\n        return function modelDoPlaceMove(scope) {\n          var stamps = gameModelSelectionService.get('local', scope.game.model_selection);\n          var _move = ( R.path(['ui_state','flip_map'], scope) ?\n                        flip_move :\n                        move\n                      );\n\n          return gameService.executeCommand('onModels', _move+'Place',\n                                            scope.factions, small,\n                                            stamps, scope, scope.game);\n        };\n      }\n\n      var model_default_bindings = {\n        'endPlace': 'p',\n        'setTargetModel': 'shift+clickModel',\n        'setOriginModel': 'ctrl+clickModel',\n      };\n      var model_bindings = R.extend(Object.create(modelBaseModeService.bindings),\n                                    model_default_bindings);\n      var model_buttons = modelsModeService.buildButtons({ single: true,\n                                                           end_place: true });\n      var model_mode = {\n        onEnter: function modelOnEnter(/*scope*/) {\n        },\n        onLeave: function modelOnLeave(/*scope*/) {\n        },\n        name: 'ModelPlace',\n        actions: model_actions,\n        buttons: model_buttons,\n        bindings: model_bindings,\n      };\n      modesService.registerMode(model_mode);\n      settingsService.register('Bindings',\n                               model_mode.name,\n                               model_default_bindings,\n                               function(bs) {\n                                 R.extend(model_mode.bindings, bs);\n                               });\n      return model_mode;\n    }\n  ]);\n"]}