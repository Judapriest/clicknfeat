{"version":3,"sources":["../../../es6/services/modes/sprayTemplate.js"],"names":[],"mappings":"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","file":"sprayTemplate.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('sprayTemplateMode', [\n    'modes',\n    'settings',\n    'templateMode',\n    'sprayTemplate',\n    'game',\n    'gameTemplates',\n    'gameTemplateSelection',\n    'gameModels',\n    function sprayTemplateModeServiceFactory(modesService,\n                                             settingsService,\n                                             templateModeService,\n                                             sprayTemplateService,\n                                             gameService,\n                                             gameTemplatesService,\n                                             gameTemplateSelectionService,\n                                             gameModelsService) {\n      let template_actions = Object.create(templateModeService.actions);\n      template_actions.spraySize6 = (state) => {\n        let stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return state.event('Game.command.execute',\n                           'onTemplates', ['setSize', [6], stamps]);\n      };\n      template_actions.spraySize8 = (state) => {\n        let stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return state.event('Game.command.execute',\n                           'onTemplates', ['setSize', [8], stamps]);\n      };\n      template_actions.spraySize10 = (state) => {\n        let stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return state.event('Game.command.execute',\n                           'onTemplates', ['setSize', [10], stamps]);\n      };\n      template_actions.setOriginModel = (state, event) => {\n        let stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return state.event('Game.command.execute',\n                           'onTemplates', [ 'setOrigin',\n                                            [state.factions, event['click#'].target],\n                                            stamps\n                                          ]);\n      };\n      template_actions.setTargetModel = (state, event) => {\n        let stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return R.pipeP(\n          gameTemplatesService.findStamp$(stamps[0]),\n          sprayTemplateService.origin,\n          (origin) => {\n            if(R.isNil(origin)) return null;\n\n            return gameModelsService\n              .findStamp(origin, state.game.models);\n          },\n          (origin_model) => {\n            if(R.isNil(origin_model)) return null;\n          \n            return state.event('Game.command.execute',\n                               'onTemplates', [ 'setTarget',\n                                                [state.factions, origin_model, event['click#'].target],\n                                                stamps\n                                              ]);\n          }\n        )(state.game.templates);\n      };\n      let moves = [\n        ['rotateLeft', 'left'],\n        ['rotateRight', 'right'],\n      ];\n      let buildTemplateMove$ = R.curry((move, small, state) => {\n        let stamps = gameTemplateSelectionService\n              .get('local', state.game.template_selection);\n        return R.pipeP(\n          function() {\n            return gameTemplatesService\n              .findStamp(stamps[0], state.game.templates);\n          },\n          sprayTemplateService.origin,\n          (origin) => {\n            if(R.isNil(origin)) return null;\n              \n            return gameModelsService\n              .findStamp(origin, state.game.models);\n          },\n          (origin_model) => {\n            return state.event('Game.command.execute',\n                               'onTemplates', [ move,\n                                                [state.factions, origin_model, small],\n                                                stamps\n                                              ]);\n          }\n        )();\n      });\n      R.forEach(([move]) => {\n        template_actions[move] = buildTemplateMove$(move, false);\n        template_actions[move+'Small'] = buildTemplateMove$(move, true);\n      }, moves);\n      let template_default_bindings = {\n        setOriginModel: 'ctrl+clickModel',\n        setTargetModel: 'shift+clickModel',\n        spraySize6: '6',\n        spraySize8: '8',\n        spraySize10: '0'\n      };\n      let template_bindings = R.extend(Object.create(templateModeService.bindings),\n                                       template_default_bindings);\n\n      let template_buttons = R.concat([\n        [ 'Size', 'toggle', 'size' ],\n        [ 'Spray6', 'spraySize6', 'size' ],\n        [ 'Spray8', 'spraySize8', 'size' ],\n        [ 'Spray10', 'spraySize10', 'size' ],\n      ], templateModeService.buttons);\n\n      let template_mode = {\n        onEnter: () => { },\n        onLeave: () => { },\n        name: 'spray'+templateModeService.name,\n        actions: template_actions,\n        buttons: template_buttons,\n        bindings: template_bindings\n      };\n      modesService.registerMode(template_mode);\n      settingsService.register('Bindings',\n                               template_mode.name,\n                               template_default_bindings,\n                               (bs) => {\n                                 R.extend(template_mode.bindings, bs);\n                               });\n      return template_mode;\n    }\n  ]);\n"]}