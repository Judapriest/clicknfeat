{"version":3,"sources":["../../../es6/services/modes/los.js"],"names":[],"mappings":"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","file":"los.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('losMode', [\n    'modes',\n    'settings',\n    'commonMode',\n    'game',\n    'gameLos',\n    'gameModels',\n    'gameModelSelection',\n    function losModeServiceFactory(modesService,\n                                   settingsService,\n                                   commonModeService,\n                                   gameService,\n                                   gameLosService,\n                                   gameModelsService,\n                                   gameModelSelectionService) {\n      var los_actions = Object.create(commonModeService.actions);\n      los_actions.exitLosMode = commonModeService.actions.modeBackToDefault;\n      los_actions.dragStartMap = function losDragStartMap(scope, drag) {\n        scope.game.los = gameLosService.setLocal(drag.start, drag.now,\n                                                 scope, scope.game.los);\n      };\n      los_actions.dragMap = function losDragMap(scope, drag) {\n        scope.game.los = gameLosService.setLocal(drag.start, drag.now,\n                                                 scope, scope.game.los);\n      };\n      los_actions.dragEndMap = function losDragEndMap(scope, drag) {\n        return gameService\n          .executeCommand('setLos',\n                          'setRemote', drag.start, drag.now,\n                          scope,  scope.game);\n      };\n      los_actions.dragStartTemplate = los_actions.dragStartMap;\n      los_actions.dragTemplate = los_actions.dragMap;\n      los_actions.dragEndTemplate = los_actions.dragEndMap;\n      los_actions.dragStartModel = los_actions.dragStartMap;\n      los_actions.dragModel = los_actions.dragMap;\n      los_actions.dragEndModel = los_actions.dragEndMap;\n      los_actions.setOriginModel = function losSetOriginModel(scope, event) {\n        return gameService\n          .executeCommand('setLos',\n                          'setOrigin', event['click#'].target,\n                          scope,  scope.game);\n      };\n      los_actions.setTargetModel = function losSetTargetModel(scope, event) {\n        return gameService\n          .executeCommand('setLos',\n                          'setTarget', event['click#'].target,\n                          scope,  scope.game);\n      };\n      los_actions.toggleIgnoreModel = function losToggleIgnoreModel(scope, event) {\n        return gameService\n          .executeCommand('setLos',\n                          'toggleIgnoreModel', event['click#'].target,\n                          scope,  scope.game);\n      };\n      var los_default_bindings = {\n        exitLosMode: 'shift+r',\n        toggleIgnoreModel: 'clickModel',\n        setOriginModel: 'ctrl+clickModel',\n        setTargetModel: 'shift+clickModel'\n      };\n      var los_bindings = R.extend(Object.create(commonModeService.bindings),\n                                  los_default_bindings);\n      var los_buttons = [\n      ];\n      var los_mode = {\n        onEnter: function losOnEnter(scope) {\n          return R.pipePromise(\n            () => {\n              return gameModelSelectionService\n                .get('local', scope.game.model_selection);\n            },\n            (stamps) => {\n              if(R.length(stamps) !== 1) return null;\n\n              return gameModelsService\n                .findStamp(stamps[0], scope.game.models)\n                .catch(R.always(null));\n            },\n            (model) => {\n              if(R.isNil(model)) return null;\n\n              return gameService\n                .executeCommand('setLos',\n                                'setOriginResetTarget', model,\n                                scope, scope.game)\n                .catch(R.always(null));\n            }\n          )();\n        },\n        onLeave: function losOnLeave(/*scope*/) {\n        },\n        name: 'LoS',\n        actions: los_actions,\n        buttons: los_buttons,\n        bindings: los_bindings,\n      };\n      modesService.registerMode(los_mode);\n      settingsService.register('Bindings',\n                               los_mode.name,\n                               los_default_bindings,\n                               (bs) => {\n                                 R.extend(los_mode.bindings, bs);\n                               });\n      return los_mode;\n    }\n  ]);\n"]}