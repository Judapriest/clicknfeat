{"version":3,"sources":["../../../es6/services/modes/default.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,OAAO,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAChC,OAAO,CAAC,aAAa,EAAE,CACtB,OAAO,EACP,UAAU,EACV,YAAY,EACZ,MAAM,EACN,UAAU,EACV,uBAAuB,EACvB,YAAY,EACZ,oBAAoB,EACpB,sBAAsB,EACtB,SAAS,yBAAyB,CAAC,YAAY,EACZ,eAAe,EACf,iBAAiB,EACjB,WAAW,EACX,eAAe,EACf,4BAA4B,EAC5B,iBAAiB,EACjB,yBAAyB,EACzB,2BAA2B,EAAE;AAC9D,MAAI,eAAe,GAAG,MAAM,CAAC,MAAM,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC;AAC/D,WAAS,qBAAqB,CAAC,KAAK,EAAE;AACpC,SAAK,CAAC,IAAI,CAAC,iBAAiB,GAAG,2BAA2B,CACvD,KAAK,CAAC,OAAO,EAAE,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;GACxD;AACD,WAAS,sBAAsB,CAAC,KAAK,EAAE;AACrC,SAAK,CAAC,IAAI,CAAC,kBAAkB,GAAG,4BAA4B,CACzD,KAAK,CAAC,OAAO,EAAE,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;GACzD;AACD,iBAAe,CAAC,iBAAiB,GAAG,SAAS,wBAAwB,CAAC,KAAK,EAAE,KAAK,EAAE;AAClF,yBAAqB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;AACpC,0BAAsB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;AACrC,QAAI,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC;AAC/C,WAAO,WAAW,CAAC,cAAc,CAAC,mBAAmB,EAAE,KAAK,EAAE,CAAC,KAAK,CAAC,EACnC,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;GACtD,CAAC;AACF,iBAAe,CAAC,oBAAoB,GAAG,SAAS,qBAAqB,CAAC,KAAK,EAAE,KAAK,EAAE;AAClF,yBAAqB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;AACpC,0BAAsB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;AACrC,QAAI,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC;AAC/C,QAAG,yBAAyB,CAAC,EAAE,CAAC,OAAO,EAAE,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,eAAe,CAAC,EAAE;AAC3E,aAAO,WAAW,CAAC,cAAc,CAAC,mBAAmB,EAAE,YAAY,EAAE,CAAC,KAAK,CAAC,EAC1C,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;KACtD,MACI;AACH,aAAO,WAAW,CAAC,cAAc,CAAC,mBAAmB,EAAE,OAAO,EAAE,CAAC,KAAK,CAAC,EACrC,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;KACtD;GACF,CAAC;AACF,iBAAe,CAAC,oBAAoB,GAAG,SAAS,2BAA2B,CAAC,KAAK,EAAE,KAAK,EAAE;AACxF,yBAAqB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;AACpC,0BAAsB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;AACrC,QAAI,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC;AAC/C,SAAK,CAAC,SAAS,CAAC,qBAAqB,EAAE,OAAO,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,CAAC;AACxE,WAAO,WAAW,CAAC,cAAc,CAAC,mBAAmB,EAAE,KAAK,EAAE,CAAC,KAAK,CAAC,EACnC,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;GACtD,CAAC;AACF,iBAAe,CAAC,cAAc,GAAG,SAAS,qBAAqB,CAAC,KAAK,EAAE,KAAK,EAAE;AAC5E,yBAAqB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;AACpC,SAAK,CAAC,IAAI,CAAC,kBAAkB,GAC3B,4BAA4B,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,EAC7C,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;GAC1E,CAAC;AACF,iBAAe,CAAC,uBAAuB,GAAG,SAAS,8BAA8B,CAAC,KAAK,EAAE,KAAK,EAAE;AAC9F,yBAAqB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;AACpC,SAAK,CAAC,SAAS,CAAC,qBAAqB,EAAE,UAAU,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,CAAC;AAC3E,SAAK,CAAC,IAAI,CAAC,kBAAkB,GAC3B,4BAA4B,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,EAC7C,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;GAC1E,CAAC;AACF,iBAAe,CAAC,aAAa,GAAG,SAAS,oBAAoB,CAAC,KAAK,EAAE,KAAK,EAAE;AAC1E,0BAAsB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;AACrC,SAAK,CAAC,IAAI,CAAC,iBAAiB,GAC1B,2BAA2B,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,EAC7C,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;GACxE,CAAC;AACF,iBAAe,CAAC,cAAc,GAAG,SAAS,qBAAqB,CAAC,KAAK,EAAE;AACrE,WAAO,KAAK,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;GACtC,CAAC;AACF,iBAAe,CAAC,YAAY,GAAG,SAAS,mBAAmB,CAAC,KAAK,EAAE;AACjE,WAAO,KAAK,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;GACpC,CAAC;AACF,iBAAe,CAAC,YAAY,GAAG,SAAS,mBAAmB,CAAC,KAAK,EAAE,KAAK,EAAE;AACxE,SAAK,CAAC,SAAS,CAAC,eAAe,EAAE,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC;GAC1D,CAAC;AACF,iBAAe,CAAC,OAAO,GAAG,SAAS,cAAc,CAAC,KAAK,EAAE,KAAK,EAAE;AAC9D,SAAK,CAAC,SAAS,CAAC,eAAe,EAAE,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC;GAC1D,CAAC;AACF,iBAAe,CAAC,UAAU,GAAG,SAAS,iBAAiB,CAAC,KAAK,EAAE,KAAK,EAAE;AACpE,SAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC;AAClC,QAAI,QAAQ,GAAG;AACb,OAAC,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;AACvC,OAAC,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;KACxC,CAAC;AACF,QAAI,YAAY,GAAG;AACjB,OAAC,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;AACvC,OAAC,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;KACxC,CAAC;AACF,WAAO,CAAC,CAAC,KAAK,CACZ,iBAAiB,CAAC,wBAAwB,CAAC,QAAQ,EAAE,YAAY,CAAC,EAClE,UAAS,MAAM,EAAE;AACf,UAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;AACpB,eAAO;OACR;;AAED,aAAO,WAAW,CAAC,cAAc,CAAC,mBAAmB,EAAE,KAAK,EAAE,MAAM,EAClC,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;KACtD,CACF,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;GACtB,CAAC;;AAEF,MAAI,wBAAwB,GAAG;AAC7B,kBAAc,EAAE,QAAQ;AACxB,gBAAY,EAAE,QAAQ;AACtB,qBAAiB,EAAE,YAAY;AAC/B,wBAAoB,EAAE,iBAAiB;AACvC,wBAAoB,EAAE,iBAAiB;AACvC,kBAAc,EAAE,eAAe;AAC/B,2BAAuB,EAAE,oBAAoB;AAC7C,iBAAa,EAAE,cAAc;GAC9B,CAAC;AACF,MAAI,gBAAgB,GAAG,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,iBAAiB,CAAC,QAAQ,CAAC,EACzC,wBAAwB,CAAC,CAAC;AAC1D,MAAI,eAAe,GAAG,EAAE,CAAC;AACzB,MAAI,YAAY,GAAG;AACjB,QAAI,EAAE,SAAS;AACf,WAAO,EAAE,SAAS,cAAc,CAAC,KAAK,EAAE;AACtC,kCAA4B,CACzB,SAAS,CAAC,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAC/C,KAAK,CAAC,YAAW;AAChB,eAAO,2BAA2B,CAC/B,SAAS,CAAC,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;OACnD,CAAC,CACD,KAAK,CAAC,YAAW;AAChB,eAAO,yBAAyB,CAC7B,SAAS,CAAC,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;OACjD,CAAC,CAAC;KACN;AACD,WAAO,EAAE,eAAe;AACxB,WAAO,EAAE,eAAe;AACxB,YAAQ,EAAE,gBAAgB;GAC3B,CAAC;AACF,cAAY,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;AACxC,iBAAe,CAAC,QAAQ,CAAC,UAAU,EACV,YAAY,CAAC,IAAI,EACjB,wBAAwB,EACxB,UAAS,EAAE,EAAE;AACX,KAAC,CAAC,MAAM,CAAC,YAAY,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;GACrC,CAAC,CAAC;AAC5B,SAAO,YAAY,CAAC;CACrB,CACF,CAAC,CAAC","file":"default.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('defaultMode', [\n    'modes',\n    'settings',\n    'commonMode',\n    'game',\n    'template',\n    'gameTemplateSelection',\n    'gameModels',\n    'gameModelSelection',\n    'gameTerrainSelection',\n    function defaultModeServiceFactory(modesService,\n                                       settingsService,\n                                       commonModeService,\n                                       gameService,\n                                       templateService,\n                                       gameTemplateSelectionService,\n                                       gameModelsService,\n                                       gameModelSelectionService,\n                                       gameTerrainSelectionService) {\n      var default_actions = Object.create(commonModeService.actions);\n      function clearTerrainSelection(scope) {\n        scope.game.terrain_selection = gameTerrainSelectionService\n          .clear('local', scope, scope.game.terrain_selection);\n      }\n      function clearTemplateSelection(scope) {\n        scope.game.template_selection = gameTemplateSelectionService\n          .clear('local', scope, scope.game.template_selection);\n      }\n      default_actions.setModelSelection = function defaultSetModelSelection(scope, event) {\n        clearTerrainSelection(scope, event);\n        clearTemplateSelection(scope, event);\n        var stamp = event['click#'].target.state.stamp;\n        return gameService.executeCommand('setModelSelection', 'set', [stamp],\n                                          scope, scope.game);\n      };\n      default_actions.toggleModelSelection = function modelsToggleSelection(scope, event) {\n        clearTerrainSelection(scope, event);\n        clearTemplateSelection(scope, event);\n        var stamp = event['click#'].target.state.stamp;\n        if(gameModelSelectionService.in('local', stamp, scope.game.model_selection)) {\n          return gameService.executeCommand('setModelSelection', 'removeFrom', [stamp],\n                                            scope, scope.game);\n        }\n        else {\n          return gameService.executeCommand('setModelSelection', 'addTo', [stamp],\n                                            scope, scope.game);\n        }\n      };\n      default_actions.modelSelectionDetail = function defaultModelSelectionDetail(scope, event) {\n        clearTerrainSelection(scope, event);\n        clearTemplateSelection(scope, event);\n        var stamp = event['click#'].target.state.stamp;\n        scope.gameEvent('openSelectionDetail', 'model', event['click#'].target);\n        return gameService.executeCommand('setModelSelection', 'set', [stamp],\n                                          scope, scope.game);\n      };\n      default_actions.selectTemplate = function defaultSelectTemplate(scope, event) {\n        clearTerrainSelection(scope, event);\n        scope.game.template_selection =\n          gameTemplateSelectionService.set('local', [event['click#'].target.state.stamp],\n                                           scope, scope.game.template_selection);\n      };\n      default_actions.templateSelectionDetail = function defaultTemplateSelectionDetail(scope, event) {\n        clearTerrainSelection(scope, event);\n        scope.gameEvent('openSelectionDetail', 'template', event['click#'].target);\n        scope.game.template_selection =\n          gameTemplateSelectionService.set('local', [event['click#'].target.state.stamp],\n                                           scope, scope.game.template_selection);\n      };\n      default_actions.selectTerrain = function defaultSelectTerrain(scope, event) {\n        clearTemplateSelection(scope, event);\n        scope.game.terrain_selection =\n          gameTerrainSelectionService.set('local', [event['click#'].target.state.stamp],\n                                          scope, scope.game.terrain_selection);\n      };\n      default_actions.enterRulerMode = function defaultEnterRulerMode(scope) {\n        return scope.doSwitchToMode('Ruler');\n      };\n      default_actions.enterLosMode = function defaultEnterLosMode(scope) {\n        return scope.doSwitchToMode('LoS');\n      };\n      default_actions.dragStartMap = function defaultDragStartMap(scope, event) {\n        scope.gameEvent('enableDragbox', event.start, event.now);\n      };\n      default_actions.dragMap = function defaultDragMap(scope, event) {\n        scope.gameEvent('enableDragbox', event.start, event.now);\n      };\n      default_actions.dragEndMap = function defaultDragEndMap(scope, event) {\n        scope.gameEvent('disableDragbox');\n        var top_left = {\n          x: Math.min(event.now.x, event.start.x),\n          y: Math.min(event.now.y, event.start.y),\n        };\n        var bottom_right = {\n          x: Math.max(event.now.x, event.start.x),\n          y: Math.max(event.now.y, event.start.y),\n        };\n        return R.pipeP(\n          gameModelsService.findStampsBetweenPoints$(top_left, bottom_right),\n          function(stamps) {\n            if(R.isEmpty(stamps)) {\n              return;\n            }\n            \n            return gameService.executeCommand('setModelSelection', 'set', stamps,\n                                              scope, scope.game);\n          }\n        )(scope.game.models);\n      };\n\n      var default_default_bindings = {\n        enterRulerMode: 'ctrl+r',\n        enterLosMode: 'ctrl+l',\n        setModelSelection: 'clickModel',\n        toggleModelSelection: 'ctrl+clickModel',\n        modelSelectionDetail: 'rightClickModel',\n        selectTemplate: 'clickTemplate',\n        templateSelectionDetail: 'rightClickTemplate',\n        selectTerrain: 'clickTerrain',\n      };\n      var default_bindings = R.extend(Object.create(commonModeService.bindings),\n                                      default_default_bindings);\n      var default_buttons = [];\n      var default_mode = {\n        name: 'Default',\n        onEnter: function defaultOnEnter(scope) {\n          gameTemplateSelectionService\n            .checkMode(scope, scope.game.template_selection)\n            .catch(function() {\n              return gameTerrainSelectionService\n                .checkMode(scope, scope.game.terrain_selection);\n            })\n            .catch(function() {\n              return gameModelSelectionService\n                .checkMode(scope, scope.game.model_selection);\n            });\n        },\n        actions: default_actions,\n        buttons: default_buttons,\n        bindings: default_bindings,\n      };\n      modesService.registerMode(default_mode);\n      settingsService.register('Bindings',\n                               default_mode.name,\n                               default_default_bindings,\n                               function(bs) {\n                                 R.extend(default_mode.bindings, bs);\n                               });\n      return default_mode;\n    }\n  ]);\n"]}