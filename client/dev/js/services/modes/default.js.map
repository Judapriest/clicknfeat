{"version":3,"sources":["../../../es6/services/modes/default.js"],"names":[],"mappings":"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","file":"default.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('defaultMode', [\n    'modes',\n    'settings',\n    'commonMode',\n    'game',\n    'template',\n    'gameTemplateSelection',\n    'gameModels',\n    'gameModelSelection',\n    'gameTerrainSelection',\n    function defaultModeServiceFactory(modesService,\n                                       settingsService,\n                                       commonModeService,\n                                       gameService,\n                                       templateService,\n                                       gameTemplateSelectionService,\n                                       gameModelsService,\n                                       gameModelSelectionService,\n                                       gameTerrainSelectionService) {\n      let DEFAULT_MOVES = {\n        DragEpsilon: 3\n      };\n      let MOVES = R.clone(DEFAULT_MOVES);\n      settingsService.register('Moves',\n                               'Default',\n                               DEFAULT_MOVES,\n                               (moves) => {\n                                 R.extend(MOVES, moves);\n                               });\n      let default_actions = Object.create(commonModeService.actions);\n      function clearTemplateSelection$(state) {\n        return () => {\n          return state.event('Game.update', R.lensProp('template_selection'),\n                             gameTemplateSelectionService.clear$('local', state));\n        };\n      }\n      function clearTerrainSelection$(state) {\n        return () => {\n          return state.event('Game.update', R.lensProp('terrain_selection'),\n                             gameTerrainSelectionService.clear$('local', state));\n        };\n      }\n      default_actions.setModelSelection = (state, event) => {\n        return R.pipePromise(\n          clearTemplateSelection$(state),\n          clearTerrainSelection$(state),\n          () => {\n            var stamp = event['click#'].target.state.stamp;\n            return state.event('Game.command.execute',\n                               'setModelSelection', ['set', [stamp]]);\n          }\n        )();\n      };\n      default_actions.toggleModelSelection = (state, event) => {\n        return R.pipePromise(\n          clearTemplateSelection$(state),\n          clearTerrainSelection$(state),\n          () => {\n            var stamp = event['click#'].target.state.stamp;\n            if(gameModelSelectionService.in('local', stamp, state.game.model_selection)) {\n              return state.event('Game.command.execute',\n                                 'setModelSelection', ['removeFrom', [stamp]]);\n            }\n            else {\n              return state.event('Game.command.execute',\n                                 'setModelSelection', ['addTo', [stamp]]);\n            }\n          }\n        )();\n      };\n      default_actions.modelSelectionDetail = (state, event) => {\n        return R.pipePromise(\n          clearTemplateSelection$(state),\n          clearTerrainSelection$(state),\n          () => {\n            var stamp = event['click#'].target.state.stamp;\n            state.changeEvent('Game.selectionDetail.open',\n                              'model', event['click#'].target);\n            return state.event('Game.command.execute',\n                               'setModelSelection', ['set', [stamp]]);\n          }\n        )();\n      };\n      default_actions.selectTemplate = (state, event) => {\n        return R.pipePromise(\n          clearTerrainSelection$(state),\n          () => {\n            return state\n              .event('Game.update', R.lensProp('template_selection'),\n                     gameTemplateSelectionService.set$('local',\n                                                       [event['click#'].target.state.stamp],\n                                                       state));\n          }\n        )();\n      };\n      default_actions.templateSelectionDetail = (state, event) => {\n        return R.pipePromise(\n          clearTerrainSelection$(state),\n          () => {\n            return state\n              .event('Game.update', R.lensProp('template_selection'),\n                     gameTemplateSelectionService.set$('local',\n                                                       [event['click#'].target.state.stamp],\n                                                       state));\n          },\n          () => { return state.changeEvent('Game.selectionDetail.open',\n                                           'template', event['click#'].target); }\n        )();\n      };\n      default_actions.selectTerrain = (state, event) => {\n        return R.pipePromise(\n          clearTemplateSelection$(state),\n          () => {\n            return state\n              .event('Game.update', R.lensProp('terrain_selection'),\n                     gameTerrainSelectionService.set$('local',\n                                                      [event['click#'].target.state.stamp],\n                                                      state));\n          }\n        )();\n      };\n      default_actions.enterRulerMode = (state) => {\n        return state.event('Modes.switchTo', 'Ruler');\n      };\n      default_actions.enterLosMode = (state) => {\n        return state.event('Modes.switchTo', 'LoS');\n      };\n      default_actions.dragStartMap = (state, event) => {\n        state.changeEvent('Game.dragBox.enable', event.start, event.now);\n      };\n      default_actions.dragMap = (state, event) => {\n        state.changeEvent('Game.dragBox.enable', event.start, event.now);\n      };\n      default_actions.dragEndMap = (state, event) => {\n        state.changeEvent('Game.dragBox.disable');\n        var top_left = {\n          x: Math.min(event.now.x, event.start.x),\n          y: Math.min(event.now.y, event.start.y)\n        };\n        var bottom_right = {\n          x: Math.max(event.now.x, event.start.x),\n          y: Math.max(event.now.y, event.start.y)\n        };\n        return R.pipeP(\n          gameModelsService.findStampsBetweenPoints$(top_left, bottom_right),\n          function(stamps) {\n            if(R.isEmpty(stamps)) {\n              return null;\n            }\n            return state.event('Game.command.execute',\n                               'setModelSelection', ['set', stamps]);\n          }\n        )(state.game.models);\n      };\n\n      var default_default_bindings = {\n        enterRulerMode: 'ctrl+r',\n        enterLosMode: 'ctrl+l',\n        setModelSelection: 'clickModel',\n        toggleModelSelection: 'ctrl+clickModel',\n        modelSelectionDetail: 'rightClickModel',\n        selectTemplate: 'clickTemplate',\n        templateSelectionDetail: 'rightClickTemplate',\n        selectTerrain: 'clickTerrain'\n      };\n      var default_bindings = R.extend(Object.create(commonModeService.bindings),\n                                      default_default_bindings);\n      var default_buttons = [];\n      var default_mode = {\n        name: 'Default',\n        onEnter: (state) => {\n          gameTemplateSelectionService\n            .checkMode(state, state.game.template_selection)\n            .catch(() => {\n              return gameTerrainSelectionService\n                .checkMode(state, state.game.terrain_selection);\n            })\n            .catch(() => {\n              return gameModelSelectionService\n                .checkMode(state, state.game.model_selection);\n            })\n            .catch(R.always(null));\n        },\n        actions: default_actions,\n        buttons: default_buttons,\n        bindings: default_bindings,\n        moves: () => MOVES\n      };\n      modesService.registerMode(default_mode);\n      settingsService.register('Bindings',\n                               default_mode.name,\n                               default_default_bindings,\n                               (bs) => {\n                                 R.extend(default_mode.bindings, bs);\n                               });\n      return default_mode;\n    }\n  ]);\n"]}