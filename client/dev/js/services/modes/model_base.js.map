{"version":3,"sources":["../../../es6/services/modes/model_base.js"],"names":[],"mappings":"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","file":"model_base.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('modelBaseMode', [\n    'modes',\n    'settings',\n    'modelsMode',\n    'sprayTemplateMode',\n    'model',\n    'game',\n    'gameModels',\n    'gameModelSelection',\n    function modelBaseModeServiceFactory(modesService,\n                                         settingsService,\n                                         modelsModeService,\n                                         sprayTemplateModeService,\n                                         modelService,\n                                         gameService,\n                                         gameModelsService,\n                                         gameModelSelectionService\n                                        ) {\n      var model_actions = Object.create(modelsModeService.actions);\n      model_actions.createAoEOnModel = function modelCreateAoEModel(scope) {\n        var stamps = gameModelSelectionService.get('local', scope.game.model_selection);\n        return R.pipeP(\n          () => {\n            return gameModelsService.findStamp(stamps[0], scope.game.models);\n          },\n          (model) => {\n            var position = R.pick(['x','y'], model.state);\n            position.type = 'aoe';\n\n            return gameService.executeCommand('createTemplate', [position],\n                                              scope, scope.game);\n          }\n        )();\n      };\n      model_actions.createSprayOnModel = function modelCreateSprayModel(scope) {\n        var stamps = gameModelSelectionService.get('local', scope.game.model_selection);\n        return R.pipeP(\n          () => {\n            return gameModelsService.findStamp(stamps[0], scope.game.models);\n          },\n          (model) =>{\n            var position = R.pick(['x','y'], model.state);\n            position.type = 'spray';\n\n            return R.pipeP(\n              () => {\n                return gameService.executeCommand('createTemplate', [position],\n                                                  scope, scope.game);\n              },\n              () => {\n                // simulate set-origin-model in sprayTemplateMode\n                return sprayTemplateModeService\n                  .actions.setOriginModel(scope, { 'click#': { target: model } });\n              }\n            )();\n          }\n        )();\n      };\n      model_actions.selectAllFriendly = function modelSelectAllFriendly(scope) {\n        var selection = gameModelSelectionService.get('local', scope.game.model_selection);\n        return R.pipeP(\n          gameModelsService.findStamp$(selection[0]),\n          (model) => {\n            var stamps = R.pipe(\n              gameModelsService.all,\n              R.filter(modelService.userIs$(modelService.user(model))),\n              R.map(modelService.stamp)\n            )(scope.game.models);\n\n            return gameService.executeCommand('setModelSelection', 'set', stamps,\n                                              scope, scope.game);\n          }\n        )(scope.game.models);\n      };\n      model_actions.selectAllUnit = function modelSelectAllUnit(scope) {\n        var selection = gameModelSelectionService.get('local', scope.game.model_selection);\n        return R.pipeP(\n          gameModelsService.findStamp$(selection[0]),\n          (model) => {\n            var unit = modelService.unit(model);\n            if(R.isNil(unit)) {\n              return self.Promise.reject('Model not in unit');\n            }\n            \n            var stamps = R.pipe(\n              gameModelsService.all,\n              R.filter(modelService.userIs$(modelService.user(model))),\n              R.filter(modelService.unitIs$(unit)),\n              R.map(modelService.stamp)\n            )(scope.game.models);\n            \n            return gameService.executeCommand('setModelSelection', 'set', stamps,\n                                              scope, scope.game);\n          }\n        )(scope.game.models);\n      };\n      model_actions.setB2B = function modelSetB2B(scope, event) {\n        var stamps = gameModelSelectionService.get('local', scope.game.model_selection);\n        return R.pipeP(\n          () => {\n            return gameModelsService.findStamp(stamps[0], scope.game.models);\n          },\n          (model) => {\n            if(model.state.stamp === event['click#'].target.state.stamp) return null;\n            \n            return gameService.executeCommand('onModels', 'setB2B',\n                                              scope.factions, event['click#'].target,\n                                              stamps, scope, scope.game);\n          }\n        )();\n      };\n\n      var model_default_bindings = {\n        'createAoEOnModel': 'ctrl+a',\n        'createSprayOnModel': 'ctrl+s',\n        'selectAllUnit': 'ctrl+u',\n        'selectAllFriendly': 'ctrl+f',\n        'setB2B': 'ctrl+shift+clickModel',\n      };\n      var model_bindings = R.extend(Object.create(modelsModeService.bindings),\n                                    model_default_bindings);\n\n      var model_mode = {\n        onEnter: function modelOnEnter(/*scope*/) {\n        },\n        onLeave: function modelOnLeave(/*scope*/) {\n        },\n        name: 'ModelBase',\n        actions: model_actions,\n        buttons: [],\n        bindings: model_bindings,\n      };\n      settingsService.register('Bindings',\n                               model_mode.name,\n                               model_default_bindings,\n                               (bs) => {\n                                 R.extend(model_mode.bindings, bs);\n                               });\n      return model_mode;\n    }\n  ]);\n"]}