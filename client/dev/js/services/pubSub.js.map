{"version":3,"sources":["../../es6/services/pubSub.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,OAAO,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAChC,OAAO,CAAC,QAAQ,EAAE,CACjB,SAAS,oBAAoB,GAAG;;AAE9B,MAAI,WAAW,GAAG,SAAS,CAAC;AAC5B,MAAI,aAAa,GAAG;AAClB,QAAI,EAAE,SAAS,UAAU,CAAC,IAAI,EAAE;AAC9B,aAAO,CAAC,CAAC,IAAI,CACX,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,EACf,CAAC,CAAC,KAAK,CAAC,cAAc,EAAE,EAAE,CAAC,CAC5B,CAAC,IAAI,CAAC,CAAC;KACT;AACD,aAAS,EAAE,SAAS,eAAe,CAAC,KAAK,EAAE,QAAQ,EAAE,MAAM,EAAE;AAC3D,aAAO,CAAC,CAAC,IAAI,CACX,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,EACtB,UAAS,KAAK,EAAE;AACd,eAAO,CAAC,CAAC,IAAI,CACX,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,KAAK,CAAC,EACnB,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,EAClB,UAAS,SAAS,EAAE;AAClB,eAAK,CAAC,KAAK,CAAC,GAAG,SAAS,CAAC;AACzB,iBAAO,WAAW,CAAC,KAAK,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;SAC5C,CACF,CAAC,KAAK,CAAC,CAAC;OACV,CACF,CAAC,MAAM,CAAC,CAAC;KACX;AACD,WAAO,EAAE,SAAS,aAAa,CAAC,+BAAK,EAA4B;AAC/D,UAAI,IAAI,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;AACjD,OAAC,CAAC,IAAI,CACJ,CAAC,CAAC,IAAI,EACN,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,EACtB,eAAe,CAAC,KAAK,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EACpC,eAAe,CAAC,WAAW,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAC3C,CAAC,IAAI,CAAC,CAAC;KACT;GACF,CAAC;AACF,WAAS,WAAW,CAAC,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE;AAC3C,WAAO,SAAS,iBAAiB,GAAG;AAClC,WAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;KAC3D,CAAC;GACH;AACD,MAAI,eAAe,GAAG,CAAC,CAAC,KAAK,CAAC,SAAS,gBAAgB,CAAC,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE;AAC1E,QAAI,SAAS,GAAG,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;AAC3C,QAAI,CAAC,GAAG,CAAC,CAAC;AACV,QAAI,CAAC,qBAAqB,CAAC,SAAS,cAAc,GAAG;AACnD,UAAG,CAAC,IAAI,SAAS,CAAC,MAAM,EAAE,OAAO;;AAEjC,eAAS,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AAC/B,OAAC,EAAE,CAAC;AACJ,UAAI,CAAC,qBAAqB,CAAC,cAAc,CAAC,CAAC;KAC5C,CAAC,CAAC;AACH,WAAO,KAAK,CAAC;GACd,CAAC,CAAC;AACH,GAAC,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;AAC9B,SAAO,aAAa,CAAC;CACtB,CACF,CAAC,CAAC","file":"pubSub.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.services')\n  .factory('pubSub', [\n    function pubSubServiceFactory() {\n      // Subscribe to this event to see all events\n      var WATCH_EVENT = '#watch#';\n      var pubSubService = {\n        init: function pubSubInit(data) {\n          return R.pipe(\n            R.defaultTo({}),\n            R.assoc('_pubSubCache', {})\n          )(data);\n        },\n        subscribe: function pubSubSubscribe(event, listener, pubSub) {\n          return R.pipe(\n            R.prop('_pubSubCache'),\n            function(cache) {\n              return R.pipe(\n                R.propOr([], event),\n                R.append(listener),\n                function(listeners) {\n                  cache[event] = listeners;\n                  return unsubscribe(event, listener, cache);\n                }\n              )(cache);\n            }\n          )(pubSub);\n        },\n        publish: function pubSubPublish(event /*, ...args..., pubSub */) {\n          var args = Array.prototype.slice.call(arguments);\n          R.pipe(\n            R.last,\n            R.prop('_pubSubCache'),\n            signalListeners(event, R.init(args)),\n            signalListeners(WATCH_EVENT, R.init(args))\n          )(args);\n        }\n      };\n      function unsubscribe(event, listener, cache) {\n        return function pubSubUnsubscribe() {\n          cache[event] = R.reject(R.equals(listener), cache[event]);\n        };\n      }\n      var signalListeners = R.curry(function _signalListeners(event, args, cache) {\n        var listeners = R.propOr([], event, cache);\n        var i = 0;\n        self.requestAnimationFrame(function signalListener() {\n          if(i >= listeners.length) return;\n\n          listeners[i].apply(null, args);\n          i++;\n          self.requestAnimationFrame(signalListener);\n        });\n        return cache;\n      });\n      R.curryService(pubSubService);\n      return pubSubService;\n    }\n  ]);\n"]}