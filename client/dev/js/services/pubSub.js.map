{"version":3,"sources":["../../es6/services/pubSub.js"],"names":[],"mappings":"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","file":"pubSub.js","sourcesContent":["angular.module('clickApp.services')\n  .factory('pubSub', [\n    function pubSubServiceFactory() {\n      // Subscribe to this event to see all events\n      var WATCH_EVENT = '#watch#';\n      var pubSubService = {\n        init: function pubSubInit(data, name = 'channel') {\n          return R.pipe(\n            R.defaultTo({}),\n            R.assoc('_pubSubName', name),\n            R.assoc('_pubSubCache', {})\n          )(data);\n        },\n        subscribe: function pubSubSubscribe(event, listener, pubSub) {\n          return R.pipe(\n            R.prop('_pubSubCache'),\n            (cache) => {\n              return R.pipe(\n                R.propOr([], event),\n                R.append(listener),\n                (listeners) => {\n                  cache[event] = listeners;\n                  // console.log(pubSub._pubSubName, event, listeners.length);\n                  return unsubscribe(event, listener, cache);\n                }\n              )(cache);\n            }\n          )(pubSub);\n        },\n        publish: function pubSubPublish(...args /*, pubSub */) {\n          var [event] = args;\n          return R.pipePromise(\n            R.last,\n            signalListeners(event, R.init(args)),\n            signalListeners(WATCH_EVENT, R.init(args))\n          )(args);\n        }\n      };\n      function unsubscribe(event, listener, cache) {\n        return () => {\n          cache[event] = R.reject(R.equals(listener), cache[event]);\n        };\n      }\n      var signalListeners = R.curry((event, args, channel) => {\n        return R.pipePromise(\n          R.pathOr([], ['_pubSubCache', event]),\n          (listeners) => {\n            if(R.isEmpty(listeners) &&\n               event !== WATCH_EVENT) {\n              console.warn(`Event: \"${channel._pubSubName}>${event}\" with no listeners`);\n            }\n            return listeners;\n          },\n          R.map((listener) => {\n            return new self.Promise((resolve) => {\n              let ret;\n              try {\n                ret = listener.apply(null, args);\n              }\n              catch(error) {\n                console.error(`Listener error: \"${channel._pubSubName}>${event}\"`,\n                              listener, error);\n              }\n              resolve(ret);\n            });\n          }),\n          R.promiseAll,\n          R.always(channel)\n        )(channel);\n      });\n      R.curryService(pubSubService);\n      return pubSubService;\n    }\n  ]);\n"]}