{"version":3,"sources":["../../../es6/controllers/game/saveCtrl.js"],"names":[],"mappings":"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","file":"saveCtrl.js","sourcesContent":["'use strict';\n\nangular.module('clickApp.controllers')\n  .controller('gameSaveCtrl', [\n    '$scope',\n    'fileExport',\n    'game',\n    'gameModels',\n    'gameModelSelection',\n    'gameTerrains',\n    function($scope,\n             fileExportService,\n             gameService,\n             gameModelsService,\n             gameModelSelectionService,\n             gameTerrainsService) {\n      console.log('init gameSaveCtrl');\n      \n      $scope.save = {\n        name: 'clicknfeat_game.json',\n        url: null\n      };\n      $scope.selection_save = {\n        name: 'clicknfeat_models.json',\n        url: null\n      };\n      $scope.board_save = {\n        name: 'clicknfeat_board.json',\n        url: null\n      };\n      function cleanup() {\n        fileExportService.cleanup($scope.save.url);\n        $scope.save.url = null;\n        fileExportService.cleanup($scope.selection_save.url);\n        $scope.selection_save.url = null;\n        fileExportService.cleanup($scope.board_save.url);\n        $scope.board_save.url = null;\n      }\n      $scope.updateExports = function updateExports() {\n        cleanup();\n        \n        fileExportService.generate('json', $scope.game)\n          .then(function(url) {\n            $scope.save.url = url;\n            $scope.$digest();\n          });\n\n        var stamps = gameModelSelectionService.get('local', $scope.game.model_selection);\n        R.pipeP(\n          gameModelsService.copyStamps$(stamps),\n          fileExportService.generate$('json'),\n          function(url) {\n            $scope.selection_save.url = url;\n            $scope.$digest();\n          }\n        )($scope.game.models);\n\n        let board = {\n          board: $scope.game.board,\n          terrain: {\n            base: { x: 0, y: 0, r: 0 },\n            terrains: R.pipe(\n              gameTerrainsService.all,\n              R.pluck('state'),\n              R.map(R.pick(['x','y','r','info','lk']))\n            )($scope.game.terrains)\n          }\n        };\n        R.pipeP(\n          fileExportService.generate$('json'),\n          function(url) {\n            $scope.board_save.url = url;\n            $scope.$digest();\n          }\n        )(board);\n      };\n      $scope.$on('$destroy', cleanup);\n      $scope.onGameLoad.then(function onGameLoad() {\n        $scope.updateExports();\n      });\n\n      $scope.onGameEvent('saveGame', function onSaveGame() {\n        $scope.updateExports();\n      }, $scope);\n    }\n  ]);\n"]}